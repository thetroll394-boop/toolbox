<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToolBox â€” Adam yang Ganteng</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=Space+Mono:wght@400;700&family=Noto+Sans:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Noto+Sans+Thai:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0a0f;--surface:#13131a;--surface2:#1c1c28;--border:#2a2a3d;--accent:#7c3aed;--accent2:#06b6d4;--accent3:#f59e0b;--text:#e8e8f0;--muted:#6b6b8a;--success:#10b981;--danger:#ef4444;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Space Mono',monospace;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(124,58,237,0.05) 1px,transparent 1px),linear-gradient(90deg,rgba(124,58,237,0.05) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
.container{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 20px;}
header{padding:40px 0 20px;text-align:center;border-bottom:1px solid var(--border);margin-bottom:32px;}
header h1{font-family:'Syne',sans-serif;font-size:clamp(2rem,6vw,3.5rem);font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-2px;}
header p{color:var(--muted);margin-top:8px;font-size:0.8rem;letter-spacing:2px;text-transform:uppercase;}
.tool-tabs{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:28px;justify-content:center;}
.tab-btn{padding:7px 13px;background:var(--surface);border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.7rem;cursor:pointer;border-radius:4px;transition:all 0.2s;text-transform:uppercase;letter-spacing:1px;}
.tab-btn:hover{border-color:var(--accent);color:var(--text);}
.tab-btn.active{background:var(--accent);border-color:var(--accent);color:#fff;}
.tool-panel{display:none;animation:fadeIn 0.3s ease;}
.tool-panel.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.panel-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:28px;margin-bottom:16px;}
.panel-title{font-family:'Syne',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:4px;}
.panel-desc{color:var(--muted);font-size:0.75rem;margin-bottom:20px;letter-spacing:1px;}
textarea,input[type="text"],input[type="number"],select{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);font-family:'Space Mono',monospace;font-size:0.82rem;padding:10px 14px;border-radius:8px;outline:none;transition:border-color 0.2s;resize:vertical;}
textarea:focus,input[type="text"]:focus,input[type="number"]:focus,select:focus{border-color:var(--accent);}
textarea{min-height:100px;}
label{display:block;font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px;margin-top:14px;}
label:first-child{margin-top:0;}
.btn{padding:9px 18px;border:none;border-radius:6px;font-family:'Space Mono',monospace;font-size:0.75rem;font-weight:700;cursor:pointer;transition:all 0.2s;text-transform:uppercase;letter-spacing:1px;}
.btn-primary{background:var(--accent);color:#fff;}.btn-primary:hover{background:#6d28d9;transform:translateY(-1px);}
.btn-secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border);}.btn-secondary:hover{border-color:var(--accent);}
.btn-cyan{background:var(--accent2);color:#000;}.btn-cyan:hover{opacity:0.9;}
.btn-group{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;}
.output-box{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;font-size:0.82rem;line-height:1.7;margin-top:14px;word-break:break-all;min-height:56px;color:var(--accent2);white-space:pre-wrap;position:relative;}
.copy-btn{position:absolute;top:8px;right:8px;background:var(--surface2);border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.65rem;padding:3px 9px;border-radius:4px;cursor:pointer;transition:all 0.2s;}
.copy-btn:hover{color:var(--text);border-color:var(--accent);}
.copy-btn.copied{color:var(--success);border-color:var(--success);}
.stats-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;}
.stat-chip{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:6px 12px;font-size:0.72rem;}
.stat-chip span{color:var(--accent3);font-weight:700;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
@media(max-width:600px){.grid-2{grid-template-columns:1fr;}}
.strength-bar{height:4px;background:var(--border);border-radius:2px;margin-top:10px;overflow:hidden;}
.strength-fill{height:100%;border-radius:2px;transition:width 0.3s,background 0.3s;}
input[type="color"]{width:54px;height:38px;border:1px solid var(--border);border-radius:6px;background:var(--bg);cursor:pointer;padding:2px;}
input[type="range"]{width:100%;accent-color:var(--accent);background:transparent;margin:6px 0;}
.toggle-row{display:flex;align-items:center;gap:10px;margin-top:10px;font-size:0.78rem;color:var(--muted);}
.toggle-row input[type="checkbox"]{width:14px;height:14px;accent-color:var(--accent);}
/* Calc */
.calc-btn{padding:14px 6px;background:var(--surface2);border:1px solid var(--border);color:var(--text);font-family:'Space Mono',monospace;font-size:0.95rem;font-weight:700;border-radius:8px;cursor:pointer;transition:all 0.15s;width:100%;}
.calc-btn:hover{background:var(--border);transform:scale(1.04);}
.calc-btn:active{transform:scale(0.96);}
.calc-btn.calc-op{background:rgba(124,58,237,0.2);border-color:var(--accent);color:var(--accent2);}
.calc-btn.calc-eq{background:var(--accent);border-color:var(--accent);color:#fff;font-size:1.1rem;}
.calc-btn.calc-eq:hover{background:#6d28d9;}
.calc-btn.calc-fn{background:var(--surface);color:var(--muted);font-size:0.75rem;}
.calc-btn.calc-fn:hover{color:var(--text);border-color:var(--accent);}
/* Translate */
.lang-output{font-family:'Noto Sans SC','Noto Sans JP','Noto Sans KR','Noto Sans Arabic','Noto Sans Thai','Noto Sans Devanagari','Noto Sans','Space Mono',sans-serif;font-size:0.9rem;line-height:2;}
.phrase-btn{background:var(--surface2);border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.7rem;padding:5px 11px;border-radius:20px;cursor:pointer;transition:all 0.2s;}
.phrase-btn:hover{border-color:var(--accent2);color:var(--accent2);}
@keyframes spin{to{transform:rotate(360deg)}}
.tr-spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;display:inline-block;margin-right:8px;vertical-align:middle;}
/* About badge */
.about-badge{background:var(--surface2);border:1px solid var(--border);color:var(--muted);font-size:0.7rem;padding:4px 11px;border-radius:20px;cursor:default;transition:all 0.2s;}
.about-badge:hover{border-color:var(--accent);color:var(--text);}
/* Gradient presets */
.gr-preset{height:36px;border-radius:6px;cursor:pointer;border:1px solid var(--border);transition:transform 0.2s;}
.gr-preset:hover{transform:scale(1.06);}
/* CSV table */
#csv-table-wrap table{width:100%;border-collapse:collapse;font-size:0.8rem;}
#csv-table-wrap th{background:var(--surface2);border:1px solid var(--border);padding:7px 11px;text-align:left;color:var(--accent2);}
#csv-table-wrap td{border:1px solid var(--border);padding:5px 11px;color:var(--text);}
/* Markdown */
.md-body h1,.md-body h2,.md-body h3{font-family:'Syne',sans-serif;color:var(--accent2);margin:12px 0 6px;}
.md-body p{margin:6px 0;line-height:1.8;}
.md-body code{background:var(--surface2);padding:2px 5px;border-radius:4px;color:var(--accent3);font-size:0.82rem;}
.md-body pre{background:var(--surface2);padding:12px;border-radius:6px;overflow-x:auto;margin:8px 0;}
.md-body blockquote{border-left:3px solid var(--accent);padding-left:12px;color:var(--muted);margin:6px 0;}
.md-body hr{border:none;border-top:1px solid var(--border);margin:14px 0;}
.md-body a{color:var(--accent2);text-decoration:underline;}
.md-body li{margin-left:20px;margin-bottom:3px;}
.md-body mark{background:rgba(124,58,237,0.35);color:var(--text);border-radius:3px;padding:1px 2px;}
/* Notif */
.notif{position:fixed;bottom:22px;right:22px;background:var(--success);color:#000;font-family:'Space Mono',monospace;font-size:0.78rem;padding:10px 18px;border-radius:8px;z-index:1000;opacity:0;transform:translateY(10px);transition:all 0.3s;pointer-events:none;}
.notif.show{opacity:1;transform:translateY(0);}
/* Badge */
.badge{display:inline-block;background:var(--surface2);border:1px solid var(--border);padding:3px 9px;border-radius:20px;font-size:0.68rem;color:var(--muted);margin:3px;}
footer{text-align:center;padding:36px 0;color:var(--muted);font-size:0.72rem;letter-spacing:2px;border-top:1px solid var(--border);margin-top:50px;}
.active-filter{border-color:var(--accent)!important;color:var(--accent2)!important;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:600px){.grid-2{grid-template-columns:1fr;}}

/* AI Chat */
.ai-msg{display:flex;gap:10px;align-items:flex-start;}
.ai-msg.ai-user{flex-direction:row-reverse;}
.ai-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;background:var(--surface2);border:1px solid var(--border);}
.ai-bubble{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:10px 14px;font-size:0.83rem;line-height:1.6;color:var(--text);max-width:85%;}
.ai-msg.ai-user .ai-bubble{background:rgba(124,58,237,0.15);border-color:var(--accent);}
.ai-msg.ai-bot .ai-bubble{border-color:var(--border);}
.ai-typing span{display:inline-block;width:6px;height:6px;background:var(--muted);border-radius:50%;animation:typing 1s infinite;}
.ai-typing span:nth-child(2){animation-delay:0.2s;}
.ai-typing span:nth-child(3){animation-delay:0.4s;}
@keyframes typing{0%,80%,100%{transform:scale(0.7);opacity:0.5;}40%{transform:scale(1);opacity:1;}}

/* Noise cards */
.noise-card.active{border-color:var(--accent)!important;background:rgba(124,58,237,0.1)!important;}

/* Game canvas */
#game-canvas{cursor:pointer;}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>âš¡ TOOLBOX</h1>
    <p>Kumpulan tools berguna â€” gratis, cepat, privat</p>
  </header>
  <div class="tool-tabs">
    <button class="tab-btn active" onclick="sw('text',this)">ğŸ“ Text</button>
    <button class="tab-btn" onclick="sw('password',this)">ğŸ” Password</button>
    <button class="tab-btn" onclick="sw('base64',this)">ğŸ”„ Base64</button>
    <button class="tab-btn" onclick="sw('json',this)">ğŸ“¦ JSON</button>
    <button class="tab-btn" onclick="sw('color',this)">ğŸ¨ Warna</button>
    <button class="tab-btn" onclick="sw('unit',this)">ğŸ“ Unit</button>
    <button class="tab-btn" onclick="sw('hash',this)">ğŸ”‘ Hash</button>
    <button class="tab-btn" onclick="sw('time',this)">â° Waktu</button>
    <button class="tab-btn" onclick="sw('calc',this)">ğŸ§® Kalkulator</button>
    <button class="tab-btn" onclick="sw('translate',this)">ğŸŒ Translate</button>
    <button class="tab-btn" onclick="sw('qr',this)">ğŸ“· QR Code</button>
    <button class="tab-btn" onclick="sw('random',this)">ğŸ² Random</button>
    <button class="tab-btn" onclick="sw('markdown',this)">ğŸ“„ Markdown</button>
    <button class="tab-btn" onclick="sw('regex',this)">ğŸ” Regex</button>
    <button class="tab-btn" onclick="sw('timer',this)">â±ï¸ Timer</button>
    <button class="tab-btn" onclick="sw('csv',this)">ğŸ“Š CSVâ†’Tabel</button>
    <button class="tab-btn" onclick="sw('gradient',this)">ğŸŒˆ Gradient</button>
    <button class="tab-btn" onclick="sw('minifier',this)">ğŸ—œï¸ Minifier</button>
    <button class="tab-btn" onclick="sw('todo',this)">ğŸ“‹ To-Do</button>
    <button class="tab-btn" onclick="sw('notepad',this)">ğŸ—’ï¸ Notepad</button>
    <button class="tab-btn" onclick="sw('currency',this)">ğŸ’± Kurs</button>
    <button class="tab-btn" onclick="sw('weather',this)">ğŸŒ¤ï¸ Cuaca</button>
    <button class="tab-btn" onclick="sw('imgcomp',this)">ğŸ–¼ï¸ Kompres</button>
    <button class="tab-btn" onclick="sw('fontprev',this)">ğŸ”¤ Font</button>
    <button class="tab-btn" onclick="sw('snippet',this)">ğŸ’» Snippet</button>
    <button class="tab-btn" onclick="sw('aspect',this)">ğŸ“ Aspek</button>
    <button class="tab-btn" onclick="sw('about',this)">ğŸ‘¤ Tentang</button>
    <button class="tab-btn" onclick="sw('calendar',this)">ğŸ“… Kalender</button>
    <button class="tab-btn" onclick="sw('budget',this)">ğŸ’° Budget</button>
    <button class="tab-btn" onclick="sw('habit',this)">ğŸ¯ Habit</button>
    <button class="tab-btn" onclick="sw('flashcard',this)">ğŸ“– Flashcard</button>
    <button class="tab-btn" onclick="sw('videogif',this)">ğŸ¬ Videoâ†’GIF</button>
    <button class="tab-btn" onclick="sw('meme',this)">ğŸ–¼ï¸ Meme</button>
    <button class="tab-btn" onclick="sw('bpm',this)">ğŸµ BPM</button>
    <button class="tab-btn" onclick="sw('urlqr',this)">ğŸŒ URL+QR</button>
    <button class="tab-btn" onclick="sw('calendar',this)">ğŸ“… Kalender</button>
    <button class="tab-btn" onclick="sw('budget',this)">ğŸ’° Budget</button>
    <button class="tab-btn" onclick="sw('habit',this)">ğŸ¯ Habit</button>
    <button class="tab-btn" onclick="sw('flashcard',this)">ğŸ“– Flashcard</button>
    <button class="tab-btn" onclick="sw('videogif',this)">ğŸ¬ Videoâ†’GIF</button>
    <button class="tab-btn" onclick="sw('meme',this)">ğŸ–¼ï¸ Meme</button>
    <button class="tab-btn" onclick="sw('bpm',this)">ğŸµ BPM</button>
    <button class="tab-btn" onclick="sw('urlqr',this)">ğŸŒ URL+QR</button>
    <button class="tab-btn" onclick="sw('pomodoro',this)">ğŸ¯ Pomodoro</button>
    <button class="tab-btn" onclick="sw('tts',this)">ğŸ¤ TTS</button>
    <button class="tab-btn" onclick="sw('ocr',this)">ğŸ“¸ OCR</button>
    <button class="tab-btn" onclick="sw('ageCalc',this)">ğŸ§® Umur</button>
    <button class="tab-btn" onclick="sw('noise',this)">ğŸŒŠ Noise</button>
    <button class="tab-btn" onclick="sw('glass',this)">ğŸ¨ Glassmorphism</button>
    <button class="tab-btn" onclick="sw('mockup',this)">ğŸ“± Mockup</button>
    <button class="tab-btn" onclick="sw('numSys',this)">ğŸ”¢ Bilangan</button>
    <button class="tab-btn" onclick="sw('games',this)">ğŸ® Games</button>
    <button class="tab-btn" onclick="sw('aihelp',this)">ğŸ¤– AI Support</button>
    <button class="tab-btn" onclick="sw('mindmap',this)">ğŸ§  Mindmap</button>
    <button class="tab-btn" onclick="sw('morse',this)">ğŸµ Morse</button>
    <button class="tab-btn" onclick="sw('worldclock',this)">ğŸŒ World Clock</button>
    <button class="tab-btn" onclick="sw('fakedata',this)">ğŸ”® Fake Data</button>
    <button class="tab-btn" onclick="sw('palette',this)">ğŸ¨ Palette</button>
    <button class="tab-btn" onclick="sw('chartgen',this)">ğŸ“Š Chart</button>
    <button class="tab-btn" onclick="sw('cipher',this)">ğŸ” Enkripsi</button>
    <button class="tab-btn" onclick="sw('ascii',this)">ğŸ–‹ï¸ ASCII Art</button>
  </div>

  <!-- TEXT -->
  <div id="tab-text" class="tool-panel active">
    <div class="panel-card">
      <div class="panel-title">Text Analyzer & Converter</div>
      <div class="panel-desc">// Hitung & ubah format teks</div>
      <label>Masukkan Teks</label>
      <textarea id="text-input" placeholder="Ketik atau paste teks..." oninput="analyzeText()"></textarea>
      <div class="stats-row">
        <div class="stat-chip">Karakter: <span id="sc">0</span></div>
        <div class="stat-chip">Kata: <span id="sw2">0</span></div>
        <div class="stat-chip">Kalimat: <span id="ss">0</span></div>
        <div class="stat-chip">Baris: <span id="sl">0</span></div>
        <div class="stat-chip">No Spasi: <span id="sn">0</span></div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="cvCase('upper')">UPPERCASE</button>
        <button class="btn btn-primary" onclick="cvCase('lower')">lowercase</button>
        <button class="btn btn-primary" onclick="cvCase('title')">Title Case</button>
        <button class="btn btn-secondary" onclick="cvCase('reverse')">esreveR</button>
        <button class="btn btn-secondary" onclick="cvCase('trim')">Trim Spasi</button>
        <button class="btn btn-secondary" onclick="cvCase('slug')">slug-case</button>
      </div>
      <div class="output-box" id="text-out">â€”<button class="copy-btn" onclick="cpOut('text-out')">COPY</button></div>
    </div>
  </div>

  <!-- PASSWORD -->
  <div id="tab-password" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Password Generator</div>
      <div class="panel-desc">// Buat password kuat secara kriptografis aman</div>
      <label>Panjang: <span id="pld">16</span> karakter</label>
      <input type="range" id="plen" min="6" max="128" value="16" oninput="document.getElementById('pld').textContent=this.value;genPass()">
      <div class="toggle-row"><input type="checkbox" id="pu" checked onchange="genPass()"> Huruf Besar (A-Z)</div>
      <div class="toggle-row"><input type="checkbox" id="pl" checked onchange="genPass()"> Huruf Kecil (a-z)</div>
      <div class="toggle-row"><input type="checkbox" id="pn" checked onchange="genPass()"> Angka (0-9)</div>
      <div class="toggle-row"><input type="checkbox" id="ps" onchange="genPass()"> Simbol (!@#$...)</div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="genPass()">ğŸ² Generate</button>
        <button class="btn btn-secondary" onclick="genPassMulti()">Generate 5x</button>
      </div>
      <div class="output-box" id="pass-out">â€”<button class="copy-btn" onclick="cpOut('pass-out')">COPY</button></div>
      <div class="strength-bar"><div class="strength-fill" id="sfill" style="width:0%"></div></div>
      <div style="margin-top:5px;font-size:0.72rem;color:var(--muted)" id="slabel"></div>
    </div>
  </div>

  <!-- BASE64 -->
  <div id="tab-base64" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Base64 & URL Encoder</div>
      <div class="panel-desc">// Encode & decode Base64 dan URL</div>
      <label>Input</label>
      <textarea id="b64-in" placeholder="Teks atau Base64..."></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="b64('encode')">Encode â†’ Base64</button>
        <button class="btn btn-cyan" onclick="b64('decode')">Decode â† Base64</button>
        <button class="btn btn-secondary" onclick="b64('url-enc')">URL Encode</button>
        <button class="btn btn-secondary" onclick="b64('url-dec')">URL Decode</button>
      </div>
      <div class="output-box" id="b64-out">â€”<button class="copy-btn" onclick="cpOut('b64-out')">COPY</button></div>
    </div>
  </div>

  <!-- JSON -->
  <div id="tab-json" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">JSON Formatter & Validator</div>
      <div class="panel-desc">// Format, minify, validasi JSON</div>
      <textarea id="json-in" placeholder='{"nama":"Adam","ganteng":true}' style="min-height:160px;"></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="fmtJson('pretty')">âœ¨ Beautify</button>
        <button class="btn btn-secondary" onclick="fmtJson('minify')">Minify</button>
        <button class="btn btn-secondary" onclick="fmtJson('validate')">Validasi</button>
        <button class="btn btn-secondary" onclick="fmtJson('keys')">Keys</button>
      </div>
      <div class="output-box" id="json-out" style="min-height:120px;">â€”<button class="copy-btn" onclick="cpOut('json-out')">COPY</button></div>
    </div>
  </div>

  <!-- COLOR -->
  <div id="tab-color" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Color Converter</div>
      <div class="panel-desc">// Konversi HEX, RGB, HSL</div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:8px;">
        <input type="color" id="cpicker" value="#7c3aed" oninput="fromPicker()">
        <input type="text" id="chex" value="#7c3aed" style="width:160px" oninput="fromHex()">
        <button class="btn btn-cyan" onclick="randColor()">ğŸ² Random</button>
      </div>
      <div id="cpreview" style="height:80px;border-radius:8px;margin-top:14px;border:1px solid var(--border);background:#7c3aed;transition:background 0.3s;"></div>
      <div class="stats-row">
        <div class="stat-chip">HEX: <span id="cvhex">#7c3aed</span></div>
        <div class="stat-chip">RGB: <span id="cvrgb">rgb(124,58,237)</span></div>
        <div class="stat-chip">HSL: <span id="cvhsl">hsl(262,84%,58%)</span></div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="copyText(document.getElementById('cvhex').textContent)">Copy HEX</button>
        <button class="btn btn-secondary" onclick="copyText(document.getElementById('cvrgb').textContent)">Copy RGB</button>
        <button class="btn btn-secondary" onclick="copyText(document.getElementById('cvhsl').textContent)">Copy HSL</button>
      </div>
    </div>
  </div>

  <!-- UNIT -->
  <div id="tab-unit" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Unit Converter</div>
      <div class="panel-desc">// Konversi berbagai satuan</div>
      <label>Kategori</label>
      <select id="ucat" onchange="updateUnits()">
        <option value="length">Panjang</option><option value="weight">Berat</option>
        <option value="temp">Suhu</option><option value="area">Luas</option>
        <option value="speed">Kecepatan</option><option value="data">Data Digital</option>
      </select>
      <div class="grid-2" style="margin-top:14px;">
        <div><label>Dari</label><select id="ufrom"></select><input type="number" id="uval" value="1" oninput="cvUnit()" style="margin-top:8px;"></div>
        <div><label>Ke</label><select id="uto"></select><div class="output-box" id="uout" style="margin-top:8px;min-height:44px;">â€”</div></div>
      </div>
      <button class="btn btn-secondary" onclick="swapUnit()" style="margin-top:10px;">â‡„ Swap</button>
    </div>
  </div>

  <!-- HASH -->
  <div id="tab-hash" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Hash Generator</div>
      <div class="panel-desc">// DJB2, FNV-1a, CRC32, SHA-256</div>
      <textarea id="hash-in" placeholder="Teks untuk di-hash..."></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="doHash('djb2')">DJB2</button>
        <button class="btn btn-primary" onclick="doHash('fnv')">FNV-1a</button>
        <button class="btn btn-cyan" onclick="doHash('sha256')">SHA-256</button>
        <button class="btn btn-secondary" onclick="doHash('crc32')">CRC32</button>
      </div>
      <div class="output-box" id="hash-out">â€”<button class="copy-btn" onclick="cpOut('hash-out')">COPY</button></div>
    </div>
  </div>

  <!-- TIME -->
  <div id="tab-time" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Timestamp & Waktu</div>
      <div class="panel-desc">// Konversi Unix timestamp & selisih tanggal</div>
      <div class="stats-row">
        <div class="stat-chip">Unix Now: <span id="tsn">â€”</span></div>
        <div class="stat-chip">ISO: <span id="tsiso">â€”</span></div>
        <div class="stat-chip">WIB: <span id="tswib">â€”</span></div>
      </div>
      <label style="margin-top:20px;">Unix Timestamp â†’ Tanggal</label>
      <input type="number" id="tsin" placeholder="1700000000">
      <div class="btn-group">
        <button class="btn btn-primary" onclick="cvTs()">Konversi</button>
        <button class="btn btn-secondary" onclick="document.getElementById('tsin').value=Math.floor(Date.now()/1000)">Sekarang</button>
      </div>
      <div class="output-box" id="ts-out">â€”<button class="copy-btn" onclick="cpOut('ts-out')">COPY</button></div>
      <label style="margin-top:20px;">Selisih 2 Tanggal</label>
      <div class="grid-2">
        <div><label>Dari</label><input type="text" id="dfrom" placeholder="2024-01-01"></div>
        <div><label>Sampai</label><input type="text" id="dto" placeholder="2025-01-01"></div>
      </div>
      <div class="btn-group"><button class="btn btn-cyan" onclick="cvDiff()">Hitung</button></div>
      <div class="output-box" id="diff-out">â€”</div>
    </div>
  </div>

  <!-- CALCULATOR -->
  <div id="tab-calc" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Kalkulator</div>
      <div class="panel-desc">// Standar, Saintifik, Persen, Cicilan</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;">
        <button class="btn btn-primary" id="cm-std" onclick="setCalcMode('std')">Standar</button>
        <button class="btn btn-secondary" id="cm-sci" onclick="setCalcMode('sci')">Saintifik</button>
        <button class="btn btn-secondary" id="cm-pct" onclick="setCalcMode('pct')">Persen</button>
        <button class="btn btn-secondary" id="cm-loan" onclick="setCalcMode('loan')">Cicilan</button>
      </div>
      <!-- Standard -->
      <div id="calc-std">
        <div id="chist" style="min-height:20px;font-size:0.7rem;color:var(--muted);text-align:right;"></div>
        <div id="cdisp" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 18px;font-size:2rem;text-align:right;color:var(--accent2);margin-bottom:10px;min-height:66px;word-break:break-all;">0</div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:7px;">
          <button class="calc-btn calc-fn" onclick="cFn('AC')">AC</button><button class="calc-btn calc-fn" onclick="cFn('+/-')">+/-</button><button class="calc-btn calc-fn" onclick="cFn('%')">%</button><button class="calc-btn calc-op" onclick="cOp('/')">Ã·</button>
          <button class="calc-btn" onclick="cNum('7')">7</button><button class="calc-btn" onclick="cNum('8')">8</button><button class="calc-btn" onclick="cNum('9')">9</button><button class="calc-btn calc-op" onclick="cOp('*')">Ã—</button>
          <button class="calc-btn" onclick="cNum('4')">4</button><button class="calc-btn" onclick="cNum('5')">5</button><button class="calc-btn" onclick="cNum('6')">6</button><button class="calc-btn calc-op" onclick="cOp('-')">âˆ’</button>
          <button class="calc-btn" onclick="cNum('1')">1</button><button class="calc-btn" onclick="cNum('2')">2</button><button class="calc-btn" onclick="cNum('3')">3</button><button class="calc-btn calc-op" onclick="cOp('+')">+</button>
          <button class="calc-btn" onclick="cNum('0')" style="grid-column:span 2;">0</button><button class="calc-btn" onclick="cNum('.')">.</button><button class="calc-btn calc-eq" onclick="cEq()">=</button>
        </div>
        <div style="text-align:right;margin-top:7px;"><button class="calc-btn calc-fn" onclick="cFn('back')" style="width:auto;padding:7px 18px;">âŒ«</button></div>
      </div>
      <!-- Scientific -->
      <div id="calc-sci" style="display:none;">
        <div id="schist" style="min-height:20px;font-size:0.7rem;color:var(--muted);text-align:right;"></div>
        <div id="scdisp" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 18px;font-size:1.7rem;text-align:right;color:var(--accent2);margin-bottom:10px;min-height:66px;">0</div>
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;">
          <button class="calc-btn calc-fn" onclick="scFn('sin')">sin</button><button class="calc-btn calc-fn" onclick="scFn('cos')">cos</button><button class="calc-btn calc-fn" onclick="scFn('tan')">tan</button><button class="calc-btn calc-fn" onclick="scFn('log')">log</button><button class="calc-btn calc-fn" onclick="scFn('ln')">ln</button>
          <button class="calc-btn calc-fn" onclick="scFn('sqrt')">âˆš</button><button class="calc-btn calc-fn" onclick="scFn('pow2')">xÂ²</button><button class="calc-btn calc-fn" onclick="scFn('pow3')">xÂ³</button><button class="calc-btn calc-op" onclick="scOp('**')">xâ¿</button><button class="calc-btn calc-fn" onclick="scFn('inv')">1/x</button>
          <button class="calc-btn calc-fn" onclick="scFn('pi')">Ï€</button><button class="calc-btn calc-fn" onclick="scFn('e')">e</button><button class="calc-btn calc-fn" onclick="scFn('abs')">|x|</button><button class="calc-btn calc-fn" onclick="scFn('fact')">n!</button><button class="calc-btn calc-fn" onclick="scFn('AC')">AC</button>
          <button class="calc-btn" onclick="scNum('7')">7</button><button class="calc-btn" onclick="scNum('8')">8</button><button class="calc-btn" onclick="scNum('9')">9</button><button class="calc-btn calc-op" onclick="scOp('/')">Ã·</button><button class="calc-btn calc-op" onclick="scOp('*')">Ã—</button>
          <button class="calc-btn" onclick="scNum('4')">4</button><button class="calc-btn" onclick="scNum('5')">5</button><button class="calc-btn" onclick="scNum('6')">6</button><button class="calc-btn calc-op" onclick="scOp('-')">âˆ’</button><button class="calc-btn calc-op" onclick="scOp('+')">+</button>
          <button class="calc-btn" onclick="scNum('1')">1</button><button class="calc-btn" onclick="scNum('2')">2</button><button class="calc-btn" onclick="scNum('3')">3</button><button class="calc-btn" onclick="scNum('0')">0</button><button class="calc-btn" onclick="scNum('.')">.</button>
          <button class="calc-btn calc-fn" onclick="scFn('back')">âŒ«</button><button class="calc-btn calc-fn" onclick="scFn('+/-')">+/-</button><button class="calc-btn calc-fn" onclick="scFn('%')">%</button><button class="calc-btn calc-eq" onclick="scEq()" style="grid-column:span 2;">=</button>
        </div>
      </div>
      <!-- Percent -->
      <div id="calc-pct" style="display:none;">
        <div class="grid-2">
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:18px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:12px;">Hitung Diskon</div>
            <label>Harga Asli (Rp)</label><input type="number" id="disc-p" placeholder="100000" oninput="calcDisc()">
            <label>Diskon (%)</label><input type="number" id="disc-pct" placeholder="20" oninput="calcDisc()">
            <div class="output-box" id="disc-out" style="margin-top:10px;">â€”</div>
          </div>
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:18px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:12px;">Persentase Perubahan</div>
            <label>Nilai Awal</label><input type="number" id="chg-f" placeholder="80" oninput="calcChg()">
            <label>Nilai Akhir</label><input type="number" id="chg-t" placeholder="100" oninput="calcChg()">
            <div class="output-box" id="chg-out" style="margin-top:10px;">â€”</div>
          </div>
        </div>
      </div>
      <!-- Loan -->
      <div id="calc-loan" style="display:none;">
        <div class="grid-2">
          <div><label>Total Pinjaman (Rp)</label><input type="number" id="la" placeholder="500000000" oninput="calcLoan()"></div>
          <div><label>Bunga/Tahun (%)</label><input type="number" id="lr" placeholder="7.5" step="0.1" oninput="calcLoan()"></div>
          <div><label>Tenor (Tahun)</label><input type="number" id="ly" placeholder="15" oninput="calcLoan()"></div>
          <div><label>DP (Rp)</label><input type="number" id="ldp" placeholder="0" oninput="calcLoan()"></div>
        </div>
        <div class="output-box" id="loan-out" style="min-height:100px;">â€”</div>
      </div>
    </div>
  </div>

  <!-- TRANSLATE -->
  <div id="tab-translate" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">AI Translator</div>
      <div class="panel-desc">// Powered by Claude AI â€” akurat & natural</div>
      <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:end;margin-bottom:14px;">
        <div><label>Dari</label>
          <select id="tr-from">
            <option value="auto">ğŸ” Deteksi Otomatis</option>
            <option value="Indonesia">Indonesia</option><option value="Inggris">Inggris</option>
            <option value="Jepang">Jepang</option><option value="Korea">Korea</option>
            <option value="Mandarin">Mandarin</option><option value="Arab">Arab</option>
            <option value="Spanyol">Spanyol</option><option value="Prancis">Prancis</option>
            <option value="Jerman">Jerman</option><option value="Hindi">Hindi</option>
            <option value="Thailand">Thailand</option><option value="Vietnam">Vietnam</option>
            <option value="Jawa">Jawa</option><option value="Sunda">Sunda</option>
          </select>
        </div>
        <button class="btn btn-secondary" onclick="swapLang()" style="padding:9px 12px;margin-bottom:0;">â‡„</button>
        <div><label>Ke</label>
          <select id="tr-to">
            <option value="Indonesia">Indonesia</option><option value="Inggris" selected>Inggris</option>
            <option value="Jepang">Jepang</option><option value="Korea">Korea</option>
            <option value="Mandarin">Mandarin</option><option value="Arab">Arab</option>
            <option value="Spanyol">Spanyol</option><option value="Prancis">Prancis</option>
            <option value="Jerman">Jerman</option><option value="Hindi">Hindi</option>
            <option value="Thailand">Thailand</option><option value="Vietnam">Vietnam</option>
            <option value="Jawa">Jawa</option><option value="Sunda">Sunda</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div>
          <label>Teks Asli</label>
          <textarea id="tr-in" placeholder="Ketik teks..." style="min-height:180px;" oninput="trCharCount()"></textarea>
          <div style="display:flex;justify-content:space-between;margin-top:6px;"><span id="tr-cc" style="font-size:0.72rem;color:var(--muted);">0 karakter</span><button class="btn btn-secondary" onclick="clearTr()" style="padding:4px 10px;font-size:0.68rem;">Hapus</button></div>
        </div>
        <div>
          <label>Hasil</label>
          <div id="tr-out" class="lang-output" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;min-height:180px;color:var(--accent2);white-space:pre-wrap;word-break:break-word;"><span style="color:var(--muted);font-size:0.78rem;">â€” hasil terjemahan â€”</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px;"><span id="tr-det" style="font-size:0.72rem;color:var(--muted);"></span><button class="btn btn-secondary" id="tr-cp" onclick="cpTranslate()" style="padding:4px 10px;font-size:0.68rem;">Copy</button></div>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="doTranslate()" id="tr-btn">ğŸŒ Terjemahkan</button>
        <label style="margin:0;display:flex;align-items:center;gap:8px;text-transform:none;letter-spacing:0;font-size:0.72rem;"><input type="checkbox" id="tr-auto" style="width:13px;height:13px;accent-color:var(--accent);"> Auto translate</label>
      </div>
      <div id="tr-load" style="display:none;margin-top:12px;text-align:center;color:var(--muted);font-size:0.82rem;"><div class="tr-spinner"></div>Menerjemahkan...</div>
      <div style="margin-top:20px;border-top:1px solid var(--border);padding-top:16px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Frasa Cepat</div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;">
          <button class="phrase-btn" onclick="quickTr('Halo, apa kabar?')">Halo, apa kabar?</button>
          <button class="phrase-btn" onclick="quickTr('Terima kasih banyak')">Terima kasih</button>
          <button class="phrase-btn" onclick="quickTr('Di mana stasiun terdekat?')">Di mana stasiun?</button>
          <button class="phrase-btn" onclick="quickTr('Berapa harganya?')">Berapa harganya?</button>
          <button class="phrase-btn" onclick="quickTr('Saya tidak mengerti')">Tidak mengerti</button>
          <button class="phrase-btn" onclick="quickTr('Selamat pagi')">Selamat pagi</button>
        </div>
      </div>
    </div>
  </div>

  <!-- QR CODE -->
  <div id="tab-qr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">QR Code Generator</div>
      <div class="panel-desc">// Buat QR Code dari teks atau URL</div>
      <label>Teks / URL</label>
      <textarea id="qr-in" placeholder="https://example.com atau teks apapun..." style="min-height:80px;" oninput="qrLive()"></textarea>
      <div class="grid-2" style="margin-top:12px;">
        <div><label>Ukuran</label>
          <select id="qr-size" onchange="genQR()">
            <option value="150">150px</option><option value="200" selected>200px</option>
            <option value="300">300px</option><option value="400">400px</option>
          </select>
        </div>
        <div><label>Error Correction</label>
          <select id="qr-ec" onchange="genQR()">
            <option value="L">L â€” 7%</option><option value="M" selected>M â€” 15%</option>
            <option value="Q">Q â€” 25%</option><option value="H">H â€” 30%</option>
          </select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="genQR()">ğŸ“· Generate QR</button>
        <button class="btn btn-secondary" onclick="dlQR()">â¬‡ Download PNG</button>
      </div>
      <div style="margin-top:18px;text-align:center;">
        <canvas id="qr-canvas" style="border:1px solid var(--border);border-radius:8px;display:none;background:#fff;"></canvas>
        <div id="qr-ph" style="color:var(--muted);font-size:0.78rem;margin-top:10px;">â€” QR Code akan muncul di sini â€”</div>
      </div>
    </div>
  </div>

  <!-- RANDOM -->
  <div id="tab-random" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Random Generator</div>
      <div class="panel-desc">// UUID, angka, warna, nama, dadu, koin</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:14px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:10px;">ğŸ”‘ UUID v4</div>
          <div id="r-uuid" style="font-size:0.68rem;color:var(--accent2);word-break:break-all;min-height:28px;">â€”</div>
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-primary" onclick="rUUID()" style="padding:5px 10px;font-size:0.68rem;">Gen</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('r-uuid').textContent)" style="padding:5px 10px;font-size:0.68rem;">Copy</button>
          </div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:10px;">ğŸ² Angka Random</div>
          <div class="grid-2" style="gap:7px;">
            <div><label style="margin:0 0 3px;font-size:0.62rem;">Min</label><input type="number" id="r-min" value="1" style="padding:5px;font-size:0.78rem;"></div>
            <div><label style="margin:0 0 3px;font-size:0.62rem;">Max</label><input type="number" id="r-max" value="100" style="padding:5px;font-size:0.78rem;"></div>
          </div>
          <div id="r-num" style="font-size:2rem;font-weight:800;color:var(--accent3);text-align:center;margin:7px 0;transition:transform 0.2s;">â€”</div>
          <button class="btn btn-secondary" onclick="rNum()" style="width:100%;padding:5px;font-size:0.68rem;">ğŸ² Roll!</button>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--success);margin-bottom:10px;">ğŸ¨ Warna Random</div>
          <div id="r-cbox" style="height:56px;border-radius:8px;background:#7c3aed;margin-bottom:7px;transition:background 0.4s;"></div>
          <div id="r-cval" style="font-size:0.72rem;color:var(--muted);text-align:center;margin-bottom:7px;">#7c3aed</div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="rColor()" style="flex:1;padding:5px;font-size:0.68rem;">Random</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('r-cval').textContent)" style="flex:1;padding:5px;font-size:0.68rem;">Copy</button>
          </div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent);margin-bottom:10px;">ğŸª™ Koin & ğŸ² Dadu</div>
          <div id="r-coin" style="font-size:2.5rem;text-align:center;margin:4px 0;transition:transform 0.3s;">ğŸª™</div>
          <div id="r-coinlbl" style="text-align:center;font-size:0.78rem;color:var(--muted);margin-bottom:7px;">â€”</div>
          <button class="btn btn-primary" onclick="rCoin()" style="width:100%;padding:5px;font-size:0.68rem;margin-bottom:8px;">Lempar Koin!</button>
          <select id="r-dice" style="margin-bottom:6px;font-size:0.78rem;"><option value="6" selected>D6</option><option value="4">D4</option><option value="8">D8</option><option value="12">D12</option><option value="20">D20</option><option value="100">D100</option></select>
          <div id="r-dres" style="font-size:1.8rem;text-align:center;">ğŸ²</div>
          <button class="btn btn-secondary" onclick="rDice()" style="width:100%;padding:5px;font-size:0.68rem;margin-top:5px;">Roll Dadu!</button>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:10px;">ğŸ‘¤ Nama Random</div>
          <select id="r-ntype" style="margin-bottom:7px;font-size:0.78rem;"><option value="id">Indonesia</option><option value="en">Inggris</option><option value="jp">Jepang</option></select>
          <div id="r-name" style="font-size:1rem;font-weight:700;color:var(--accent2);min-height:24px;margin-bottom:7px;">â€”</div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="rName()" style="flex:1;padding:5px;font-size:0.68rem;">Gen</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('r-name').textContent)" style="flex:1;padding:5px;font-size:0.68rem;">Copy</button>
          </div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:10px;">ğŸ“‹ Pilih Acak dari List</div>
          <textarea id="r-list" placeholder="Pizza&#10;Bakso&#10;Nasi Goreng&#10;Soto" style="min-height:80px;font-size:0.78rem;"></textarea>
          <div class="btn-group" style="margin-top:7px;">
            <button class="btn btn-primary" onclick="rPick(1)" style="flex:1;padding:5px;font-size:0.68rem;">Pilih 1</button>
            <button class="btn btn-secondary" onclick="rPick(3)" style="flex:1;padding:5px;font-size:0.68rem;">Pilih 3</button>
          </div>
          <div class="output-box" id="r-pick" style="margin-top:8px;min-height:44px;">â€”</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MARKDOWN -->
  <div id="tab-markdown" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Markdown Preview</div>
      <div class="panel-desc">// Tulis & preview Markdown secara live</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;">
        <button class="btn btn-secondary" onclick="mdIns('**bold**')" style="padding:4px 9px;font-size:0.68rem;"><b>B</b></button>
        <button class="btn btn-secondary" onclick="mdIns('*italic*')" style="padding:4px 9px;font-size:0.68rem;"><i>I</i></button>
        <button class="btn btn-secondary" onclick="mdIns('# Heading')" style="padding:4px 9px;font-size:0.68rem;">H1</button>
        <button class="btn btn-secondary" onclick="mdIns('## Heading')" style="padding:4px 9px;font-size:0.68rem;">H2</button>
        <button class="btn btn-secondary" onclick="mdIns('[teks](url)')" style="padding:4px 9px;font-size:0.68rem;">ğŸ”—</button>
        <button class="btn btn-secondary" onclick="mdIns('\`kode\`')" style="padding:4px 9px;font-size:0.68rem;">&lt;&gt;</button>
        <button class="btn btn-secondary" onclick="mdIns('- item')" style="padding:4px 9px;font-size:0.68rem;">â€¢ List</button>
        <button class="btn btn-secondary" onclick="mdIns('> quote')" style="padding:4px 9px;font-size:0.68rem;">" Quote</button>
        <button class="btn btn-secondary" onclick="mdIns('---')" style="padding:4px 9px;font-size:0.68rem;">HR</button>
        <button class="btn btn-primary" onclick="mdSample()" style="padding:4px 9px;font-size:0.68rem;">ğŸ“„ Contoh</button>
      </div>
      <div class="grid-2">
        <div><label>Editor</label><textarea id="md-in" placeholder="# Judul&#10;&#10;Tulis **markdown** di sini..." style="min-height:380px;font-size:0.8rem;" oninput="renderMd()"></textarea></div>
        <div><label>Preview</label><div id="md-prev" class="md-body" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:16px;min-height:380px;overflow-y:auto;line-height:1.8;color:var(--text);"></div></div>
      </div>
    </div>
  </div>

  <!-- REGEX -->
  <div id="tab-regex" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Regex Tester</div>
      <div class="panel-desc">// Uji ekspresi reguler dengan highlight real-time</div>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
        <span style="color:var(--muted);font-size:1.1rem;">/</span>
        <input type="text" id="rx-pat" placeholder="pattern..." style="flex:1;" oninput="testRx()">
        <span style="color:var(--muted);font-size:1.1rem;">/</span>
        <input type="text" id="rx-flags" value="gi" style="width:65px;" oninput="testRx()">
      </div>
      <label>Teks Uji</label>
      <textarea id="rx-in" placeholder="Teks untuk diuji..." style="min-height:100px;" oninput="testRx()"></textarea>
      <label>Hasil (Match Dihighlight)</label>
      <div id="rx-out" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;min-height:70px;font-size:0.82rem;line-height:1.8;white-space:pre-wrap;word-break:break-word;">â€”</div>
      <div id="rx-stat" style="margin-top:7px;font-size:0.72rem;color:var(--muted);"></div>
      <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:9px;">Preset</div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;">
          <button class="phrase-btn" onclick="rxPreset('Email','[a-zA-Z0-9._%+\\-]+@[a-zA-Z0-9.\\-]+\\.[a-zA-Z]{2,}','gi','Kirim ke adam@example.com atau winda@test.co.id')">ğŸ“§ Email</button>
          <button class="phrase-btn" onclick="rxPreset('URL','https?:\\/\\/[\\w\\-\\.]+\\.[a-z]{2,}[\\w\\-\\._~:\\/?#\\[\\]@!$&\'\\(\\)\\*\\+,;=]*','gi','Cek https://google.com dan https://github.com')">ğŸ”— URL</button>
          <button class="phrase-btn" onclick="rxPreset('No HP','(\\+62|0)[0-9]{9,12}','g','Hub. Adam 081234567890 atau +6281234567891')">ğŸ“± No. HP</button>
          <button class="phrase-btn" onclick="rxPreset('Angka','\\d+','g','Harga Rp 150000 diskon 20% bayar Rp 120000')">ğŸ”¢ Angka</button>
          <button class="phrase-btn" onclick="rxPreset('Hashtag','#[\\w]+','g','#toolbox #adam #coding sangat keren!')">ğŸ·ï¸ Hashtag</button>
          <button class="phrase-btn" onclick="rxPreset('IP','\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b','g','Server di 192.168.1.1 backup 10.0.0.1')">ğŸŒ IP Address</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TIMER -->
  <div id="tab-timer" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Stopwatch & Countdown Timer</div>
      <div class="panel-desc">// Stopwatch presisi & countdown dengan preset</div>
      <div class="grid-2">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:22px;text-align:center;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:14px;font-size:0.75rem;letter-spacing:2px;">â± STOPWATCH</div>
          <div id="sw-d" style="font-family:'Space Mono',monospace;font-size:2.5rem;font-weight:700;color:var(--text);letter-spacing:2px;margin-bottom:18px;">00:00:00.000</div>
          <div class="btn-group" style="justify-content:center;">
            <button class="btn btn-primary" id="sw-btn" onclick="swToggle()">â–¶ Start</button>
            <button class="btn btn-secondary" onclick="swReset()">â†º Reset</button>
            <button class="btn btn-secondary" onclick="swLap()">âš‘ Lap</button>
          </div>
          <div id="sw-laps" style="margin-top:14px;max-height:130px;overflow-y:auto;font-size:0.72rem;text-align:left;"></div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:22px;text-align:center;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:14px;font-size:0.75rem;letter-spacing:2px;">â³ COUNTDOWN</div>
          <div style="display:flex;gap:7px;justify-content:center;margin-bottom:14px;">
            <div><label style="font-size:0.6rem;">Jam</label><input type="number" id="cd-h" value="0" min="0" max="23" style="width:55px;text-align:center;padding:7px 3px;font-size:1.1rem;"></div>
            <div style="font-size:1.8rem;padding-top:14px;color:var(--muted);">:</div>
            <div><label style="font-size:0.6rem;">Menit</label><input type="number" id="cd-m" value="5" min="0" max="59" style="width:55px;text-align:center;padding:7px 3px;font-size:1.1rem;"></div>
            <div style="font-size:1.8rem;padding-top:14px;color:var(--muted);">:</div>
            <div><label style="font-size:0.6rem;">Detik</label><input type="number" id="cd-s" value="0" min="0" max="59" style="width:55px;text-align:center;padding:7px 3px;font-size:1.1rem;"></div>
          </div>
          <div id="cd-d" style="font-family:'Space Mono',monospace;font-size:2.5rem;font-weight:700;color:var(--accent3);letter-spacing:2px;margin-bottom:18px;">00:05:00</div>
          <div class="btn-group" style="justify-content:center;">
            <button class="btn btn-cyan" id="cd-btn" onclick="cdToggle()">â–¶ Start</button>
            <button class="btn btn-secondary" onclick="cdReset()">â†º Reset</button>
          </div>
          <div style="margin-top:12px;">
            <div style="font-size:0.68rem;color:var(--muted);margin-bottom:7px;">Preset Cepat</div>
            <div style="display:flex;gap:5px;flex-wrap:wrap;justify-content:center;">
              <button class="phrase-btn" onclick="cdPreset(1,0,0)">1 Menit</button>
              <button class="phrase-btn" onclick="cdPreset(5,0,0)">5 Menit</button>
              <button class="phrase-btn" onclick="cdPreset(25,0,0)">ğŸ… Pomodoro</button>
              <button class="phrase-btn" onclick="cdPreset(60,0,0)">1 Jam</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CSV TO TABLE -->
  <div id="tab-csv" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">CSV â†’ Tabel</div>
      <div class="panel-desc">// Konversi CSV / TSV menjadi tabel rapi</div>
      <div class="grid-2">
        <div><label>Separator</label>
          <select id="csv-sep" onchange="renderCsv()">
            <option value=",">Koma (,)</option><option value=";">Titik koma (;)</option>
            <option value="	">Tab (TSV)</option><option value="|">Pipe (|)</option>
          </select>
        </div>
        <div style="display:flex;align-items:flex-end;gap:10px;padding-bottom:2px;">
          <label class="toggle-row" style="margin:0;"><input type="checkbox" id="csv-hdr" checked onchange="renderCsv()"> Baris pertama = header</label>
        </div>
      </div>
      <label>Input CSV</label>
      <textarea id="csv-in" style="min-height:120px;font-size:0.8rem;" placeholder="Nama,Umur,Kota&#10;Adam,25,Jakarta&#10;Winda,22,Bandung" oninput="renderCsv()"></textarea>
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="csvSample()">ğŸ“„ Contoh</button>
        <button class="btn btn-secondary" onclick="csvExport('markdown')">Export Markdown</button>
        <button class="btn btn-secondary" onclick="csvExport('html')">Export HTML</button>
      </div>
      <div id="csv-wrap" style="overflow-x:auto;margin-top:12px;border:1px solid var(--border);border-radius:8px;min-height:60px;"></div>
      <div id="csv-stat" style="margin-top:7px;font-size:0.72rem;color:var(--muted);"></div>
    </div>
  </div>

  <!-- GRADIENT -->
  <div id="tab-gradient" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">CSS Gradient Generator</div>
      <div class="panel-desc">// Buat gradient cantik & salin CSS-nya</div>
      <div class="grid-2">
        <div>
          <label>Tipe</label><select id="gr-type" onchange="renderGr()"><option value="linear">Linear</option><option value="radial">Radial</option><option value="conic">Conic</option></select>
          <label>Arah</label>
          <select id="gr-dir" onchange="renderGr()">
            <option value="to right">â†’ Kanan</option><option value="to left">â† Kiri</option>
            <option value="to bottom">â†“ Bawah</option><option value="to top">â†‘ Atas</option>
            <option value="135deg">135Â°</option><option value="45deg">45Â°</option>
          </select>
        </div>
        <div>
          <label>Warna 1</label>
          <div style="display:flex;gap:7px;align-items:center;"><input type="color" id="gr-c1" value="#7c3aed" oninput="renderGr()" style="width:46px;height:34px;"><input type="text" id="gr-c1t" value="#7c3aed" style="flex:1;" oninput="syncGr(1)"></div>
          <label>Warna 2</label>
          <div style="display:flex;gap:7px;align-items:center;"><input type="color" id="gr-c2" value="#06b6d4" oninput="renderGr()" style="width:46px;height:34px;"><input type="text" id="gr-c2t" value="#06b6d4" style="flex:1;" oninput="syncGr(2)"></div>
          <label>Warna 3 <input type="checkbox" id="gr-c3on" onchange="renderGr()" style="width:12px;height:12px;accent-color:var(--accent);vertical-align:middle;"> aktif</label>
          <div style="display:flex;gap:7px;align-items:center;"><input type="color" id="gr-c3" value="#f59e0b" oninput="renderGr()" style="width:46px;height:34px;"><input type="text" id="gr-c3t" value="#f59e0b" style="flex:1;" oninput="syncGr(3)"></div>
        </div>
      </div>
      <div id="gr-prev" style="height:130px;border-radius:10px;margin-top:14px;border:1px solid var(--border);transition:background 0.3s;"></div>
      <div class="btn-group" style="margin-top:12px;">
        <button class="btn btn-primary" onclick="copyText(document.getElementById('gr-css').value)">ğŸ“‹ Copy CSS</button>
        <button class="btn btn-secondary" onclick="randGr()">ğŸ² Random</button>
      </div>
      <label>CSS Output</label>
      <input type="text" id="gr-css" readonly style="font-size:0.76rem;color:var(--accent2);">
      <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Preset</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(72px,1fr));gap:7px;" id="gr-presets"></div>
      </div>
    </div>
  </div>

  <!-- MINIFIER -->
  <div id="tab-minifier" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">CSS / JS Minifier</div>
      <div class="panel-desc">// Kompres kode, hapus whitespace & komentar</div>
      <div style="display:flex;gap:8px;margin-bottom:12px;">
        <button class="btn btn-primary" id="mini-css" onclick="setMini('css')">CSS</button>
        <button class="btn btn-secondary" id="mini-js" onclick="setMini('js')">JavaScript</button>
      </div>
      <label>Kode Input</label>
      <textarea id="mini-in" placeholder="Paste kode CSS atau JS..." style="min-height:180px;font-size:0.8rem;"></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="doMinify()">ğŸ—œï¸ Minify!</button>
        <button class="btn btn-secondary" onclick="doBeautify()">âœ¨ Beautify</button>
        <button class="btn btn-secondary" onclick="miniSample()">ğŸ“„ Contoh</button>
      </div>
      <div class="stats-row" id="mini-stat" style="margin-top:12px;"></div>
      <label>Hasil</label>
      <div class="output-box" id="mini-out" style="min-height:100px;font-size:0.8rem;">â€”<button class="copy-btn" onclick="cpOut('mini-out')">COPY</button></div>
    </div>
  </div>

  <!-- TODO -->
  <div id="tab-todo" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">To-Do List</div>
      <div class="panel-desc">// Catat tugas, prioritas & status â€” tersimpan otomatis</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <input type="text" id="todo-input" placeholder="Tugas baru..." style="flex:1;" onkeydown="if(event.key==='Enter')addTodo()">
        <select id="todo-pri" style="width:110px;">
          <option value="high">ğŸ”´ Tinggi</option>
          <option value="med" selected>ğŸŸ¡ Sedang</option>
          <option value="low">ğŸŸ¢ Rendah</option>
        </select>
        <button class="btn btn-primary" onclick="addTodo()">+ Tambah</button>
      </div>
      <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
        <button class="phrase-btn active-filter" id="tf-all" onclick="filterTodo('all',this)">Semua</button>
        <button class="phrase-btn" id="tf-active" onclick="filterTodo('active',this)">Aktif</button>
        <button class="phrase-btn" id="tf-done" onclick="filterTodo('done',this)">Selesai</button>
        <button class="phrase-btn" id="tf-high" onclick="filterTodo('high',this)">ğŸ”´ Tinggi</button>
        <span style="flex:1"></span>
        <button class="btn btn-secondary" onclick="clearDoneTodo()" style="font-size:0.72rem;padding:5px 10px;">Hapus selesai</button>
      </div>
      <div id="todo-list" style="display:flex;flex-direction:column;gap:6px;min-height:60px;"></div>
      <div id="todo-empty" style="color:var(--muted);font-size:0.8rem;text-align:center;padding:20px;display:none;">Belum ada tugas ğŸ‰</div>
      <div style="display:flex;justify-content:space-between;margin-top:12px;font-size:0.75rem;color:var(--muted);">
        <span id="todo-stats"></span>
        <button onclick="clearAllTodo()" style="background:none;border:none;color:var(--danger);cursor:pointer;font-size:0.72rem;">Hapus semua</button>
      </div>
    </div>
  </div>

  <!-- NOTEPAD -->
  <div id="tab-notepad" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Notepad</div>
      <div class="panel-desc">// Catatan cepat â€” tersimpan otomatis di browser</div>
      <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;">
        <input type="text" id="np-title" placeholder="Judul catatan..." style="flex:1;font-weight:700;">
        <button class="btn btn-primary" onclick="saveNote()">ğŸ’¾ Simpan</button>
        <button class="btn btn-secondary" onclick="newNote()">+ Baru</button>
      </div>
      <div style="display:grid;grid-template-columns:200px 1fr;gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Catatan Tersimpan</div>
          <div id="np-list" style="display:flex;flex-direction:column;gap:4px;max-height:380px;overflow-y:auto;"></div>
          <div id="np-empty-list" style="color:var(--muted);font-size:0.75rem;text-align:center;padding:12px;">Belum ada catatan</div>
        </div>
        <div>
          <textarea id="np-body" placeholder="Mulai menulis di sini...

Catatan kamu tersimpan otomatis di browser.
Tidak perlu login, tidak ada data yang dikirim." style="min-height:380px;font-size:0.9rem;line-height:1.7;" oninput="npAutoSave()"></textarea>
          <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:0.72rem;color:var(--muted);">
            <span id="np-wordcount">0 kata</span>
            <span id="np-saved-status">â€”</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CURRENCY -->
  <div id="tab-currency" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Konversi Kurs Mata Uang</div>
      <div class="panel-desc">// Kurs live dari ExchangeRate API (update harian)</div>
      <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:end;margin-bottom:16px;">
        <div>
          <label>Dari</label>
          <select id="cur-from" onchange="convertCur()">
            <option value="IDR" selected>ğŸ‡®ğŸ‡© IDR â€” Rupiah</option>
            <option value="USD">ğŸ‡ºğŸ‡¸ USD â€” Dollar AS</option>
            <option value="EUR">ğŸ‡ªğŸ‡º EUR â€” Euro</option>
            <option value="GBP">ğŸ‡¬ğŸ‡§ GBP â€” Pound</option>
            <option value="JPY">ğŸ‡¯ğŸ‡µ JPY â€” Yen</option>
            <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD â€” Dollar Singapura</option>
            <option value="MYR">ğŸ‡²ğŸ‡¾ MYR â€” Ringgit</option>
            <option value="AUD">ğŸ‡¦ğŸ‡º AUD â€” Dollar Australia</option>
            <option value="CNY">ğŸ‡¨ğŸ‡³ CNY â€” Yuan</option>
            <option value="SAR">ğŸ‡¸ğŸ‡¦ SAR â€” Riyal</option>
            <option value="KRW">ğŸ‡°ğŸ‡· KRW â€” Won</option>
            <option value="HKD">ğŸ‡­ğŸ‡° HKD â€” Dollar HK</option>
          </select>
          <input type="number" id="cur-amount" value="1000000" oninput="convertCur()" style="margin-top:8px;">
        </div>
        <button onclick="swapCur()" class="btn btn-secondary" style="margin-bottom:0;padding:10px 14px;">â‡„</button>
        <div>
          <label>Ke</label>
          <select id="cur-to" onchange="convertCur()">
            <option value="IDR">ğŸ‡®ğŸ‡© IDR â€” Rupiah</option>
            <option value="USD" selected>ğŸ‡ºğŸ‡¸ USD â€” Dollar AS</option>
            <option value="EUR">ğŸ‡ªğŸ‡º EUR â€” Euro</option>
            <option value="GBP">ğŸ‡¬ğŸ‡§ GBP â€” Pound</option>
            <option value="JPY">ğŸ‡¯ğŸ‡µ JPY â€” Yen</option>
            <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD â€” Dollar Singapura</option>
            <option value="MYR">ğŸ‡²ğŸ‡¾ MYR â€” Ringgit</option>
            <option value="AUD">ğŸ‡¦ğŸ‡º AUD â€” Dollar Australia</option>
            <option value="CNY">ğŸ‡¨ğŸ‡³ CNY â€” Yuan</option>
            <option value="SAR">ğŸ‡¸ğŸ‡¦ SAR â€” Riyal</option>
            <option value="KRW">ğŸ‡°ğŸ‡· KRW â€” Won</option>
            <option value="HKD">ğŸ‡­ğŸ‡° HKD â€” Dollar HK</option>
          </select>
          <div id="cur-result" style="margin-top:8px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px 16px;font-size:1.1rem;color:var(--accent2);font-family:'Syne',sans-serif;font-weight:700;min-height:48px;">â€”</div>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="loadRates()">ğŸ”„ Update Kurs</button>
      </div>
      <div id="cur-rate-info" style="margin-top:12px;font-size:0.75rem;color:var(--muted);">Klik "Update Kurs" untuk mengambil data terbaru</div>
      <div id="cur-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:16px;"></div>
    </div>
  </div>

  <!-- WEATHER -->
  <div id="tab-weather" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Cek Cuaca</div>
      <div class="panel-desc">// Info cuaca real-time via Open-Meteo (gratis, no key)</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <input type="text" id="wx-city" placeholder="Nama kota, contoh: Jakarta" style="flex:1;" onkeydown="if(event.key==='Enter')searchWeather()">
        <button class="btn btn-primary" onclick="searchWeather()">ğŸ” Cari</button>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <button class="phrase-btn" onclick="quickWeather('Jakarta')">Jakarta</button>
        <button class="phrase-btn" onclick="quickWeather('Bandung')">Bandung</button>
        <button class="phrase-btn" onclick="quickWeather('Surabaya')">Surabaya</button>
        <button class="phrase-btn" onclick="quickWeather('Yogyakarta')">Yogyakarta</button>
        <button class="phrase-btn" onclick="quickWeather('Bali')">Bali</button>
        <button class="phrase-btn" onclick="quickWeather('Medan')">Medan</button>
        <button class="phrase-btn" onclick="quickWeather('Makassar')">Makassar</button>
      </div>
      <div id="wx-loading" style="display:none;text-align:center;color:var(--muted);font-size:0.85rem;padding:20px;">ğŸŒ Mencari data cuaca...</div>
      <div id="wx-result" style="display:none;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:24px;text-align:center;">
          <div id="wx-city-name" style="font-family:'Syne',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:4px;"></div>
          <div id="wx-icon" style="font-size:4rem;margin:12px 0;"></div>
          <div id="wx-temp" style="font-size:3rem;font-weight:800;font-family:'Syne',sans-serif;color:var(--accent2);"></div>
          <div id="wx-desc" style="color:var(--muted);margin-top:6px;font-size:0.9rem;"></div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-top:12px;" id="wx-details"></div>
      </div>
      <div id="wx-error" style="display:none;color:var(--danger);font-size:0.85rem;padding:12px;"></div>
    </div>
  </div>

  <!-- IMAGE COMPRESSOR -->
  <div id="tab-imgcomp" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Image Compressor</div>
      <div class="panel-desc">// Kompres gambar langsung di browser â€” privat, no upload</div>
      <div id="ic-drop" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;transition:all 0.2s;" onclick="document.getElementById('ic-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="icDrop(event)">
        <div style="font-size:2.5rem;">ğŸ–¼ï¸</div>
        <div style="color:var(--muted);margin-top:8px;font-size:0.85rem;">Klik atau drag & drop gambar di sini</div>
        <div style="color:var(--muted);font-size:0.72rem;margin-top:4px;">JPG, PNG, WebP â€” max 20MB</div>
        <input type="file" id="ic-file" accept="image/*" style="display:none;" onchange="icLoad(this)">
      </div>
      <div id="ic-controls" style="display:none;margin-top:16px;">
        <div class="grid-2">
          <div>
            <label>Kualitas: <span id="ic-q-val">80</span>%</label>
            <input type="range" id="ic-quality" min="10" max="100" value="80" oninput="document.getElementById('ic-q-val').textContent=this.value;icPreview()">
            <label>Format Output</label>
            <select id="ic-format" onchange="icPreview()">
              <option value="image/jpeg">JPEG</option>
              <option value="image/png">PNG</option>
              <option value="image/webp">WebP</option>
            </select>
            <label>Resize (0 = original)</label>
            <div style="display:flex;gap:8px;">
              <input type="number" id="ic-w" placeholder="Lebar px" oninput="icPreview()">
              <input type="number" id="ic-h" placeholder="Tinggi px" oninput="icPreview()">
            </div>
          </div>
          <div>
            <label>Preview Hasil</label>
            <canvas id="ic-canvas" style="max-width:100%;border:1px solid var(--border);border-radius:8px;display:block;"></canvas>
          </div>
        </div>
        <div class="stats-row" style="margin-top:12px;">
          <div class="stat-chip">Asli: <span id="ic-orig-size" style="color:var(--accent3);">â€”</span></div>
          <div class="stat-chip">Hasil: <span id="ic-new-size" style="color:var(--success);">â€”</span></div>
          <div class="stat-chip">Hemat: <span id="ic-saved" style="color:var(--success);">â€”</span></div>
          <div class="stat-chip">Dimensi: <span id="ic-dims">â€”</span></div>
        </div>
        <div class="btn-group" style="margin-top:12px;">
          <button class="btn btn-primary" onclick="icDownload()">â¬‡ Download</button>
          <button class="btn btn-secondary" onclick="icReset()">Ganti Gambar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FONT PREVIEW -->
  <div id="tab-fontprev" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Font Preview</div>
      <div class="panel-desc">// Preview 40+ Google Fonts dengan teks kustom</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <input type="text" id="fp-text" value="Halo Dunia! The quick brown fox." style="flex:1;" oninput="renderFonts()">
        <div style="display:flex;align-items:center;gap:8px;">
          <label style="margin:0;white-space:nowrap;">Ukuran:</label>
          <input type="number" id="fp-size" value="28" min="12" max="80" style="width:70px;" oninput="renderFonts()">
        </div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <button class="phrase-btn" onclick="fpCategory('all')">Semua</button>
        <button class="phrase-btn" onclick="fpCategory('serif')">Serif</button>
        <button class="phrase-btn" onclick="fpCategory('sans')">Sans-Serif</button>
        <button class="phrase-btn" onclick="fpCategory('mono')">Monospace</button>
        <button class="phrase-btn" onclick="fpCategory('display')">Display</button>
      </div>
      <div id="fp-grid" style="display:flex;flex-direction:column;gap:2px;max-height:480px;overflow-y:auto;"></div>
    </div>
  </div>

  <!-- SNIPPET MANAGER -->
  <div id="tab-snippet" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Snippet Manager</div>
      <div class="panel-desc">// Simpan dan kelola potongan kode favorit</div>
      <div style="display:grid;grid-template-columns:260px 1fr;gap:16px;">
        <div>
          <div style="display:flex;gap:6px;margin-bottom:10px;">
            <input type="text" id="snip-search" placeholder="Cari snippet..." style="flex:1;font-size:0.8rem;" oninput="renderSnippets()">
            <button class="btn btn-primary" onclick="newSnippet()" style="padding:8px 12px;">+</button>
          </div>
          <div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px;">
            <button class="phrase-btn" onclick="filterSnip('all')">Semua</button>
            <button class="phrase-btn" onclick="filterSnip('js')">JS</button>
            <button class="phrase-btn" onclick="filterSnip('css')">CSS</button>
            <button class="phrase-btn" onclick="filterSnip('html')">HTML</button>
            <button class="phrase-btn" onclick="filterSnip('python')">Python</button>
            <button class="phrase-btn" onclick="filterSnip('other')">Lain</button>
          </div>
          <div id="snip-list" style="display:flex;flex-direction:column;gap:4px;max-height:380px;overflow-y:auto;"></div>
          <div id="snip-empty" style="color:var(--muted);font-size:0.78rem;text-align:center;padding:16px;">Belum ada snippet</div>
        </div>
        <div id="snip-editor" style="display:flex;flex-direction:column;gap:8px;">
          <div style="display:flex;gap:8px;">
            <input type="text" id="snip-name" placeholder="Nama snippet..." style="flex:1;">
            <select id="snip-lang" style="width:100px;">
              <option value="js">JavaScript</option>
              <option value="css">CSS</option>
              <option value="html">HTML</option>
              <option value="python">Python</option>
              <option value="sql">SQL</option>
              <option value="bash">Bash</option>
              <option value="other">Lainnya</option>
            </select>
          </div>
          <input type="text" id="snip-desc" placeholder="Deskripsi singkat...">
          <textarea id="snip-code" placeholder="Paste kode di sini..." style="min-height:300px;font-size:0.82rem;font-family:'Space Mono',monospace;"></textarea>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" onclick="saveSnippet()">ğŸ’¾ Simpan</button>
            <button class="btn btn-cyan" onclick="copySnippet()" id="snip-copy-btn">ğŸ“‹ Copy Kode</button>
            <button class="btn btn-secondary" onclick="deleteSnippet()" style="margin-left:auto;">ğŸ—‘ Hapus</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ASPECT RATIO -->
  <div id="tab-aspect" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Aspect Ratio & Dimensi</div>
      <div class="panel-desc">// Hitung rasio gambar, skala dimensi, & resize proporsional</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:20px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:14px;">ğŸ“ Hitung Rasio</div>
          <label>Lebar (W)</label><input type="number" id="ar-w" placeholder="1920" oninput="calcAR()">
          <label>Tinggi (H)</label><input type="number" id="ar-h" placeholder="1080" oninput="calcAR()">
          <div class="output-box" id="ar-out" style="margin-top:12px;min-height:60px;">â€”</div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:20px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:14px;">ğŸ“ Skala Proporsional</div>
          <label>Lebar Asli</label><input type="number" id="sc-ow" placeholder="1920" oninput="calcScale()">
          <label>Tinggi Asli</label><input type="number" id="sc-oh" placeholder="1080" oninput="calcScale()">
          <label>Target Lebar (isi salah satu)</label><input type="number" id="sc-tw" placeholder="800" oninput="calcScale()">
          <label>Target Tinggi</label><input type="number" id="sc-th" placeholder="" oninput="calcScale()">
          <div class="output-box" id="sc-out" style="margin-top:12px;min-height:60px;">â€”</div>
        </div>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:20px;margin-top:16px;">
        <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--success);margin-bottom:14px;">ğŸ¯ Preset Rasio Umum</div>
        <div style="display:flex;flex-wrap:wrap;gap:8px;">
          <button class="phrase-btn" onclick="setAR(16,9)">16:9 (HD/YouTube)</button>
          <button class="phrase-btn" onclick="setAR(4,3)">4:3 (Klasik)</button>
          <button class="phrase-btn" onclick="setAR(1,1)">1:1 (Square)</button>
          <button class="phrase-btn" onclick="setAR(9,16)">9:16 (Story/TikTok)</button>
          <button class="phrase-btn" onclick="setAR(3,2)">3:2 (Foto DSLR)</button>
          <button class="phrase-btn" onclick="setAR(21,9)">21:9 (Ultrawide)</button>
          <button class="phrase-btn" onclick="setAR(2,1)">2:1 (Banner)</button>
          <button class="phrase-btn" onclick="setAR(4,5)">4:5 (Instagram)</button>
          <button class="phrase-btn" onclick="setAR(1200,630)">1200:630 (OG Image)</button>
        </div>
        <div class="output-box" id="ar-preset-out" style="margin-top:12px;min-height:50px;display:none;">â€”</div>
      </div>
    </div>
  </div>

  <!-- MINDMAP -->
  <div id="tab-mindmap" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Teks â†’ Mindmap</div>
      <div class="panel-desc">// Tulis bullet points, otomatis jadi visualisasi mindmap</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div>
          <label>Input (gunakan indentasi 2 spasi)</label>
          <textarea id="mm-input" style="min-height:340px;font-size:0.82rem;font-family:'Space Mono',monospace;" oninput="renderMindmap()" placeholder="Topik Utama
  Subtopik 1
    Detail A
    Detail B
  Subtopik 2
    Detail C
  Subtopik 3
    Detail D
    Detail E"></textarea>
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-secondary" onclick="mmExample()">Contoh</button>
            <button class="btn btn-secondary" onclick="mmDownload()">â¬‡ SVG</button>
          </div>
        </div>
        <div>
          <label>Preview Mindmap</label>
          <div id="mm-canvas" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;min-height:340px;overflow:auto;position:relative;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MORSE CODE -->
  <div id="tab-morse" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Text â†” Morse Code</div>
      <div class="panel-desc">// Konversi teks ke morse dan putar suaranya via Web Audio API</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Teks</label>
          <textarea id="morse-text" style="min-height:120px;" placeholder="Ketik teks..." oninput="textToMorse()"></textarea>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="textToMorse()">â†’ Ke Morse</button>
            <button class="btn btn-secondary" onclick="morseToText()">â† Dari Morse</button>
          </div>
        </div>
        <div>
          <label>Morse Code</label>
          <textarea id="morse-code" style="min-height:120px;letter-spacing:2px;font-size:1rem;" placeholder="... --- ..." oninput="morseToText()"></textarea>
          <div class="btn-group">
            <button class="btn btn-cyan" onclick="playMorse()" id="morse-play-btn">â–¶ Putar Suara</button>
            <button class="btn btn-secondary" onclick="stopMorse()">â¹ Stop</button>
          </div>
        </div>
      </div>
      <div style="margin-top:16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <div><label style="margin:0;margin-right:8px;">Speed:</label>
          <input type="range" id="morse-speed" min="5" max="30" value="15" style="width:120px;vertical-align:middle;"> <span id="morse-speed-val">15 WPM</span>
        </div>
        <div><label style="margin:0;margin-right:8px;">Frekuensi:</label>
          <input type="range" id="morse-freq" min="400" max="1000" value="600" style="width:120px;vertical-align:middle;"> <span id="morse-freq-val">600 Hz</span>
        </div>
      </div>
      <div id="morse-visual" style="margin-top:16px;min-height:32px;display:flex;gap:3px;flex-wrap:wrap;align-items:center;"></div>
      <details style="margin-top:16px;">
        <summary style="font-size:0.78rem;color:var(--muted);cursor:pointer;">Tabel Morse</summary>
        <div id="morse-table" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:10px;font-size:0.72rem;"></div>
      </details>
    </div>
  </div>

  <!-- WORLD CLOCK -->
  <div id="tab-worldclock" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸŒ World Clock</div>
      <div class="panel-desc">// Jam langsung dari 15+ kota di seluruh dunia</div>
      <div id="wc-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;"></div>
      <div style="margin-top:20px;border-top:1px solid var(--border);padding-top:16px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;">Tambah Kota Custom</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <input type="text" id="wc-city-name" placeholder="Nama Kota" style="width:160px;">
          <select id="wc-tz" style="flex:1;min-width:200px;"></select>
          <button class="btn btn-primary" onclick="addWCCity()">+ Tambah</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FAKE DATA GENERATOR -->
  <div id="tab-fakedata" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ”® Fake Data Generator Indonesia</div>
      <div class="panel-desc">// Buat data dummy realistis untuk testing & development</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:flex-end;">
        <div><label>Jumlah Data</label><input type="number" id="fd-count" value="5" min="1" max="50" style="width:80px;"></div>
        <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;padding-bottom:2px;">
          <label style="margin:0;text-transform:none;letter-spacing:0;font-size:0.78rem;color:var(--muted);">Kolom:</label>
          <label class="fd-check"><input type="checkbox" id="fd-nama" checked> Nama</label>
          <label class="fd-check"><input type="checkbox" id="fd-nik" checked> NIK</label>
          <label class="fd-check"><input type="checkbox" id="fd-email" checked> Email</label>
          <label class="fd-check"><input type="checkbox" id="fd-phone" checked> Telepon</label>
          <label class="fd-check"><input type="checkbox" id="fd-alamat" checked> Alamat</label>
          <label class="fd-check"><input type="checkbox" id="fd-dob"> Tgl Lahir</label>
          <label class="fd-check"><input type="checkbox" id="fd-job"> Pekerjaan</label>
          <label class="fd-check"><input type="checkbox" id="fd-bank"> Rekening</label>
        </div>
        <button class="btn btn-primary" onclick="genFakeData()">ğŸ”® Generate</button>
        <button class="btn btn-secondary" onclick="copyFakeData()">Copy JSON</button>
        <button class="btn btn-secondary" onclick="exportFakeCSV()">Export CSV</button>
      </div>
      <div id="fd-table-wrap" style="overflow-x:auto;"></div>
      <div id="fd-json-out" style="display:none;"></div>
    </div>
  </div>

  <!-- PALETTE EXTRACTOR -->
  <div id="tab-palette" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¨ Color Palette Extractor</div>
      <div class="panel-desc">// Upload foto, ambil warna dominan otomatis</div>
      <div id="pal-drop" style="border:2px dashed var(--border);border-radius:12px;padding:36px;text-align:center;cursor:pointer;" onclick="document.getElementById('pal-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="palDrop(event)">
        <div style="font-size:2.5rem;">ğŸ–¼ï¸</div>
        <div style="color:var(--muted);font-size:0.85rem;margin-top:8px;">Klik atau drag & drop gambar</div>
        <input type="file" id="pal-file" accept="image/*" style="display:none;" onchange="palLoad(this)">
      </div>
      <div id="pal-result" style="display:none;margin-top:16px;">
        <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:start;">
          <img id="pal-img" style="max-width:200px;max-height:200px;border-radius:8px;border:1px solid var(--border);">
          <div>
            <div style="font-size:0.78rem;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;">Warna Dominan</div>
            <div id="pal-colors" style="display:flex;flex-direction:column;gap:8px;"></div>
          </div>
        </div>
        <div style="margin-top:16px;">
          <div style="font-size:0.78rem;color:var(--muted);margin-bottom:8px;">Jumlah Warna: <input type="range" id="pal-count" min="3" max="12" value="6" style="width:100px;vertical-align:middle;" oninput="palReExtract()"> <span id="pal-count-val">6</span></div>
          <div id="pal-swatches" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHART GENERATOR -->
  <div id="tab-chartgen" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“Š Text â†’ Chart Generator</div>
      <div class="panel-desc">// Input data sederhana, langsung jadi grafik cantik</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div>
          <label>Tipe Chart</label>
          <select id="cg-type" onchange="renderChart()">
            <option value="bar">Bar Chart</option>
            <option value="horizontal-bar">Horizontal Bar</option>
            <option value="line">Line Chart</option>
            <option value="pie">Pie Chart</option>
            <option value="donut">Donut Chart</option>
          </select>
          <label>Data (Label,Nilai â€” satu per baris)</label>
          <textarea id="cg-data" style="min-height:200px;font-size:0.82rem;" oninput="renderChart()" placeholder="Januari,120
Februari,95
Maret,180
April,145
Mei,210
Juni,175"></textarea>
          <label>Judul Chart</label>
          <input type="text" id="cg-title" value="Data Saya" oninput="renderChart()">
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-secondary" onclick="cgDownload()">â¬‡ Download PNG</button>
          </div>
        </div>
        <div>
          <label>Preview</label>
          <canvas id="cg-canvas" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;width:100%;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- CIPHER / ENKRIPSI -->
  <div id="tab-cipher" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ” Enkripsi Teks</div>
      <div class="panel-desc">// Caesar, ROT13, Vigenere, Atbash, Base85 cipher</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <button class="btn btn-primary" id="ci-caesar" onclick="setCipher('caesar')">Caesar</button>
        <button class="btn btn-secondary" id="ci-rot13" onclick="setCipher('rot13')">ROT13</button>
        <button class="btn btn-secondary" id="ci-vigenere" onclick="setCipher('vigenere')">Vigenere</button>
        <button class="btn btn-secondary" id="ci-atbash" onclick="setCipher('atbash')">Atbash</button>
        <button class="btn btn-secondary" id="ci-morse2" onclick="setCipher('binary')">Binary</button>
      </div>
      <div id="ci-caesar-opts" style="margin-bottom:12px;">
        <label>Geser: <span id="ci-shift-val">3</span></label>
        <input type="range" id="ci-shift" min="1" max="25" value="3" oninput="document.getElementById('ci-shift-val').textContent=this.value;doCipher()">
      </div>
      <div id="ci-vigenere-opts" style="display:none;margin-bottom:12px;">
        <label>Kunci (huruf saja)</label>
        <input type="text" id="ci-key" placeholder="contoh: RAHASIA" oninput="doCipher()" style="width:200px;">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Teks Input</label>
          <textarea id="ci-input" style="min-height:160px;" oninput="doCipher()" placeholder="Tulis teks yang ingin dienkripsi..."></textarea>
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-primary" onclick="doCipher()">ğŸ” Enkripsi</button>
            <button class="btn btn-cyan" onclick="doCipherDecrypt()">ğŸ”“ Dekripsi</button>
          </div>
        </div>
        <div>
          <label>Hasil</label>
          <div class="output-box" id="ci-output" style="min-height:160px;">â€”
            <button class="copy-btn" onclick="cpOut('ci-output')">COPY</button>
          </div>
          <div style="margin-top:8px;font-size:0.75rem;color:var(--muted);" id="ci-info"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ASCII ART -->
  <div id="tab-ascii" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ–‹ï¸ ASCII Art Generator</div>
      <div class="panel-desc">// Konversi teks jadi ASCII art berbagai style font</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:flex-end;">
        <div style="flex:1;min-width:200px;">
          <label>Teks</label>
          <input type="text" id="aa-input" value="TOOLBOX" placeholder="Maks 10 karakter" maxlength="10" oninput="genAsciiArt()">
        </div>
        <div>
          <label>Style Font</label>
          <select id="aa-font" onchange="genAsciiArt()" style="min-width:160px;"></select>
        </div>
      </div>
      <div class="output-box" id="aa-output" style="font-size:0.62rem;line-height:1.2;min-height:120px;font-family:'Space Mono',monospace;white-space:pre;overflow-x:auto;color:var(--accent2);">â€”
        <button class="copy-btn" onclick="cpOut('aa-output')">COPY</button>
      </div>
      <div style="margin-top:12px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:8px;">Preview Semua Style:</div>
        <div id="aa-all-preview" style="display:flex;flex-direction:column;gap:12px;max-height:400px;overflow-y:auto;"></div>
      </div>
    </div>
  </div>

  <!-- POMODORO -->
  <div id="tab-pomodoro" class="tool-panel">
    <div class="panel-card" style="text-align:center;max-width:500px;margin:0 auto;">
      <div class="panel-title">ğŸ¯ Pomodoro Timer</div>
      <div class="panel-desc">// Teknik fokus 25 menit kerja, 5 menit istirahat</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-bottom:20px;">
        <button class="phrase-btn" id="pom-work-btn" onclick="pomSetMode('work')">ğŸ¯ Fokus</button>
        <button class="phrase-btn" id="pom-short-btn" onclick="pomSetMode('short')">â˜• Istirahat Pendek</button>
        <button class="phrase-btn" id="pom-long-btn" onclick="pomSetMode('long')">ğŸ˜´ Istirahat Panjang</button>
      </div>
      <div id="pom-display" style="font-family:'Space Mono',monospace;font-size:5rem;font-weight:700;color:var(--accent2);letter-spacing:4px;margin:20px 0;line-height:1;">25:00</div>
      <div id="pom-mode-label" style="font-size:0.85rem;color:var(--muted);margin-bottom:20px;">Mode: Fokus</div>
      <div style="display:flex;gap:10px;justify-content:center;margin-bottom:24px;">
        <button class="btn btn-primary" id="pom-btn" onclick="pomToggle()" style="min-width:120px;font-size:1rem;">â–¶ Mulai</button>
        <button class="btn btn-secondary" onclick="pomReset()">â†º Reset</button>
        <button class="btn btn-secondary" onclick="pomSkip()">â­ Skip</button>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.78rem;color:var(--muted);">
          <span>Progres Sesi</span><span id="pom-count">0 / 4 sesi</span>
        </div>
        <div style="display:flex;gap:6px;justify-content:center;" id="pom-dots"></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:16px;justify-content:center;flex-wrap:wrap;">
        <div><label style="display:block;font-size:0.72rem;margin-bottom:4px;">Fokus (menit)</label><input type="number" id="pom-work-min" value="25" min="1" max="90" style="width:70px;text-align:center;" onchange="pomReset()"></div>
        <div><label style="display:block;font-size:0.72rem;margin-bottom:4px;">Istirahat Pendek</label><input type="number" id="pom-short-min" value="5" min="1" max="30" style="width:70px;text-align:center;" onchange="pomReset()"></div>
        <div><label style="display:block;font-size:0.72rem;margin-bottom:4px;">Istirahat Panjang</label><input type="number" id="pom-long-min" value="15" min="1" max="60" style="width:70px;text-align:center;" onchange="pomReset()"></div>
      </div>
    </div>
  </div>

  <!-- TEXT TO SPEECH -->
  <div id="tab-tts" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¤ Text to Speech</div>
      <div class="panel-desc">// Ubah teks menjadi suara dengan berbagai pilihan</div>
      <label>Teks</label>
      <textarea id="tts-text" style="min-height:140px;" placeholder="Ketik teks yang ingin dibaca...">Halo! Selamat datang di Toolbox, kumpulan tools berguna buatan Adam yang ganteng.</textarea>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:12px;">
        <div>
          <label>Suara / Bahasa</label>
          <select id="tts-voice" style="width:100%;"></select>
        </div>
        <div>
          <label>Kecepatan: <span id="tts-rate-val">1x</span></label>
          <input type="range" id="tts-rate" min="0.5" max="2" value="1" step="0.1" oninput="document.getElementById('tts-rate-val').textContent=this.value+'x'">
          <label>Nada: <span id="tts-pitch-val">1</span></label>
          <input type="range" id="tts-pitch" min="0.5" max="2" value="1" step="0.1" oninput="document.getElementById('tts-pitch-val').textContent=this.value">
        </div>
      </div>
      <div class="btn-group" style="margin-top:16px;">
        <button class="btn btn-primary" onclick="ttsSpeak()" id="tts-btn">â–¶ Mulai Baca</button>
        <button class="btn btn-secondary" onclick="ttsPause()" id="tts-pause">â¸ Pause</button>
        <button class="btn btn-secondary" onclick="ttsStop()">â¹ Stop</button>
      </div>
      <div id="tts-status" style="margin-top:10px;font-size:0.78rem;color:var(--muted);">Siap membaca...</div>
      <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:8px;">Teks Cepat:</div>
        <div style="display:flex;flex-wrap:wrap;gap:6px;">
          <button class="phrase-btn" onclick="ttsQuick('Halo, selamat pagi!')">Selamat Pagi</button>
          <button class="phrase-btn" onclick="ttsQuick('Terima kasih banyak.')">Terima Kasih</button>
          <button class="phrase-btn" onclick="ttsQuick('Satu dua tiga empat lima enam tujuh delapan sembilan sepuluh.')">1-10</button>
          <button class="phrase-btn" onclick="ttsQuick('Waktunya istirahat!')">Waktunya Istirahat</button>
        </div>
      </div>
    </div>
  </div>

  <!-- OCR -->
  <div id="tab-ocr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“¸ Screenshot to Text (OCR)</div>
      <div class="panel-desc">// Ekstrak teks dari gambar â€” powered by Tesseract.js (offline)</div>
      <div id="ocr-drop" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;" onclick="document.getElementById('ocr-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="ocrDrop(event)">
        <div style="font-size:2.5rem;">ğŸ“¸</div>
        <div style="color:var(--muted);margin-top:8px;font-size:0.85rem;">Klik atau drag & drop gambar screenshot</div>
        <div style="color:var(--muted);font-size:0.72rem;margin-top:4px;">JPG, PNG, WebP â€” teks apapun di gambar akan diekstrak</div>
        <input type="file" id="ocr-file" accept="image/*" style="display:none;" onchange="ocrProcess(this)">
      </div>
      <div id="ocr-preview-wrap" style="display:none;margin-top:16px;">
        <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:start;">
          <img id="ocr-img" style="max-width:220px;max-height:220px;border-radius:8px;border:1px solid var(--border);">
          <div style="flex:1;">
            <label>Bahasa OCR</label>
            <select id="ocr-lang" style="width:100%;margin-bottom:8px;">
              <option value="eng">Inggris</option>
              <option value="ind" selected>Indonesia</option>
            </select>
            <button class="btn btn-primary" onclick="runOCR()" id="ocr-run-btn" style="width:100%;">ğŸ” Ekstrak Teks</button>
            <div id="ocr-progress" style="display:none;margin-top:10px;">
              <div style="background:var(--border);border-radius:4px;height:6px;overflow:hidden;"><div id="ocr-bar" style="height:100%;background:var(--accent);width:0%;transition:width 0.3s;border-radius:4px;"></div></div>
              <div id="ocr-prog-text" style="font-size:0.75rem;color:var(--muted);margin-top:4px;">Memuat...</div>
            </div>
          </div>
        </div>
        <label style="margin-top:16px;">Hasil Teks</label>
        <div class="output-box" id="ocr-output" style="min-height:120px;white-space:pre-wrap;">â€” klik Ekstrak Teks untuk memulai â€”
          <button class="copy-btn" onclick="cpOut('ocr-output')">COPY</button>
        </div>
        <div class="btn-group" style="margin-top:8px;">
          <button class="btn btn-secondary" onclick="ocrReset()">Ganti Gambar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AGE CALCULATOR -->
  <div id="tab-ageCalc" class="tool-panel">
    <div class="panel-card" style="max-width:600px;margin:0 auto;">
      <div class="panel-title">ğŸ§® Kalkulator Umur</div>
      <div class="panel-desc">// Hitung umur tepat, hari ulang tahun, dan milestone</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Tanggal Lahir</label>
          <input type="date" id="age-dob" oninput="calcAge()">
          <label style="margin-top:12px;">Hitung Sampai Tanggal</label>
          <input type="date" id="age-to" oninput="calcAge()">
          <button class="btn btn-secondary" onclick="document.getElementById('age-to').value=new Date().toISOString().slice(0,10);calcAge()" style="margin-top:8px;width:100%;">ğŸ“… Pakai Hari Ini</button>
        </div>
        <div id="age-result" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;min-height:160px;">
          <div style="color:var(--muted);font-size:0.8rem;text-align:center;padding-top:30px;">Isi tanggal lahir untuk melihat hasil</div>
        </div>
      </div>
      <div id="age-milestones" style="margin-top:16px;display:none;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Milestone Umur</div>
        <div id="age-milestone-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px;"></div>
      </div>
      <div id="age-bday" style="margin-top:12px;display:none;background:rgba(124,58,237,0.1);border:1px solid var(--accent);border-radius:10px;padding:14px;text-align:center;font-size:0.85rem;color:var(--accent2);"></div>
    </div>
  </div>

  <!-- NOISE GENERATOR -->
  <div id="tab-noise" class="tool-panel">
    <div class="panel-card" style="max-width:540px;margin:0 auto;text-align:center;">
      <div class="panel-title">ğŸŒŠ Noise Generator</div>
      <div class="panel-desc">// White, brown, pink noise â€” bantu fokus & relaksasi</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:20px 0;">
        <div id="noise-white-card" class="noise-card" onclick="toggleNoise('white')" style="background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;">
          <div style="font-size:2.5rem;">â¬œ</div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-top:8px;">White Noise</div>
          <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Semua frekuensi rata</div>
        </div>
        <div id="noise-pink-card" class="noise-card" onclick="toggleNoise('pink')" style="background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;">
          <div style="font-size:2.5rem;">ğŸŒ¸</div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-top:8px;">Pink Noise</div>
          <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Lembut & alami</div>
        </div>
        <div id="noise-brown-card" class="noise-card" onclick="toggleNoise('brown')" style="background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;">
          <div style="font-size:2.5rem;">ğŸŸ¤</div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-top:8px;">Brown Noise</div>
          <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Dalam & berumur</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:16px;">
        <span style="font-size:0.8rem;color:var(--muted);">ğŸ”ˆ</span>
        <input type="range" id="noise-vol" min="0" max="1" value="0.3" step="0.01" style="width:200px;" oninput="noiseSetVolume(this.value)">
        <span style="font-size:0.8rem;color:var(--muted);">ğŸ”Š</span>
        <span id="noise-vol-pct" style="font-size:0.78rem;color:var(--muted);min-width:35px;">30%</span>
      </div>
      <div id="noise-status" style="font-size:0.85rem;color:var(--muted);margin-bottom:12px;">Pilih noise untuk mulai</div>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
        <button class="phrase-btn" onclick="noiseTimer(25)">â± 25 menit</button>
        <button class="phrase-btn" onclick="noiseTimer(45)">â± 45 menit</button>
        <button class="phrase-btn" onclick="noiseTimer(60)">â± 1 jam</button>
        <button class="phrase-btn" onclick="stopAllNoise()">â¹ Stop Semua</button>
      </div>
      <div id="noise-timer-display" style="display:none;margin-top:12px;font-size:1.2rem;color:var(--accent3);font-family:'Space Mono',monospace;"></div>
    </div>
  </div>

  <!-- GLASSMORPHISM BUILDER -->
  <div id="tab-glass" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¨ CSS Glassmorphism Builder</div>
      <div class="panel-desc">// Buat efek kaca (glassmorphism) dan copy CSS-nya</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:20px;">
        <div>
          <label>Blur: <span id="gl-blur-v">12px</span></label>
          <input type="range" id="gl-blur" min="0" max="40" value="12" oninput="renderGlass()">
          <label>Transparansi: <span id="gl-alpha-v">0.15</span></label>
          <input type="range" id="gl-alpha" min="0" max="1" value="0.15" step="0.01" oninput="renderGlass()">
          <label>Border Opacity: <span id="gl-border-v">0.3</span></label>
          <input type="range" id="gl-border" min="0" max="1" value="0.3" step="0.01" oninput="renderGlass()">
          <label>Border Radius: <span id="gl-radius-v">16px</span></label>
          <input type="range" id="gl-radius" min="0" max="50" value="16" oninput="renderGlass()">
          <label>Shadow Intensity: <span id="gl-shadow-v">0.3</span></label>
          <input type="range" id="gl-shadow" min="0" max="1" value="0.3" step="0.01" oninput="renderGlass()">
          <label>Warna Tint</label>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
            <input type="color" id="gl-color" value="#ffffff" oninput="renderGlass()" style="width:50px;height:36px;">
            <span style="font-size:0.75rem;color:var(--muted);">Warna dasar kaca</span>
          </div>
          <label style="margin-top:12px;">Background Scene</label>
          <select id="gl-bg" onchange="renderGlass()">
            <option value="gradient1">ğŸŒˆ Gradient Purple-Cyan</option>
            <option value="gradient2">ğŸŒ… Gradient Sunset</option>
            <option value="gradient3">ğŸŒ¿ Gradient Forest</option>
            <option value="dots">âœ¦ Dark with Dots</option>
          </select>
        </div>
        <div>
          <label>Preview</label>
          <div id="gl-scene" style="height:280px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;">
            <div id="gl-card" style="padding:28px 36px;text-align:center;">
              <div style="font-size:2rem;">âœ¨</div>
              <div style="font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700;margin:8px 0;">Glass Card</div>
              <div style="font-size:0.82rem;opacity:0.8;">Efek glassmorphism yang cantik</div>
            </div>
          </div>
          <label style="margin-top:16px;">CSS Code</label>
          <div class="output-box" id="gl-code" style="font-size:0.78rem;min-height:80px;">â€”
            <button class="copy-btn" onclick="cpOut('gl-code')">COPY</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DEVICE MOCKUP -->
  <div id="tab-mockup" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“± Device Mockup Preview</div>
      <div class="panel-desc">// Preview URL atau HTML kamu di dalam frame perangkat</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:20px;">
        <div>
          <label>Perangkat</label>
          <select id="mk-device" onchange="renderMockup()">
            <option value="phone">ğŸ“± Smartphone</option>
            <option value="tablet">ğŸ“Ÿ Tablet</option>
            <option value="laptop">ğŸ’» Laptop</option>
          </select>
          <label>Warna Frame</label>
          <select id="mk-color" onchange="renderMockup()">
            <option value="#1a1a2e">ğŸ–¤ Dark</option>
            <option value="#f0f0f0">ğŸ¤ Silver</option>
            <option value="#ffd700">ğŸ¥‡ Gold</option>
            <option value="#7c3aed">ğŸŸ£ Purple</option>
          </select>
          <label style="margin-top:12px;">URL untuk Preview</label>
          <input type="text" id="mk-url" placeholder="https://example.com" value="https://example.com">
          <button class="btn btn-primary" onclick="renderMockup()" style="width:100%;margin-top:8px;">ğŸ”„ Load Preview</button>
          <div style="margin-top:12px;font-size:0.72rem;color:var(--muted);">âš  Beberapa website tidak bisa di-embed karena kebijakan CORS mereka.</div>
          <div class="btn-group" style="margin-top:10px;">
            <button class="btn btn-secondary" onclick="mkQuick('https://google.com')">Google</button>
            <button class="btn btn-secondary" onclick="mkQuick('https://example.com')">Example</button>
          </div>
        </div>
        <div style="display:flex;align-items:center;justify-content:center;min-height:400px;" id="mk-preview-wrap">
          <div id="mk-frame-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- NUMBER SYSTEM -->
  <div id="tab-numSys" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ”¢ Konversi Sistem Bilangan</div>
      <div class="panel-desc">// Konversi antara biner, oktal, desimal, dan heksadesimal</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
        <div>
          <label>Desimal (Basis 10)</label>
          <input type="text" id="ns-dec" placeholder="255" oninput="nsConvert('dec')">
          <label>Biner (Basis 2)</label>
          <input type="text" id="ns-bin" placeholder="11111111" oninput="nsConvert('bin')">
        </div>
        <div>
          <label>Oktal (Basis 8)</label>
          <input type="text" id="ns-oct" placeholder="377" oninput="nsConvert('oct')">
          <label>Heksadesimal (Basis 16)</label>
          <input type="text" id="ns-hex" placeholder="FF" oninput="nsConvert('hex')">
        </div>
      </div>
      <div id="ns-info" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;font-size:0.82rem;color:var(--muted);min-height:50px;margin-bottom:16px;"></div>
      <div style="border-top:1px solid var(--border);padding-top:16px;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Operasi Bitwise</div>
        <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:end;">
          <div><label>A (desimal)</label><input type="number" id="bw-a" placeholder="12" oninput="calcBitwise()"></div>
          <div><label>B (desimal)</label><input type="number" id="bw-b" placeholder="10" oninput="calcBitwise()"></div>
          <div><label>&nbsp;</label><button class="btn btn-primary" onclick="calcBitwise()">Hitung</button></div>
        </div>
        <div id="bw-result" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <!-- GAMES -->
  <div id="tab-games" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ® Mini Games</div>
      <div class="panel-desc">// Istirahat sejenak dengan game seru</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
        <button class="btn btn-primary" id="game-snake-btn" onclick="selectGame('snake')">ğŸ Snake</button>
        <button class="btn btn-secondary" id="game-flappy-btn" onclick="selectGame('flappy')">ğŸ¦ Flappy Bird</button>
        <button class="btn btn-secondary" id="game-2048-btn" onclick="selectGame('2048')">ğŸ”¢ 2048</button>
        <button class="btn btn-secondary" id="game-breakout-btn" onclick="selectGame('breakout')">ğŸ§± Breakout</button>
      </div>
      <div style="display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;">
        <div style="text-align:center;">
          <canvas id="game-canvas" width="400" height="450" style="border:2px solid var(--border);border-radius:10px;background:#0a0a0f;display:block;"></canvas>
          <div id="game-score" style="font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700;color:var(--accent2);margin-top:8px;">Skor: 0</div>
          <div id="game-controls-hint" style="font-size:0.72rem;color:var(--muted);margin-top:4px;"></div>
        </div>
        <div style="flex:1;min-width:200px;">
          <div id="game-info" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;font-size:0.82rem;color:var(--muted);line-height:1.8;"></div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="startGame()" id="game-start-btn">â–¶ Mulai</button>
            <button class="btn btn-secondary" onclick="pauseGame()" id="game-pause-btn">â¸ Pause</button>
          </div>
          <div id="game-highscore" style="margin-top:12px;font-size:0.78rem;color:var(--muted);"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI SUPPORT -->
  <div id="tab-aihelp" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¤– AI Assistant â€” Powered by Claude</div>
      <div class="panel-desc">// AI asli yang bisa mengelola & memperbaiki toolbox secara otomatis</div>

      <!-- Auto Scanner Strip -->
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px 16px;margin-bottom:12px;">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.82rem;color:var(--accent2);">ğŸ” Auto Bug Scanner</div>
          <select id="ai-scan-interval" style="width:110px;font-size:0.75rem;padding:4px 8px;">
            <option value="0">Manual saja</option>
            <option value="30">30 detik</option>
            <option value="60" selected>1 menit</option>
            <option value="120">2 menit</option>
            <option value="300">5 menit</option>
          </select>
          <button class="btn btn-primary" onclick="startAiScanner()" id="ai-scanner-btn" style="font-size:0.75rem;padding:5px 10px;">â–¶ Aktifkan</button>
          <button class="btn btn-secondary" onclick="stopAiScanner()" style="font-size:0.75rem;padding:5px 10px;">â¹ Stop</button>
          <button class="btn btn-cyan" onclick="runManualScan()" style="font-size:0.75rem;padding:5px 10px;">ğŸ” Scan Now</button>
        </div>
        <div id="ai-scanner-status" style="margin-top:6px;font-size:0.72rem;color:var(--muted);">Scanner belum aktif</div>
        <div id="ai-scan-log" style="margin-top:6px;max-height:80px;overflow-y:auto;font-size:0.68rem;font-family:'Space Mono',monospace;display:flex;flex-direction:column;gap:2px;"></div>
      </div>

      <!-- Chat -->
      <div id="ai-messages" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:320px;max-height:420px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;">
        <div class="ai-msg ai-bot">
          <div class="ai-avatar">ğŸ¤–</div>
          <div class="ai-bubble">Halo! Saya <strong>Claude AI</strong> â€” AI asli yang terintegrasi di Toolbox ini.<br><br>Saya bisa:<br>â€¢ ğŸ’¬ Menjawab pertanyaan apapun dengan cerdas<br>â€¢ ğŸ”§ Mendeteksi & memperbaiki bug otomatis<br>â€¢ ğŸš€ Membuka tool, menjelaskan fitur, membantu tugas<br>â€¢ ğŸ“Š Menganalisis data & memberi saran<br><br>Tanya apapun â€” saya siap membantu! âœ¨</div>
        </div>
      </div>

      <!-- Input area -->
      <div style="display:flex;gap:8px;margin-top:10px;">
        <textarea id="ai-input" placeholder="Tanya apapun ke Claude AI... (Enter = kirim, Shift+Enter = baris baru)" style="flex:1;min-height:44px;max-height:120px;resize:vertical;font-size:0.85rem;line-height:1.5;" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendAI();}"></textarea>
        <button class="btn btn-primary" onclick="sendAI()" id="ai-send-btn" style="align-self:flex-end;padding:12px 18px;">â¤</button>
      </div>

      <!-- Quick actions -->
      <div style="display:flex;flex-wrap:wrap;gap:5px;margin-top:8px;">
        <button class="phrase-btn" onclick="aiQuick('Buka tab translate')">Buka Translate</button>
        <button class="phrase-btn" onclick="aiQuick('Scan dan perbaiki semua bug di toolbox ini')">Scan Bug</button>
        <button class="phrase-btn" onclick="aiQuick('Tools apa saja yang ada di toolbox ini?')">List Tools</button>
        <button class="phrase-btn" onclick="aiQuick('Generate password yang kuat untuk saya')">Generate Password</button>
        <button class="phrase-btn" onclick="aiQuick('Analisis keadaan toolbox sekarang â€” apakah ada yang perlu diperbaiki?')">Analisis Toolbox</button>
        <button class="phrase-btn" onclick="aiQuick('Buatkan to-do list untuk hari ini')">Buat To-Do</button>
        <button class="phrase-btn" onclick="aiQuick('Reset semua game ke kondisi awal')">Reset Games</button>
      </div>
    </div>
  </div>

  <!-- CALENDAR -->
  <div id="tab-calendar" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“… Kalender & Event Planner</div>
      <div class="panel-desc">// Jadwal bulanan, tambah event berwarna, tersimpan di browser</div>
      <div style="display:grid;grid-template-columns:1fr 300px;gap:16px;">
        <div>
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
            <button class="btn btn-secondary" onclick="calNav(-1)" style="padding:6px 14px;">â€¹</button>
            <div id="cal-title" style="flex:1;text-align:center;font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem;"></div>
            <button class="btn btn-secondary" onclick="calNav(1)" style="padding:6px 14px;">â€º</button>
            <button class="btn btn-primary" onclick="calGoToday()" style="padding:6px 12px;font-size:0.75rem;">Hari ini</button>
          </div>
          <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:4px;">
            <div style="text-align:center;font-size:0.7rem;color:var(--muted);padding:4px;" id="cal-daynames"></div>
          </div>
          <div id="cal-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;"></div>
        </div>
        <div>
          <div id="cal-selected-label" style="font-size:0.78rem;color:var(--muted);margin-bottom:8px;">Pilih tanggal untuk tambah event</div>
          <div id="cal-event-form" style="display:none;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:12px;">
            <label>Nama Event</label>
            <input type="text" id="cal-ev-name" placeholder="Nama event...">
            <label>Waktu</label>
            <input type="time" id="cal-ev-time" value="09:00">
            <label>Warna</label>
            <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;" id="cal-color-picker">
              <div class="cal-color-dot active-cal-color" data-color="#7c3aed" onclick="selectCalColor('#7c3aed',this)" style="width:22px;height:22px;border-radius:50%;background:#7c3aed;cursor:pointer;border:2px solid white;"></div>
              <div class="cal-color-dot" data-color="#06b6d4" onclick="selectCalColor('#06b6d4',this)" style="width:22px;height:22px;border-radius:50%;background:#06b6d4;cursor:pointer;border:2px solid transparent;"></div>
              <div class="cal-color-dot" data-color="#10b981" onclick="selectCalColor('#10b981',this)" style="width:22px;height:22px;border-radius:50%;background:#10b981;cursor:pointer;border:2px solid transparent;"></div>
              <div class="cal-color-dot" data-color="#f59e0b" onclick="selectCalColor('#f59e0b',this)" style="width:22px;height:22px;border-radius:50%;background:#f59e0b;cursor:pointer;border:2px solid transparent;"></div>
              <div class="cal-color-dot" data-color="#ef4444" onclick="selectCalColor('#ef4444',this)" style="width:22px;height:22px;border-radius:50%;background:#ef4444;cursor:pointer;border:2px solid transparent;"></div>
              <div class="cal-color-dot" data-color="#ec4899" onclick="selectCalColor('#ec4899',this)" style="width:22px;height=22px;border-radius:50%;background:#ec4899;cursor:pointer;border:2px solid transparent;"></div>
            </div>
            <button class="btn btn-primary" onclick="addCalEvent()" style="width:100%;margin-top:10px;">+ Tambah Event</button>
          </div>
          <div id="cal-events-list" style="display:flex;flex-direction:column;gap:6px;max-height:340px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- BUDGET TRACKER -->
  <div id="tab-budget" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ’° Budget Tracker</div>
      <div class="panel-desc">// Catat pemasukan & pengeluaran, lihat grafik keuangan</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;" id="budget-summary"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.88rem;margin-bottom:12px;color:var(--accent2);">+ Transaksi Baru</div>
            <div style="display:flex;gap:6px;margin-bottom:10px;">
              <button class="btn btn-primary" id="bud-inc-btn" onclick="setBudType('income')" style="flex:1;font-size:0.78rem;">ğŸ’š Pemasukan</button>
              <button class="btn btn-secondary" id="bud-exp-btn" onclick="setBudType('expense')" style="flex:1;font-size:0.78rem;">â¤ï¸ Pengeluaran</button>
            </div>
            <input type="text" id="bud-desc" placeholder="Keterangan...">
            <input type="number" id="bud-amount" placeholder="Jumlah (Rp)" style="margin-top:8px;">
            <select id="bud-cat" style="margin-top:8px;">
              <option value="makanan">ğŸ” Makanan</option>
              <option value="transportasi">ğŸš— Transportasi</option>
              <option value="belanja">ğŸ›ï¸ Belanja</option>
              <option value="hiburan">ğŸ® Hiburan</option>
              <option value="kesehatan">ğŸ’Š Kesehatan</option>
              <option value="pendidikan">ğŸ“š Pendidikan</option>
              <option value="gaji">ğŸ’¼ Gaji/Bonus</option>
              <option value="lainnya">ğŸ“¦ Lainnya</option>
            </select>
            <input type="date" id="bud-date" style="margin-top:8px;">
            <button class="btn btn-primary" onclick="addBudget()" style="width:100%;margin-top:10px;">Tambah</button>
          </div>
          <canvas id="bud-chart" width="280" height="200" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;"></canvas>
        </div>
        <div>
          <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center;">
            <input type="text" id="bud-search" placeholder="Cari..." style="flex:1;font-size:0.8rem;" oninput="renderBudget()">
            <select id="bud-filter" onchange="renderBudget()" style="width:130px;font-size:0.78rem;">
              <option value="all">Semua</option>
              <option value="income">Pemasukan</option>
              <option value="expense">Pengeluaran</option>
            </select>
            <button class="btn btn-secondary" onclick="exportBudgetCSV()" style="font-size:0.72rem;padding:6px 10px;">CSV</button>
          </div>
          <div id="bud-list" style="display:flex;flex-direction:column;gap:6px;max-height:420px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- HABIT TRACKER -->
  <div id="tab-habit" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¯ Habit Tracker</div>
      <div class="panel-desc">// Pantau kebiasaan harian, streak, statistik 30 hari</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;align-items:flex-end;">
        <input type="text" id="habit-name" placeholder="Nama kebiasaan baru..." style="flex:1;" onkeydown="if(event.key==='Enter')addHabit()">
        <input type="text" id="habit-icon" placeholder="Ikon" style="width:60px;text-align:center;" value="â­">
        <select id="habit-color" style="width:110px;">
          <option value="#7c3aed">ğŸŸ£ Ungu</option>
          <option value="#06b6d4">ğŸ”µ Cyan</option>
          <option value="#10b981">ğŸŸ¢ Hijau</option>
          <option value="#f59e0b">ğŸŸ¡ Kuning</option>
          <option value="#ef4444">ğŸ”´ Merah</option>
        </select>
        <button class="btn btn-primary" onclick="addHabit()">+ Tambah</button>
      </div>
      <div id="habit-list" style="display:flex;flex-direction:column;gap:12px;"></div>
      <div id="habit-empty" style="text-align:center;color:var(--muted);padding:30px;font-size:0.85rem;">Belum ada habit. Tambahkan kebiasaan yang ingin kamu pantau! ğŸ’ª</div>
    </div>
  </div>

  <!-- FLASHCARD -->
  <div id="tab-flashcard" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“– Flashcard & Quiz Maker</div>
      <div class="panel-desc">// Buat kartu belajar, kuis interaktif, & lacak progres</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <button class="btn btn-primary" id="fc-mode-manage" onclick="setFCMode('manage')">ğŸ“ Kelola Kartu</button>
        <button class="btn btn-secondary" id="fc-mode-study" onclick="setFCMode('study')">ğŸ“– Belajar</button>
        <button class="btn btn-secondary" id="fc-mode-quiz" onclick="setFCMode('quiz')">ğŸ¯ Kuis</button>
      </div>
      <!-- Manage mode -->
      <div id="fc-manage">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
          <div>
            <label>Pertanyaan / Depan Kartu</label>
            <textarea id="fc-front" style="min-height:80px;" placeholder="Tulis pertanyaan..."></textarea>
          </div>
          <div>
            <label>Jawaban / Belakang Kartu</label>
            <textarea id="fc-back" style="min-height:80px;" placeholder="Tulis jawaban..."></textarea>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-bottom:16px;">
          <select id="fc-deck" style="flex:1;">
            <option value="default">ğŸ“š Deck Default</option>
          </select>
          <input type="text" id="fc-new-deck" placeholder="Deck baru..." style="flex:1;">
          <button class="btn btn-secondary" onclick="addFCDeck()">+ Deck</button>
          <button class="btn btn-primary" onclick="addFlashcard()">+ Kartu</button>
        </div>
        <div id="fc-card-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;max-height:300px;overflow-y:auto;"></div>
      </div>
      <!-- Study mode -->
      <div id="fc-study" style="display:none;text-align:center;">
        <div style="font-size:0.8rem;color:var(--muted);margin-bottom:12px;" id="fc-study-progress"></div>
        <div id="fc-card-display" onclick="flipFCCard()" style="cursor:pointer;background:var(--bg);border:2px solid var(--accent);border-radius:16px;padding:40px 30px;min-height:180px;display:flex;align-items:center;justify-content:center;flex-direction:column;transition:all 0.3s;position:relative;overflow:hidden;">
          <div style="font-size:0.7rem;color:var(--muted);position:absolute;top:12px;left:50%;transform:translateX(-50%);text-transform:uppercase;letter-spacing:1px;" id="fc-card-side">PERTANYAAN</div>
          <div id="fc-card-text" style="font-size:1.1rem;text-align:center;line-height:1.6;"></div>
        </div>
        <div style="margin-top:16px;display:flex;gap:8px;justify-content:center;">
          <button class="btn btn-secondary" onclick="fcStudyNav(-1)">â€¹ Prev</button>
          <button class="btn btn-primary" onclick="flipFCCard()">ğŸ”„ Flip</button>
          <button class="btn btn-secondary" onclick="fcStudyNav(1)">Next â€º</button>
          <button class="btn btn-secondary" onclick="shuffleFC()">ğŸ”€ Acak</button>
        </div>
      </div>
      <!-- Quiz mode -->
      <div id="fc-quiz" style="display:none;">
        <div id="fc-quiz-content"></div>
      </div>
    </div>
  </div>

  <!-- VIDEO TO GIF -->
  <div id="tab-videogif" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¬ Video â†’ GIF Converter</div>
      <div class="panel-desc">// Konversi video pendek jadi GIF animasi langsung di browser</div>
      <div id="vg-upload" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;" onclick="document.getElementById('vg-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="vgDrop(event)">
        <div style="font-size:2.5rem;">ğŸ¬</div>
        <div style="color:var(--muted);margin-top:8px;">Klik atau drag & drop video (MP4, WebM, MOV)</div>
        <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Max 30 detik direkomendasikan</div>
        <input type="file" id="vg-file" accept="video/*" style="display:none;" onchange="vgLoad(this)">
      </div>
      <div id="vg-controls" style="display:none;margin-top:16px;">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div>
            <video id="vg-video" style="width:100%;border-radius:8px;border:1px solid var(--border);" controls></video>
            <div style="margin-top:12px;">
              <label>Mulai (detik): <span id="vg-start-v">0</span></label>
              <input type="range" id="vg-start" min="0" max="30" value="0" step="0.1" oninput="document.getElementById('vg-start-v').textContent=this.value;vgPreviewFrame()">
              <label>Selesai (detik): <span id="vg-end-v">5</span></label>
              <input type="range" id="vg-end" min="0" max="30" value="5" step="0.1" oninput="document.getElementById('vg-end-v').textContent=this.value">
              <label>FPS: <span id="vg-fps-v">10</span></label>
              <input type="range" id="vg-fps" min="5" max="25" value="10" oninput="document.getElementById('vg-fps-v').textContent=this.value">
              <label>Lebar output: <span id="vg-width-v">320</span>px</label>
              <input type="range" id="vg-width" min="100" max="640" value="320" step="10" oninput="document.getElementById('vg-width-v').textContent=this.value">
            </div>
          </div>
          <div style="text-align:center;">
            <label>Preview Frame</label>
            <canvas id="vg-preview" style="max-width:100%;border:1px solid var(--border);border-radius:8px;display:block;margin:0 auto;"></canvas>
            <div class="btn-group" style="margin-top:12px;justify-content:center;">
              <button class="btn btn-primary" onclick="vgConvert()" id="vg-convert-btn">ğŸ¬ Convert ke GIF</button>
              <button class="btn btn-secondary" onclick="vgReset()">Ganti Video</button>
            </div>
            <div id="vg-progress" style="display:none;margin-top:12px;">
              <div style="background:var(--border);border-radius:4px;height:8px;overflow:hidden;"><div id="vg-bar" style="height:100%;background:var(--accent);width:0%;transition:width 0.1s;border-radius:4px;"></div></div>
              <div id="vg-prog-text" style="font-size:0.75rem;color:var(--muted);margin-top:4px;"></div>
            </div>
            <div id="vg-result" style="margin-top:12px;display:none;">
              <img id="vg-gif-out" style="max-width:100%;border-radius:8px;border:1px solid var(--border);">
              <button class="btn btn-primary" onclick="vgDownload()" style="margin-top:8px;width:100%;">â¬‡ Download GIF</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MEME GENERATOR -->
  <div id="tab-meme" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ–¼ï¸ Meme Generator</div>
      <div class="panel-desc">// Upload gambar atau pilih template, tambah teks, download meme!</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Upload Gambar atau Pilih Template</label>
          <div style="display:flex;gap:8px;margin-bottom:10px;">
            <button class="btn btn-primary" onclick="document.getElementById('meme-file').click()" style="flex:1;">ğŸ“ Upload</button>
            <button class="btn btn-secondary" onclick="showMemeTemplates()" style="flex:1;">ğŸ­ Template</button>
            <input type="file" id="meme-file" accept="image/*" style="display:none;" onchange="memeLoad(this)">
          </div>
          <div id="meme-templates" style="display:none;display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px;"></div>
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;">
            <label>Teks Atas</label>
            <input type="text" id="meme-top" placeholder="TEKS ATAS..." oninput="renderMeme()" style="text-transform:uppercase;">
            <label>Teks Bawah</label>
            <input type="text" id="meme-bottom" placeholder="TEKS BAWAH..." oninput="renderMeme()" style="text-transform:uppercase;">
            <label>Ukuran Font: <span id="meme-size-v">48</span>px</label>
            <input type="range" id="meme-size" min="20" max="100" value="48" oninput="document.getElementById('meme-size-v').textContent=this.value;renderMeme()">
            <label>Warna Teks</label>
            <div style="display:flex;gap:8px;">
              <input type="color" id="meme-color" value="#ffffff" oninput="renderMeme()" style="width:50px;height:36px;">
              <input type="color" id="meme-stroke" value="#000000" oninput="renderMeme()" style="width:50px;height:36px;">
              <span style="font-size:0.72rem;color:var(--muted);align-self:center;">Fill Â· Outline</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="memeDL()" style="width:100%;margin-top:10px;">â¬‡ Download Meme</button>
        </div>
        <div>
          <label>Preview</label>
          <canvas id="meme-canvas" style="max-width:100%;border-radius:8px;border:1px solid var(--border);display:block;"></canvas>
          <div id="meme-ph" style="background:var(--bg);border:2px dashed var(--border);border-radius:8px;height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:0.85rem;flex-direction:column;gap:8px;">
            <div style="font-size:2rem;">ğŸ–¼ï¸</div>Upload gambar untuk mulai
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BPM TAP COUNTER -->
  <div id="tab-bpm" class="tool-panel">
    <div class="panel-card" style="max-width:500px;margin:0 auto;text-align:center;">
      <div class="panel-title">ğŸµ BPM Tap Counter</div>
      <div class="panel-desc">// Tap mengikuti ketukan lagu untuk hitung BPM</div>
      <div id="bpm-display" style="font-family:'Space Mono',monospace;font-size:6rem;font-weight:700;color:var(--accent2);letter-spacing:2px;margin:20px 0;line-height:1;transition:transform 0.05s;">--</div>
      <div style="font-size:0.85rem;color:var(--muted);margin-bottom:8px;" id="bpm-label">Tap mengikuti ketukan musik</div>
      <button id="bpm-tap-btn" onclick="tapBPM()" style="width:200px;height:200px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:white;font-family:'Syne',sans-serif;font-size:1.8rem;font-weight:800;cursor:pointer;transition:all 0.1s;box-shadow:0 0 40px rgba(124,58,237,0.4);" onmousedown="this.style.transform='scale(0.93)'" onmouseup="this.style.transform='scale(1)'" onkeydown="">
        TAP
      </button>
      <div style="margin-top:20px;font-size:0.8rem;color:var(--muted);">atau tekan <kbd style="background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:2px 6px;">Spasi</kbd></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:20px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;">
          <div id="bpm-taps" style="font-size:1.3rem;font-weight:700;color:var(--accent3);">0</div>
          <div style="font-size:0.7rem;color:var(--muted);">Tap</div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;">
          <div id="bpm-min" style="font-size:1.3rem;font-weight:700;color:var(--success);">--</div>
          <div style="font-size:0.7rem;color:var(--muted);">Min BPM</div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;">
          <div id="bpm-max" style="font-size:1.3rem;font-weight:700;color:var(--danger);">--</div>
          <div style="font-size:0.7rem;color:var(--muted);">Max BPM</div>
        </div>
      </div>
      <div id="bpm-genre" style="margin-top:16px;background:rgba(124,58,237,0.1);border:1px solid var(--accent);border-radius:8px;padding:12px;font-size:0.85rem;display:none;"></div>
      <div class="btn-group" style="margin-top:16px;justify-content:center;">
        <button class="btn btn-secondary" onclick="resetBPM()">â†º Reset</button>
      </div>
    </div>
  </div>

  <!-- URL SHORTENER + QR -->
  <div id="tab-urlqr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸŒ URL Shortener + QR Combo</div>
      <div class="panel-desc">// Persingkat URL via TinyURL API + langsung buat QR Code-nya</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
        <div>
          <label>URL Panjang</label>
          <textarea id="uq-input" style="min-height:80px;" placeholder="https://link-panjang-banget.com/dengan/banyak/parameter?query=1&foo=bar"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button class="btn btn-primary" onclick="shortenURL()" id="uq-btn" style="flex:1;">âœ‚ï¸ Persingkat + QR</button>
            <button class="btn btn-secondary" onclick="uqPaste()">ğŸ“‹ Paste</button>
          </div>
          <div style="margin-top:12px;">
            <label>URL Pendek</label>
            <div style="display:flex;gap:8px;">
              <input type="text" id="uq-short" readonly placeholder="Hasil URL pendek..." style="flex:1;cursor:pointer;" onclick="this.select();">
              <button class="btn btn-cyan" onclick="copyUQ()">Copy</button>
            </div>
          </div>
          <div id="uq-info" style="margin-top:8px;font-size:0.75rem;color:var(--muted);"></div>
          <div style="margin-top:16px;">
            <label>Riwayat URL (tersimpan lokal)</label>
            <div id="uq-history" style="display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto;"></div>
          </div>
        </div>
        <div style="text-align:center;">
          <label>QR Code</label>
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:20px;display:inline-block;">
            <canvas id="uq-qr" style="display:none;"></canvas>
            <div id="uq-qr-ph" style="width:200px;height:200px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:0.8rem;flex-direction:column;gap:8px;"><div style="font-size:2rem;">ğŸ“±</div>QR muncul otomatis</div>
          </div>
          <div style="margin-top:12px;">
            <label>Warna QR</label>
            <div style="display:flex;gap:8px;justify-content:center;align-items:center;">
              <input type="color" id="uq-fg" value="#e8e8f0" style="width:44px;height:36px;" oninput="uqRegenQR()">
              <span style="font-size:0.72rem;color:var(--muted);">Garis</span>
              <input type="color" id="uq-bg" value="#0a0a0f" style="width:44px;height:36px;" oninput="uqRegenQR()">
              <span style="font-size:0.72rem;color:var(--muted);">BG</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="uqDLQR()" style="margin-top:10px;">â¬‡ Download QR</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CALENDAR -->
  <div id="tab-calendar" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“… Kalender & Event Planner</div>
      <div class="panel-desc">// Catat jadwal & event â€” tersimpan otomatis di browser</div>
      <div style="display:grid;grid-template-columns:1fr 300px;gap:16px;">
        <div>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
            <button class="btn btn-secondary" onclick="calNav(-1)" style="padding:6px 14px;">â—€</button>
            <div id="cal-title" style="font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem;color:var(--text);"></div>
            <button class="btn btn-secondary" onclick="calNav(1)" style="padding:6px 14px;">â–¶</button>
          </div>
          <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:4px;">
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Min</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Sen</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Sel</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Rab</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Kam</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Jum</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Sab</div>
          </div>
          <div id="cal-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;"></div>
        </div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.85rem;color:var(--accent2);margin-bottom:10px;" id="cal-selected-date">Pilih tanggal</div>
          <input type="text" id="cal-event-title" placeholder="Judul event..." style="width:100%;margin-bottom:8px;">
          <div style="display:flex;gap:6px;margin-bottom:8px;">
            <input type="time" id="cal-event-time" style="flex:1;">
            <input type="color" id="cal-event-color" value="#7c3aed" style="width:44px;height:38px;">
          </div>
          <select id="cal-event-cat" style="width:100%;margin-bottom:8px;">
            <option value="kerja">ğŸ’¼ Kerja</option><option value="personal">ğŸ‘¤ Personal</option>
            <option value="kesehatan">ğŸ¥ Kesehatan</option><option value="belajar">ğŸ“š Belajar</option>
            <option value="lainnya">ğŸ“Œ Lainnya</option>
          </select>
          <button class="btn btn-primary" onclick="calAddEvent()" style="width:100%;">+ Tambah Event</button>
          <div id="cal-day-events" style="margin-top:12px;display:flex;flex-direction:column;gap:6px;max-height:260px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- BUDGET TRACKER -->
  <div id="tab-budget" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ’° Budget Tracker</div>
      <div class="panel-desc">// Catat pemasukan & pengeluaran, lihat grafik keuangan</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:20px;">
        <div style="background:rgba(16,185,129,0.1);border:1px solid var(--success);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:0.7rem;color:var(--success);text-transform:uppercase;letter-spacing:1px;">Total Pemasukan</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--success);" id="bgt-income">Rp 0</div>
        </div>
        <div style="background:rgba(239,68,68,0.1);border:1px solid var(--danger);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:0.7rem;color:var(--danger);text-transform:uppercase;letter-spacing:1px;">Total Pengeluaran</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--danger);" id="bgt-expense">Rp 0</div>
        </div>
        <div id="bgt-balance-card" style="background:rgba(124,58,237,0.1);border:1px solid var(--accent);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:0.7rem;color:var(--accent2);text-transform:uppercase;letter-spacing:1px;">Saldo</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--accent2);" id="bgt-balance">Rp 0</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.85rem;color:var(--text);margin-bottom:12px;">+ Tambah Transaksi</div>
          <div style="display:flex;gap:6px;margin-bottom:10px;">
            <button class="btn" id="bgt-type-in" onclick="setBgtType('income')" style="flex:1;background:rgba(16,185,129,0.2);border:1px solid var(--success);color:var(--success);">+ Masuk</button>
            <button class="btn" id="bgt-type-out" onclick="setBgtType('expense')" style="flex:1;background:var(--surface2);border:1px solid var(--border);color:var(--muted);">âˆ’ Keluar</button>
          </div>
          <input type="text" id="bgt-desc" placeholder="Keterangan..." style="width:100%;margin-bottom:8px;">
          <input type="number" id="bgt-amount" placeholder="Jumlah (Rp)" style="width:100%;margin-bottom:8px;">
          <select id="bgt-cat" style="width:100%;margin-bottom:8px;">
            <option value="gaji">ğŸ’¼ Gaji/Usaha</option><option value="makanan">ğŸ” Makanan</option>
            <option value="transport">ğŸš— Transport</option><option value="belanja">ğŸ›ï¸ Belanja</option>
            <option value="tagihan">ğŸ“„ Tagihan</option><option value="hiburan">ğŸ® Hiburan</option>
            <option value="lainnya">ğŸ“Œ Lainnya</option>
          </select>
          <input type="date" id="bgt-date" style="width:100%;margin-bottom:10px;">
          <button class="btn btn-primary" onclick="bgtAdd()" style="width:100%;">Simpan</button>
        </div>
        <div>
          <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center;flex-wrap:wrap;">
            <button class="phrase-btn" onclick="bgtFilter('all')">Semua</button>
            <button class="phrase-btn" onclick="bgtFilter('income')">Pemasukan</button>
            <button class="phrase-btn" onclick="bgtFilter('expense')">Pengeluaran</button>
            <button class="btn btn-secondary" onclick="bgtExport()" style="margin-left:auto;font-size:0.72rem;padding:5px 10px;">Export CSV</button>
            <button class="btn btn-secondary" onclick="if(confirm('Hapus semua?'))bgtClear()" style="font-size:0.72rem;padding:5px 10px;color:var(--danger);">Hapus Semua</button>
          </div>
          <canvas id="bgt-chart" height="120" style="width:100%;margin-bottom:12px;"></canvas>
          <div id="bgt-list" style="display:flex;flex-direction:column;gap:6px;max-height:300px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- HABIT TRACKER -->
  <div id="tab-habit" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¯ Habit Tracker</div>
      <div class="panel-desc">// Pantau kebiasaan harian â€” streak & statistik 30 hari</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;align-items:flex-end;flex-wrap:wrap;">
        <input type="text" id="habit-name" placeholder="Nama kebiasaan baru..." style="flex:1;min-width:180px;">
        <input type="color" id="habit-color" value="#7c3aed" style="width:44px;height:38px;">
        <select id="habit-icon" style="width:80px;">
          <option>ğŸ’ª</option><option>ğŸ“š</option><option>ğŸƒ</option><option>ğŸ’§</option>
          <option>ğŸ§˜</option><option>ğŸ¥—</option><option>ğŸ˜´</option><option>ğŸ¯</option>
          <option>âœï¸</option><option>ğŸ¸</option>
        </select>
        <button class="btn btn-primary" onclick="habitAdd()">+ Tambah</button>
      </div>
      <div id="habit-list" style="display:flex;flex-direction:column;gap:10px;"></div>
      <div id="habit-empty" style="text-align:center;color:var(--muted);padding:30px;font-size:0.85rem;display:none;">Belum ada kebiasaan. Tambahkan di atas!</div>
    </div>
  </div>

  <!-- FLASHCARD -->
  <div id="tab-flashcard" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ“– Flashcard & Quiz Maker</div>
      <div class="panel-desc">// Buat kartu belajar dan kuis interaktif</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <button class="btn btn-primary" id="fc-mode-create" onclick="setFcMode('create')">âœï¸ Buat Kartu</button>
        <button class="btn btn-secondary" id="fc-mode-study" onclick="setFcMode('study')">ğŸ“– Belajar</button>
        <button class="btn btn-secondary" id="fc-mode-quiz" onclick="setFcMode('quiz')">ğŸ¯ Kuis</button>
      </div>
      <!-- CREATE MODE -->
      <div id="fc-create">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px;">
          <div><label>Pertanyaan / Depan</label><textarea id="fc-q" style="min-height:80px;" placeholder="Apa itu fotosintesis?"></textarea></div>
          <div><label>Jawaban / Belakang</label><textarea id="fc-a" style="min-height:80px;" placeholder="Proses tumbuhan mengubah cahaya matahari jadi makanan..."></textarea></div>
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end;">
          <div style="flex:1;"><label>Deck / Kategori</label><input type="text" id="fc-deck" placeholder="Nama deck..."></div>
          <button class="btn btn-primary" onclick="fcAddCard()">+ Tambah Kartu</button>
          <button class="btn btn-secondary" onclick="fcImport()">Import CSV</button>
        </div>
        <div id="fc-card-list" style="margin-top:16px;display:flex;flex-direction:column;gap:6px;max-height:300px;overflow-y:auto;"></div>
      </div>
      <!-- STUDY MODE -->
      <div id="fc-study" style="display:none;text-align:center;">
        <div style="margin-bottom:12px;"><label>Deck: </label>
          <select id="fc-study-deck" style="width:200px;" onchange="fcStudyInit()"></select>
        </div>
        <div id="fc-flip-card" onclick="fcFlip()" style="cursor:pointer;background:var(--bg);border:2px solid var(--border);border-radius:16px;padding:40px 24px;min-height:180px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;position:relative;margin-bottom:16px;">
          <div id="fc-flip-content" style="font-size:1.2rem;color:var(--text);text-align:center;"></div>
          <div style="position:absolute;bottom:10px;right:14px;font-size:0.68rem;color:var(--muted);">Klik untuk balik</div>
        </div>
        <div style="display:flex;gap:8px;justify-content:center;margin-bottom:12px;">
          <button class="btn btn-secondary" onclick="fcStudyNav(-1)">â—€ Prev</button>
          <span id="fc-study-progress" style="line-height:2.2;font-size:0.82rem;color:var(--muted);"></span>
          <button class="btn btn-secondary" onclick="fcStudyNav(1)">Next â–¶</button>
        </div>
        <div style="display:flex;gap:8px;justify-content:center;">
          <button class="btn btn-secondary" onclick="fcStudyInit()">ğŸ”€ Acak Ulang</button>
        </div>
      </div>
      <!-- QUIZ MODE -->
      <div id="fc-quiz" style="display:none;">
        <div id="fc-quiz-setup" style="text-align:center;">
          <label>Deck: </label><select id="fc-quiz-deck" style="width:200px;"></select>
          <button class="btn btn-primary" onclick="fcQuizStart()" style="margin-left:10px;">Mulai Kuis</button>
        </div>
        <div id="fc-quiz-play" style="display:none;">
          <div id="fc-quiz-q" style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:24px;text-align:center;font-size:1.1rem;min-height:80px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;"></div>
          <input type="text" id="fc-quiz-ans" placeholder="Ketik jawaban..." style="width:100%;margin-bottom:8px;" onkeydown="if(event.key==='Enter')fcQuizCheck()">
          <div style="display:flex;gap:8px;justify-content:center;">
            <button class="btn btn-primary" onclick="fcQuizCheck()">âœ“ Cek</button>
            <button class="btn btn-secondary" onclick="fcQuizSkip()">Skip â–¶</button>
          </div>
          <div id="fc-quiz-feedback" style="text-align:center;margin-top:12px;font-size:0.9rem;min-height:32px;"></div>
          <div style="margin-top:8px;font-size:0.78rem;color:var(--muted);text-align:center;" id="fc-quiz-score"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- VIDEO TO GIF -->
  <div id="tab-videogif" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ¬ Video â†’ GIF Converter</div>
      <div class="panel-desc">// Konversi video pendek jadi GIF langsung di browser</div>
      <div id="vg-drop" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;" onclick="document.getElementById('vg-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="vgDrop(event)">
        <div style="font-size:2.5rem;">ğŸ¬</div>
        <div style="color:var(--muted);margin-top:8px;font-size:0.85rem;">Klik atau drag & drop video</div>
        <div style="color:var(--muted);font-size:0.72rem;margin-top:4px;">MP4, WebM, MOV â€” max 50MB</div>
        <input type="file" id="vg-file" accept="video/*" style="display:none;" onchange="vgLoad(this)">
      </div>
      <div id="vg-controls" style="display:none;margin-top:16px;">
        <video id="vg-video" style="max-width:100%;border-radius:8px;margin-bottom:12px;" controls></video>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px;">
          <div>
            <label>Mulai (detik): <span id="vg-start-v">0</span></label>
            <input type="range" id="vg-start" min="0" max="30" value="0" step="0.1" oninput="document.getElementById('vg-start-v').textContent=parseFloat(this.value).toFixed(1)">
            <label>Selesai (detik): <span id="vg-end-v">5</span></label>
            <input type="range" id="vg-end" min="0" max="30" value="5" step="0.1" oninput="document.getElementById('vg-end-v').textContent=parseFloat(this.value).toFixed(1)">
          </div>
          <div>
            <label>FPS: <span id="vg-fps-v">10</span></label>
            <input type="range" id="vg-fps" min="5" max="24" value="10" oninput="document.getElementById('vg-fps-v').textContent=this.value">
            <label>Lebar output (px): <span id="vg-w-v">320</span></label>
            <input type="range" id="vg-w" min="120" max="640" value="320" step="10" oninput="document.getElementById('vg-w-v').textContent=this.value">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="vgConvert()" id="vg-btn">ğŸ¬ Convert ke GIF</button>
          <button class="btn btn-secondary" onclick="vgReset()">Ganti Video</button>
        </div>
        <div id="vg-progress" style="display:none;margin-top:12px;">
          <div style="background:var(--border);border-radius:4px;height:8px;overflow:hidden;"><div id="vg-prog-bar" style="height:100%;background:var(--accent);width:0%;transition:width 0.2s;border-radius:4px;"></div></div>
          <div id="vg-prog-text" style="font-size:0.75rem;color:var(--muted);margin-top:4px;text-align:center;"></div>
        </div>
        <div id="vg-result" style="display:none;margin-top:12px;text-align:center;">
          <img id="vg-gif" style="max-width:100%;border-radius:8px;border:1px solid var(--border);">
          <div class="btn-group" style="justify-content:center;margin-top:10px;">
            <button class="btn btn-primary" onclick="vgDownload()">â¬‡ Download GIF</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MEME GENERATOR -->
  <div id="tab-meme" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸ–¼ï¸ Meme Generator</div>
      <div class="panel-desc">// Tambah teks ke gambar & buat meme sendiri</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div>
          <label>Template Meme</label>
          <div id="meme-templates" style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-bottom:10px;max-height:140px;overflow-y:auto;"></div>
          <div style="text-align:center;margin-bottom:8px;font-size:0.72rem;color:var(--muted);">atau</div>
          <button class="btn btn-secondary" onclick="document.getElementById('meme-file').click()" style="width:100%;margin-bottom:12px;">ğŸ“ Upload Gambar</button>
          <input type="file" id="meme-file" accept="image/*" style="display:none;" onchange="memeLoadFile(this)">
          <label>Teks Atas</label>
          <input type="text" id="meme-top" placeholder="TEKS ATAS" oninput="drawMeme()">
          <label>Teks Bawah</label>
          <input type="text" id="meme-bottom" placeholder="TEKS BAWAH" oninput="drawMeme()">
          <label>Ukuran Font: <span id="meme-fs-v">40</span></label>
          <input type="range" id="meme-fs" min="16" max="80" value="40" oninput="document.getElementById('meme-fs-v').textContent=this.value;drawMeme()">
          <label>Warna Teks</label>
          <div style="display:flex;gap:8px;">
            <input type="color" id="meme-color" value="#ffffff" oninput="drawMeme()" style="width:50px;height:36px;">
            <input type="color" id="meme-stroke" value="#000000" oninput="drawMeme()" style="width:50px;height:36px;">
            <span style="font-size:0.72rem;color:var(--muted);line-height:2.2;">Fill / Stroke</span>
          </div>
          <div class="btn-group" style="margin-top:12px;">
            <button class="btn btn-primary" onclick="memeDownload()">â¬‡ Download</button>
          </div>
        </div>
        <div>
          <label>Preview</label>
          <canvas id="meme-canvas" style="max-width:100%;border:1px solid var(--border);border-radius:8px;display:block;background:#111;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- BPM TAP COUNTER -->
  <div id="tab-bpm" class="tool-panel">
    <div class="panel-card" style="max-width:480px;margin:0 auto;text-align:center;">
      <div class="panel-title">ğŸµ BPM Tap Counter</div>
      <div class="panel-desc">// Tap sesuai irama untuk menghitung tempo lagu (BPM)</div>
      <div id="bpm-display" style="font-family:'Syne',sans-serif;font-size:6rem;font-weight:800;color:var(--accent2);letter-spacing:-2px;margin:20px 0;line-height:1;transition:color 0.1s;">--</div>
      <div style="font-size:0.85rem;color:var(--muted);margin-bottom:24px;" id="bpm-label">Tap untuk mulai</div>
      <button id="bpm-btn" onclick="bpmTap()" style="width:200px;height:200px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:white;font-size:1.4rem;font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;transition:transform 0.08s,box-shadow 0.08s;box-shadow:0 8px 32px rgba(124,58,237,0.4);" onmousedown="this.style.transform='scale(0.94)';this.style.boxShadow='0 4px 16px rgba(124,58,237,0.3)'" onmouseup="this.style.transform='';this.style.boxShadow='0 8px 32px rgba(124,58,237,0.4)'">TAP</button>
      <div style="margin-top:24px;display:flex;gap:16px;justify-content:center;flex-wrap:wrap;">
        <div style="text-align:center;"><div id="bpm-taps" style="font-size:1.2rem;font-weight:700;color:var(--accent3);">0</div><div style="font-size:0.68rem;color:var(--muted);">Taps</div></div>
        <div style="text-align:center;"><div id="bpm-min" style="font-size:1.2rem;font-weight:700;color:var(--success);">--</div><div style="font-size:0.68rem;color:var(--muted);">Min BPM</div></div>
        <div style="text-align:center;"><div id="bpm-max" style="font-size:1.2rem;font-weight:700;color:var(--danger);">--</div><div style="font-size:0.68rem;color:var(--muted);">Max BPM</div></div>
      </div>
      <div style="margin-top:20px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-secondary" onclick="bpmReset()">â†º Reset</button>
        <button class="phrase-btn" onclick="bpmSetManual(60)">60 BPM</button>
        <button class="phrase-btn" onclick="bpmSetManual(90)">90 BPM</button>
        <button class="phrase-btn" onclick="bpmSetManual(120)">120 BPM</button>
        <button class="phrase-btn" onclick="bpmSetManual(140)">140 BPM</button>
      </div>
      <div id="bpm-genre" style="margin-top:12px;font-size:0.78rem;color:var(--accent);font-style:italic;min-height:20px;"></div>
      <canvas id="bpm-viz" width="400" height="60" style="margin-top:16px;border-radius:8px;"></canvas>
    </div>
  </div>

  <!-- URL SHORTENER + QR COMBO -->
  <div id="tab-urlqr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ğŸŒ URL Shortener + QR Combo</div>
      <div class="panel-desc">// Analisis URL + langsung buat QR code-nya</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <input type="text" id="uq-input" placeholder="https://example.com/path/to/very/long/url" style="flex:1;" oninput="uqAnalyze()">
        <button class="btn btn-primary" onclick="uqProcess()">ğŸ” Proses</button>
      </div>
      <div id="uq-result" style="display:none;">
        <div style="display:grid;grid-template-columns:1fr auto;gap:20px;align-items:start;">
          <div>
            <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;">
              <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Analisis URL</div>
              <div id="uq-analysis" style="font-size:0.82rem;line-height:1.9;color:var(--text);"></div>
            </div>
            <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;">
              <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">URL Pendek (via TinyURL)</div>
              <div id="uq-short" style="color:var(--accent2);font-size:0.9rem;word-break:break-all;"></div>
              <button class="btn btn-secondary" onclick="uqCopyShort()" style="margin-top:8px;font-size:0.72rem;padding:5px 10px;">Copy</button>
            </div>
            <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
              <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Riwayat (tersimpan lokal)</div>
              <div id="uq-history" style="display:flex;flex-direction:column;gap:6px;max-height:160px;overflow-y:auto;"></div>
            </div>
          </div>
          <div style="text-align:center;">
            <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">QR Code</div>
            <canvas id="uq-qr" style="border:1px solid var(--border);border-radius:8px;background:#fff;"></canvas>
            <div class="btn-group" style="justify-content:center;margin-top:8px;">
              <button class="btn btn-secondary" onclick="uqDownloadQR()" style="font-size:0.72rem;">â¬‡ QR</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ABOUT -->
  <div id="tab-about" class="tool-panel">
    <div class="panel-card" style="text-align:center;padding:44px 28px;">
      <div style="font-size:3rem;margin-bottom:10px;">âš¡</div>
      <div style="font-family:'Syne',sans-serif;font-size:2rem;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-1px;">TOOLBOX</div>
      <div style="color:var(--muted);font-size:0.72rem;letter-spacing:3px;text-transform:uppercase;margin-bottom:36px;">Kumpulan Tools Berguna</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;max-width:580px;margin:0 auto 36px;">
        <!-- Adam -->
        <div style="background:var(--bg);border:2px solid var(--accent);border-radius:16px;padding:26px 18px;position:relative;overflow:hidden;">
          <div style="position:absolute;top:-20px;right:-20px;width:70px;height:70px;background:var(--accent);opacity:0.1;border-radius:50%;"></div>
          <div style="font-size:2.8rem;margin-bottom:10px;">ğŸ‘‘</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:800;color:var(--accent2);margin-bottom:6px;">Adam</div>
          <div style="display:inline-block;background:rgba(124,58,237,0.2);border:1px solid var(--accent);color:var(--accent);font-size:0.68rem;padding:2px 9px;border-radius:20px;margin-bottom:10px;">âœ¨ YANG GANTENG</div>
          <div style="color:var(--muted);font-size:0.76rem;line-height:1.7;">Pembuat & Developer<br>Pemilik ide brilliant<br><span style="color:var(--accent3);">ğŸ† Main Creator</span></div>
        </div>
        <!-- Winda -->
        <div style="background:var(--bg);border:2px solid var(--border);border-radius:16px;padding:26px 18px;position:relative;overflow:hidden;">
          <div style="position:absolute;top:-20px;right:-20px;width:70px;height:70px;background:var(--muted);opacity:0.08;border-radius:50%;"></div>
          <div style="font-size:2.8rem;margin-bottom:10px;">ğŸ˜¬</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:800;color:var(--muted);margin-bottom:6px;">Winda</div>
          <div style="display:inline-block;background:rgba(107,107,138,0.15);border:1px solid var(--border);color:var(--muted);font-size:0.68rem;padding:2px 9px;border-radius:20px;margin-bottom:10px;">ğŸ’€ SI JELEK</div>
          <div style="color:var(--muted);font-size:0.76rem;line-height:1.7;">Saudara Adam<br>Tester tidak resmi<br><span style="opacity:0.5;">ğŸ¥ˆ Supporter (katanya)</span></div>
        </div>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:18px 24px;max-width:480px;margin:0 auto 32px;font-size:0.82rem;color:var(--muted);line-height:1.8;font-style:italic;">
        "Dibuat dengan â¤ï¸ oleh Adam yang ganteng,<br>didukung (mungkin) oleh Winda si jelek." ğŸ˜„
      </div>
      <div style="border-top:1px solid var(--border);padding-top:24px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px;">53 Tools Tersedia</div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;justify-content:center;">
          <span class="about-badge">ğŸ“ Text</span><span class="about-badge">ğŸ” Password</span><span class="about-badge">ğŸ”„ Base64</span>
          <span class="about-badge">ğŸ“¦ JSON</span><span class="about-badge">ğŸ¨ Warna</span><span class="about-badge">ğŸ“ Unit</span>
          <span class="about-badge">ğŸ”‘ Hash</span><span class="about-badge">â° Waktu</span><span class="about-badge">ğŸ§® Kalkulator</span>
          <span class="about-badge">ğŸŒ Translate</span><span class="about-badge">ğŸ“· QR Code</span><span class="about-badge">ğŸ² Random</span>
          <span class="about-badge">ğŸ“„ Markdown</span><span class="about-badge">ğŸ” Regex</span><span class="about-badge">â±ï¸ Timer</span>
          <span class="about-badge">ğŸ“Š CSVâ†’Tabel</span><span class="about-badge">ğŸŒˆ Gradient</span><span class="about-badge">ğŸ—œï¸ Minifier</span>
          <span class="about-badge">ğŸ“‹ To-Do</span><span class="about-badge">ğŸ—’ï¸ Notepad</span><span class="about-badge">ğŸ’± Kurs</span>
          <span class="about-badge">ğŸŒ¤ï¸ Cuaca</span><span class="about-badge">ğŸ–¼ï¸ Kompres</span><span class="about-badge">ğŸ”¤ Font</span>
          <span class="about-badge">ğŸ’» Snippet</span><span class="about-badge">ğŸ“ Aspek Rasio</span>
          <span class="about-badge">ğŸ§  Mindmap</span><span class="about-badge">ğŸµ Morse</span><span class="about-badge">ğŸŒ World Clock</span>
          <span class="about-badge">ğŸ”® Fake Data</span><span class="about-badge">ğŸ¨ Palette</span><span class="about-badge">ğŸ“Š Chart</span>
          <span class="about-badge">ğŸ” Enkripsi</span><span class="about-badge">ğŸ–‹ï¸ ASCII Art</span>
          <span class="about-badge">ğŸ¯ Pomodoro</span><span class="about-badge">ğŸ¤ TTS</span><span class="about-badge">ğŸ“¸ OCR</span>
          <span class="about-badge">ğŸ§® Kalkulator Umur</span><span class="about-badge">ğŸŒŠ Noise</span><span class="about-badge">ğŸ¨ Glassmorphism</span>
          <span class="about-badge">ğŸ“± Mockup</span><span class="about-badge">ğŸ”¢ Bilangan</span><span class="about-badge">ğŸ® Games</span>
          <span class="about-badge">ğŸ¤– AI Claude</span>
          <span class="about-badge">ğŸ“… Kalender</span><span class="about-badge">ğŸ’° Budget</span><span class="about-badge">ğŸ¯ Habit</span>
          <span class="about-badge">ğŸ“– Flashcard</span><span class="about-badge">ğŸ¬ Videoâ†’GIF</span><span class="about-badge">ğŸ–¼ï¸ Meme</span>
          <span class="about-badge">ğŸµ BPM</span><span class="about-badge">ğŸŒ URL+QR</span>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <p>âš¡ TOOLBOX by Adam yang Ganteng â€” Semua proses di browser, data aman</p>
    <div style="margin-top:10px;">
      <span class="badge">ğŸ”’ Client-Side</span><span class="badge">âš¡ Tanpa Login</span>
      <span class="badge">ğŸ†“ Gratis</span><span class="badge">â¤ï¸ by Adam</span>
    </div>
  </div>
</footer>
<div class="notif" id="notif">âœ“ Disalin!</div>

<script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
<script>
// ===== TAB SWITCH =====
function sw(name,btn){
  document.querySelectorAll('.tool-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  btn.classList.add('active');
}
// ===== NOTIF =====
function showNotif(m='âœ“ Disalin!'){const n=document.getElementById('notif');n.textContent=m;n.classList.add('show');setTimeout(()=>n.classList.remove('show'),2000);}
function copyText(t){navigator.clipboard.writeText(t).then(()=>showNotif());}
function cpOut(id){const el=document.getElementById(id);const text=el.innerText.replace(/COPY$|COPIED!$/,'').trim();navigator.clipboard.writeText(text).then(()=>{const b=el.querySelector('.copy-btn');if(b){b.textContent='COPIED!';b.classList.add('copied');setTimeout(()=>{b.textContent='COPY';b.classList.remove('copied');},2000);}showNotif();});}

// ===== TEXT =====
function analyzeText(){const t=document.getElementById('text-input').value;document.getElementById('sc').textContent=t.length;document.getElementById('sw2').textContent=t.trim()?t.trim().split(/\s+/).length:0;document.getElementById('ss').textContent=(t.match(/[.!?]+/g)||[]).length;document.getElementById('sl').textContent=t?t.split('\n').length:0;document.getElementById('sn').textContent=t.replace(/\s/g,'').length;}
function cvCase(type){const t=document.getElementById('text-input').value;let o='';switch(type){case'upper':o=t.toUpperCase();break;case'lower':o=t.toLowerCase();break;case'title':o=t.toLowerCase().replace(/\b\w/g,c=>c.toUpperCase());break;case'reverse':o=t.split('').reverse().join('');break;case'trim':o=t.replace(/\s+/g,' ').trim();break;case'slug':o=t.toLowerCase().trim().replace(/[^\w\s-]/g,'').replace(/[\s_]+/g,'-').replace(/^-+|-+$/g,'');break;}const b=document.getElementById('text-out');b.childNodes[0].textContent=o||'(kosong)';}

// ===== PASSWORD =====
function genPass(){const len=parseInt(document.getElementById('plen').value);let chars='';if(document.getElementById('pu').checked)chars+='ABCDEFGHIJKLMNOPQRSTUVWXYZ';if(document.getElementById('pl').checked)chars+='abcdefghijklmnopqrstuvwxyz';if(document.getElementById('pn').checked)chars+='0123456789';if(document.getElementById('ps').checked)chars+='!@#$%^&*()_+-=[]{}|;:,.<>?';if(!chars){document.getElementById('pass-out').childNodes[0].textContent='âš  Pilih satu opsi';return;}const arr=new Uint32Array(len);crypto.getRandomValues(arr);const p=Array.from(arr).map(v=>chars[v%chars.length]).join('');document.getElementById('pass-out').childNodes[0].textContent=p;pwStrength(p);}
function genPassMulti(){const a=[];for(let i=0;i<5;i++){genPass();a.push(document.getElementById('pass-out').childNodes[0].textContent);}document.getElementById('pass-out').childNodes[0].textContent=a.join('\n');}
function pwStrength(p){let s=0;if(p.length>=8)s++;if(p.length>=12)s++;if(p.length>=20)s++;if(/[A-Z]/.test(p))s++;if(/[a-z]/.test(p))s++;if(/[0-9]/.test(p))s++;if(/[^A-Za-z0-9]/.test(p))s++;const pct=Math.min(100,(s/7)*100);const f=document.getElementById('sfill');const l=document.getElementById('slabel');f.style.width=pct+'%';if(pct<30){f.style.background='#ef4444';l.textContent='Lemah';}else if(pct<60){f.style.background='#f59e0b';l.textContent='Sedang';}else if(pct<85){f.style.background='#10b981';l.textContent='Kuat';}else{f.style.background='#06b6d4';l.textContent='âš¡ Sangat Kuat';}}

// ===== BASE64 =====
function b64(type){const inp=document.getElementById('b64-in').value;let o='';try{if(type==='encode')o=btoa(unescape(encodeURIComponent(inp)));else if(type==='decode')o=decodeURIComponent(escape(atob(inp)));else if(type==='url-enc')o=encodeURIComponent(inp);else o=decodeURIComponent(inp);}catch(e){o='âš  Error: '+e.message;}document.getElementById('b64-out').childNodes[0].textContent=o;}

// ===== JSON =====
function fmtJson(type){const inp=document.getElementById('json-in').value;const b=document.getElementById('json-out');try{const p=JSON.parse(inp);if(type==='pretty')b.childNodes[0].textContent=JSON.stringify(p,null,2);else if(type==='minify')b.childNodes[0].textContent=JSON.stringify(p);else if(type==='validate')b.childNodes[0].textContent='âœ… Valid! Tipe: '+(Array.isArray(p)?'Array':typeof p)+' | Keys: '+(typeof p==='object'?Object.keys(p).length:'N/A');else b.childNodes[0].textContent='Keys:\n'+Object.keys(p).map((k,i)=>(i+1)+'. '+k+' ('+typeof p[k]+')').join('\n');}catch(e){b.childNodes[0].textContent='âŒ Invalid: '+e.message;}}

// ===== COLOR =====
function h2rgb(h){return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16)};}
function rgb2h(r,g,b){return'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');}
function rgb2hsl(r,g,b){r/=255;g/=255;b/=255;const max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max===min){h=s=0;}else{const d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;}h/=6;}return{h:Math.round(h*360),s:Math.round(s*100),l:Math.round(l*100)};}
function setColor(hex){document.getElementById('cpreview').style.background=hex;document.getElementById('cpicker').value=hex;document.getElementById('chex').value=hex;const{r,g,b}=h2rgb(hex);const{h,s,l}=rgb2hsl(r,g,b);document.getElementById('cvhex').textContent=hex;document.getElementById('cvrgb').textContent=`rgb(${r},${g},${b})`;document.getElementById('cvhsl').textContent=`hsl(${h},${s}%,${l}%)`;}
function fromPicker(){setColor(document.getElementById('cpicker').value);}
function fromHex(){const h=document.getElementById('chex').value;if(/^#[0-9A-Fa-f]{6}$/.test(h))setColor(h);}
function randColor(){setColor('#'+[...crypto.getRandomValues(new Uint8Array(3))].map(b=>b.toString(16).padStart(2,'0')).join(''));}

// ===== UNIT =====
const UD={length:{units:['mm','cm','m','km','inch','feet','yard','mile'],toBase:{'mm':0.001,'cm':0.01,'m':1,'km':1000,'inch':0.0254,'feet':0.3048,'yard':0.9144,'mile':1609.34}},weight:{units:['mg','g','kg','ton','oz','lb'],toBase:{'mg':0.000001,'g':0.001,'kg':1,'ton':1000,'oz':0.0283495,'lb':0.453592}},temp:{units:['Celsius','Fahrenheit','Kelvin'],toBase:null},area:{units:['mmÂ²','cmÂ²','mÂ²','kmÂ²','hectare','acre','ftÂ²'],toBase:{'mmÂ²':0.000001,'cmÂ²':0.0001,'mÂ²':1,'kmÂ²':1000000,'hectare':10000,'acre':4046.86,'ftÂ²':0.092903}},speed:{units:['m/s','km/h','mph','knot'],toBase:{'m/s':1,'km/h':0.277778,'mph':0.44704,'knot':0.514444}},data:{units:['bit','byte','KB','MB','GB','TB'],toBase:{'bit':0.125,'byte':1,'KB':1024,'MB':1048576,'GB':1073741824,'TB':1099511627776}}};
function updateUnits(){const cat=document.getElementById('ucat').value;const u=UD[cat].units;document.getElementById('ufrom').innerHTML=u.map(x=>`<option>${x}</option>`).join('');document.getElementById('uto').innerHTML=u.map((x,i)=>`<option${i===1?' selected':''}>${x}</option>`).join('');cvUnit();}
function cvUnit(){const cat=document.getElementById('ucat').value;const val=parseFloat(document.getElementById('uval').value);const from=document.getElementById('ufrom').value;const to=document.getElementById('uto').value;let res;if(cat==='temp'){let c;if(from==='Celsius')c=val;else if(from==='Fahrenheit')c=(val-32)*5/9;else c=val-273.15;if(to==='Celsius')res=c;else if(to==='Fahrenheit')res=c*9/5+32;else res=c+273.15;}else{const base=val*UD[cat].toBase[from];res=base/UD[cat].toBase[to];}document.getElementById('uout').textContent=isNaN(res)?'â€”':(parseFloat(res.toFixed(8)))+' '+to;}
function swapUnit(){const f=document.getElementById('ufrom');const t=document.getElementById('uto');const tmp=f.value;f.value=t.value;t.value=tmp;cvUnit();}

// ===== HASH =====
function djb2(s){let h=5381;for(let i=0;i<s.length;i++)h=((h<<5)+h)+s.charCodeAt(i);return(h>>>0).toString(16).padStart(8,'0');}
function fnv(s){let h=2166136261;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=(h*16777619)>>>0;}return h.toString(16).padStart(8,'0');}
function crc32(s){let t=[];for(let n=0;n<256;n++){let c=n;for(let k=0;k<8;k++)c=(c&1)?0xEDB88320^(c>>>1):c>>>1;t[n]=c;}let c=0xFFFFFFFF;for(let i=0;i<s.length;i++)c=(c>>>8)^t[(c^s.charCodeAt(i))&0xFF];return((c^0xFFFFFFFF)>>>0).toString(16).padStart(8,'0');}
async function doHash(type){const inp=document.getElementById('hash-in').value;const b=document.getElementById('hash-out');let o='';if(type==='djb2')o='DJB2:    '+djb2(inp);else if(type==='fnv')o='FNV-1a:  '+fnv(inp);else if(type==='crc32')o='CRC32:   '+crc32(inp);else{try{const e=new TextEncoder().encode(inp);const buf=await crypto.subtle.digest('SHA-256',e);o='SHA-256:\n'+Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');}catch(e){o='âš  '+e.message;}}b.childNodes[0].textContent=o;}

// ===== TIME =====
function updTime(){const n=new Date();document.getElementById('tsn').textContent=Math.floor(n.getTime()/1000);document.getElementById('tsiso').textContent=n.toISOString().slice(0,19);document.getElementById('tswib').textContent=n.toLocaleString('id-ID',{timeZone:'Asia/Jakarta'});}
setInterval(updTime,1000);updTime();
function cvTs(){const ts=parseInt(document.getElementById('tsin').value);if(isNaN(ts)){document.getElementById('ts-out').childNodes[0].textContent='âš  Masukkan angka valid';return;}const d=new Date(ts*1000);const o=['UTC:   '+d.toUTCString(),'ISO:   '+d.toISOString(),'WIB:   '+d.toLocaleString('id-ID',{timeZone:'Asia/Jakarta'}),'WITA:  '+d.toLocaleString('id-ID',{timeZone:'Asia/Makassar'}),'WIT:   '+d.toLocaleString('id-ID',{timeZone:'Asia/Jayapura'})].join('\n');document.getElementById('ts-out').childNodes[0].textContent=o;}
function cvDiff(){const a=new Date(document.getElementById('dfrom').value);const b=new Date(document.getElementById('dto').value);if(isNaN(a)||isNaN(b)){document.getElementById('diff-out').textContent='âš  Format: YYYY-MM-DD';return;}const ms=Math.abs(b-a);const days=Math.floor(ms/86400000);document.getElementById('diff-out').textContent=`${days} hari\n${Math.floor(days/7)} minggu\n${Math.floor(days/30.4375)} bulan (~)\n${Math.floor(days/365.25)} tahun (~)`;}

// ===== CALCULATOR =====
let cMode='std';
let cS={d:'0',p:null,op:null,new:true,h:''};
let scS={d:'0',p:null,op:null,new:true,h:''};
function setCalcMode(m){cMode=m;['std','sci','pct','loan'].forEach(x=>{document.getElementById('calc-'+x).style.display=x===m?'block':'none';document.getElementById('cm-'+x).className='btn '+(x===m?'btn-primary':'btn-secondary');});}
function updDisp(){const d=document.getElementById('cdisp');const h=document.getElementById('chist');let v=cS.d;if(!isNaN(v)&&!v.includes('.')&&Math.abs(parseFloat(v))<1e15)v=parseFloat(v).toLocaleString('id-ID',{maximumFractionDigits:10});d.textContent=v;h.textContent=cS.h;d.style.fontSize=v.length>14?'1.1rem':v.length>10?'1.6rem':'2rem';}
function cNum(n){if(cS.new){cS.d=n==='.'?'0.':n;cS.new=false;}else if(n==='.'&&cS.d.includes('.'))return;else cS.d+=n;updDisp();}
function cOp(op){if(cS.op&&!cS.new)cEq(true);cS.p=parseFloat(cS.d.replace(/[^0-9.-]/g,''));cS.op=op;cS.h=cS.d+' '+{'+':'+','-':'âˆ’','*':'Ã—','/':'Ã·','**':'^'}[op];cS.new=true;updDisp();}
function cEq(chain=false){if(!cS.op)return;const a=cS.p,b=parseFloat(cS.d.replace(/[^0-9.-]/g,''));let r;switch(cS.op){case'+':r=a+b;break;case'-':r=a-b;break;case'*':r=a*b;break;case'/':r=b===0?'Error:Ã·0':a/b;break;case'**':r=Math.pow(a,b);}if(!chain)cS.h+=(' '+cS.d+' =');cS.d=typeof r==='string'?r:String(parseFloat(r.toFixed(10)));if(!chain){cS.op=null;cS.p=null;}cS.new=true;updDisp();}
function cFn(fn){const cur=parseFloat(cS.d.replace(/[^0-9.-]/g,''))||0;if(fn==='AC'){cS={d:'0',p:null,op:null,new:true,h:''};}else if(fn==='+/-'){cS.d=String(-cur);cS.new=false;}else if(fn==='%'){cS.d=String(cur/100);cS.new=false;}else if(fn==='back'){cS.d=cS.d.length>1?cS.d.slice(0,-1):'0';cS.new=false;}updDisp();}
// Scientific
function updScDisp(){const d=document.getElementById('scdisp');d.textContent=scS.d;document.getElementById('schist').textContent=scS.h;d.style.fontSize=scS.d.length>14?'1rem':scS.d.length>10?'1.4rem':'1.7rem';}
function scNum(n){if(scS.new){scS.d=n==='.'?'0.':n;scS.new=false;}else if(n==='.'&&scS.d.includes('.'))return;else scS.d+=n;updScDisp();}
function scOp(op){if(scS.op&&!scS.new)scEq(true);scS.p=parseFloat(scS.d);scS.op=op;scS.h=scS.d+' '+{'+':'+','-':'âˆ’','*':'Ã—','/':'Ã·','**':'^'}[op];scS.new=true;updScDisp();}
function scEq(chain=false){if(!scS.op)return;const a=scS.p,b=parseFloat(scS.d);let r;switch(scS.op){case'+':r=a+b;break;case'-':r=a-b;break;case'*':r=a*b;break;case'/':r=b===0?'Error':a/b;break;case'**':r=Math.pow(a,b);}if(!chain)scS.h+=(' '+scS.d+' =');scS.d=typeof r==='string'?r:String(parseFloat(r.toPrecision(12)));if(!chain){scS.op=null;scS.p=null;}scS.new=true;updScDisp();}
function fact(n){if(n<0)return NaN;if(n<=1)return 1;if(n>170)return Infinity;let r=1;for(let i=2;i<=n;i++)r*=i;return r;}
function scFn(fn){const cur=parseFloat(scS.d)||0;let r;switch(fn){case'sin':r=Math.sin(cur*Math.PI/180);break;case'cos':r=Math.cos(cur*Math.PI/180);break;case'tan':r=Math.tan(cur*Math.PI/180);break;case'log':r=cur<=0?'Error':Math.log10(cur);break;case'ln':r=cur<=0?'Error':Math.log(cur);break;case'sqrt':r=cur<0?'Error':Math.sqrt(cur);break;case'pow2':r=Math.pow(cur,2);break;case'pow3':r=Math.pow(cur,3);break;case'inv':r=cur===0?'Error':1/cur;break;case'abs':r=Math.abs(cur);break;case'fact':r=fact(Math.round(cur));break;case'pi':scS.d=String(Math.PI);scS.new=true;updScDisp();return;case'e':scS.d=String(Math.E);scS.new=true;updScDisp();return;case'+/-':r=-cur;break;case'%':r=cur/100;break;case'back':scS.d=scS.d.length>1?scS.d.slice(0,-1):'0';scS.new=false;updScDisp();return;case'AC':scS={d:'0',p:null,op:null,new:true,h:''};updScDisp();return;}scS.d=typeof r==='string'?r:String(parseFloat(r.toPrecision(12)));scS.new=true;updScDisp();}
function calcDisc(){const p=parseFloat(document.getElementById('disc-p').value)||0;const pct=parseFloat(document.getElementById('disc-pct').value)||0;const save=p*pct/100;document.getElementById('disc-out').textContent=`Hemat: Rp ${save.toLocaleString('id-ID')}\nHarga Akhir: Rp ${(p-save).toLocaleString('id-ID')}`;}
function calcChg(){const f=parseFloat(document.getElementById('chg-f').value)||0;const t=parseFloat(document.getElementById('chg-t').value)||0;if(f===0){document.getElementById('chg-out').textContent='âš  Nilai awal tidak boleh 0';return;}const pct=((t-f)/Math.abs(f))*100;document.getElementById('chg-out').textContent=`${pct>=0?'ğŸ“ˆ Naik':'ğŸ“‰ Turun'} ${Math.abs(pct).toFixed(2)}%\n${f.toLocaleString('id-ID')} â†’ ${t.toLocaleString('id-ID')}`;}
function calcLoan(){const total=parseFloat(document.getElementById('la').value)||0;const dp=parseFloat(document.getElementById('ldp').value)||0;const ry=parseFloat(document.getElementById('lr').value)||0;const y=parseFloat(document.getElementById('ly').value)||0;const pokok=total-dp;const rm=ry/100/12;const n=y*12;if(!pokok||!n||!ry){document.getElementById('loan-out').textContent='â€” isi semua kolom â€”';return;}const cic=pokok*(rm*Math.pow(1+rm,n))/(Math.pow(1+rm,n)-1);const tot=cic*n;const flat=pokok/n+(pokok*ry/100/12);document.getElementById('loan-out').textContent=`â” ANUITAS (Efektif) â”\nCicilan/bulan: Rp ${Math.round(cic).toLocaleString('id-ID')}\nTotal bayar:   Rp ${Math.round(tot).toLocaleString('id-ID')}\nTotal bunga:   Rp ${Math.round(tot-pokok).toLocaleString('id-ID')}\n\nâ” FLAT â”\nCicilan/bulan: Rp ${Math.round(flat).toLocaleString('id-ID')}\nTotal bayar:   Rp ${Math.round(flat*n).toLocaleString('id-ID')}\n\nTenor: ${y}th (${n} bulan) | DP: Rp ${dp.toLocaleString('id-ID')}`;}
document.addEventListener('keydown',e=>{if(cMode==='std'){'0123456789.'.includes(e.key)&&cNum(e.key);e.key==='+'&&cOp('+');e.key==='-'&&cOp('-');e.key==='*'&&cOp('*');e.key==='/'&&(e.preventDefault(),cOp('/'));(e.key==='Enter'||e.key==='=')&&cEq();e.key==='Backspace'&&cFn('back');e.key==='Escape'&&cFn('AC');}});

// ===== TRANSLATE =====
let trLast='',trTimer=null;
function trCharCount(){const v=document.getElementById('tr-in').value;document.getElementById('tr-cc').textContent=v.length+' karakter';if(document.getElementById('tr-auto').checked){clearTimeout(trTimer);trTimer=setTimeout(()=>{if(v.trim())doTranslate();},1200);}}
function swapLang(){const f=document.getElementById('tr-from');const t=document.getElementById('tr-to');const fv=f.value==='auto'?t.value:f.value;const tv=t.value;for(let o of f.options)if(o.value===tv){f.value=tv;break;}for(let o of t.options)if(o.value===fv){t.value=fv;break;}const out=document.getElementById('tr-out').textContent.replace('â€” hasil terjemahan â€”','').trim();if(out){document.getElementById('tr-in').value=out;document.getElementById('tr-cc').textContent=out.length+' karakter';}document.getElementById('tr-out').innerHTML='<span style="color:var(--muted);font-size:0.78rem;">â€” hasil terjemahan â€”</span>';document.getElementById('tr-det').textContent='';}
function clearTr(){document.getElementById('tr-in').value='';document.getElementById('tr-cc').textContent='0 karakter';document.getElementById('tr-out').innerHTML='<span style="color:var(--muted);font-size:0.78rem;">â€” hasil terjemahan â€”</span>';document.getElementById('tr-det').textContent='';}
async function doTranslate(){
  const text=document.getElementById('tr-in').value.trim();
  if(!text||text===trLast)return;
  const fl=document.getElementById('tr-from').value;
  const tl=document.getElementById('tr-to').value;
  const btn=document.getElementById('tr-btn');
  const load=document.getElementById('tr-load');
  const out=document.getElementById('tr-out');
  btn.disabled=true;btn.textContent='â³...';load.style.display='block';out.innerHTML='';

  // MyMemory language codes (free API, no key needed)
  const LC={'Indonesia':'id','Inggris':'en','Jepang':'ja','Korea':'ko','Mandarin':'zh-CN','Arab':'ar','Spanyol':'es','Prancis':'fr','Jerman':'de','Portugis':'pt','Italia':'it','Rusia':'ru','Hindi':'hi','Thailand':'th','Vietnam':'vi','Melayu':'ms','Belanda':'nl','Turki':'tr','Jawa':'jv','Sunda':'su'};
  const toCode=LC[tl]||'en';
  const fromCode=fl==='auto'?'':LC[fl]||'id';
  const rtlL=['Arab'];const cjkL=['Mandarin','Jepang','Korea'];

  try {
    // Chunk text (MyMemory limit ~500 chars)
    const chunks=[];let cur='';
    for(const seg of (text.match(/[^\n]{1,400}\n?/g)||[text])){
      if((cur+seg).length>450){if(cur)chunks.push(cur.trim());cur=seg;}else cur+=seg;
    }
    if(cur.trim())chunks.push(cur.trim());

    const parts=[];
    for(const chunk of chunks){
      const pair=fl==='auto'?`autodetect|${toCode}`:`${fromCode}|${toCode}`;
      const url=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(chunk)}&langpair=${pair}`;
      const r=await fetch(url);
      if(!r.ok)throw new Error('HTTP '+r.status);
      const d=await r.json();
      if(d.responseStatus===200||d.responseStatus==='200'){
        parts.push(d.responseData.translatedText);
        if(chunks.indexOf(chunk)===0&&fl==='auto'&&d.responseData.detectedLanguage){
          document.getElementById('tr-det').textContent='ğŸ” Terdeteksi: '+d.responseData.detectedLanguage;
        }
      } else {
        throw new Error(d.responseDetails||'Terjemahan gagal ('+d.responseStatus+')');
      }
    }

    const res=parts.join(' ');
    out.setAttribute('data-rtl',rtlL.includes(tl)?'true':'false');
    out.style.direction=rtlL.includes(tl)?'rtl':'ltr';
    out.style.textAlign=rtlL.includes(tl)?'right':'left';
    out.textContent=res;
    trLast=text;

  } catch(e){
    out.innerHTML=`<span style="color:var(--danger)">âš  ${e.message}</span><br><span style="color:var(--muted);font-size:0.78rem;">Pastikan internet aktif. MyMemory gratis ~5000 kata/hari.</span>`;
  } finally {
    btn.disabled=false;btn.textContent='ğŸŒ Terjemahkan';load.style.display='none';
  }
}
function cpTranslate(){const t=document.getElementById('tr-out').textContent.replace('â€” hasil terjemahan â€”','').trim();if(!t)return;navigator.clipboard.writeText(t).then(()=>{const b=document.getElementById('tr-cp');b.textContent='âœ“ Copied!';setTimeout(()=>b.textContent='Copy',2000);});}
function quickTr(p){document.getElementById('tr-in').value=p;document.getElementById('tr-cc').textContent=p.length+' karakter';doTranslate();}

// ===== QR CODE =====
let qrTimer=null;
function qrLive(){clearTimeout(qrTimer);qrTimer=setTimeout(()=>{if(document.getElementById('qr-in').value.trim())genQR();},600);}
function genQR(){const text=document.getElementById('qr-in').value.trim();if(!text)return;const size=parseInt(document.getElementById('qr-size').value);const ec=document.getElementById('qr-ec').value;const canvas=document.getElementById('qr-canvas');const ph=document.getElementById('qr-ph');canvas.width=size;canvas.height=size;const url=`https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}&ecc=${ec}&format=png`;const img=new Image();img.crossOrigin='anonymous';img.onload=()=>{const ctx=canvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,size,size);ctx.drawImage(img,0,0,size,size);canvas.style.display='block';ph.style.display='none';};img.onerror=()=>{ph.textContent='âš  Gagal. Cek koneksi internet.';};img.src=url;}
function dlQR(){const c=document.getElementById('qr-canvas');if(c.style.display==='none'){genQR();return;}const a=document.createElement('a');a.download='qrcode.png';a.href=c.toDataURL('image/png');a.click();}

// ===== RANDOM =====
function rUUID(){const u=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16));document.getElementById('r-uuid').textContent=u;}
function rNum(){const mn=parseInt(document.getElementById('r-min').value);const mx=parseInt(document.getElementById('r-max').value);const a=new Uint32Array(1);crypto.getRandomValues(a);const n=mn+(a[0]%(mx-mn+1));const el=document.getElementById('r-num');el.style.transform='scale(1.3)';el.textContent=n;setTimeout(()=>el.style.transform='',200);}
function rColor(){const h='#'+[...crypto.getRandomValues(new Uint8Array(3))].map(b=>b.toString(16).padStart(2,'0')).join('');document.getElementById('r-cbox').style.background=h;document.getElementById('r-cval').textContent=h;}
function rCoin(){const el=document.getElementById('r-coin');const lbl=document.getElementById('r-coinlbl');el.style.transform='rotateY(720deg)';setTimeout(()=>{const r=Math.random()<0.5;el.textContent=r?'ğŸª™':'ğŸ’¿';lbl.textContent=r?'HEADS (Angka)':'TAILS (Gambar)';lbl.style.color=r?'var(--accent3)':'var(--accent2)';el.style.transform='';},300);}
function rDice(){const s=parseInt(document.getElementById('r-dice').value);const faces=['','âš€','âš','âš‚','âšƒ','âš„','âš…'];const a=new Uint32Array(1);crypto.getRandomValues(a);const r=(a[0]%s)+1;const el=document.getElementById('r-dres');el.style.transform='rotate(360deg)';setTimeout(()=>{el.textContent=s===6&&r<=6?faces[r]:r;el.style.transform='';},200);}
const NAMES={id:{f:['Adam','Budi','Citra','Dewi','Eko','Farah','Gilang','Hana','Irfan','Joko','Kiki','Lina','Mika','Nadia','Reza','Sari','Tono','Wahyu','Yusuf','Zahra'],l:['Santoso','Wijaya','Kusuma','Pratama','Saputra','Hidayat','Nugroho','Purnama','Suharto','Rahayu']},en:{f:['James','Emily','William','Sophia','Oliver','Ava','Noah','Mia','Liam','Charlotte','Lucas','Amelia'],l:['Smith','Johnson','Williams','Jones','Brown','Davis','Miller','Wilson','Moore','Taylor']},jp:{f:['Haruto','Sakura','Riku','Yui','Sota','Hina','Yuto','Mio','Hayato','Aoi'],l:['Sato','Suzuki','Tanaka','Watanabe','Ito','Yamamoto','Nakamura','Kobayashi']}};
function rName(){const t=document.getElementById('r-ntype').value;const n=NAMES[t];const a=crypto.getRandomValues(new Uint32Array(2));const f=n.f[a[0]%n.f.length];const l=n.l[a[1]%n.l.length];document.getElementById('r-name').textContent=t==='jp'?l+' '+f:f+' '+l;}
function rPick(count){const items=document.getElementById('r-list').value.split('\n').filter(l=>l.trim());if(!items.length)return;const shuffled=[...items].sort(()=>Math.random()-0.5);const picks=shuffled.slice(0,Math.min(count,items.length));document.getElementById('r-pick').textContent=(count===1?'ğŸ¯ '+picks[0].trim():picks.map((p,i)=>(i+1)+'. '+p.trim()).join('\n'));}

// ===== MARKDOWN =====
function renderMd(){const inp=document.getElementById('md-in').value;const prev=document.getElementById('md-prev');let h=inp.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/```([\s\S]*?)```/g,'<pre><code>$1</code></pre>').replace(/^###### (.+)$/gm,'<h6>$1</h6>').replace(/^##### (.+)$/gm,'<h5>$1</h5>').replace(/^#### (.+)$/gm,'<h4>$1</h4>').replace(/^### (.+)$/gm,'<h3>$1</h3>').replace(/^## (.+)$/gm,'<h2>$1</h2>').replace(/^# (.+)$/gm,'<h1>$1</h1>').replace(/\*\*\*(.+?)\*\*\*/g,'<strong><em>$1</em></strong>').replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>').replace(/`([^`]+)`/g,'<code>$1</code>').replace(/^&gt; (.+)$/gm,'<blockquote>$1</blockquote>').replace(/^---$/gm,'<hr>').replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/!\[(.+?)\]\((.+?)\)/g,'<img src="$2" alt="$1" style="max-width:100%;border-radius:6px;">').replace(/^- \[x\] (.+)$/gm,'<div style="display:flex;gap:8px;"><input type="checkbox" checked disabled><span style="text-decoration:line-through;opacity:0.6">$1</span></div>').replace(/^- \[ \] (.+)$/gm,'<div style="display:flex;gap:8px;"><input type="checkbox" disabled>$1</div>').replace(/^[-*+] (.+)$/gm,'<li>$1</li>').replace(/^\d+\. (.+)$/gm,'<li style="list-style:decimal;margin-left:20px;">$1</li>').replace(/~~(.+?)~~/g,'<del>$1</del>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');prev.innerHTML='<p>'+h+'</p>';}
function mdIns(t){const ta=document.getElementById('md-in');const s=ta.selectionStart;ta.value=ta.value.substring(0,s)+t+ta.value.substring(ta.selectionEnd);ta.focus();ta.selectionStart=ta.selectionEnd=s+t.length;renderMd();}
function mdSample(){document.getElementById('md-in').value=`# âš¡ Toolbox oleh Adam yang Ganteng\n\nToolbox ini dibuat dengan **penuh semangat** dan *sedikit bantuan* dari Winda.\n\n## Fitur Tersedia\n\n- ğŸ“ Text Analyzer\n- ğŸ” Password Generator\n- ğŸŒ AI Translator\n- ğŸ§® Kalkulator lengkap\n\n## Kode Contoh\n\n\`\`\`\nconst creator = "Adam yang ganteng";\nconsole.log("Dibuat oleh:", creator);\n\`\`\`\n\n> Semua tools 100% gratis dan berjalan di browser!\n\n---\n\n### To Do\n\n- [x] Buat toolbox keren\n- [x] Tambahkan AI translate\n- [ ] Ajarin Winda ~~yang jelek~~ ğŸ˜„`;renderMd();}

// ===== REGEX =====
function testRx(){const pat=document.getElementById('rx-pat').value;const flags=document.getElementById('rx-flags').value;const inp=document.getElementById('rx-in').value;const out=document.getElementById('rx-out');const stat=document.getElementById('rx-stat');if(!pat){out.innerHTML=inp||'â€”';stat.textContent='';return;}try{const rx=new RegExp(pat,flags);const matches=[...inp.matchAll(new RegExp(pat,flags.includes('g')?flags:flags+'g'))];out.innerHTML=inp.replace(rx,m=>`<mark>${m.replace(/</g,'&lt;')}</mark>`)||'â€”';stat.textContent=`âœ… Valid â€” ${matches.length} match`;stat.style.color='var(--success)';}catch(e){out.innerHTML=inp||'â€”';stat.textContent='âŒ Error: '+e.message;stat.style.color='var(--danger)';}}
function rxPreset(name,pat,flags,sample){document.getElementById('rx-pat').value=pat;document.getElementById('rx-flags').value=flags;if(!document.getElementById('rx-in').value)document.getElementById('rx-in').value=sample;testRx();}

// ===== STOPWATCH =====
let swInt=null,swRun=false,swMs=0,swLapN=0;
function swToggle(){if(swRun){clearInterval(swInt);swRun=false;document.getElementById('sw-btn').textContent='â–¶ Lanjut';}else{const start=Date.now()-swMs;swInt=setInterval(()=>{swMs=Date.now()-start;const m=swMs;const h=Math.floor(m/3600000).toString().padStart(2,'0');const mn=Math.floor((m%3600000)/60000).toString().padStart(2,'0');const s=Math.floor((m%60000)/1000).toString().padStart(2,'0');const ms=Math.floor(m%1000).toString().padStart(3,'0');document.getElementById('sw-d').textContent=`${h}:${mn}:${s}.${ms}`;},10);swRun=true;document.getElementById('sw-btn').textContent='â¸ Pause';}}
function swReset(){clearInterval(swInt);swRun=false;swMs=0;swLapN=0;document.getElementById('sw-d').textContent='00:00:00.000';document.getElementById('sw-btn').textContent='â–¶ Start';document.getElementById('sw-laps').innerHTML='';}
function swLap(){if(!swRun&&swMs===0)return;swLapN++;const d=document.getElementById('sw-d').textContent;const laps=document.getElementById('sw-laps');const div=document.createElement('div');div.style.cssText='padding:3px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;';div.innerHTML=`<span style="color:var(--muted)">Lap ${swLapN}</span><span style="color:var(--accent2)">${d}</span>`;laps.insertBefore(div,laps.firstChild);}

// ===== COUNTDOWN =====
let cdInt=null,cdRun=false,cdRem=0;
function cdToggle(){if(cdRun){clearInterval(cdInt);cdRun=false;document.getElementById('cd-btn').textContent='â–¶ Lanjut';}else{if(cdRem===0){const h=parseInt(document.getElementById('cd-h').value)||0;const m=parseInt(document.getElementById('cd-m').value)||0;const s=parseInt(document.getElementById('cd-s').value)||0;cdRem=h*3600+m*60+s;}if(cdRem<=0)return;const end=Date.now()+cdRem*1000;cdInt=setInterval(()=>{cdRem=Math.max(0,Math.round((end-Date.now())/1000));const h=Math.floor(cdRem/3600);const m=Math.floor((cdRem%3600)/60);const s=cdRem%60;document.getElementById('cd-d').textContent=`${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;if(cdRem===0){clearInterval(cdInt);cdRun=false;document.getElementById('cd-btn').textContent='â–¶ Start';document.getElementById('cd-d').style.color='var(--danger)';showNotif('â° Waktu Habis!');}},250);cdRun=true;document.getElementById('cd-btn').textContent='â¸ Pause';document.getElementById('cd-d').style.color='var(--accent3)';}}
function cdReset(){clearInterval(cdInt);cdRun=false;cdRem=0;document.getElementById('cd-btn').textContent='â–¶ Start';document.getElementById('cd-d').style.color='var(--accent3)';const h=parseInt(document.getElementById('cd-h').value)||0;const m=parseInt(document.getElementById('cd-m').value)||0;const s=parseInt(document.getElementById('cd-s').value)||0;cdRem=h*3600+m*60+s;const hh=Math.floor(cdRem/3600);const mm=Math.floor((cdRem%3600)/60);const ss=cdRem%60;document.getElementById('cd-d').textContent=`${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;}
function cdPreset(m,h=0,s=0){clearInterval(cdInt);cdRun=false;cdRem=0;document.getElementById('cd-h').value=h;document.getElementById('cd-m').value=m;document.getElementById('cd-s').value=s;document.getElementById('cd-btn').textContent='â–¶ Start';document.getElementById('cd-d').style.color='var(--accent3)';cdRem=h*3600+m*60+s;const hh=Math.floor(cdRem/3600);const mm2=Math.floor((cdRem%3600)/60);const ss=cdRem%60;document.getElementById('cd-d').textContent=`${hh.toString().padStart(2,'0')}:${mm2.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;}

// ===== CSV TABLE =====
function renderCsv(){const raw=document.getElementById('csv-in').value;const sep=document.getElementById('csv-sep').value;const hdr=document.getElementById('csv-hdr').checked;const wrap=document.getElementById('csv-wrap');if(!raw.trim()){wrap.innerHTML='';document.getElementById('csv-stat').textContent='';return;}const rows=raw.trim().split('\n').map(r=>r.split(sep));let html='<table>';let ds=0;if(hdr&&rows.length>0){html+='<thead><tr>'+rows[0].map(h=>`<th>${h.trim()}</th>`).join('')+'</tr></thead>';ds=1;}html+='<tbody>';for(let i=ds;i<rows.length;i++){const odd=(i-ds)%2===0;html+=`<tr style="background:${odd?'var(--bg)':'var(--surface)'};">`+rows[i].map(c=>`<td>${c.trim()}</td>`).join('')+'</tr>';}html+='</tbody></table>';wrap.innerHTML=html;document.getElementById('csv-stat').textContent=`${rows.length-ds} baris Ã— ${rows[0].length} kolom`;}
function csvSample(){document.getElementById('csv-in').value=`Nama,Umur,Kota,Pekerjaan\nAdam,25,Jakarta,Developer\nWinda,22,Bandung,Designer\nBudi,30,Surabaya,Manager\nSari,28,Yogyakarta,Analyst`;renderCsv();}
function csvExport(fmt){const raw=document.getElementById('csv-in').value;const sep=document.getElementById('csv-sep').value;const rows=raw.trim().split('\n').map(r=>r.split(sep));if(!rows.length)return;let out='';if(fmt==='markdown'){out='| '+rows[0].map(h=>h.trim()).join(' | ')+' |\n';out+='| '+rows[0].map(()=>'---').join(' | ')+' |\n';for(let i=1;i<rows.length;i++)out+='| '+rows[i].map(c=>c.trim()).join(' | ')+' |\n';}else{out='<table>\n<thead><tr>'+rows[0].map(h=>`<th>${h.trim()}</th>`).join('')+'</tr></thead>\n<tbody>\n';for(let i=1;i<rows.length;i++)out+='<tr>'+rows[i].map(c=>`<td>${c.trim()}</td>`).join('')+'</tr>\n';out+='</tbody>\n</table>';}navigator.clipboard.writeText(out).then(()=>showNotif('âœ“ '+fmt.toUpperCase()+' disalin!'));}

// ===== GRADIENT =====
const GR_PRESETS=[['#667eea','#764ba2'],['#f093fb','#f5576c'],['#4facfe','#00f2fe'],['#43e97b','#38f9d7'],['#fa709a','#fee140'],['#30cfd0','#330867'],['#a18cd1','#fbc2eb'],['#fd7043','#ff8a65'],['#00b09b','#96c93d'],['#a1c4fd','#c2e9fb'],['#7c3aed','#06b6d4'],['#f59e0b','#ef4444']];
function renderGr(){const type=document.getElementById('gr-type').value;const dir=document.getElementById('gr-dir').value;const c1=document.getElementById('gr-c1').value;const c2=document.getElementById('gr-c2').value;const c3=document.getElementById('gr-c3').value;const use3=document.getElementById('gr-c3on').checked;document.getElementById('gr-c1t').value=c1;document.getElementById('gr-c2t').value=c2;document.getElementById('gr-c3t').value=c3;const stops=use3?`${c1}, ${c2}, ${c3}`:`${c1}, ${c2}`;let css;if(type==='linear')css=`linear-gradient(${dir}, ${stops})`;else if(type==='radial')css=`radial-gradient(circle, ${stops})`;else css=`conic-gradient(${stops})`;document.getElementById('gr-prev').style.background=css;document.getElementById('gr-css').value=`background: ${css};`;}
function syncGr(n){const t=document.getElementById('gr-c'+n+'t').value;if(/^#[0-9A-Fa-f]{6}$/.test(t)){document.getElementById('gr-c'+n).value=t;renderGr();}}
function randGr(){const a=crypto.getRandomValues(new Uint32Array(1));const p=GR_PRESETS[a[0]%GR_PRESETS.length];document.getElementById('gr-c1').value=p[0];document.getElementById('gr-c2').value=p[1];renderGr();}
function initGrPresets(){const c=document.getElementById('gr-presets');GR_PRESETS.forEach(([c1,c2])=>{const d=document.createElement('div');d.className='gr-preset';d.style.background=`linear-gradient(135deg,${c1},${c2})`;d.onclick=()=>{document.getElementById('gr-c1').value=c1;document.getElementById('gr-c2').value=c2;document.getElementById('gr-c3on').checked=false;renderGr();};c.appendChild(d);});}

// ===== MINIFIER =====
let miniMode='css';
function setMini(m){miniMode=m;document.getElementById('mini-css').className='btn '+(m==='css'?'btn-primary':'btn-secondary');document.getElementById('mini-js').className='btn '+(m==='js'?'btn-primary':'btn-secondary');}
function doMinify(){const inp=document.getElementById('mini-in').value;if(!inp.trim())return;let o;if(miniMode==='css'){o=inp.replace(/\/\*[\s\S]*?\*\//g,'').replace(/\s*([{}:;,>~+])\s*/g,'$1').replace(/\s+/g,' ').replace(/;\}/g,'}').trim();}else{o=inp.replace(/\/\/[^\n]*/g,'').replace(/\/\*[\s\S]*?\*\//g,'').replace(/\n\s*/g,' ').replace(/\s{2,}/g,' ').replace(/\s*([=+\-*/%&|^!<>?:;,{}()[\]])\s*/g,'$1').trim();}const ratio=((1-o.length/inp.length)*100).toFixed(1);document.getElementById('mini-out').childNodes[0].textContent=o;document.getElementById('mini-stat').innerHTML=`<div class="stat-chip">Asli: <span>${inp.length}</span></div><div class="stat-chip">Hasil: <span>${o.length}</span></div><div class="stat-chip">Hemat: <span>${ratio}%</span></div>`;}
function doBeautify(){const inp=document.getElementById('mini-in').value;let o;if(miniMode==='css'){o=inp.replace(/\s*{\s*/g,' {\n  ').replace(/;\s*/g,';\n  ').replace(/\s*}\s*/g,'\n}\n').trim();}else{o=inp.replace(/;/g,';\n').replace(/\{/g,' {\n  ').replace(/\}/g,'\n}\n').replace(/\n\s*\n/g,'\n').trim();}document.getElementById('mini-out').childNodes[0].textContent=o;document.getElementById('mini-stat').innerHTML='';}
function miniSample(){document.getElementById('mini-in').value=miniMode==='css'?`.btn {\n  background: #7c3aed;\n  color: white;\n  padding: 10px 20px;\n  border-radius: 8px;\n  /* Main button style */\n  font-size: 1rem;\n  transition: all 0.2s ease;\n}\n\n.btn:hover {\n  opacity: 0.9;\n  transform: translateY(-1px);\n}`:`// Fungsi greeting\nfunction greet(name) {\n  const msg = "Halo, " + name + "!";\n  console.log(msg);\n  return msg;\n}\n\n// Hitung total\nfunction total(items) {\n  let sum = 0;\n  for (let i = 0; i < items.length; i++) {\n    sum += items[i].price;\n  }\n  return sum;\n}`;}

// ===== INIT =====
updateUnits();
setColor('#7c3aed');
renderGr();
initGrPresets();

// ===== TODO LIST =====
let todos = JSON.parse(localStorage.getItem('tb-todos')||'[]');
let todoFilter = 'all';
function saveTodos(){ localStorage.setItem('tb-todos', JSON.stringify(todos)); }
function addTodo(){
  const v = document.getElementById('todo-input').value.trim();
  if(!v) return;
  todos.unshift({ id: Date.now(), text: v, pri: document.getElementById('todo-pri').value, done: false, date: new Date().toLocaleDateString('id-ID') });
  document.getElementById('todo-input').value = '';
  saveTodos(); renderTodos();
}
function toggleTodo(id){ const t = todos.find(t=>t.id===id); if(t){ t.done=!t.done; saveTodos(); renderTodos(); } }
function deleteTodo(id){ todos = todos.filter(t=>t.id!==id); saveTodos(); renderTodos(); }
function filterTodo(f, btn){ todoFilter=f; document.querySelectorAll('.active-filter').forEach(b=>b.classList.remove('active-filter')); if(btn)btn.classList.add('active-filter'); renderTodos(); }
function clearDoneTodo(){ todos = todos.filter(t=>!t.done); saveTodos(); renderTodos(); }
function clearAllTodo(){ if(confirm('Hapus semua tugas?')){ todos=[]; saveTodos(); renderTodos(); } }
function renderTodos(){
  const priColor = {high:'var(--danger)', med:'var(--accent3)', low:'var(--success)'};
  const priLabel = {high:'ğŸ”´', med:'ğŸŸ¡', low:'ğŸŸ¢'};
  let filtered = todos.filter(t => {
    if(todoFilter==='active') return !t.done;
    if(todoFilter==='done') return t.done;
    if(todoFilter==='high') return t.pri==='high';
    return true;
  });
  const list = document.getElementById('todo-list');
  const empty = document.getElementById('todo-empty');
  if(!filtered.length){ list.innerHTML=''; empty.style.display='block'; }
  else {
    empty.style.display='none';
    list.innerHTML = filtered.map(t=>`
      <div style="display:flex;align-items:center;gap:10px;background:var(--bg);border:1px solid ${t.done?'var(--border)':'var(--border)'};border-left:3px solid ${priColor[t.pri]};border-radius:8px;padding:10px 14px;opacity:${t.done?0.5:1};">
        <input type="checkbox" ${t.done?'checked':''} onchange="toggleTodo(${t.id})" style="width:16px;height:16px;accent-color:var(--accent);cursor:pointer;flex-shrink:0;">
        <span style="flex:1;font-size:0.88rem;${t.done?'text-decoration:line-through;color:var(--muted)':''}">${t.text}</span>
        <span style="font-size:0.7rem;color:var(--muted);">${t.date}</span>
        <span style="font-size:0.8rem;">${priLabel[t.pri]}</span>
        <button onclick="deleteTodo(${t.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem;padding:0 4px;" title="Hapus">âœ•</button>
      </div>`).join('');
  }
  const done = todos.filter(t=>t.done).length;
  document.getElementById('todo-stats').textContent = `${todos.length} tugas Â· ${done} selesai Â· ${todos.length-done} aktif`;
}
renderTodos();

// ===== NOTEPAD =====
let notes = JSON.parse(localStorage.getItem('tb-notes')||'[]');
let activeNoteId = null;
let npTimer = null;
function saveNotes(){ localStorage.setItem('tb-notes', JSON.stringify(notes)); }
function newNote(){
  activeNoteId = null;
  document.getElementById('np-title').value = '';
  document.getElementById('np-body').value = '';
  document.getElementById('np-saved-status').textContent = 'â€” catatan baru â€”';
  document.getElementById('np-wordcount').textContent = '0 kata';
}
function saveNote(){
  const title = document.getElementById('np-title').value.trim() || 'Tanpa Judul';
  const body = document.getElementById('np-body').value;
  if(!body.trim() && !activeNoteId) return;
  const now = new Date().toLocaleString('id-ID');
  if(activeNoteId){
    const n = notes.find(n=>n.id===activeNoteId);
    if(n){ n.title=title; n.body=body; n.updated=now; }
  } else {
    activeNoteId = Date.now();
    notes.unshift({ id: activeNoteId, title, body, created: now, updated: now });
  }
  saveNotes(); renderNoteList();
  document.getElementById('np-saved-status').textContent = 'âœ… Tersimpan ' + now;
}
function loadNote(id){
  const n = notes.find(n=>n.id===id);
  if(!n) return;
  activeNoteId = id;
  document.getElementById('np-title').value = n.title;
  document.getElementById('np-body').value = n.body;
  npUpdateCount();
  document.getElementById('np-saved-status').textContent = 'Diupdate: ' + n.updated;
  renderNoteList();
}
function deleteNote(id){
  notes = notes.filter(n=>n.id!==id);
  saveNotes(); renderNoteList();
  if(activeNoteId===id) newNote();
}
function npAutoSave(){
  npUpdateCount();
  clearTimeout(npTimer);
  npTimer = setTimeout(saveNote, 1500);
  document.getElementById('np-saved-status').textContent = 'ğŸ’¾ Menyimpan...';
}
function npUpdateCount(){
  const w = document.getElementById('np-body').value.trim().split(/\s+/).filter(Boolean).length;
  document.getElementById('np-wordcount').textContent = w + ' kata';
}
function renderNoteList(){
  const search = (document.getElementById('snip-search')||{value:''}).value;
  const list = document.getElementById('np-list');
  const empty = document.getElementById('np-empty-list');
  if(!notes.length){ list.innerHTML=''; empty.style.display='block'; return; }
  empty.style.display='none';
  list.innerHTML = notes.map(n=>`
    <div onclick="loadNote(${n.id})" style="cursor:pointer;padding:10px 12px;border-radius:8px;border:1px solid ${activeNoteId===n.id?'var(--accent)':'var(--border)'};background:${activeNoteId===n.id?'rgba(124,58,237,0.1)':'var(--bg)'};transition:all 0.15s;">
      <div style="font-size:0.82rem;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${n.title}</div>
      <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${n.body.substring(0,50)}...</div>
      <div style="display:flex;justify-content:space-between;margin-top:4px;">
        <span style="font-size:0.65rem;color:var(--muted);">${n.updated}</span>
        <button onclick="event.stopPropagation();deleteNote(${n.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.72rem;" title="Hapus">ğŸ—‘</button>
      </div>
    </div>`).join('');
}
renderNoteList();

// ===== CURRENCY =====
let rates = {};
let ratesBase = 'USD';
async function loadRates(){
  const info = document.getElementById('cur-rate-info');
  info.textContent = 'â³ Mengambil data kurs...';
  try {
    const r = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
    const d = await r.json();
    rates = d.rates;
    ratesBase = 'USD';
    info.textContent = `âœ… Kurs update: ${new Date(d.time_last_updated*1000).toLocaleString('id-ID')} Â· Sumber: ExchangeRate-API`;
    convertCur();
    renderRateGrid();
  } catch(e) {
    // fallback hardcoded approximate rates
    rates = {IDR:15800,USD:1,EUR:0.92,GBP:0.79,JPY:149,SGD:1.34,MYR:4.68,AUD:1.53,CNY:7.24,SAR:3.75,KRW:1330,HKD:7.82};
    info.textContent = 'âš  Gagal update live â€” menggunakan kurs perkiraan. Aktifkan internet untuk data terbaru.';
    convertCur();
    renderRateGrid();
  }
}
function convertCur(){
  if(!Object.keys(rates).length) return;
  const from = document.getElementById('cur-from').value;
  const to = document.getElementById('cur-to').value;
  const amount = parseFloat(document.getElementById('cur-amount').value)||0;
  const inUSD = amount / (rates[from]||1);
  const result = inUSD * (rates[to]||1);
  const fmt = (n,c) => n.toLocaleString('id-ID',{maximumFractionDigits:c>1000?0:c>10?2:4});
  document.getElementById('cur-result').textContent = `${fmt(result, result)} ${to}`;
}
function swapCur(){
  const f=document.getElementById('cur-from'),t=document.getElementById('cur-to'),v=f.value;
  f.value=t.value;t.value=v;convertCur();
}
function renderRateGrid(){
  const currs=['IDR','USD','EUR','GBP','JPY','SGD','MYR','AUD','CNY','SAR'];
  const flags={IDR:'ğŸ‡®ğŸ‡©',USD:'ğŸ‡ºğŸ‡¸',EUR:'ğŸ‡ªğŸ‡º',GBP:'ğŸ‡¬ğŸ‡§',JPY:'ğŸ‡¯ğŸ‡µ',SGD:'ğŸ‡¸ğŸ‡¬',MYR:'ğŸ‡²ğŸ‡¾',AUD:'ğŸ‡¦ğŸ‡º',CNY:'ğŸ‡¨ğŸ‡³',SAR:'ğŸ‡¸ğŸ‡¦'};
  const g=document.getElementById('cur-grid');
  g.innerHTML=currs.map(c=>{
    const v=(rates[c]||1).toLocaleString('id-ID',{maximumFractionDigits:2});
    return `<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 12px;">
      <div style="font-size:1rem;">${flags[c]||''}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.9rem;color:var(--accent2);">${c}</div>
      <div style="font-size:0.75rem;color:var(--muted);">${v} / USD</div>
    </div>`;
  }).join('');
}
// Load rates on tab open
document.querySelector('[onclick*="currency"]')?.addEventListener('click',()=>{ if(!Object.keys(rates).length) loadRates(); });

// ===== WEATHER =====
const wxCodes = {
  0:'â˜€ï¸',1:'ğŸŒ¤ï¸',2:'â›…',3:'â˜ï¸',45:'ğŸŒ«ï¸',48:'ğŸŒ«ï¸',
  51:'ğŸŒ¦ï¸',53:'ğŸŒ¦ï¸',55:'ğŸŒ§ï¸',61:'ğŸŒ§ï¸',63:'ğŸŒ§ï¸',65:'ğŸŒ§ï¸',
  71:'â„ï¸',73:'â„ï¸',75:'â„ï¸',80:'ğŸŒ¦ï¸',81:'ğŸŒ¦ï¸',82:'â›ˆï¸',
  95:'â›ˆï¸',96:'â›ˆï¸',99:'â›ˆï¸'
};
const wxDesc = {
  0:'Cerah',1:'Cerah berawan',2:'Berawan sebagian',3:'Mendung',
  45:'Berkabut',48:'Berkabut',51:'Gerimis ringan',53:'Gerimis',55:'Gerimis lebat',
  61:'Hujan ringan',63:'Hujan sedang',65:'Hujan lebat',
  71:'Salju ringan',73:'Salju sedang',75:'Salju lebat',
  80:'Hujan lokal',81:'Hujan lokal',82:'Hujan deras',
  95:'Badai petir',96:'Badai petir',99:'Badai petir besar'
};
async function searchWeather(){
  const city = document.getElementById('wx-city').value.trim();
  if(!city) return;
  document.getElementById('wx-loading').style.display='block';
  document.getElementById('wx-result').style.display='none';
  document.getElementById('wx-error').style.display='none';
  try {
    const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=id`);
    const gd = await geo.json();
    if(!gd.results?.length) throw new Error(`Kota "${city}" tidak ditemukan`);
    const {latitude:lat, longitude:lon, name, country} = gd.results[0];
    const wx = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m,windspeed_10m,apparent_temperature&timezone=auto&forecast_days=1`);
    const wd = await wx.json();
    const cw = wd.current_weather;
    const icon = wxCodes[cw.weathercode]||'ğŸŒ¡ï¸';
    const desc = wxDesc[cw.weathercode]||'â€”';
    const humidity = wd.hourly?.relativehumidity_2m?.[0]||'â€”';
    const feelsLike = wd.hourly?.apparent_temperature?.[0]||'â€”';
    document.getElementById('wx-city-name').textContent = `${name}, ${country}`;
    document.getElementById('wx-icon').textContent = icon;
    document.getElementById('wx-temp').textContent = `${cw.temperature}Â°C`;
    document.getElementById('wx-desc').textContent = desc;
    document.getElementById('wx-details').innerHTML = [
      {icon:'ğŸŒ¡ï¸', label:'Terasa', val:`${feelsLike}Â°C`},
      {icon:'ğŸ’¨', label:'Angin', val:`${cw.windspeed} km/h`},
      {icon:'ğŸ’§', label:'Kelembapan', val:`${humidity}%`},
      {icon:'ğŸ“', label:'Koordinat', val:`${lat.toFixed(2)}, ${lon.toFixed(2)}`},
    ].map(d=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center;">
      <div style="font-size:1.5rem;">${d.icon}</div>
      <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">${d.label}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-top:2px;">${d.val}</div>
    </div>`).join('');
    document.getElementById('wx-result').style.display='block';
  } catch(e) {
    document.getElementById('wx-error').textContent = 'âš  ' + e.message;
    document.getElementById('wx-error').style.display='block';
  } finally {
    document.getElementById('wx-loading').style.display='none';
  }
}
function quickWeather(city){ document.getElementById('wx-city').value=city; searchWeather(); }

// ===== IMAGE COMPRESSOR =====
let icOrigFile=null, icOrigSize=0;
function icLoad(input){ if(input.files[0]) icProcess(input.files[0]); }
function icDrop(e){ e.preventDefault(); document.getElementById('ic-drop').style.borderColor='var(--border)'; const f=e.dataTransfer.files[0]; if(f&&f.type.startsWith('image/')) icProcess(f); }
function icProcess(file){
  icOrigFile=file; icOrigSize=file.size;
  document.getElementById('ic-controls').style.display='block';
  document.getElementById('ic-drop').style.display='none';
  document.getElementById('ic-orig-size').textContent=fmtBytes(file.size);
  icPreview();
}
function icPreview(){
  if(!icOrigFile)return;
  const quality=parseInt(document.getElementById('ic-quality').value)/100;
  const format=document.getElementById('ic-format').value;
  const tw=parseInt(document.getElementById('ic-w').value)||0;
  const th=parseInt(document.getElementById('ic-h').value)||0;
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const canvas=document.getElementById('ic-canvas');
      let w=img.width,h=img.height;
      if(tw&&!th){h=Math.round(tw*h/w);w=tw;}
      else if(th&&!tw){w=Math.round(th*w/h);h=th;}
      else if(tw&&th){w=tw;h=th;}
      canvas.width=w;canvas.height=h;
      canvas.getContext('2d').drawImage(img,0,0,w,h);
      canvas.toBlob(blob=>{
        document.getElementById('ic-new-size').textContent=fmtBytes(blob.size);
        const saved=Math.max(0,(1-blob.size/icOrigSize)*100);
        document.getElementById('ic-saved').textContent=saved.toFixed(1)+'%';
        document.getElementById('ic-dims').textContent=`${w}Ã—${h}px`;
      },format,quality);
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(icOrigFile);
}
function icDownload(){
  const canvas=document.getElementById('ic-canvas');
  const format=document.getElementById('ic-format').value;
  const quality=parseInt(document.getElementById('ic-quality').value)/100;
  const ext={'image/jpeg':'jpg','image/png':'png','image/webp':'webp'}[format]||'jpg';
  canvas.toBlob(blob=>{
    const a=document.createElement('a');
    a.download='compressed.'+ext;
    a.href=URL.createObjectURL(blob);
    a.click();
    showNotif('âœ… Gambar didownload!');
  },format,quality);
}
function icReset(){ icOrigFile=null; document.getElementById('ic-controls').style.display='none'; document.getElementById('ic-drop').style.display='block'; document.getElementById('ic-file').value=''; }
function fmtBytes(b){ if(b<1024)return b+'B'; if(b<1048576)return (b/1024).toFixed(1)+'KB'; return (b/1048576).toFixed(2)+'MB'; }

// ===== FONT PREVIEW =====
const fpFonts = [
  {name:'Playfair Display',cat:'serif'},{name:'Merriweather',cat:'serif'},{name:'Lora',cat:'serif'},
  {name:'Cormorant Garamond',cat:'serif'},{name:'EB Garamond',cat:'serif'},{name:'Libre Baskerville',cat:'serif'},
  {name:'Roboto',cat:'sans'},{name:'Open Sans',cat:'sans'},{name:'Lato',cat:'sans'},
  {name:'Nunito',cat:'sans'},{name:'Poppins',cat:'sans'},{name:'Raleway',cat:'sans'},
  {name:'Montserrat',cat:'sans'},{name:'Source Sans 3',cat:'sans'},{name:'DM Sans',cat:'sans'},
  {name:'Space Grotesk',cat:'sans'},{name:'Outfit',cat:'sans'},{name:'Plus Jakarta Sans',cat:'sans'},
  {name:'JetBrains Mono',cat:'mono'},{name:'Fira Code',cat:'mono'},{name:'Source Code Pro',cat:'mono'},
  {name:'IBM Plex Mono',cat:'mono'},{name:'Inconsolata',cat:'mono'},{name:'Courier Prime',cat:'mono'},
  {name:'Syne',cat:'display'},{name:'Bebas Neue',cat:'display'},{name:'Righteous',cat:'display'},
  {name:'Abril Fatface',cat:'display'},{name:'Permanent Marker',cat:'display'},{name:'Pacifico',cat:'display'},
  {name:'Dancing Script',cat:'display'},{name:'Great Vibes',cat:'display'},{name:'Lobster',cat:'display'},
];
let fpCat='all';
let fpLoaded={};
function fpCategory(c){ fpCat=c; renderFonts(); }
function renderFonts(){
  const text=document.getElementById('fp-text').value||'Halo Dunia!';
  const size=document.getElementById('fp-size').value||28;
  const filtered=fpFonts.filter(f=>fpCat==='all'||f.cat===fpCat);
  const grid=document.getElementById('fp-grid');
  grid.innerHTML=filtered.map(f=>{
    if(!fpLoaded[f.name]){
      const link=document.createElement('link');
      link.rel='stylesheet';
      link.href=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(f.name)}&display=swap`;
      document.head.appendChild(link);
      fpLoaded[f.name]=true;
    }
    return `<div style="display:flex;align-items:center;gap:16px;padding:12px 16px;border-bottom:1px solid var(--border);transition:background 0.15s;" onmouseover="this.style.background='var(--surface2)'" onmouseout="this.style.background=''" title="Klik untuk copy nama font" onclick="navigator.clipboard.writeText('${f.name}').then(()=>showNotif('${f.name} disalin!'));this.style.borderColor='var(--accent)'">
      <div style="width:120px;flex-shrink:0;">
        <div style="font-size:0.7rem;color:var(--muted);">${f.name}</div>
        <div style="font-size:0.62rem;color:var(--border);text-transform:uppercase;">${f.cat}</div>
      </div>
      <div style="font-family:'${f.name}',serif;font-size:${size}px;color:var(--text);flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer;">${text}</div>
    </div>`;
  }).join('');
}
renderFonts();

// ===== SNIPPET MANAGER =====
let snippets=JSON.parse(localStorage.getItem('tb-snippets')||'[]');
let activeSnipId=null;
let snipFilter='all';
function saveSnippets(){ localStorage.setItem('tb-snippets',JSON.stringify(snippets)); }
function newSnippet(){
  activeSnipId=null;
  document.getElementById('snip-name').value='';
  document.getElementById('snip-desc').value='';
  document.getElementById('snip-code').value='';
  document.getElementById('snip-lang').value='js';
}
function saveSnippet(){
  const name=document.getElementById('snip-name').value.trim()||'Snippet Baru';
  const code=document.getElementById('snip-code').value;
  const desc=document.getElementById('snip-desc').value;
  const lang=document.getElementById('snip-lang').value;
  if(!code.trim()) return;
  const now=new Date().toLocaleString('id-ID');
  if(activeSnipId){
    const s=snippets.find(s=>s.id===activeSnipId);
    if(s){s.name=name;s.code=code;s.desc=desc;s.lang=lang;s.updated=now;}
  } else {
    activeSnipId=Date.now();
    snippets.unshift({id:activeSnipId,name,code,desc,lang,created:now,updated:now});
  }
  saveSnippets(); renderSnippets(); showNotif('Snippet disimpan!');
}
function loadSnippet(id){
  const s=snippets.find(s=>s.id===id);
  if(!s) return;
  activeSnipId=id;
  document.getElementById('snip-name').value=s.name;
  document.getElementById('snip-desc').value=s.desc;
  document.getElementById('snip-code').value=s.code;
  document.getElementById('snip-lang').value=s.lang;
  renderSnippets();
}
function deleteSnippet(){
  if(!activeSnipId) return;
  if(confirm('Hapus snippet ini?')){ snippets=snippets.filter(s=>s.id!==activeSnipId); saveSnippets(); newSnippet(); renderSnippets(); }
}
function copySnippet(){ const c=document.getElementById('snip-code').value; if(c) navigator.clipboard.writeText(c).then(()=>showNotif('Kode disalin!')); }
function filterSnip(f){ snipFilter=f; renderSnippets(); }
function renderSnippets(){
  const q=(document.getElementById('snip-search').value||'').toLowerCase();
  const langColors={js:'#f7df1e',css:'#1572b6',html:'#e34c26',python:'#3776ab',sql:'#cc2927',bash:'#4eaa25',other:'var(--muted)'};
  let filtered=snippets.filter(s=>{
    if(snipFilter!=='all'&&s.lang!==snipFilter) return false;
    if(q&&!s.name.toLowerCase().includes(q)&&!s.desc.toLowerCase().includes(q)&&!s.code.toLowerCase().includes(q)) return false;
    return true;
  });
  const list=document.getElementById('snip-list');
  const empty=document.getElementById('snip-empty');
  if(!filtered.length){ list.innerHTML=''; empty.style.display='block'; return; }
  empty.style.display='none';
  list.innerHTML=filtered.map(s=>`
    <div onclick="loadSnippet(${s.id})" style="cursor:pointer;padding:10px 12px;border-radius:8px;border:1px solid ${activeSnipId===s.id?'var(--accent)':'var(--border)'};background:${activeSnipId===s.id?'rgba(124,58,237,0.1)':'var(--bg)'};transition:all 0.15s;">
      <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px;">
        <span style="width:8px;height:8px;background:${langColors[s.lang]||'var(--muted)'};border-radius:50%;flex-shrink:0;"></span>
        <span style="font-size:0.82rem;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.name}</span>
      </div>
      <div style="font-size:0.7rem;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.desc||s.lang.toUpperCase()}</div>
    </div>`).join('');
}
// Add some starter snippets
if(!snippets.length){
  snippets=[
    {id:1,name:'Fetch API',lang:'js',desc:'Ambil data dari API',code:`async function fetchData(url) {\n  try {\n    const res = await fetch(url);\n    const data = await res.json();\n    return data;\n  } catch(err) {\n    console.error('Error:', err);\n  }\n}`,created:'â€”',updated:'â€”'},
    {id:2,name:'Flexbox Center',lang:'css',desc:'Center dengan flexbox',code:`.container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n}`,created:'â€”',updated:'â€”'},
    {id:3,name:'HTML Template',lang:'html',desc:'Template HTML dasar',code:`<!DOCTYPE html>\n<html lang="id">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Halaman</title>\n</head>\n<body>\n  <h1>Halo Dunia!</h1>\n</body>\n</html>`,created:'â€”',updated:'â€”'},
  ];
  saveSnippets();
}
renderSnippets();

// ===== ASPECT RATIO =====
function gcd(a,b){ return b?gcd(b,a%b):a; }
function calcAR(){
  const w=parseInt(document.getElementById('ar-w').value)||0;
  const h=parseInt(document.getElementById('ar-h').value)||0;
  if(!w||!h){ document.getElementById('ar-out').textContent='â€”'; return; }
  const g=gcd(w,h);
  const rw=w/g, rh=h/g;
  const dec=(w/h).toFixed(4);
  document.getElementById('ar-out').textContent=`Rasio: ${rw}:${rh}\nDesimal: ${dec}:1\nTipe: ${rw===16&&rh===9?'Widescreen HD':rw===4&&rh===3?'Klasik TV':rw===1&&rh===1?'Square':rw===9&&rh===16?'Portrait/Story':rw===21&&rh===9?'Ultrawide':'Custom'}`;
}
function calcScale(){
  const ow=parseInt(document.getElementById('sc-ow').value)||0;
  const oh=parseInt(document.getElementById('sc-oh').value)||0;
  const tw=parseInt(document.getElementById('sc-tw').value)||0;
  const th=parseInt(document.getElementById('sc-th').value)||0;
  if(!ow||!oh){ document.getElementById('sc-out').textContent='â€”'; return; }
  if(tw){
    const nh=Math.round(tw*oh/ow);
    document.getElementById('sc-out').textContent=`Target: ${tw} Ã— ${nh} px\nSkala: ${(tw/ow*100).toFixed(1)}%`;
  } else if(th){
    const nw=Math.round(th*ow/oh);
    document.getElementById('sc-out').textContent=`Target: ${nw} Ã— ${th} px\nSkala: ${(th/oh*100).toFixed(1)}%`;
  }
}
function setAR(w,h){
  document.getElementById('ar-w').value=w;
  document.getElementById('ar-h').value=h;
  calcAR();
  const presets={
    '16:9':['1920Ã—1080','1280Ã—720','3840Ã—2160','2560Ã—1440'],
    '4:3':['1024Ã—768','800Ã—600','1400Ã—1050'],
    '1:1':['1080Ã—1080','500Ã—500','800Ã—800'],
    '9:16':['1080Ã—1920','720Ã—1280'],
    '3:2':['3000Ã—2000','4500Ã—3000'],
    '21:9':['2560Ã—1080','3440Ã—1440'],
    '2:1':['2000Ã—1000','1200Ã—600'],
    '4:5':['1080Ã—1350','800Ã—1000'],
    '1200:630':['1200Ã—630'],
  };
  const g=gcd(w,h);
  const key=`${w/g}:${h/g}`;
  const ps=presets[key]||[];
  const pout=document.getElementById('ar-preset-out');
  if(ps.length){
    pout.style.display='block';
    pout.textContent=`Resolusi umum ${key}:\n${ps.join(' Â· ')}`;
  } else { pout.style.display='none'; }
}

// ===== MINDMAP =====
function mmExample(){
  document.getElementById('mm-input').value=`Teknologi
  Artificial Intelligence
    Machine Learning
    Computer Vision
    NLP
  Web Development
    Frontend
      React
      Vue
    Backend
      Node.js
      Python
  Mobile
    Android
    iOS`;
  renderMindmap();
}
function renderMindmap(){
  const raw=document.getElementById('mm-input').value;
  const lines=raw.split('\n').filter(l=>l.trim());
  if(!lines.length) return;
  const canvas=document.getElementById('mm-canvas');
  // Parse tree
  const root={text:lines[0].trim(),children:[],level:0};
  const stack=[root];
  for(let i=1;i<lines.length;i++){
    const line=lines[i];
    const indent=line.search(/\S/);
    const level=Math.floor(indent/2)+1;
    const node={text:line.trim(),children:[],level};
    while(stack.length>level) stack.pop();
    if(stack.length) stack[stack.length-1].children.push(node);
    stack.push(node);
  }
  // Render as SVG
  const colors=['#7c3aed','#06b6d4','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899'];
  const W=700,H=500;
  let svg=`<svg width="${W}" height="${H}" xmlns="http://www.w3.org/2000/svg" style="font-family:Space Mono,monospace;">`;
  svg+=`<rect width="${W}" height="${H}" fill="#0a0a0f" rx="8"/>`;
  const cx=160,cy=H/2,rx=120,ry=26;
  // Draw root
  svg+=`<ellipse cx="${cx}" cy="${cy}" rx="${rx}" ry="${ry}" fill="#7c3aed" opacity="0.9"/>`;
  svg+=`<text x="${cx}" y="${cy+5}" text-anchor="middle" fill="white" font-size="13" font-weight="bold">${root.text.substring(0,18)}</text>`;
  // Draw branches
  const total=root.children.length;
  root.children.forEach((child,i)=>{
    const angle=((i/(total||1))*Math.PI*1.6)-(Math.PI*0.8);
    const bx=cx+rx+1;
    const by=cy;
    const ex=320,ey=80+(i*(H-80)/(total||1));
    const color=colors[i%colors.length];
    svg+=`<line x1="${bx}" y1="${by}" x2="${ex}" y2="${ey}" stroke="${color}" stroke-width="2" opacity="0.7"/>`;
    const tw=Math.min(child.text.length*7+16,160);
    svg+=`<rect x="${ex}" y="${ey-16}" width="${tw}" height="28" rx="8" fill="${color}" opacity="0.25"/>`;
    svg+=`<rect x="${ex}" y="${ey-16}" width="3" height="28" rx="1" fill="${color}"/>`;
    svg+=`<text x="${ex+10}" y="${ey+5}" fill="#e8e8f0" font-size="11.5">${child.text.substring(0,20)}</text>`;
    // Sub children
    child.children.forEach((sub,j)=>{
      const sx=ex+tw+10;
      const sy=ey-14*(child.children.length-1)/2+j*22;
      svg+=`<line x1="${ex+tw}" y1="${ey}" x2="${sx}" y2="${sy+6}" stroke="${color}" stroke-width="1.5" opacity="0.4"/>`;
      const stw=Math.min(sub.text.length*6+12,140);
      svg+=`<rect x="${sx}" y="${sy}" width="${stw}" height="20" rx="4" fill="${color}" opacity="0.12"/>`;
      svg+=`<text x="${sx+8}" y="${sy+13}" fill="#9999bb" font-size="10">${sub.text.substring(0,22)}</text>`;
    });
  });
  svg+=`</svg>`;
  canvas.innerHTML=svg;
}
function mmDownload(){
  const svg=document.getElementById('mm-canvas').innerHTML;
  if(!svg.includes('<svg')) return;
  const blob=new Blob([svg],{type:'image/svg+xml'});
  const a=document.createElement('a');a.download='mindmap.svg';a.href=URL.createObjectURL(blob);a.click();
}

// ===== MORSE CODE =====
const MORSE_MAP={A:'.-',B:'-...',C:'-.-.',D:'-..',E:'.',F:'..-.',G:'--.',H:'....',I:'..',J:'.---',K:'-.-',L:'.-..',M:'--',N:'-.',O:'---',P:'.--.',Q:'--.-',R:'.-.',S:'...',T:'-',U:'..-',V:'...-',W:'.--',X:'-..-',Y:'-.--',Z:'--..',0:'-----',1:'.----',2:'..---',3:'...--',4:'....-',5:'.....',6:'-....',7:'--...',8:'---..',9:'----.',' ':'/'};
const MORSE_REV=Object.fromEntries(Object.entries(MORSE_MAP).map(([k,v])=>[v,k]));
function textToMorse(){
  const t=document.getElementById('morse-text').value.toUpperCase();
  const m=t.split('').map(c=>MORSE_MAP[c]||'').filter(c=>c).join(' ');
  document.getElementById('morse-code').value=m;
  updateMorseVisual(m);
}
function morseToText(){
  const m=document.getElementById('morse-code').value.trim();
  const words=m.split(' / ');
  const t=words.map(w=>w.split(' ').map(s=>MORSE_REV[s]||'?').join('')).join(' ');
  document.getElementById('morse-text').value=t;
  updateMorseVisual(m);
}
function updateMorseVisual(m){
  const v=document.getElementById('morse-visual');
  v.innerHTML=m.split('').map(c=>{
    if(c==='.') return `<div style="width:8px;height:8px;background:var(--accent2);border-radius:50%;flex-shrink:0;"></div>`;
    if(c==='-') return `<div style="width:24px;height:8px;background:var(--accent);border-radius:4px;flex-shrink:0;"></div>`;
    if(c===' ') return `<div style="width:8px;"></div>`;
    if(c==='/') return `<div style="width:16px;height:8px;background:var(--border);border-radius:2px;flex-shrink:0;opacity:0.5;"></div>`;
    return '';
  }).join('');
}
let morseCtx=null,morseStop=false;
async function playMorse(){
  const code=document.getElementById('morse-code').value.trim();
  if(!code){showNotif('Isi teks dulu!');return;}
  morseStop=false;
  const wpm=parseInt(document.getElementById('morse-speed').value)||15;
  const freq=parseInt(document.getElementById('morse-freq').value)||600;
  const dot=1200/wpm;
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const btn=document.getElementById('morse-play-btn');
  btn.textContent='â¸ Playing...';
  const play=async(dur)=>{
    if(morseStop) return;
    const o=ctx.createOscillator(),g=ctx.createGain();
    o.connect(g);g.connect(ctx.destination);
    o.frequency.value=freq;g.gain.value=0.3;
    o.start();
    await new Promise(r=>setTimeout(r,dur));
    o.stop();
    await new Promise(r=>setTimeout(r,dot));
  };
  for(const char of code){
    if(morseStop) break;
    if(char==='.') await play(dot);
    else if(char==='-') await play(dot*3);
    else if(char===' ') await new Promise(r=>setTimeout(r,dot*2));
    else if(char==='/') await new Promise(r=>setTimeout(r,dot*5));
  }
  ctx.close();
  btn.textContent='â–¶ Putar Suara';
}
function stopMorse(){ morseStop=true; document.getElementById('morse-play-btn').textContent='â–¶ Putar Suara'; }
document.getElementById('morse-speed')?.addEventListener('input',e=>document.getElementById('morse-speed-val').textContent=e.target.value+' WPM');
document.getElementById('morse-freq')?.addEventListener('input',e=>document.getElementById('morse-freq-val').textContent=e.target.value+' Hz');
// Morse table
(()=>{
  const t=document.getElementById('morse-table');
  if(t) t.innerHTML=Object.entries(MORSE_MAP).map(([k,v])=>`<div style="background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:4px 8px;"><span style="color:var(--text);font-weight:700;">${k}</span><span style="color:var(--muted);margin-left:6px;">${v}</span></div>`).join('');
})();

// ===== WORLD CLOCK =====
const WC_CITIES=[
  {name:'Jakarta',tz:'Asia/Jakarta',flag:'ğŸ‡®ğŸ‡©'},{name:'Bali',tz:'Asia/Makassar',flag:'ğŸ‡®ğŸ‡©'},
  {name:'Tokyo',tz:'Asia/Tokyo',flag:'ğŸ‡¯ğŸ‡µ'},{name:'Seoul',tz:'Asia/Seoul',flag:'ğŸ‡°ğŸ‡·'},
  {name:'Singapore',tz:'Asia/Singapore',flag:'ğŸ‡¸ğŸ‡¬'},{name:'Beijing',tz:'Asia/Shanghai',flag:'ğŸ‡¨ğŸ‡³'},
  {name:'Dubai',tz:'Asia/Dubai',flag:'ğŸ‡¦ğŸ‡ª'},{name:'London',tz:'Europe/London',flag:'ğŸ‡¬ğŸ‡§'},
  {name:'Paris',tz:'Europe/Paris',flag:'ğŸ‡«ğŸ‡·'},{name:'New York',tz:'America/New_York',flag:'ğŸ‡ºğŸ‡¸'},
  {name:'Los Angeles',tz:'America/Los_Angeles',flag:'ğŸ‡ºğŸ‡¸'},{name:'Sydney',tz:'Australia/Sydney',flag:'ğŸ‡¦ğŸ‡º'},
  {name:'Mumbai',tz:'Asia/Kolkata',flag:'ğŸ‡®ğŸ‡³'},{name:'Moscow',tz:'Europe/Moscow',flag:'ğŸ‡·ğŸ‡º'},
  {name:'SÃ£o Paulo',tz:'America/Sao_Paulo',flag:'ğŸ‡§ğŸ‡·'},
];
let wcCustom=JSON.parse(localStorage.getItem('tb-wc-custom')||'[]');
let wcInterval=null;
function renderWorldClock(){
  const all=[...WC_CITIES,...wcCustom];
  const grid=document.getElementById('wc-grid');
  if(!grid) return;
  const now=new Date();
  grid.innerHTML=all.map((c,i)=>{
    const t=now.toLocaleTimeString('id-ID',{timeZone:c.tz,hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const d=now.toLocaleDateString('id-ID',{timeZone:c.tz,weekday:'short',day:'numeric',month:'short'});
    const isCustom=i>=WC_CITIES.length;
    const h=parseInt(now.toLocaleTimeString('en-US',{timeZone:c.tz,hour:'2-digit',hour12:false}));
    const isDark=h<6||h>=20;
    return `<div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;position:relative;">
      ${isCustom?`<button onclick="removeWCCity(${i-WC_CITIES.length})" style="position:absolute;top:6px;right:8px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">âœ•</button>`:''}
      <div style="font-size:1.4rem;">${c.flag||'ğŸŒ'} ${isDark?'ğŸŒ™':'â˜€ï¸'}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.92rem;color:var(--text);margin:4px 0;">${c.name}</div>
      <div style="font-family:'Space Mono',monospace;font-size:1.4rem;font-weight:700;color:var(--accent2);letter-spacing:1px;">${t}</div>
      <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;">${d}</div>
      <div style="font-size:0.65rem;color:var(--border);margin-top:2px;">${c.tz}</div>
    </div>`;
  }).join('');
}
function addWCCity(){
  const name=document.getElementById('wc-city-name').value.trim();
  const tz=document.getElementById('wc-tz').value;
  if(!name||!tz) return;
  wcCustom.push({name,tz,flag:'ğŸŒ'});
  localStorage.setItem('tb-wc-custom',JSON.stringify(wcCustom));
  document.getElementById('wc-city-name').value='';
  renderWorldClock();
}
function removeWCCity(i){ wcCustom.splice(i,1); localStorage.setItem('tb-wc-custom',JSON.stringify(wcCustom)); renderWorldClock(); }
// Populate timezone select
(()=>{
  const tzs=['Africa/Cairo','America/Chicago','America/Denver','America/Los_Angeles','America/Mexico_City','America/New_York','America/Sao_Paulo','America/Toronto','Asia/Bangkok','Asia/Colombo','Asia/Dubai','Asia/Hong_Kong','Asia/Jakarta','Asia/Karachi','Asia/Kolkata','Asia/Kuala_Lumpur','Asia/Makassar','Asia/Manila','Asia/Riyadh','Asia/Seoul','Asia/Shanghai','Asia/Singapore','Asia/Taipei','Asia/Tehran','Asia/Tokyo','Australia/Melbourne','Australia/Sydney','Europe/Amsterdam','Europe/Berlin','Europe/Istanbul','Europe/London','Europe/Madrid','Europe/Moscow','Europe/Paris','Europe/Rome','Pacific/Auckland','Pacific/Honolulu'];
  const sel=document.getElementById('wc-tz');
  if(sel) sel.innerHTML=tzs.map(t=>`<option value="${t}">${t}</option>`).join('');
})();
// Start ticking when tab is opened
document.querySelector('[onclick*="worldclock"]')?.addEventListener('click',()=>{ clearInterval(wcInterval); renderWorldClock(); wcInterval=setInterval(renderWorldClock,1000); });

// ===== FAKE DATA =====
const FD={
  first:['Budi','Siti','Ahmad','Dewi','Rudi','Ayu','Hendra','Nur','Andi','Putri','Rizky','Indah','Wahyu','Mega','Dian','Bayu','Citra','Fajar','Gita','Irma','Joko','Kartika','Lena','Mulyadi','Nova','Oka','Prita','Rini','Surya','Tari','Yuni','Zahra','Agus','Eka','Firman'],
  last:['Santoso','Rahayu','Kusuma','Pratama','Wijaya','Sari','Putra','Susanto','Hidayat','Wahyudi','Nugroho','Lestari','Permata','Saputra','Wibowo','Handoko','Setiawan','Kurniawan','Gunawan','Hartono','Irawati','Juliani','Kristiawan','Lukito','Mulyono'],
  city:['Jakarta','Bandung','Surabaya','Yogyakarta','Semarang','Medan','Makassar','Palembang','Tangerang','Bekasi','Depok','Bogor','Malang','Denpasar','Balikpapan'],
  prov:{'Jakarta':'DKI Jakarta','Bandung':'Jawa Barat','Surabaya':'Jawa Timur','Yogyakarta':'DIY','Semarang':'Jawa Tengah','Medan':'Sumatera Utara','Makassar':'Sulawesi Selatan','Palembang':'Sumatera Selatan','Tangerang':'Banten','Bekasi':'Jawa Barat','Depok':'Jawa Barat','Bogor':'Jawa Barat','Malang':'Jawa Timur','Denpasar':'Bali','Balikpapan':'Kalimantan Timur'},
  street:['Jl. Sudirman','Jl. Thamrin','Jl. Gatot Subroto','Jl. Merdeka','Jl. Pahlawan','Jl. Ahmad Yani','Jl. Diponegoro','Jl. Imam Bonjol','Jl. Hayam Wuruk','Jl. Veteran'],
  job:['Software Engineer','Data Analyst','Product Manager','UI/UX Designer','Marketing Manager','Akuntan','Dokter','Guru','Pengacara','Arsitek','Fotografer','Jurnalis','Apoteker','Konsultan','HR Manager'],
  bank:['BCA','BNI','BRI','Mandiri','CIMB Niaga','Danamon','Permata','BTN'],
  domain:['gmail.com','yahoo.com','outlook.com','email.com','mail.com'],
};
function rndItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function rndInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function genNIK(city,dob,gender){
  const kodes={'Jakarta':'3174','Bandung':'3273','Surabaya':'3578','Yogyakarta':'3471','Semarang':'3374','Medan':'1275','Makassar':'7371','Palembang':'1671','Tangerang':'3603','Bekasi':'3275','Depok':'3276','Bogor':'3201','Malang':'3573','Denpasar':'5171','Balikpapan':'6471'};
  const kode=kodes[city]||'3174';
  const d=new Date(dob);
  let dd=d.getDate(),mm=d.getMonth()+1,yy=String(d.getFullYear()).slice(2);
  if(gender==='P') dd+=40;
  const dobStr=String(dd).padStart(2,'0')+String(mm).padStart(2,'0')+yy;
  const rand=String(rndInt(1000,9999));
  const seq=String(rndInt(100,999));
  return kode+'01'+dobStr+rand+seq.slice(0,3);
}
let fdData=[];
function genFakeData(){
  const count=Math.min(50,parseInt(document.getElementById('fd-count').value)||5);
  fdData=[];
  for(let i=0;i<count;i++){
    const fn=rndItem(FD.first),ln=rndItem(FD.last);
    const gender=Math.random()>0.5?'L':'P';
    const city=rndItem(FD.city);
    const year=rndInt(1970,2000),month=rndInt(1,12),day=rndInt(1,28);
    const dob=`${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const row={};
    if(document.getElementById('fd-nama').checked) row.nama=fn+' '+ln;
    if(document.getElementById('fd-nik').checked) row.nik=genNIK(city,dob,gender);
    if(document.getElementById('fd-email').checked) row.email=fn.toLowerCase()+'.'+ln.toLowerCase()+rndInt(1,99)+'@'+rndItem(FD.domain);
    if(document.getElementById('fd-phone').checked) row.telepon='08'+rndInt(1,9)+String(rndInt(10000000,99999999));
    if(document.getElementById('fd-alamat').checked) row.alamat=rndItem(FD.street)+' No.'+rndInt(1,200)+', '+city+', '+FD.prov[city];
    if(document.getElementById('fd-dob').checked) row.tgl_lahir=dob;
    if(document.getElementById('fd-job').checked) row.pekerjaan=rndItem(FD.job);
    if(document.getElementById('fd-bank').checked) row.rekening=rndItem(FD.bank)+' '+String(rndInt(100,999))+'-'+String(rndInt(100,999))+'-'+String(rndInt(1000,9999));
    fdData.push(row);
  }
  renderFDTable();
}
function renderFDTable(){
  if(!fdData.length) return;
  const keys=Object.keys(fdData[0]);
  let html=`<table class="csv-table"><thead><tr>${keys.map(k=>`<th>${k}</th>`).join('')}</tr></thead><tbody>`;
  fdData.forEach(r=>{ html+=`<tr>${keys.map(k=>`<td>${r[k]}</td>`).join('')}</tr>`; });
  html+=`</tbody></table>`;
  document.getElementById('fd-table-wrap').innerHTML=html;
}
function copyFakeData(){ navigator.clipboard.writeText(JSON.stringify(fdData,null,2)).then(()=>showNotif('JSON disalin!')); }
function exportFakeCSV(){
  if(!fdData.length) return;
  const keys=Object.keys(fdData[0]);
  const csv=[keys.join(','),...fdData.map(r=>keys.map(k=>`"${r[k]}"`).join(','))].join('\n');
  const a=document.createElement('a');a.download='fake-data.csv';a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.click();
  showNotif('CSV didownload!');
}

// ===== PALETTE EXTRACTOR =====
let palCanvas=null,palImgData=null;
function palDrop(e){ e.preventDefault(); document.getElementById('pal-drop').style.borderColor='var(--border)'; const f=e.dataTransfer.files[0]; if(f&&f.type.startsWith('image/')) palProcess(f); }
function palLoad(inp){ if(inp.files[0]) palProcess(inp.files[0]); }
function palProcess(file){
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      document.getElementById('pal-img').src=e.target.result;
      const c=document.createElement('canvas');
      c.width=Math.min(img.width,100);c.height=Math.min(img.height,100);
      const ctx=c.getContext('2d');ctx.drawImage(img,0,0,c.width,c.height);
      palImgData=ctx.getImageData(0,0,c.width,c.height);
      document.getElementById('pal-drop').style.display='none';
      document.getElementById('pal-result').style.display='block';
      palReExtract();
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(file);
}
function palReExtract(){
  const n=parseInt(document.getElementById('pal-count').value)||6;
  document.getElementById('pal-count-val').textContent=n;
  if(!palImgData) return;
  const d=palImgData.data;
  const pixels=[];
  for(let i=0;i<d.length;i+=16) pixels.push([d[i],d[i+1],d[i+2]]);
  // Simple k-means-like: bucket by quantized color
  const buckets={};
  pixels.forEach(([r,g,b])=>{
    const qr=Math.round(r/32)*32,qg=Math.round(g/32)*32,qb=Math.round(b/32)*32;
    const k=`${qr},${qg},${qb}`;
    if(!buckets[k]) buckets[k]={r:0,g:0,b:0,count:0,qr,qg,qb};
    buckets[k].r+=r;buckets[k].g+=g;buckets[k].b+=b;buckets[k].count++;
  });
  const sorted=Object.values(buckets).sort((a,b)=>b.count-a.count).slice(0,n);
  const colors=sorted.map(b=>({r:Math.round(b.r/b.count),g:Math.round(b.g/b.count),b:Math.round(b.b/b.count),count:b.count}));
  // Render
  const colorsEl=document.getElementById('pal-colors');
  const swatchEl=document.getElementById('pal-swatches');
  colorsEl.innerHTML=colors.map(c=>{
    const hex='#'+[c.r,c.g,c.b].map(x=>x.toString(16).padStart(2,'0')).join('');
    const {h,s,l}=rgbToHsl(c.r,c.g,c.b);
    const pct=((c.count/pixels.length)*100).toFixed(1);
    const textColor=(c.r*0.299+c.g*0.587+c.b*0.114)>140?'#000':'#fff';
    return `<div style="display:flex;align-items:center;gap:10px;cursor:pointer;" onclick="navigator.clipboard.writeText('${hex}').then(()=>showNotif('${hex} disalin!'))">
      <div style="width:48px;height:32px;background:${hex};border-radius:6px;flex-shrink:0;border:1px solid rgba(255,255,255,0.1);"></div>
      <div style="flex:1;">
        <div style="font-size:0.85rem;font-weight:700;color:var(--accent2);">${hex.toUpperCase()}</div>
        <div style="font-size:0.7rem;color:var(--muted);">rgb(${c.r},${c.g},${c.b}) Â· hsl(${h},${s}%,${l}%) Â· ${pct}%</div>
      </div>
      <div style="width:60px;height:8px;background:var(--border);border-radius:4px;overflow:hidden;"><div style="height:100%;background:${hex};width:${pct}%;"></div></div>
    </div>`;
  }).join('');
  swatchEl.innerHTML=colors.map(c=>{
    const hex='#'+[c.r,c.g,c.b].map(x=>x.toString(16).padStart(2,'0')).join('');
    return `<div onclick="navigator.clipboard.writeText('${hex}').then(()=>showNotif('${hex} disalin!'))" title="${hex}" style="width:40px;height:40px;background:${hex};border-radius:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.15);transition:transform 0.15s;" onmouseover="this.style.transform='scale(1.15)'" onmouseout="this.style.transform=''"></div>`;
  }).join('');
}

// ===== CHART GENERATOR =====
let cgChartInstance=null;
function renderChart(){
  const raw=document.getElementById('cg-data').value.trim();
  const type=document.getElementById('cg-type').value;
  const title=document.getElementById('cg-title').value;
  if(!raw) return;
  const rows=raw.split('\n').map(r=>r.split(',').map(s=>s.trim())).filter(r=>r.length>=2);
  if(!rows.length) return;
  const labels=rows.map(r=>r[0]);
  const values=rows.map(r=>parseFloat(r[1])||0);
  const palette=['#7c3aed','#06b6d4','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#f97316','#14b8a6','#84cc16'];
  const canvas=document.getElementById('cg-canvas');
  const W=canvas.parentElement.offsetWidth-32||500,H=360;
  canvas.width=W;canvas.height=H;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#0a0a0f';ctx.fillRect(0,0,W,H);
  // Title
  ctx.fillStyle='#e8e8f0';ctx.font='bold 16px Syne,sans-serif';ctx.textAlign='center';
  ctx.fillText(title,W/2,30);
  const pad={t:50,r:20,b:60,l:55};
  const cw=W-pad.l-pad.r,ch=H-pad.t-pad.b;
  if(type==='pie'||type==='donut'){
    const cx=W/2,cy=H/2+10,r=Math.min(cw,ch)/2-10;
    const total=values.reduce((a,b)=>a+b,0);
    let angle=-Math.PI/2;
    values.forEach((v,i)=>{
      const sweep=(v/total)*Math.PI*2;
      ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,angle,angle+sweep);ctx.closePath();
      ctx.fillStyle=palette[i%palette.length];ctx.fill();
      if(type==='donut'){ctx.beginPath();ctx.arc(cx,cy,r*0.5,0,Math.PI*2);ctx.fillStyle='#0a0a0f';ctx.fill();}
      const midA=angle+sweep/2;
      const tx=cx+Math.cos(midA)*(r*0.7),ty=cy+Math.sin(midA)*(r*0.7);
      ctx.fillStyle='#fff';ctx.font='bold 11px Space Mono,monospace';ctx.textAlign='center';
      ctx.fillText(((v/total)*100).toFixed(1)+'%',tx,ty+4);
      angle+=sweep;
    });
    const maxL=5;
    labels.slice(0,maxL).forEach((l,i)=>{
      ctx.fillStyle=palette[i%palette.length];ctx.fillRect(10,H-50+i*16,12,12);
      ctx.fillStyle='#9999bb';ctx.font='11px Space Mono,monospace';ctx.textAlign='left';
      ctx.fillText(l.substring(0,20),28,H-42+i*16);
    });
  } else {
    const max=Math.max(...values)*1.1||1;
    const yStep=Math.ceil(max/5);
    // Grid & Y axis
    for(let i=0;i<=5;i++){
      const y=pad.t+ch-(i/5)*ch;
      ctx.strokeStyle='#2a2a3d';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+cw,y);ctx.stroke();
      ctx.fillStyle='#6b6b8a';ctx.font='10px Space Mono,monospace';ctx.textAlign='right';
      ctx.fillText(Math.round(i*yStep),pad.l-5,y+4);
    }
    if(type==='bar'||type==='horizontal-bar'){
      const bw=Math.min(cw/labels.length*0.6,60);
      labels.forEach((l,i)=>{
        const x=pad.l+(i+0.5)*(cw/labels.length);
        const bh=(values[i]/max)*ch;
        const y=pad.t+ch-bh;
        const grad=ctx.createLinearGradient(0,y,0,y+bh);
        grad.addColorStop(0,palette[i%palette.length]);
        grad.addColorStop(1,palette[i%palette.length]+'44');
        ctx.fillStyle=grad;
        ctx.beginPath();ctx.roundRect?ctx.roundRect(x-bw/2,y,bw,bh,4):ctx.fillRect(x-bw/2,y,bw,bh);ctx.fill();
        ctx.fillStyle='#e8e8f0';ctx.font='bold 10px Space Mono,monospace';ctx.textAlign='center';
        ctx.fillText(values[i],x,y-5);
        ctx.fillStyle='#9999bb';ctx.font='10px Space Mono,monospace';
        ctx.fillText(l.substring(0,8),x,H-pad.b+15);
      });
    } else if(type==='line'){
      ctx.beginPath();
      labels.forEach((l,i)=>{
        const x=pad.l+(i/(labels.length-1||1))*cw;
        const y=pad.t+ch-(values[i]/max)*ch;
        i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
      });
      ctx.strokeStyle='#7c3aed';ctx.lineWidth=2.5;ctx.stroke();
      // Fill
      ctx.lineTo(pad.l+cw,pad.t+ch);ctx.lineTo(pad.l,pad.t+ch);ctx.closePath();
      ctx.fillStyle='rgba(124,58,237,0.15)';ctx.fill();
      // Dots & labels
      labels.forEach((l,i)=>{
        const x=pad.l+(i/(labels.length-1||1))*cw;
        const y=pad.t+ch-(values[i]/max)*ch;
        ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fillStyle='#7c3aed';ctx.fill();
        ctx.fillStyle='#e8e8f0';ctx.font='10px Space Mono,monospace';ctx.textAlign='center';ctx.fillText(values[i],x,y-8);
        ctx.fillStyle='#9999bb';ctx.fillText(l.substring(0,8),x,H-pad.b+15);
      });
    }
    ctx.strokeStyle='#2a2a3d';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,pad.t);ctx.lineTo(pad.l,pad.t+ch);ctx.lineTo(pad.l+cw,pad.t+ch);ctx.stroke();
  }
}
function cgDownload(){
  const c=document.getElementById('cg-canvas');
  const a=document.createElement('a');a.download='chart.png';a.href=c.toDataURL();a.click();
}

// ===== CIPHER =====
let currentCipher='caesar';
function setCipher(c){
  currentCipher=c;
  ['caesar','rot13','vigenere','atbash','morse2'].forEach(id=>{ const el=document.getElementById('ci-'+id); if(el) el.className='btn btn-secondary'; });
  const active=document.getElementById('ci-'+c);if(active) active.className='btn btn-primary';
  document.getElementById('ci-caesar-opts').style.display=c==='caesar'?'block':'none';
  document.getElementById('ci-vigenere-opts').style.display=c==='vigenere'?'block':'none';
  doCipher();
}
function caesarShift(text,n){ return text.replace(/[a-zA-Z]/g,c=>{ const base=c<='Z'?65:97; return String.fromCharCode((c.charCodeAt(0)-base+n+26)%26+base); }); }
function vigenereEncrypt(text,key,decrypt=false){
  key=key.toUpperCase().replace(/[^A-Z]/g,'');if(!key) return text;
  let ki=0;
  return text.replace(/[a-zA-Z]/g,c=>{ const base=c<='Z'?65:97; const kc=key.charCodeAt(ki%key.length)-65; ki++; const shift=decrypt?(26-kc):kc; return String.fromCharCode((c.charCodeAt(0)-base+shift)%26+base); });
}
function atbash(text){ return text.replace(/[a-zA-Z]/g,c=>{ const base=c<='Z'?65:97; return String.fromCharCode(25-(c.charCodeAt(0)-base)+base); }); }
function toBinary(text){ return text.split('').map(c=>c.charCodeAt(0).toString(2).padStart(8,'0')).join(' '); }
function fromBinary(text){ return text.split(' ').map(b=>String.fromCharCode(parseInt(b,2))).join(''); }
function doCipher(decrypt=false){
  const input=document.getElementById('ci-input').value;
  const shift=parseInt(document.getElementById('ci-shift').value)||3;
  const key=document.getElementById('ci-key').value||'KEY';
  let out='',info='';
  if(currentCipher==='caesar'){ out=caesarShift(input,decrypt?-shift:shift); info=`Geser: ${shift} posisi | ${decrypt?'Dekripsi':'Enkripsi'}`; }
  else if(currentCipher==='rot13'){ out=caesarShift(input,13); info='ROT13 (self-inverse)'; }
  else if(currentCipher==='vigenere'){ out=vigenereEncrypt(input,key,decrypt); info=`Kunci: ${key.toUpperCase()} | ${decrypt?'Dekripsi':'Enkripsi'}`; }
  else if(currentCipher==='atbash'){ out=atbash(input); info='Atbash: Aâ†”Z, Bâ†”Y, dll'; }
  else if(currentCipher==='binary'){ out=decrypt?fromBinary(input):toBinary(input); info=decrypt?'Binary â†’ Teks':'Teks â†’ Binary'; }
  document.getElementById('ci-output').childNodes[0].textContent=out;
  document.getElementById('ci-info').textContent=info;
}
function doCipherDecrypt(){ doCipher(true); }

// ===== ASCII ART =====
const AA_FONTS={
  'Block':(t)=>aaBlock(t),
  'Shadow':(t)=>aaShadow(t),
  'Double':(t)=>aaDouble(t),
  'Stars':(t)=>t.split('').map(c=>`âœ¦${c}âœ¦`).join(''),
  'Wide':(t)=>t.split('').map(c=>c+' ').join(''),
  'Bubble':(t)=>t.split('').map(c=>{ const bubbles={A:'â’¶',B:'â’·',C:'â’¸',D:'â’¹',E:'â’º',F:'â’»',G:'â’¼',H:'â’½',I:'â’¾',J:'â’¿',K:'â“€',L:'â“',M:'â“‚',N:'â“ƒ',O:'â“„',P:'â“…',Q:'â“†',R:'â“‡',S:'â“ˆ',T:'â“‰',U:'â“Š',V:'â“‹',W:'â“Œ',X:'â“',Y:'â“',Z:'â“',' ':' '}; return bubbles[c.toUpperCase()]||c; }).join(''),
  'Box':(t)=>{ const top='â•”'+'â•'.repeat(t.length+2)+'â•—'; const mid='â•‘ '+t+' â•‘'; const bot='â•š'+'â•'.repeat(t.length+2)+'â•'; return [top,mid,bot].join('\n'); },
  'Arrow':(t)=>t.split('').map(c=>`â†’${c}â†`).join(''),
  'Fire':(t)=>{ const flames=['ğŸ”¥','ğŸ’¥','âš¡']; return flames[0]+' '+t.split('').join('Â·')+' '+flames[0]; },
  'Matrix':(t)=>{ const lines=[]; const chars='01'; lines.push(Array(t.length*2+2).fill(0).map(()=>chars[Math.floor(Math.random()*2)]).join('')); lines.push('[ '+t.toUpperCase()+' ]'); lines.push(Array(t.length*2+2).fill(0).map(()=>chars[Math.floor(Math.random()*2)]).join('')); return lines.join('\n'); },
};
function aaBlock(t){
  const letters={A:['  _  ',' / \\ ','/_/_\\'],B:['|---|','|---|','|___]'],C:[' ___','(   ','\\___'],D:['|\\  ','| \\ ','|__\\'],E:['|===','|== ','|___'],F:['|===','|== ','|   '],G:[' ___','( _ ','\\__G'],H:['|  |','|--|','|  |'],I:['===','|  ','==='],J:['  |','  |','__/'],K:['|\\ ','|/ ','|\\ '],L:['|  ','|  ','|__'],M:['|\\/|','|  |','|  |'],N:['|\\ |','| \\|','|  |'],O:[' _ ','( )','(_)'],P:['|--\\','|__/','|   '],Q:[' _ ','(_)','/_\\'],R:['|--\\','|_/ ','|  \\'],S:[' ___','(___','____)'],T:['===','| ','| '],U:['|  |','|  |','\\__/'],V:['\\  /','\\  /','\\/ '],W:['\\    /','\\  / ','\\\/  '],X:['\\/ ','/ \\','\\  '],Y:['\\/ ',' |  ',' |  '],Z:['=== ','/ /','=== '],' ':['  ','  ','  ']};
  const rows=[[],[],[]];
  t.toUpperCase().split('').forEach(c=>{ const l=letters[c]||['?','?','?']; rows[0].push(l[0]);rows[1].push(l[1]);rows[2].push(l[2]); });
  return rows.map(r=>r.join(' ')).join('\n');
}
function aaShadow(t){
  return t.toUpperCase().split('').map(c=>`${c}\nâ–‘`).join('');
}
function aaDouble(t){
  const map={A:'ğ”¸',B:'ğ”¹',C:'â„‚',D:'ğ”»',E:'ğ”¼',F:'ğ”½',G:'ğ”¾',H:'â„',I:'ğ•€',J:'ğ•',K:'ğ•‚',L:'ğ•ƒ',M:'ğ•„',N:'â„•',O:'ğ•†',P:'â„™',Q:'â„š',R:'â„',S:'ğ•Š',T:'ğ•‹',U:'ğ•Œ',V:'ğ•',W:'ğ•',X:'ğ•',Y:'ğ•',Z:'â„¤',' ':' '};
  return t.toUpperCase().split('').map(c=>map[c]||c).join('');
}
function populateAaFonts(){
  const sel=document.getElementById('aa-font');
  if(sel) sel.innerHTML=Object.keys(AA_FONTS).map(k=>`<option value="${k}">${k}</option>`).join('');
}
function genAsciiArt(){
  const text=document.getElementById('aa-input').value||'TEXT';
  const font=document.getElementById('aa-font').value;
  if(!AA_FONTS[font]) return;
  const out=AA_FONTS[font](text);
  document.getElementById('aa-output').childNodes[0].textContent=out;
  // All previews
  const prev=document.getElementById('aa-all-preview');
  prev.innerHTML=Object.entries(AA_FONTS).map(([name,fn])=>{
    let result;try{result=fn(text);}catch(e){result='(error)';}
    return `<div style="border:1px solid var(--border);border-radius:8px;padding:12px;cursor:pointer;" onclick="document.getElementById('aa-font').value='${name}';genAsciiArt()">
      <div style="font-size:0.68rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">${name}</div>
      <pre style="font-size:0.72rem;color:var(--accent2);white-space:pre;overflow-x:auto;line-height:1.4;margin:0;">${result}</pre>
    </div>`;
  }).join('');
}
populateAaFonts();
genAsciiArt();

// CSS for fake data check labels
document.head.insertAdjacentHTML('beforeend',`<style>.fd-check{font-size:0.76rem;color:var(--muted);display:flex;align-items:center;gap:4px;cursor:pointer;}.fd-check input{width:13px;height:13px;accent-color:var(--accent);}</style>`);

// Auto-init mindmap example
mmExample();

// ===== POMODORO =====
let pomMode='work', pomRunning=false, pomInterval=null, pomRemain=25*60, pomSessions=0;
const pomDurations={work:()=>parseInt(document.getElementById('pom-work-min').value||25)*60, short:()=>parseInt(document.getElementById('pom-short-min').value||5)*60, long:()=>parseInt(document.getElementById('pom-long-min').value||15)*60};
const pomLabels={work:'Mode: Fokus ğŸ¯',short:'Mode: Istirahat Pendek â˜•',long:'Mode: Istirahat Panjang ğŸ˜´'};
function pomSetMode(m){
  pomMode=m; pomReset();
  document.querySelectorAll('[id^=pom-][id$=-btn]').forEach(b=>b.classList.remove('active-filter'));
  document.getElementById('pom-'+m+'-btn')?.classList.add('active-filter');
}
function pomToggle(){
  if(pomRunning){clearInterval(pomInterval);pomRunning=false;document.getElementById('pom-btn').textContent='â–¶ Lanjut';}
  else{pomRunning=true;document.getElementById('pom-btn').textContent='â¸ Pause';pomInterval=setInterval(pomTick,1000);}
}
function pomTick(){
  pomRemain--;
  pomUpdateDisplay();
  if(pomRemain<=0){
    clearInterval(pomInterval);pomRunning=false;
    document.getElementById('pom-btn').textContent='â–¶ Mulai';
    if(pomMode==='work'){pomSessions++;pomUpdateDots();}
    try{new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAA").play();}catch(e){}
    alert(pomMode==='work'?`âœ… Sesi fokus selesai! Istirahat dulu.`:`âœ… Istirahat selesai! Waktunya fokus lagi.`);
    pomMode=pomSessions%4===0&&pomSessions>0?'long':pomMode==='work'?'short':'work';
    pomReset();
  }
}
function pomReset(){
  clearInterval(pomInterval);pomRunning=false;
  pomRemain=pomDurations[pomMode]();
  pomUpdateDisplay();
  document.getElementById('pom-btn').textContent='â–¶ Mulai';
  document.getElementById('pom-mode-label').textContent=pomLabels[pomMode];
}
function pomSkip(){clearInterval(pomInterval);pomRunning=false;pomRemain=0;pomTick();}
function pomUpdateDisplay(){
  const m=Math.floor(pomRemain/60),s=pomRemain%60;
  document.getElementById('pom-display').textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  document.title=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} â€” Pomodoro`;
}
function pomUpdateDots(){
  const d=document.getElementById('pom-dots');
  d.innerHTML=Array(4).fill(0).map((_,i)=>`<div style="width:20px;height:20px;border-radius:50%;background:${i<pomSessions%4||pomSessions%4===0&&pomSessions>0&&i<4?'var(--accent)':'var(--border)'};transition:all 0.3s;"></div>`).join('');
  document.getElementById('pom-count').textContent=`${pomSessions} / 4 sesi`;
}
pomReset();pomUpdateDots();

// ===== TEXT TO SPEECH =====
let ttsUtter=null;
function ttsLoadVoices(){
  const voices=speechSynthesis.getVoices();
  const sel=document.getElementById('tts-voice');
  if(!sel)return;
  sel.innerHTML=voices.map((v,i)=>`<option value="${i}">${v.name} (${v.lang})</option>`).join('');
  // Prefer Indonesian
  const idIdx=voices.findIndex(v=>v.lang.startsWith('id'));
  if(idIdx>=0) sel.value=idIdx;
}
if('speechSynthesis' in window){speechSynthesis.onvoiceschanged=ttsLoadVoices;ttsLoadVoices();}
function ttsSpeak(){
  if(!window.speechSynthesis){document.getElementById('tts-status').textContent='âš  Browser tidak mendukung TTS';return;}
  speechSynthesis.cancel();
  const text=document.getElementById('tts-text').value;
  if(!text.trim())return;
  ttsUtter=new SpeechSynthesisUtterance(text);
  const voices=speechSynthesis.getVoices();
  const idx=parseInt(document.getElementById('tts-voice').value)||0;
  if(voices[idx]) ttsUtter.voice=voices[idx];
  ttsUtter.rate=parseFloat(document.getElementById('tts-rate').value)||1;
  ttsUtter.pitch=parseFloat(document.getElementById('tts-pitch').value)||1;
  ttsUtter.onstart=()=>document.getElementById('tts-status').textContent='ğŸ”Š Sedang membaca...';
  ttsUtter.onend=()=>document.getElementById('tts-status').textContent='âœ… Selesai';
  ttsUtter.onerror=e=>document.getElementById('tts-status').textContent='âš  Error: '+e.error;
  speechSynthesis.speak(ttsUtter);
}
function ttsPause(){if(speechSynthesis.paused){speechSynthesis.resume();document.getElementById('tts-pause').textContent='â¸ Pause';}else{speechSynthesis.pause();document.getElementById('tts-pause').textContent='â–¶ Lanjut';}}
function ttsStop(){speechSynthesis.cancel();document.getElementById('tts-status').textContent='â¹ Dihentikan';document.getElementById('tts-pause').textContent='â¸ Pause';}
function ttsQuick(t){document.getElementById('tts-text').value=t;ttsSpeak();}

// ===== OCR =====
let ocrImgData=null;
function ocrDrop(e){e.preventDefault();document.getElementById('ocr-drop').style.borderColor='var(--border)';const f=e.dataTransfer.files[0];if(f&&f.type.startsWith('image/'))ocrLoadFile(f);}
function ocrProcess(inp){if(inp.files[0])ocrLoadFile(inp.files[0]);}
function ocrLoadFile(file){
  const reader=new FileReader();
  reader.onload=e=>{
    ocrImgData=e.target.result;
    document.getElementById('ocr-img').src=ocrImgData;
    document.getElementById('ocr-drop').style.display='none';
    document.getElementById('ocr-preview-wrap').style.display='block';
  };
  reader.readAsDataURL(file);
}
async function runOCR(){
  if(!ocrImgData)return;
  const lang=document.getElementById('ocr-lang').value;
  const btn=document.getElementById('ocr-run-btn');
  const prog=document.getElementById('ocr-progress');
  const bar=document.getElementById('ocr-bar');
  const progText=document.getElementById('ocr-prog-text');
  const out=document.getElementById('ocr-output');
  btn.disabled=true;prog.style.display='block';
  out.childNodes[0].textContent='Memproses...';
  try{
    const result=await Tesseract.recognize(ocrImgData,lang,{
      logger:m=>{
        if(m.status==='recognizing text'){
          const pct=Math.round(m.progress*100);
          bar.style.width=pct+'%';
          progText.textContent=`Mengenali teks... ${pct}%`;
        }
      }
    });
    out.childNodes[0].textContent=result.data.text||'Tidak ada teks terdeteksi';
    progText.textContent='âœ… Selesai!';
  }catch(e){
    out.childNodes[0].textContent='âš  Error: '+e.message+'\n\nPastikan koneksi internet aktif (butuh download model OCR pertama kali).';
  }finally{btn.disabled=false;}
}
function ocrReset(){ocrImgData=null;document.getElementById('ocr-drop').style.display='block';document.getElementById('ocr-preview-wrap').style.display='none';document.getElementById('ocr-file').value='';}

// ===== AGE CALCULATOR =====
function calcAge(){
  const dob=document.getElementById('age-dob').value;
  const to=document.getElementById('age-to').value;
  if(!dob||!to)return;
  const d1=new Date(dob),d2=new Date(to);
  if(d2<d1){document.getElementById('age-result').innerHTML='<div style="color:var(--danger);font-size:0.82rem;padding:20px;text-align:center;">âš  Tanggal "sampai" harus lebih dari tanggal lahir</div>';return;}
  let yy=d2.getFullYear()-d1.getFullYear(),mm=d2.getMonth()-d1.getMonth(),dd=d2.getDate()-d1.getDate();
  if(dd<0){mm--;dd+=new Date(d2.getFullYear(),d2.getMonth(),0).getDate();}
  if(mm<0){yy--;mm+=12;}
  const totalDays=Math.floor((d2-d1)/86400000);
  const totalWeeks=Math.floor(totalDays/7);
  const totalMonths=yy*12+mm;
  const totalHours=totalDays*24;
  document.getElementById('age-result').innerHTML=`
    <div style="text-align:center;margin-bottom:14px;">
      <div style="font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;color:var(--accent2);line-height:1;">${yy}</div>
      <div style="font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Tahun</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center;">
      <div><div style="font-weight:700;color:var(--accent3);">${mm}</div><div style="font-size:0.68rem;color:var(--muted);">Bulan</div></div>
      <div><div style="font-weight:700;color:var(--success);">${dd}</div><div style="font-size:0.68rem;color:var(--muted);">Hari</div></div>
      <div><div style="font-weight:700;color:var(--accent);">${totalDays.toLocaleString('id-ID')}</div><div style="font-size:0.68rem;color:var(--muted);">Total Hari</div></div>
    </div>
    <div style="margin-top:10px;font-size:0.72rem;color:var(--muted);text-align:center;line-height:1.8;">
      ${totalWeeks.toLocaleString('id-ID')} minggu Â· ${totalMonths} bulan Â· ${totalHours.toLocaleString('id-ID')} jam
    </div>`;
  // Milestones
  const milestones=[1,5,10,13,17,18,20,21,25,30,40,50,60,70,80,100];
  const upcoming=milestones.filter(a=>a>yy).slice(0,8);
  const passed=milestones.filter(a=>a<=yy).slice(-4);
  document.getElementById('age-milestones').style.display='block';
  document.getElementById('age-milestone-list').innerHTML=[...passed,...upcoming].map(a=>{
    const mDate=new Date(d1.getFullYear()+a,d1.getMonth(),d1.getDate());
    const daysLeft=Math.ceil((mDate-d2)/86400000);
    const isPast=a<=yy;
    return `<div style="background:var(--bg);border:1px solid ${isPast?'var(--border)':'var(--accent)'};border-radius:8px;padding:10px;text-align:center;">
      <div style="font-family:'Syne',sans-serif;font-weight:700;color:${isPast?'var(--muted)':'var(--accent2)'};">${a} th</div>
      <div style="font-size:0.68rem;color:var(--muted);">${isPast?'âœ“ Sudah lewat':daysLeft+' hari lagi'}</div>
    </div>`;
  }).join('');
  // Birthday check
  const nextBday=new Date(d2.getFullYear(),d1.getMonth(),d1.getDate());
  if(nextBday<d2) nextBday.setFullYear(nextBday.getFullYear()+1);
  const daysUntil=Math.ceil((nextBday-d2)/86400000);
  const bdayEl=document.getElementById('age-bday');
  bdayEl.style.display='block';
  if(daysUntil===0) bdayEl.innerHTML='ğŸ‚ <strong>Selamat Ulang Tahun!</strong> Hari ini adalah hari spesialmu! ğŸ‰';
  else bdayEl.innerHTML=`ğŸ‚ Ulang tahun berikutnya: <strong>${nextBday.toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}</strong> â€” ${daysUntil} hari lagi`;
}
document.addEventListener('DOMContentLoaded',()=>{
  const today=new Date().toISOString().slice(0,10);
  document.getElementById('age-to').value=today;
});

// ===== NOISE GENERATOR =====
let noiseCtx=null, noiseNodes={}, noiseTimerInterval=null;
function getNoiseCtx(){if(!noiseCtx)noiseCtx=new(window.AudioContext||window.webkitAudioContext)();return noiseCtx;}
function makeWhiteNoise(ctx){
  const buf=ctx.createBuffer(1,ctx.sampleRate*2,ctx.sampleRate);
  const d=buf.getChannelData(0);for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
  const s=ctx.createBufferSource();s.buffer=buf;s.loop=true;return s;
}
function makePinkNoise(ctx){
  const buf=ctx.createBuffer(1,ctx.sampleRate*2,ctx.sampleRate);
  const d=buf.getChannelData(0);let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0;
  for(let i=0;i<d.length;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555179;b1=0.99332*b1+w*0.0750759;b2=0.96900*b2+w*0.1538520;b3=0.86650*b3+w*0.3104856;b4=0.55000*b4+w*0.5329522;b5=-0.7616*b5-w*0.0168980;d[i]=(b0+b1+b2+b3+b4+b5+w*0.5362)*0.11;}
  const s=ctx.createBufferSource();s.buffer=buf;s.loop=true;return s;
}
function makeBrownNoise(ctx){
  const buf=ctx.createBuffer(1,ctx.sampleRate*2,ctx.sampleRate);
  const d=buf.getChannelData(0);let last=0;
  for(let i=0;i<d.length;i++){const w=Math.random()*2-1;last=(last+0.02*w)/1.02;d[i]=last*3.5;}
  const s=ctx.createBufferSource();s.buffer=buf;s.loop=true;return s;
}
function toggleNoise(type){
  const ctx=getNoiseCtx();
  if(noiseNodes[type]){noiseNodes[type].gain.gain.value=0;setTimeout(()=>{try{noiseNodes[type].src.stop();}catch(e){}delete noiseNodes[type];},300);document.getElementById('noise-'+type+'-card').classList.remove('active');document.getElementById('noise-status').textContent='Noise dihentikan';return;}
  const makers={white:makeWhiteNoise,pink:makePinkNoise,brown:makeBrownNoise};
  const src=makers[type](ctx);
  const gain=ctx.createGain();gain.gain.value=parseFloat(document.getElementById('noise-vol').value)||0.3;
  src.connect(gain);gain.connect(ctx.destination);src.start();
  noiseNodes[type]={src,gain};
  document.getElementById('noise-'+type+'-card').classList.add('active');
  document.getElementById('noise-status').textContent='ğŸ”Š '+{white:'White',pink:'Pink',brown:'Brown'}[type]+' Noise sedang diputar...';
}
function noiseSetVolume(v){document.getElementById('noise-vol-pct').textContent=Math.round(v*100)+'%';Object.values(noiseNodes).forEach(n=>n.gain.gain.value=parseFloat(v));}
function stopAllNoise(){Object.keys(noiseNodes).forEach(t=>{try{noiseNodes[t].src.stop();}catch(e){}document.getElementById('noise-'+t+'-card').classList.remove('active');});noiseNodes={};document.getElementById('noise-status').textContent='â¹ Semua noise dihentikan';clearInterval(noiseTimerInterval);document.getElementById('noise-timer-display').style.display='none';}
function noiseTimer(min){
  clearInterval(noiseTimerInterval);let secs=min*60;
  document.getElementById('noise-timer-display').style.display='block';
  noiseTimerInterval=setInterval(()=>{secs--;const m=Math.floor(secs/60),s=secs%60;document.getElementById('noise-timer-display').textContent=`â± ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;if(secs<=0){stopAllNoise();clearInterval(noiseTimerInterval);}},1000);
}

// ===== GLASSMORPHISM BUILDER =====
const glBgs={gradient1:'linear-gradient(135deg,#7c3aed,#06b6d4)',gradient2:'linear-gradient(135deg,#f97316,#ec4899,#8b5cf6)',gradient3:'linear-gradient(135deg,#4ade80,#0ea5e9,#6366f1)',dots:'radial-gradient(circle,#2a2a4a 1px,transparent 1px) 0 0 / 24px 24px, #0a0a0f'};
function renderGlass(){
  const blur=document.getElementById('gl-blur').value;document.getElementById('gl-blur-v').textContent=blur+'px';
  const alpha=document.getElementById('gl-alpha').value;document.getElementById('gl-alpha-v').textContent=alpha;
  const borderO=document.getElementById('gl-border').value;document.getElementById('gl-border-v').textContent=borderO;
  const radius=document.getElementById('gl-radius').value;document.getElementById('gl-radius-v').textContent=radius+'px';
  const shadow=document.getElementById('gl-shadow').value;document.getElementById('gl-shadow-v').textContent=shadow;
  const color=document.getElementById('gl-color').value;
  const bg=glBgs[document.getElementById('gl-bg').value];
  const r=parseInt(color.slice(1,3),16),g=parseInt(color.slice(3,5),16),b=parseInt(color.slice(5,7),16);
  const css=`backdrop-filter: blur(${blur}px);
-webkit-backdrop-filter: blur(${blur}px);
background: rgba(${r},${g},${b},${alpha});
border: 1px solid rgba(${r},${g},${b},${borderO});
border-radius: ${radius}px;
box-shadow: 0 8px 32px rgba(0,0,0,${shadow});`;
  document.getElementById('gl-scene').style.background=bg;
  const card=document.getElementById('gl-card');
  card.style.cssText=`padding:28px 36px;text-align:center;backdrop-filter:blur(${blur}px);-webkit-backdrop-filter:blur(${blur}px);background:rgba(${r},${g},${b},${alpha});border:1px solid rgba(${r},${g},${b},${borderO});border-radius:${radius}px;box-shadow:0 8px 32px rgba(0,0,0,${shadow});color:white;`;
  document.getElementById('gl-code').childNodes[0].textContent='.glass {\n  '+css.split('\n').join('\n  ')+'\n}';
}
renderGlass();

// ===== DEVICE MOCKUP =====
const mkFrames={
  phone:{w:280,h:520,border:18,notch:true,label:'Smartphone (375Ã—812)'},
  tablet:{w:420,h:560,border:22,notch:false,label:'Tablet (768Ã—1024)'},
  laptop:{w:560,h:360,border:16,notch:false,isLaptop:true,label:'Laptop (1280Ã—800)'},
};
function renderMockup(){
  const device=document.getElementById('mk-device').value;
  const frameColor=document.getElementById('mk-color').value;
  const f=mkFrames[device];
  const wrap=document.getElementById('mk-frame-container');
  const url=document.getElementById('mk-url').value||'https://example.com';
  let html='';
  if(f.isLaptop){
    html=`<div style="position:relative;display:inline-block;">
      <div style="background:${frameColor};border-radius:12px 12px 0 0;padding:${f.border}px ${f.border}px 0;box-shadow:0 0 0 2px #333;display:inline-block;">
        <div style="background:#111;width:8px;height:8px;border-radius:50%;margin:0 auto 8px;"></div>
        <iframe src="${url}" style="width:${f.w}px;height:${f.h}px;border:none;border-radius:4px;display:block;" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
      </div>
      <div style="background:${frameColor};height:14px;width:${f.w+f.border*2+40}px;border-radius:0 0 8px 8px;margin:0 auto;box-shadow:0 4px 16px rgba(0,0,0,0.4);"></div>
      <div style="background:#444;height:4px;width:${f.w+f.border*2+80}px;border-radius:0 0 4px 4px;margin:0 auto;"></div>
    </div>`;
  } else {
    html=`<div style="background:${frameColor};border-radius:${f.border*2}px;padding:${f.border}px;box-shadow:0 0 0 2px #222, 0 24px 48px rgba(0,0,0,0.5);display:inline-block;position:relative;">
      ${f.notch?`<div style="background:${frameColor};width:100px;height:24px;border-radius:0 0 16px 16px;position:absolute;top:${f.border}px;left:50%;transform:translateX(-50%);z-index:2;display:flex;align-items:center;justify-content:center;gap:6px;"><div style="width:10px;height:10px;border-radius:50%;background:#111;"></div><div style="width:40px;height:6px;border-radius:3px;background:#111;"></div></div>`:''}
      <iframe src="${url}" style="width:${f.w}px;height:${f.h}px;border:none;border-radius:${f.border}px;display:block;" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
      <div style="width:50px;height:5px;background:#333;border-radius:3px;margin:8px auto 0;"></div>
    </div>`;
  }
  wrap.innerHTML=html;
}
function mkQuick(url){document.getElementById('mk-url').value=url;renderMockup();}
renderMockup();

// ===== NUMBER SYSTEM =====
function nsConvert(from){
  const inputs={dec:document.getElementById('ns-dec'),bin:document.getElementById('ns-bin'),oct:document.getElementById('ns-oct'),hex:document.getElementById('ns-hex')};
  const val=inputs[from].value.trim();
  if(!val){['dec','bin','oct','hex'].filter(k=>k!==from).forEach(k=>inputs[k].value='');document.getElementById('ns-info').innerHTML='';return;}
  let decimal;
  try{
    if(from==='dec') decimal=parseInt(val,10);
    else if(from==='bin') decimal=parseInt(val,2);
    else if(from==='oct') decimal=parseInt(val,8);
    else decimal=parseInt(val,16);
    if(isNaN(decimal)) throw new Error('Input tidak valid');
    if(from!=='dec') inputs.dec.value=decimal;
    if(from!=='bin') inputs.bin.value=decimal.toString(2);
    if(from!=='oct') inputs.oct.value=decimal.toString(8);
    if(from!=='hex') inputs.hex.value=decimal.toString(16).toUpperCase();
    const bits=decimal.toString(2);
    document.getElementById('ns-info').innerHTML=`
      <span style="color:var(--accent2);">Nilai: ${decimal}</span> &nbsp;|&nbsp;
      <span style="color:var(--muted);">Bit: ${bits.length}</span> &nbsp;|&nbsp;
      <span style="color:var(--muted);">Byte: ${Math.ceil(bits.length/8)}</span> &nbsp;|&nbsp;
      <span style="color:var(--success);">ASCII: ${decimal>=32&&decimal<=126?String.fromCharCode(decimal):'â€”'}</span> &nbsp;|&nbsp;
      <span style="color:var(--accent3);">Signed: ${decimal>2147483647?decimal-4294967296:decimal}</span>`;
  }catch(e){document.getElementById('ns-info').innerHTML=`<span style="color:var(--danger)">âš  ${e.message}</span>`;}
}
function calcBitwise(){
  const a=parseInt(document.getElementById('bw-a').value)||0;
  const b=parseInt(document.getElementById('bw-b').value)||0;
  const ops=[['AND','&',a&b],['OR','|',a|b],['XOR','^',a^b],['NOT A','~',~a],['Lshift <<','<<',a<<1],['Rshift >>','>>',a>>1]];
  document.getElementById('bw-result').innerHTML=`<div style="display:flex;flex-wrap:wrap;gap:8px;">
    ${ops.map(([name,op,res])=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:8px 12px;font-size:0.8rem;">
      <span style="color:var(--muted);">${name}: </span><span style="color:var(--accent2);font-weight:700;">${res}</span>
      <div style="font-size:0.68rem;color:var(--muted);">${res.toString(2)}</div>
    </div>`).join('')}
  </div>`;
}

// ===== MINI GAMES =====
let gameLoop=null, gameState=null, currentGame='snake';
const GC=document.getElementById('game-canvas');
const GX=GC.getContext('2d');
const GW=GC.width, GH=GC.height;

function selectGame(g){
  currentGame=g;
  ['snake','flappy','2048','breakout'].forEach(id=>{
    const b=document.getElementById('game-'+id+'-btn');
    if(b) b.className=id===g?'btn btn-primary':'btn btn-secondary';
  });
  cancelAnimationFrame(gameLoop);clearInterval(gameLoop);gameState=null;
  const info={
    snake:'ğŸ Snake\n\nMakan makanan untuk tumbuh!\nHindari dinding & ekor sendiri.\n\nKontrol: â† â†’ â†‘ â†“\natau WASD',
    flappy:'ğŸ¦ Flappy Bird\n\nKlik / Tekan Space untuk terbang!\nHindari pipa-pipa.\n\nKontrol: Klik / Space',
    '2048':'ğŸ”¢ 2048\n\nGeser tile untuk menggabungkan!\nCapai angka 2048.\n\nKontrol: â† â†’ â†‘ â†“',
    breakout:'ğŸ§± Breakout\n\nPecahkan semua bata!\nJangan sampai bola jatuh.\n\nKontrol: â† â†’ atau mouse',
  };
  document.getElementById('game-info').style.whiteSpace='pre-line';
  document.getElementById('game-info').textContent=info[g]||'';
  document.getElementById('game-controls-hint').textContent={snake:'Arrow / WASD',flappy:'Space / Click',2048:'Arrow Keys',breakout:'â† â†’ / Mouse'}[g]||'';
  const hs=JSON.parse(localStorage.getItem('tb-hs')||'{}');
  document.getElementById('game-highscore').textContent=hs[g]?`ğŸ† High Score: ${hs[g]}`:'';
  drawGameIdle(g);
}
function drawGameIdle(g){
  GX.clearRect(0,0,GW,GH);
  GX.fillStyle='#0a0a0f';GX.fillRect(0,0,GW,GH);
  GX.fillStyle='#7c3aed';GX.font='bold 20px Syne,sans-serif';GX.textAlign='center';
  GX.fillText({snake:'ğŸ SNAKE',flappy:'ğŸ¦ FLAPPY BIRD','2048':'ğŸ”¢ 2048',breakout:'ğŸ§± BREAKOUT'}[g]||g,GW/2,GH/2-20);
  GX.fillStyle='#6b6b8a';GX.font='14px Space Mono,monospace';
  GX.fillText('Tekan â–¶ Mulai',GW/2,GH/2+20);
}
function startGame(){
  cancelAnimationFrame(gameLoop);clearInterval(gameLoop);
  if(currentGame==='snake') startSnake();
  else if(currentGame==='flappy') startFlappy();
  else if(currentGame==='2048') start2048();
  else if(currentGame==='breakout') startBreakout();
}
function pauseGame(){
  if(!gameState) return;
  gameState.paused=!gameState.paused;
  document.getElementById('game-pause-btn').textContent=gameState.paused?'â–¶ Lanjut':'â¸ Pause';
}
function updateScore(s){
  document.getElementById('game-score').textContent='Skor: '+s;
  const hs=JSON.parse(localStorage.getItem('tb-hs')||'{}');
  if(!hs[currentGame]||s>hs[currentGame]){hs[currentGame]=s;localStorage.setItem('tb-hs',JSON.stringify(hs));document.getElementById('game-highscore').textContent='ğŸ† High Score: '+s;}
}
function gameOver(score){
  cancelAnimationFrame(gameLoop);clearInterval(gameLoop);
  GX.fillStyle='rgba(0,0,0,0.7)';GX.fillRect(0,0,GW,GH);
  GX.fillStyle='#ef4444';GX.font='bold 28px Syne,sans-serif';GX.textAlign='center';GX.fillText('GAME OVER',GW/2,GH/2-20);
  GX.fillStyle='#e8e8f0';GX.font='18px Space Mono,monospace';GX.fillText('Skor: '+score,GW/2,GH/2+20);
  GX.fillStyle='#7c3aed';GX.font='14px Space Mono,monospace';GX.fillText('Tekan â–¶ Mulai lagi',GW/2,GH/2+50);
  updateScore(score);
  gameState=null;
}

/* SNAKE */
function startSnake(){
  const SZ=20,COLS=Math.floor(GW/SZ),ROWS=Math.floor(GH/SZ);
  gameState={snake:[{x:10,y:10}],dir:{x:1,y:0},nextDir:{x:1,y:0},food:null,score:0,paused:false};
  function placeFood(){
    let fx,fy,tries=0;
    do{fx=Math.floor(Math.random()*COLS);fy=Math.floor(Math.random()*ROWS);tries++;}
    while(gameState.snake.some(s=>s.x===fx&&s.y===fy)&&tries<200);
    gameState.food={x:fx,y:fy};
  }
  placeFood();updateScore(0);

  // âœ… KEYBOARD HANDLER â€” dipasang ke document, bukan canvas
  const snakeKeyHandler=e=>{
    if(!gameState||currentGame!=='snake') return;
    const key=e.key;
    // Cegah scroll halaman saat main
    if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(key)) e.preventDefault();
    const d=gameState.nextDir;
    if((key==='ArrowUp'   ||key==='w'||key==='W') && d.y===0) gameState.nextDir={x:0,y:-1};
    if((key==='ArrowDown' ||key==='s'||key==='S') && d.y===0) gameState.nextDir={x:0,y:1};
    if((key==='ArrowLeft' ||key==='a'||key==='A') && d.x===0) gameState.nextDir={x:-1,y:0};
    if((key==='ArrowRight'||key==='d'||key==='D') && d.x===0) gameState.nextDir={x:1,y:0};
    if(key===' '||key==='p'||key==='P') pauseGame();
  };
  document.addEventListener('keydown', snakeKeyHandler);

  // Touch controls untuk mobile
  let touchStartX=0,touchStartY=0;
  GC.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY;e.preventDefault();},{passive:false});
  GC.addEventListener('touchend',e=>{
    if(!gameState) return;
    const dx=e.changedTouches[0].clientX-touchStartX;
    const dy=e.changedTouches[0].clientY-touchStartY;
    const d=gameState.nextDir;
    if(Math.abs(dx)>Math.abs(dy)){
      if(dx>20&&d.x===0) gameState.nextDir={x:1,y:0};
      if(dx<-20&&d.x===0) gameState.nextDir={x:-1,y:0};
    } else {
      if(dy>20&&d.y===0) gameState.nextDir={x:0,y:1};
      if(dy<-20&&d.y===0) gameState.nextDir={x:0,y:-1};
    }
    e.preventDefault();
  },{passive:false});

  gameState._cleanup=()=>{ document.removeEventListener('keydown',snakeKeyHandler); };

  gameLoop=setInterval(()=>{
    if(!gameState||gameState.paused) return;
    // Apply direction
    gameState.dir={...gameState.nextDir};
    const head={x:gameState.snake[0].x+gameState.dir.x, y:gameState.snake[0].y+gameState.dir.y};
    // Wall & self collision
    if(head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS||gameState.snake.some(s=>s.x===head.x&&s.y===head.y)){
      gameOver(gameState.score); return;
    }
    gameState.snake.unshift(head);
    if(gameState.food && head.x===gameState.food.x&&head.y===gameState.food.y){
      gameState.score+=10; updateScore(gameState.score); placeFood();
    } else { gameState.snake.pop(); }

    // Draw
    GX.fillStyle='#0a0a0f'; GX.fillRect(0,0,GW,GH);
    // Grid dots
    GX.fillStyle='#1a1a2e';
    for(let x=0;x<COLS;x++) for(let y=0;y<ROWS;y++){GX.beginPath();GX.arc(x*SZ+SZ/2,y*SZ+SZ/2,1,0,Math.PI*2);GX.fill();}
    // Food â€” apel merah berkilap
    if(gameState.food){
      GX.fillStyle='#ef4444';GX.beginPath();GX.arc(gameState.food.x*SZ+SZ/2,gameState.food.y*SZ+SZ/2,SZ/2-2,0,Math.PI*2);GX.fill();
      GX.fillStyle='rgba(255,255,255,0.4)';GX.beginPath();GX.arc(gameState.food.x*SZ+SZ/2-3,gameState.food.y*SZ+SZ/2-3,3,0,Math.PI*2);GX.fill();
    }
    // Snake body
    gameState.snake.forEach((s,i)=>{
      const g2=GX.createLinearGradient(s.x*SZ,s.y*SZ,(s.x+1)*SZ,(s.y+1)*SZ);
      g2.addColorStop(0,i===0?'#06b6d4':'#7c3aed');
      g2.addColorStop(1,i===0?'#0ea5e9':'#5b21b6');
      GX.fillStyle=g2;
      GX.beginPath();
      if(GX.roundRect) GX.roundRect(s.x*SZ+1,s.y*SZ+1,SZ-2,SZ-2,i===0?6:4);
      else GX.rect(s.x*SZ+1,s.y*SZ+1,SZ-2,SZ-2);
      GX.fill();
      // Mata di kepala
      if(i===0){
        GX.fillStyle='white';
        const ex=s.x*SZ+SZ/2+(gameState.dir.x*4), ey=s.y*SZ+SZ/2+(gameState.dir.y*4);
        const px=gameState.dir.y!==0?3:0, py=gameState.dir.x!==0?3:0;
        GX.beginPath();GX.arc(ex-py,ey-px,3,0,Math.PI*2);GX.fill();
        GX.beginPath();GX.arc(ex+py,ey+px,3,0,Math.PI*2);GX.fill();
        GX.fillStyle='#0a0a0f';
        GX.beginPath();GX.arc(ex-py,ey-px,1.5,0,Math.PI*2);GX.fill();
        GX.beginPath();GX.arc(ex+py,ey+px,1.5,0,Math.PI*2);GX.fill();
      }
    });
    // Score overlay
    GX.fillStyle='rgba(124,58,237,0.8)';GX.font='bold 13px Space Mono,monospace';GX.textAlign='left';
    GX.fillText('SKOR: '+gameState.score,8,18);
  },140);

  // Tampilkan hint kontrol
  document.getElementById('game-controls-hint').textContent='â† â†’ â†‘ â†“ atau WASD | P = Pause | Swipe untuk mobile';
}

/* FLAPPY BIRD */
function startFlappy(){
  const BIRD_X=80,GRAVITY=0.35,JUMP=-7,PIPE_W=52,GAP=130,PIPE_SPEED=2.5;
  gameState={bird:{y:GH/2,vy:0},pipes:[],score:0,frame:0,paused:false,started:false};
  function addPipe(){const ty=50+Math.random()*(GH-GAP-100);gameState.pipes.push({x:GW,ty,by:ty+GAP});}
  addPipe();
  function flap(){if(gameState)gameState.bird.vy=JUMP;gameState.started=true;}
  GC.onclick=flap;
  const handler=e=>{if(e.code==='Space'){e.preventDefault();flap();}};
  document.addEventListener('keydown',handler);
  gameState._cleanup=()=>{GC.onclick=null;document.removeEventListener('keydown',handler);};
  updateScore(0);
  function frame(){
    if(!gameState){return;}
    gameLoop=requestAnimationFrame(frame);
    if(gameState.paused)return;
    if(gameState.started) gameState.bird.vy+=GRAVITY;
    gameState.bird.y+=gameState.bird.vy;
    gameState.frame++;
    if(gameState.frame%90===0) addPipe();
    gameState.pipes.forEach(p=>p.x-=PIPE_SPEED);
    gameState.pipes=gameState.pipes.filter(p=>p.x>-PIPE_W);
    // Score
    gameState.pipes.forEach(p=>{if(Math.abs(p.x+PIPE_W/2-BIRD_X)<PIPE_SPEED+1&&!p.scored){p.scored=true;gameState.score++;updateScore(gameState.score);}});
    // Collision
    const bx=BIRD_X-14,by=gameState.bird.y-14;
    if(gameState.bird.y>GH-20||gameState.bird.y<0){if(gameState.started){if(gameState._cleanup)gameState._cleanup();gameOver(gameState.score);return;}}
    for(const p of gameState.pipes){if(bx+28>p.x&&bx<p.x+PIPE_W&&(by<p.ty||by+28>p.by)){if(gameState.started){if(gameState._cleanup)gameState._cleanup();gameOver(gameState.score);return;}}}
    // Draw
    GX.fillStyle='#0a0a2e';GX.fillRect(0,0,GW,GH);
    // Stars bg
    GX.fillStyle='rgba(255,255,255,0.4)';
    for(let i=0;i<30;i++){const sx=(i*73+gameState.frame*0.3)%GW,sy=(i*137)%GH;GX.beginPath();GX.arc(sx,sy,1,0,Math.PI*2);GX.fill();}
    // Pipes
    gameState.pipes.forEach(p=>{
      const g2=GX.createLinearGradient(p.x,0,p.x+PIPE_W,0);g2.addColorStop(0,'#16a34a');g2.addColorStop(1,'#4ade80');GX.fillStyle=g2;
      GX.fillRect(p.x,0,PIPE_W,p.ty);GX.fillRect(p.x,p.by,PIPE_W,GH-p.by);
      GX.fillStyle='#15803d';GX.fillRect(p.x-4,p.ty-18,PIPE_W+8,18);GX.fillRect(p.x-4,p.by,PIPE_W+8,18);
    });
    // Ground
    GX.fillStyle='#854d0e';GX.fillRect(0,GH-20,GW,20);GX.fillStyle='#a16207';GX.fillRect(0,GH-20,GW,6);
    // Bird
    GX.save();GX.translate(BIRD_X,gameState.bird.y);GX.rotate(Math.min(Math.PI/4,gameState.bird.vy*0.04));
    GX.fillStyle='#fbbf24';GX.beginPath();GX.ellipse(0,0,16,12,0,0,Math.PI*2);GX.fill();
    GX.fillStyle='#f59e0b';GX.beginPath();GX.ellipse(0,0,16,12,0,0,Math.PI);GX.fill();
    GX.fillStyle='white';GX.beginPath();GX.arc(5,-4,5,0,Math.PI*2);GX.fill();
    GX.fillStyle='#1e1b4b';GX.beginPath();GX.arc(7,-4,3,0,Math.PI*2);GX.fill();
    GX.fillStyle='#f97316';GX.beginPath();GX.moveTo(14,0);GX.lineTo(22,-4);GX.lineTo(22,4);GX.fill();
    GX.restore();
    if(!gameState.started){GX.fillStyle='rgba(0,0,0,0.4)';GX.fillRect(0,0,GW,GH);GX.fillStyle='white';GX.font='bold 18px Syne,sans-serif';GX.textAlign='center';GX.fillText('Klik / Space untuk mulai',GW/2,GH/2);}
  }
  gameLoop=requestAnimationFrame(frame);
}

/* 2048 */
function start2048(){
  let grid=Array(4).fill(null).map(()=>Array(4).fill(0));
  let score=0,moved=false;
  function add(){const empty=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!grid[r][c])empty.push([r,c]);if(!empty.length)return;const[r,c]=empty[Math.floor(Math.random()*empty.length)];grid[r][c]=Math.random()<0.9?2:4;}
  add();add();updateScore(0);
  const colors={'2':'#eee4da','4':'#ede0c8','8':'#f2b179','16':'#f59563','32':'#f67c5f','64':'#f65e3b','128':'#edcf72','256':'#edcc61','512':'#edc850','1024':'#edc53f','2048':'#edc22e'};
  function draw(){
    GX.fillStyle='#0a0a0f';GX.fillRect(0,0,GW,GH);
    const SZ=90,PAD=10,OX=(GW-4*(SZ+PAD)+PAD)/2,OY=(GH-4*(SZ+PAD)+PAD)/2;
    GX.fillStyle='#1a1a2e';GX.roundRect?GX.roundRect(OX-PAD,OY-PAD,4*(SZ+PAD)+PAD,4*(SZ+PAD)+PAD,12):GX.fillRect(OX-PAD,OY-PAD,4*(SZ+PAD)+PAD,4*(SZ+PAD)+PAD);GX.fill();
    for(let r=0;r<4;r++)for(let c=0;c<4;c++){
      const v=grid[r][c],x=OX+c*(SZ+PAD),y=OY+r*(SZ+PAD);
      GX.fillStyle=colors[v]||'#7c3aed';GX.beginPath();GX.roundRect?GX.roundRect(x,y,SZ,SZ,8):GX.fillRect(x,y,SZ,SZ);GX.fill();
      if(v){GX.fillStyle=v<=4?'#776e65':'#f9f6f2';GX.font=`bold ${v>99?v>999?22:26:32}px Syne,sans-serif`;GX.textAlign='center';GX.fillText(v,x+SZ/2,y+SZ/2+10);}
    }
  }
  function slide(row){const f=row.filter(v=>v);const merged=[];let skip=false;for(let i=0;i<f.length;i++){if(!skip&&i<f.length-1&&f[i]===f[i+1]){merged.push(f[i]*2);score+=f[i]*2;skip=true;}else if(skip){skip=false;}else merged.push(f[i]);}while(merged.length<4)merged.push(0);const changed=merged.some((v,i)=>v!==row[i]);return{row:merged,changed};}
  gameState={score,grid,paused:false};
  const handler=e=>{
    if(!gameState)return;
    const dirs={ArrowLeft:()=>{let ch=false;grid=grid.map(r=>{const{row,changed}=slide(r);if(changed)ch=true;return row;});return ch;},ArrowRight:()=>{let ch=false;grid=grid.map(r=>{const{row,changed}=slide([...r].reverse());if(changed)ch=true;return row.reverse();});return ch;},ArrowUp:()=>{let ch=false;for(let c=0;c<4;c++){const col=grid.map(r=>r[c]);const{row,changed}=slide(col);if(changed)ch=true;row.forEach((v,r)=>grid[r][c]=v);}return ch;},ArrowDown:()=>{let ch=false;for(let c=0;c<4;c++){const col=grid.map(r=>r[c]).reverse();const{row,changed}=slide(col);if(changed)ch=true;row.reverse().forEach((v,r)=>grid[r][c]=v);}return ch;}};
    const fn=dirs[e.key];if(fn){e.preventDefault();if(fn()){add();updateScore(score);draw();if(grid.flat().includes(2048)){alert('ğŸ‰ Selamat! Kamu mencapai 2048!');}}}}; 
  document.addEventListener('keydown',handler);
  gameState._cleanup=()=>document.removeEventListener('keydown',handler);
  draw();
}

/* BREAKOUT */
function startBreakout(){
  const BR={x:GW/2,y:GH-40,w:80,h:12,speed:6};
  const BALL={x:GW/2,y:GH-60,vx:3,vy:-4,r:8};
  const ROWS=5,COLS=8,BW=42,BH=16,PAD=6,OX=14,OY=50;
  const bricks=[];
  const brickColors=['#ef4444','#f97316','#eab308','#22c55e','#3b82f6'];
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)bricks.push({x:OX+c*(BW+PAD),y:OY+r*(BH+PAD),alive:true,color:brickColors[r]});
  let score=0,mousX=GW/2;
  GC.onmousemove=e=>{const rect=GC.getBoundingClientRect();mousX=e.clientX-rect.left;};
  const kh=e=>{if(e.key==='ArrowLeft')BR.x=Math.max(BR.w/2,BR.x-BR.speed*2);if(e.key==='ArrowRight')BR.x=Math.min(GW-BR.w/2,BR.x+BR.speed*2);};
  document.addEventListener('keydown',kh);
  gameState={br:BR,ball:BALL,bricks,score:0,paused:false,_cleanup:()=>{GC.onmousemove=null;document.removeEventListener('keydown',kh);}};
  updateScore(0);
  function frame(){
    if(!gameState){return;}
    gameLoop=requestAnimationFrame(frame);
    if(gameState.paused)return;
    BR.x=Math.max(BR.w/2,Math.min(GW-BR.w/2,mousX));
    BALL.x+=BALL.vx;BALL.y+=BALL.vy;
    if(BALL.x<BALL.r||BALL.x>GW-BALL.r)BALL.vx*=-1;
    if(BALL.y<BALL.r)BALL.vy*=-1;
    if(BALL.y>GH){if(gameState._cleanup)gameState._cleanup();gameOver(score);return;}
    if(BALL.y+BALL.r>GH-40&&BALL.y<GH-28&&BALL.x>BR.x-BR.w/2&&BALL.x<BR.x+BR.w/2){BALL.vy=-Math.abs(BALL.vy);BALL.vx+=(BALL.x-(BR.x))* 0.05;}
    bricks.forEach(b=>{if(!b.alive)return;if(BALL.x>b.x&&BALL.x<b.x+BW&&BALL.y>b.y&&BALL.y<b.y+BH){b.alive=false;BALL.vy*=-1;score+=10;updateScore(score);}});
    if(bricks.every(b=>!b.alive)){if(gameState._cleanup)gameState._cleanup();GX.fillStyle='rgba(0,0,0,0.7)';GX.fillRect(0,0,GW,GH);GX.fillStyle='#10b981';GX.font='bold 28px Syne,sans-serif';GX.textAlign='center';GX.fillText('ğŸ‰ MENANG!',GW/2,GH/2);updateScore(score);return;}
    // Draw
    GX.fillStyle='#0a0a0f';GX.fillRect(0,0,GW,GH);
    bricks.forEach(b=>{if(!b.alive)return;GX.fillStyle=b.color;GX.beginPath();GX.roundRect?GX.roundRect(b.x,b.y,BW,BH,3):GX.fillRect(b.x,b.y,BW,BH);GX.fill();});
    const pg=GX.createLinearGradient(BR.x-BR.w/2,0,BR.x+BR.w/2,0);pg.addColorStop(0,'#7c3aed');pg.addColorStop(1,'#06b6d4');GX.fillStyle=pg;GX.beginPath();GX.roundRect?GX.roundRect(BR.x-BR.w/2,GH-40,BR.w,BR.h,6):GX.fillRect(BR.x-BR.w/2,GH-40,BR.w,BR.h);GX.fill();
    const bg=GX.createRadialGradient(BALL.x,BALL.y,0,BALL.x,BALL.y,BALL.r);bg.addColorStop(0,'#e8e8f0');bg.addColorStop(1,'#7c3aed');GX.fillStyle=bg;GX.beginPath();GX.arc(BALL.x,BALL.y,BALL.r,0,Math.PI*2);GX.fill();
  }
  gameLoop=requestAnimationFrame(frame);
}
selectGame('snake');

// ===== AI POWERED BY CLAUDE (REAL API) =====
let aiChatHistory = [];

function getToolboxContext() {
  const tabs = document.querySelectorAll('[id^="tab-"]');
  const tabNames = Array.from(tabs).map(t => t.id.replace('tab-', ''));
  const currentTabEl = document.querySelector('.tab-btn.active');
  const currentTab = currentTabEl ? currentTabEl.textContent.trim() : 'unknown';
  return `Kamu adalah AI Assistant pintar yang tertanam di dalam aplikasi web bernama "Toolbox by Adam" â€” sebuah all-in-one toolbox dengan ${tabNames.length} tools lengkap.

TOOLBOX CONTEXT:
- Tab aktif sekarang: ${currentTab}
- Semua tab/tools: ${tabNames.join(', ')}
- Tools tersedia: Text Analyzer, Password Generator, Base64, JSON Formatter, Color Converter, Unit Converter, Hash Generator, Timestamp, Kalkulator (4 mode), Translate (MyMemory), QR Code, Random Generator, Markdown Preview, Regex Tester, Stopwatch & Timer, CSVâ†’Tabel, Gradient Generator, Minifier, To-Do List, Notepad, Kurs Mata Uang, Cuaca, Image Compressor, Font Preview, Snippet Manager, Aspect Ratio, Mindmap, Morse Code (+ audio), World Clock (15+ kota), Fake Data Indonesia, Palette Extractor, Chart Generator, Enkripsi (Caesar/ROT13/Vigenere/Atbash), ASCII Art, Pomodoro Timer, Text to Speech, OCR (Tesseract.js), Kalkulator Umur, Noise Generator (Web Audio), Glassmorphism Builder, Device Mockup, Konversi Bilangan (Bitwise), Mini Games (Snake/Flappy/2048/Breakout), Auto Bug Scanner, Kalender & Event Planner, Budget Tracker, Habit Tracker, Flashcard Quiz Maker, Videoâ†’GIF, Meme Generator, BPM Tap Counter, URL+QR Combo.
- Dibuat oleh: Adam (yang ganteng) ğŸ‘‘

KEMAMPUANMU:
1. Jawab pertanyaan apapun secara cerdas dan natural (bahasa Indonesia/Inggris)
2. Bantu user menggunakan tools yang ada
3. Saat user minta "buka tab X", respond dengan instruksi jelas cara navigasinya
4. Analisis masalah/bug dan beri solusi konkret
5. Bantu dengan coding, penulisan, perhitungan, analisis data, dll
6. Beri saran & rekomendasi yang berguna
7. Jika diminta "scan bug" atau "perbaiki toolbox" â€” jalankan scan dengan calling function

ACTIONS yang bisa kamu trigger (tulis dalam format <ACTION:nama_action>):
- <ACTION:open_tab:nama_tab> â€” buka tab tertentu (contoh: <ACTION:open_tab:translate>)
- <ACTION:run_scan> â€” jalankan bug scanner
- <ACTION:generate_password> â€” generate password random
- <ACTION:clear_todos> â€” bersihkan semua todo
- <ACTION:show_tools_list> â€” tampilkan semua tools

Selalu jawab dengan ramah, natural, dan helpful. Kalau bisa, selalu sertakan ACTION yang relevan.`;
}

async function sendAI() {
  const inp = document.getElementById('ai-input');
  const msg = inp.value.trim();
  if (!msg) return;
  inp.value = '';
  inp.style.height = '44px';

  const container = document.getElementById('ai-messages');
  const sendBtn = document.getElementById('ai-send-btn');

  // User message
  container.insertAdjacentHTML('beforeend', `
    <div class="ai-msg ai-user">
      <div class="ai-avatar">ğŸ‘¤</div>
      <div class="ai-bubble">${msg.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')}</div>
    </div>`);

  // Typing indicator
  container.insertAdjacentHTML('beforeend', `
    <div class="ai-msg ai-bot" id="ai-typing-ind">
      <div class="ai-avatar">ğŸ¤–</div>
      <div class="ai-bubble ai-typing"><span></span><span></span><span></span></div>
    </div>`);
  container.scrollTop = container.scrollHeight;
  if (sendBtn) { sendBtn.disabled = true; sendBtn.textContent = 'â³'; }

  // Add to history
  aiChatHistory.push({ role: 'user', content: msg });
  // Keep history to last 10 messages
  if (aiChatHistory.length > 20) aiChatHistory = aiChatHistory.slice(-20);

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: getToolboxContext(),
        messages: aiChatHistory
      })
    });

    const data = await response.json();
    document.getElementById('ai-typing-ind')?.remove();

    let reply = data.content?.[0]?.text || 'Maaf, tidak ada respons dari AI.';

    // Process ACTIONs in reply
    const actionMatches = [...reply.matchAll(/<ACTION:([^>]+)>/g)];
    actionMatches.forEach(m => {
      const action = m[1];
      reply = reply.replace(m[0], ''); // remove tag from display
      setTimeout(() => executeAiAction(action), 500);
    });

    // Format reply
    const formatted = reply.trim()
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/`([^`]+)`/g, '<code style="background:var(--surface2);padding:1px 5px;border-radius:3px;font-size:0.85em;">$1</code>')
      .replace(/\n/g, '<br>');

    container.insertAdjacentHTML('beforeend', `
      <div class="ai-msg ai-bot">
        <div class="ai-avatar">ğŸ¤–</div>
        <div class="ai-bubble">${formatted}</div>
      </div>`);

    // Add assistant reply to history
    aiChatHistory.push({ role: 'assistant', content: reply.trim() });

  } catch (err) {
    document.getElementById('ai-typing-ind')?.remove();
    // Fallback to local KB
    const fallback = aiLocalFallback(msg);
    container.insertAdjacentHTML('beforeend', `
      <div class="ai-msg ai-bot">
        <div class="ai-avatar">ğŸ¤–</div>
        <div class="ai-bubble" style="border-color:var(--accent3);">
          ${fallback.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')}
          <div style="font-size:0.68rem;color:var(--muted);margin-top:6px;">âš¡ Mode offline (Claude API tidak terjangkau)</div>
        </div>
      </div>`);
  }

  if (sendBtn) { sendBtn.disabled = false; sendBtn.textContent = 'â¤'; }
  container.scrollTop = container.scrollHeight;
}

function executeAiAction(action) {
  const [cmd, ...args] = action.split(':');
  if (cmd === 'open_tab') {
    const tabName = args[0];
    const btn = document.querySelector(`[onclick*="sw('${tabName}'"]`);
    if (btn) { btn.click(); showNotif(`ğŸ“‚ Membuka tab: ${tabName}`); }
  } else if (cmd === 'run_scan') {
    runManualScan();
  } else if (cmd === 'generate_password') {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%';
    const pw = Array(16).fill(0).map(() => chars[Math.floor(Math.random()*chars.length)]).join('');
    const el = document.getElementById('pw-output');
    if (el) { el.childNodes[0].textContent = pw; showNotif('Password dibuat: ' + pw); }
  } else if (cmd === 'show_tools_list') {
    const tabs = document.querySelectorAll('.tab-btn');
    showNotif(`${tabs.length} tools tersedia di toolbar atas!`);
  }
}

function aiLocalFallback(q) {
  const lq = q.toLowerCase();
  if (lq.includes('tools') || lq.includes('fitur') || lq.includes('apa saja')) return 'Toolbox ini punya **53+ tools** lengkap! Scroll tab di atas untuk melihat semua. Mulai dari Text Analyzer, Password Generator, Translator, Games, hingga AI Assistant ini.';
  if (lq.includes('translate') || lq.includes('terjemah')) return 'Klik tab **ğŸŒ Translate** â†’ pilih bahasa asal & tujuan â†’ ketik teks â†’ klik Terjemahkan.';
  if (lq.includes('password')) return 'Klik tab **ğŸ” Password** â†’ atur panjang & karakter â†’ klik Generate â†’ Copy.';
  if (lq.includes('game') || lq.includes('snake')) return 'Klik tab **ğŸ® Games** â†’ pilih Snake/Flappy/2048/Breakout â†’ klik â–¶ Mulai. Snake pakai arrow keys atau WASD.';
  if (lq.includes('bug') || lq.includes('scan') || lq.includes('perbaiki')) { setTimeout(runManualScan, 300); return 'ğŸ” Menjalankan **Auto Bug Scanner**...'; }
  if (lq.includes('halo') || lq.includes('hi') || lq.includes('hello')) return 'Halo! ğŸ‘‹ Saya Claude AI. Maaf koneksi API sedang tidak aktif, tapi saya masih bisa bantu dalam mode offline. Tanya tentang cara pakai tools!';
  return 'Maaf, koneksi ke Claude API tidak aktif saat ini. Coba pertanyaan tentang cara pakai tools yang ada di Toolbox, atau klik **Scan Bug** untuk cek kesehatan toolbox!';
}

function aiQuick(q) {
  const inp = document.getElementById('ai-input');
  if (inp) { inp.value = q; sendAI(); }
}

// Update about badge count
document.querySelectorAll('.panel-title').forEach(()=>{});


// ===== CALENDAR =====
let calYear=new Date().getFullYear(), calMonth=new Date().getMonth();
let calSelectedDate=null;
let calEvents=JSON.parse(localStorage.getItem('tb-cal-events')||'{}');
function calNav(d){calMonth+=d;if(calMonth>11){calMonth=0;calYear++;}if(calMonth<0){calMonth=11;calYear--;}calRender();}
function calRender(){
  const months=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
  document.getElementById('cal-title').textContent=`${months[calMonth]} ${calYear}`;
  const first=new Date(calYear,calMonth,1).getDay();
  const days=new Date(calYear,calMonth+1,0).getDate();
  const today=new Date();
  let html='';
  for(let i=0;i<first;i++) html+=`<div style="padding:6px;"></div>`;
  for(let d=1;d<=days;d++){
    const key=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const evs=calEvents[key]||[];
    const isToday=today.getFullYear()===calYear&&today.getMonth()===calMonth&&today.getDate()===d;
    const isSel=calSelectedDate===key;
    const dots=evs.slice(0,3).map(e=>`<div style="width:5px;height:5px;border-radius:50%;background:${e.color||'var(--accent)'};flex-shrink:0;"></div>`).join('');
    html+=`<div onclick="calSelectDay('${key}')" style="padding:6px 4px;text-align:center;border-radius:8px;cursor:pointer;border:1px solid ${isSel?'var(--accent)':'transparent'};background:${isToday?'rgba(124,58,237,0.2)':isSel?'rgba(124,58,237,0.1)':'transparent'};transition:all 0.15s;" onmouseover="this.style.background='rgba(124,58,237,0.08)'" onmouseout="this.style.background='${isToday?'rgba(124,58,237,0.2)':isSel?'rgba(124,58,237,0.1)':'transparent'}'">
      <div style="font-size:0.82rem;font-weight:${isToday?'800':'400'};color:${isToday?'var(--accent2)':'var(--text)'};">${d}</div>
      <div style="display:flex;justify-content:center;gap:2px;margin-top:2px;min-height:5px;">${dots}</div>
    </div>`;
  }
  document.getElementById('cal-grid').innerHTML=html;
  if(calSelectedDate) calShowDayEvents(calSelectedDate);
}
function calSelectDay(key){
  calSelectedDate=key;
  const [y,m,d]=key.split('-');
  document.getElementById('cal-selected-date').textContent=`${d} ${['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'][parseInt(m)-1]} ${y}`;
  calRender();calShowDayEvents(key);
}
function calShowDayEvents(key){
  const evs=calEvents[key]||[];
  const el=document.getElementById('cal-day-events');
  el.innerHTML=evs.length?evs.map((e,i)=>`<div style="background:var(--bg);border-left:3px solid ${e.color||'var(--accent)'};border-radius:0 6px 6px 0;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;">
    <div><div style="font-size:0.82rem;font-weight:600;">${e.title}</div><div style="font-size:0.68rem;color:var(--muted);">${e.time||''} Â· ${e.cat||''}</div></div>
    <button onclick="calDeleteEvent('${key}',${i})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">âœ•</button>
  </div>`).join(''):'<div style="color:var(--muted);font-size:0.78rem;padding:10px 0;">Tidak ada event hari ini</div>';
}
function calAddEvent(){
  if(!calSelectedDate){showNotif('Pilih tanggal dulu!');return;}
  const title=document.getElementById('cal-event-title').value.trim();
  if(!title){showNotif('Isi judul event!');return;}
  if(!calEvents[calSelectedDate]) calEvents[calSelectedDate]=[];
  calEvents[calSelectedDate].push({title,time:document.getElementById('cal-event-time').value,color:document.getElementById('cal-event-color').value,cat:document.getElementById('cal-event-cat').value});
  localStorage.setItem('tb-cal-events',JSON.stringify(calEvents));
  document.getElementById('cal-event-title').value='';
  calRender();showNotif('Event ditambahkan!');
}
function calDeleteEvent(key,i){calEvents[key].splice(i,1);if(!calEvents[key].length)delete calEvents[key];localStorage.setItem('tb-cal-events',JSON.stringify(calEvents));calRender();}
calRender();

// ===== BUDGET TRACKER =====
let bgtData=JSON.parse(localStorage.getItem('tb-budget')||'[]');
let bgtFilterType='all', bgtCurrentType='income';
function setBgtType(t){
  bgtCurrentType=t;
  document.getElementById('bgt-type-in').style.cssText=t==='income'?'flex:1;background:rgba(16,185,129,0.2);border:1px solid var(--success);color:var(--success);':'flex:1;background:var(--surface2);border:1px solid var(--border);color:var(--muted);';
  document.getElementById('bgt-type-out').style.cssText=t==='expense'?'flex:1;background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger);':'flex:1;background:var(--surface2);border:1px solid var(--border);color:var(--muted);';
}
function bgtAdd(){
  const desc=document.getElementById('bgt-desc').value.trim();
  const amount=parseFloat(document.getElementById('bgt-amount').value);
  if(!desc||!amount||amount<=0){showNotif('Isi keterangan dan jumlah!');return;}
  bgtData.unshift({id:Date.now(),type:bgtCurrentType,desc,amount,cat:document.getElementById('bgt-cat').value,date:document.getElementById('bgt-date').value||new Date().toISOString().slice(0,10)});
  localStorage.setItem('tb-budget',JSON.stringify(bgtData));
  document.getElementById('bgt-desc').value='';document.getElementById('bgt-amount').value='';
  bgtRender();showNotif('Transaksi disimpan!');
}
function bgtRender(){
  const inc=bgtData.filter(d=>d.type==='income').reduce((s,d)=>s+d.amount,0);
  const exp=bgtData.filter(d=>d.type==='expense').reduce((s,d)=>s+d.amount,0);
  const bal=inc-exp;
  const fmt=n=>'Rp '+Math.abs(n).toLocaleString('id-ID');
  document.getElementById('bgt-income').textContent=fmt(inc);
  document.getElementById('bgt-expense').textContent=fmt(exp);
  document.getElementById('bgt-balance').textContent=(bal<0?'-':'')+fmt(bal);
  document.getElementById('bgt-balance').style.color=bal>=0?'var(--success)':'var(--danger)';
  const filtered=bgtFilterType==='all'?bgtData:bgtData.filter(d=>d.type===bgtFilterType);
  const catIcons={gaji:'ğŸ’¼',makanan:'ğŸ”',transport:'ğŸš—',belanja:'ğŸ›ï¸',tagihan:'ğŸ“„',hiburan:'ğŸ®',lainnya:'ğŸ“Œ'};
  document.getElementById('bgt-list').innerHTML=filtered.slice(0,50).map(d=>`<div style="display:flex;align-items:center;gap:10px;background:var(--bg);border:1px solid var(--border);border-left:3px solid ${d.type==='income'?'var(--success)':'var(--danger)'};border-radius:0 8px 8px 0;padding:8px 12px;">
    <div style="font-size:1.2rem;">${catIcons[d.cat]||'ğŸ“Œ'}</div>
    <div style="flex:1;"><div style="font-size:0.82rem;">${d.desc}</div><div style="font-size:0.68rem;color:var(--muted);">${d.date}</div></div>
    <div style="font-weight:700;color:${d.type==='income'?'var(--success)':'var(--danger)'};">${d.type==='income'?'+':'-'}${fmt(d.amount)}</div>
    <button onclick="bgtDelete(${d.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">âœ•</button>
  </div>`).join('')||'<div style="color:var(--muted);text-align:center;padding:20px;font-size:0.82rem;">Belum ada transaksi</div>';
  bgtDrawChart();
}
function bgtDrawChart(){
  const canvas=document.getElementById('bgt-chart');if(!canvas)return;
  const ctx=canvas.getContext('2d');const W=canvas.offsetWidth||500,H=120;canvas.width=W;canvas.height=H;
  ctx.fillStyle='var(--bg)';ctx.fillRect(0,0,W,H);
  const last7=[];const today=new Date();
  for(let i=6;i>=0;i--){const d=new Date(today);d.setDate(d.getDate()-i);last7.push(d.toISOString().slice(0,10));}
  const incDay=last7.map(d=>bgtData.filter(t=>t.date===d&&t.type==='income').reduce((s,t)=>s+t.amount,0));
  const expDay=last7.map(d=>bgtData.filter(t=>t.date===d&&t.type==='expense').reduce((s,t)=>s+t.amount,0));
  const max=Math.max(...incDay,...expDay,1);
  const bw=Math.floor((W-40)/7*0.35),gap=Math.floor((W-40)/7);
  last7.forEach((d,i)=>{
    const x=20+i*gap,yBase=H-25;
    const ih=Math.round((incDay[i]/max)*(H-40));
    const eh=Math.round((expDay[i]/max)*(H-40));
    if(ih>0){ctx.fillStyle='rgba(16,185,129,0.7)';ctx.fillRect(x,yBase-ih,bw,ih);}
    if(eh>0){ctx.fillStyle='rgba(239,68,68,0.7)';ctx.fillRect(x+bw+2,yBase-eh,bw,eh);}
    ctx.fillStyle='#6b6b8a';ctx.font='9px Space Mono,monospace';ctx.textAlign='center';
    ctx.fillText(d.slice(5),x+bw/2,H-8);
  });
}
function bgtFilter(t){bgtFilterType=t;bgtRender();}
function bgtDelete(id){bgtData=bgtData.filter(d=>d.id!==id);localStorage.setItem('tb-budget',JSON.stringify(bgtData));bgtRender();}
function bgtClear(){bgtData=[];localStorage.setItem('tb-budget','[]');bgtRender();}
function bgtExport(){
  const csv=['Tanggal,Tipe,Keterangan,Kategori,Jumlah',...bgtData.map(d=>`${d.date},${d.type},"${d.desc}",${d.cat},${d.amount}`)].join('\n');
  const a=document.createElement('a');a.download='budget.csv';a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.click();
}
setBgtType('income');
document.getElementById('bgt-date').value=new Date().toISOString().slice(0,10);
bgtRender();

// ===== HABIT TRACKER =====
let habits=JSON.parse(localStorage.getItem('tb-habits')||'[]');
function habitAdd(){
  const name=document.getElementById('habit-name').value.trim();
  if(!name){showNotif('Isi nama kebiasaan!');return;}
  habits.push({id:Date.now(),name,color:document.getElementById('habit-color').value,icon:document.getElementById('habit-icon').value,checks:{}});
  localStorage.setItem('tb-habits',JSON.stringify(habits));
  document.getElementById('habit-name').value='';
  habitRender();showNotif('Kebiasaan ditambahkan!');
}
function habitToggle(id,date){
  const h=habits.find(h=>h.id===id);if(!h)return;
  h.checks[date]=!h.checks[date];
  localStorage.setItem('tb-habits',JSON.stringify(habits));habitRender();
}
function habitDelete(id){habits=habits.filter(h=>h.id!==id);localStorage.setItem('tb-habits',JSON.stringify(habits));habitRender();}
function habitRender(){
  const list=document.getElementById('habit-list');
  const empty=document.getElementById('habit-empty');
  if(!habits.length){list.innerHTML='';empty.style.display='block';return;}
  empty.style.display='none';
  const today=new Date();
  const days=[];for(let i=29;i>=0;i--){const d=new Date(today);d.setDate(d.getDate()-i);days.push(d.toISOString().slice(0,10));}
  list.innerHTML=habits.map(h=>{
    const streak=()=>{let s=0,d=new Date(today);while(h.checks[d.toISOString().slice(0,10)]){s++;d.setDate(d.getDate()-1);}return s;};
    const pct=Math.round((days.filter(d=>h.checks[d]).length/30)*100);
    const st=streak();
    const boxes=days.map(d=>{
      const isToday=d===today.toISOString().slice(0,10);
      return `<div onclick="habitToggle(${h.id},'${d}')" title="${d}" style="width:14px;height:14px;border-radius:2px;cursor:pointer;background:${h.checks[d]?h.color:'var(--border)'};border:${isToday?'2px solid var(--accent)':'1px solid transparent'};transition:all 0.15s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'"></div>`;
    }).join('');
    return `<div style="background:var(--bg);border:1px solid var(--border);border-left:3px solid ${h.color};border-radius:0 10px 10px 0;padding:12px 16px;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
        <span style="font-size:1.4rem;">${h.icon}</span>
        <div style="flex:1;"><div style="font-weight:700;font-size:0.9rem;">${h.name}</div>
          <div style="font-size:0.7rem;color:var(--muted);">${pct}% bulan ini Â· ğŸ”¥ ${st} hari streak</div>
        </div>
        <button onclick="habitDelete(${h.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;">ğŸ—‘</button>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:2px;">${boxes}</div>
      <div style="margin-top:8px;background:var(--border);border-radius:3px;height:4px;overflow:hidden;"><div style="height:100%;background:${h.color};width:${pct}%;border-radius:3px;transition:width 0.3s;"></div></div>
    </div>`;
  }).join('');
}
habitRender();

// ===== FLASHCARD =====
let fcCards=JSON.parse(localStorage.getItem('tb-flashcards')||'[]');
let fcStudyCards=[],fcStudyIdx=0,fcStudyFlipped=false;
let fcQuizCards=[],fcQuizIdx=0,fcQuizScore=0,fcQuizTotal=0;
function setFcMode(m){
  ['create','study','quiz'].forEach(id=>{document.getElementById('fc-'+id).style.display='none';document.getElementById('fc-mode-'+id).className='btn btn-secondary';});
  document.getElementById('fc-'+m).style.display='block';document.getElementById('fc-mode-'+m).className='btn btn-primary';
  if(m==='study'||m==='quiz'){fcPopulateDecks();fcStudyInit();}
}
function fcGetDecks(){return [...new Set(fcCards.map(c=>c.deck||'Default'))];}
function fcPopulateDecks(){
  const decks=fcGetDecks();
  ['fc-study-deck','fc-quiz-deck'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=decks.map(d=>`<option>${d}</option>`).join('');});
}
function fcAddCard(){
  const q=document.getElementById('fc-q').value.trim(),a=document.getElementById('fc-a').value.trim(),deck=document.getElementById('fc-deck').value.trim()||'Default';
  if(!q||!a){showNotif('Isi pertanyaan dan jawaban!');return;}
  fcCards.push({id:Date.now(),q,a,deck});localStorage.setItem('tb-flashcards',JSON.stringify(fcCards));
  document.getElementById('fc-q').value='';document.getElementById('fc-a').value='';
  fcRenderCardList();showNotif('Kartu ditambahkan!');
}
function fcRenderCardList(){
  document.getElementById('fc-card-list').innerHTML=fcCards.slice(-10).reverse().map(c=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:10px;">
    <div style="flex:1;"><div style="font-size:0.8rem;font-weight:600;">${c.q.substring(0,60)}</div><div style="font-size:0.7rem;color:var(--muted);">${c.a.substring(0,60)} Â· [${c.deck}]</div></div>
    <button onclick="fcDeleteCard(${c.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;">âœ•</button>
  </div>`).join('')||'<div style="color:var(--muted);font-size:0.78rem;text-align:center;padding:20px;">Belum ada kartu. Tambahkan di atas!</div>';
}
function fcDeleteCard(id){fcCards=fcCards.filter(c=>c.id!==id);localStorage.setItem('tb-flashcards',JSON.stringify(fcCards));fcRenderCardList();}
function fcStudyInit(){
  const deck=document.getElementById('fc-study-deck')?.value;
  let cards=deck?fcCards.filter(c=>c.deck===deck):fcCards;
  fcStudyCards=cards.sort(()=>Math.random()-0.5);fcStudyIdx=0;fcStudyFlipped=false;fcStudyRender();
}
function fcStudyRender(){
  if(!fcStudyCards.length){document.getElementById('fc-flip-content').textContent='Belum ada kartu. Buat dulu di tab "Buat Kartu"!';document.getElementById('fc-study-progress').textContent='';return;}
  const c=fcStudyCards[fcStudyIdx];
  document.getElementById('fc-flip-content').textContent=fcStudyFlipped?c.a:c.q;
  document.getElementById('fc-flip-card').style.background=fcStudyFlipped?'rgba(6,182,212,0.1)':'var(--bg)';
  document.getElementById('fc-flip-card').style.borderColor=fcStudyFlipped?'var(--accent2)':'var(--border)';
  document.getElementById('fc-study-progress').textContent=`${fcStudyIdx+1} / ${fcStudyCards.length}`;
}
function fcFlip(){fcStudyFlipped=!fcStudyFlipped;fcStudyRender();}
function fcStudyNav(d){fcStudyIdx=(fcStudyIdx+d+fcStudyCards.length)%fcStudyCards.length;fcStudyFlipped=false;fcStudyRender();}
function fcQuizStart(){
  const deck=document.getElementById('fc-quiz-deck')?.value;
  let cards=deck?fcCards.filter(c=>c.deck===deck):fcCards;
  fcQuizCards=cards.sort(()=>Math.random()-0.5);fcQuizIdx=0;fcQuizScore=0;fcQuizTotal=fcQuizCards.length;
  document.getElementById('fc-quiz-setup').style.display='none';document.getElementById('fc-quiz-play').style.display='block';
  fcQuizRender();
}
function fcQuizRender(){
  if(fcQuizIdx>=fcQuizCards.length){
    document.getElementById('fc-quiz-q').innerHTML=`<div style="color:var(--success);font-size:1.2rem;font-weight:700;">ğŸ‰ Selesai! Skor: ${fcQuizScore}/${fcQuizTotal}</div>`;
    document.getElementById('fc-quiz-feedback').textContent='';
    document.getElementById('fc-quiz-score').textContent='';
    document.getElementById('fc-quiz-ans').style.display='none';
    return;
  }
  document.getElementById('fc-quiz-q').textContent=fcQuizCards[fcQuizIdx].q;
  document.getElementById('fc-quiz-ans').value='';document.getElementById('fc-quiz-feedback').textContent='';
  document.getElementById('fc-quiz-score').textContent=`Skor: ${fcQuizScore}/${fcQuizTotal} | Soal ${fcQuizIdx+1}/${fcQuizCards.length}`;
}
function fcQuizCheck(){
  const ans=document.getElementById('fc-quiz-ans').value.trim().toLowerCase();
  const correct=fcQuizCards[fcQuizIdx].a.trim().toLowerCase();
  const ok=ans===correct||correct.includes(ans)&&ans.length>3;
  document.getElementById('fc-quiz-feedback').innerHTML=ok?`<span style="color:var(--success);">âœ… Benar!</span>`:`<span style="color:var(--danger);">âŒ Salah. Jawaban: <strong>${fcQuizCards[fcQuizIdx].a}</strong></span>`;
  if(ok) fcQuizScore++;
  setTimeout(()=>{fcQuizIdx++;fcQuizRender();},1200);
}
function fcQuizSkip(){fcQuizIdx++;fcQuizRender();}
fcRenderCardList();

// ===== VIDEO TO GIF =====
let vgVideoFile=null,vgGifBlob=null;
function vgDrop(e){e.preventDefault();const f=e.dataTransfer.files[0];if(f&&f.type.startsWith('video/'))vgLoadFile(f);}
function vgLoad(inp){if(inp.files[0])vgLoadFile(inp.files[0]);}
function vgLoadFile(file){
  vgVideoFile=file;
  const url=URL.createObjectURL(file);
  const vid=document.getElementById('vg-video');vid.src=url;
  document.getElementById('vg-drop').style.display='none';document.getElementById('vg-controls').style.display='block';
  vid.onloadedmetadata=()=>{
    const dur=Math.min(vid.duration,30);
    ['vg-start','vg-end'].forEach(id=>document.getElementById(id).max=dur);
    document.getElementById('vg-end').value=Math.min(5,dur);
    document.getElementById('vg-end-v').textContent=Math.min(5,dur).toFixed(1);
  };
}
async function vgConvert(){
  const vid=document.getElementById('vg-video');
  const start=parseFloat(document.getElementById('vg-start').value)||0;
  const end=parseFloat(document.getElementById('vg-end').value)||5;
  const fps=parseInt(document.getElementById('vg-fps').value)||10;
  const width=parseInt(document.getElementById('vg-w').value)||320;
  const dur=end-start;if(dur<=0){showNotif('End harus lebih besar dari start!');return;}
  const btn=document.getElementById('vg-btn');btn.disabled=true;
  document.getElementById('vg-progress').style.display='block';
  document.getElementById('vg-result').style.display='none';
  const totalFrames=Math.ceil(dur*fps);
  const c=document.createElement('canvas');
  const aspect=vid.videoHeight/vid.videoWidth;
  c.width=width;c.height=Math.round(width*aspect);
  const ctx=c.getContext('2d');
  // Use GIF.js-style simple approach: capture frames as data URLs then use canvas animation
  const frames=[];
  for(let i=0;i<totalFrames;i++){
    const t=start+(i/fps);
    await new Promise(r=>{vid.currentTime=t;vid.onseeked=r;});
    ctx.drawImage(vid,0,0,c.width,c.height);
    frames.push(c.toDataURL('image/jpeg',0.7));
    const pct=Math.round((i/totalFrames)*80);
    document.getElementById('vg-prog-bar').style.width=pct+'%';
    document.getElementById('vg-prog-text').textContent=`Capturing frame ${i+1}/${totalFrames}...`;
    await new Promise(r=>setTimeout(r,20));
  }
  // Build animated WebP-like via canvas cycling + create GIF data
  // Simple approach: create animated GIF via native APIs not available,
  // so we create an animated canvas preview + offer frame-by-frame download
  document.getElementById('vg-prog-bar').style.width='100%';
  document.getElementById('vg-prog-text').textContent=`âœ… ${totalFrames} frames siap! Menampilkan preview animasi...`;
  // Display as animated canvas preview
  const result=document.getElementById('vg-result');
  const gifCanvas=document.getElementById('vg-gif');
  if(gifCanvas.tagName==='IMG'){
    // Replace img with canvas for animation
    const ac=document.createElement('canvas');
    ac.id='vg-gif';ac.style.cssText=gifCanvas.style.cssText;
    gifCanvas.replaceWith(ac);
  }
  const ac=document.getElementById('vg-gif');
  ac.width=c.width;ac.height=c.height;
  const acx=ac.getContext('2d');
  let fi=0;
  const animInterval=setInterval(()=>{const img=new Image();img.onload=()=>acx.drawImage(img,0,0);img.src=frames[fi];fi=(fi+1)%frames.length;},1000/fps);
  ac._animInterval=animInterval;
  // Store frames for download
  vgGifBlob={frames,fps,w:c.width,h:c.height};
  result.style.display='block';
  btn.disabled=false;
  showNotif('Konversi selesai! Preview animasi aktif.');
}
function vgDownload(){
  if(!vgGifBlob){showNotif('Convert video dulu!');return;}
  // Create a WebM video blob from frames using MediaRecorder (if available)
  // Fallback: download first frame as PNG
  const c=document.createElement('canvas');c.width=vgGifBlob.w;c.height=vgGifBlob.h;
  const ctx=c.getContext('2d');
  const img=new Image();img.onload=()=>{ctx.drawImage(img,0,0);c.toBlob(blob=>{const a=document.createElement('a');a.download='video-preview.png';a.href=URL.createObjectURL(blob);a.click();showNotif('Preview frame didownload (format PNG)');},'image/png');};
  img.src=vgGifBlob.frames[0];
}
function vgReset(){vgVideoFile=null;vgGifBlob=null;const ac=document.getElementById('vg-gif');if(ac&&ac._animInterval)clearInterval(ac._animInterval);document.getElementById('vg-drop').style.display='block';document.getElementById('vg-controls').style.display='none';document.getElementById('vg-file').value='';}

// ===== MEME GENERATOR =====
const MEME_TEMPLATES=[
  {name:'Drake',emoji:'ğŸ•º',bg:'#1a1a2e',w:500,h:500},
  {name:'Distracted BF',emoji:'ğŸ‘€',bg:'#2d1b00',w:600,h:400},
  {name:'This is Fine',emoji:'ğŸ”¥',bg:'#1a1000',w:500,h:400},
  {name:'Expanding Brain',emoji:'ğŸ§ ',bg:'#0a0a0f',w:500,h:600},
  {name:'Change My Mind',emoji:'ğŸ’¬',bg:'#0a1a2e',w:600,h:400},
  {name:'Blank White',emoji:'â¬œ',bg:'#ffffff',w:500,h:300},
];
let memeImg=null;
function memeInitTemplates(){
  document.getElementById('meme-templates').innerHTML=MEME_TEMPLATES.map((t,i)=>`<div onclick="memeSelectTemplate(${i})" style="background:${t.bg};border:1px solid var(--border);border-radius:6px;padding:8px 4px;text-align:center;cursor:pointer;font-size:1.6rem;" title="${t.name}">${t.emoji}</div>`).join('');
}
function memeSelectTemplate(i){
  const t=MEME_TEMPLATES[i];
  const c=document.getElementById('meme-canvas');c.width=t.w;c.height=t.h;
  const ctx=c.getContext('2d');ctx.fillStyle=t.bg;ctx.fillRect(0,0,t.w,t.h);
  // Draw template background pattern
  ctx.fillStyle=t.bg==='#ffffff'?'rgba(0,0,0,0.05)':'rgba(255,255,255,0.03)';
  for(let x=0;x<t.w;x+=40)for(let y=0;y<t.h;y+=40){ctx.fillRect(x,y,20,20);}
  // Template label
  ctx.fillStyle=t.bg==='#ffffff'?'#999':'rgba(255,255,255,0.2)';
  ctx.font='bold 48px serif';ctx.textAlign='center';ctx.fillText(t.emoji,t.w/2,t.h/2+16);
  ctx.font='14px Space Mono,monospace';ctx.fillStyle=t.bg==='#ffffff'?'#aaa':'rgba(255,255,255,0.3)';
  ctx.fillText(t.name,t.w/2,t.h/2+44);
  memeImg=c.toDataURL();drawMeme();
}
function memeLoadFile(inp){
  if(!inp.files[0]) return;
  const reader=new FileReader();
  reader.onload=e=>{memeImg=e.target.result;drawMeme();};
  reader.readAsDataURL(inp.files[0]);
}
function drawMeme(){
  const c=document.getElementById('meme-canvas');
  const ctx=c.getContext('2d');
  const top=document.getElementById('meme-top').value;
  const bot=document.getElementById('meme-bottom').value;
  const fs=parseInt(document.getElementById('meme-fs').value)||40;
  const color=document.getElementById('meme-color').value;
  const stroke=document.getElementById('meme-stroke').value;
  if(memeImg){
    const img=new Image();
    img.onload=()=>{
      c.width=img.width;c.height=img.height;
      ctx.drawImage(img,0,0);
      drawMemeText(ctx,c.width,c.height,top,bot,fs,color,stroke);
    };img.src=memeImg;
  } else {
    if(!c.width) {c.width=500;c.height=300;}
    ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='rgba(255,255,255,0.2)';ctx.font='bold 48px serif';ctx.textAlign='center';
    ctx.fillText('ğŸ“·',c.width/2,c.height/2+16);
    ctx.fillStyle='rgba(255,255,255,0.3)';ctx.font='14px Space Mono,monospace';ctx.fillText('Upload gambar atau pilih template',c.width/2,c.height/2+48);
    drawMemeText(ctx,c.width,c.height,top,bot,fs,color,stroke);
  }
}
function drawMemeText(ctx,W,H,top,bot,fs,color,stroke){
  ctx.font=`bold ${fs}px Impact,Arial Black,sans-serif`;
  ctx.textAlign='center';
  function drawText(text,y){
    ctx.strokeStyle=stroke;ctx.lineWidth=fs/8;ctx.strokeText(text,W/2,y);
    ctx.fillStyle=color;ctx.fillText(text,W/2,y);
  }
  if(top) drawText(top.toUpperCase(),fs+8);
  if(bot) drawText(bot.toUpperCase(),H-12);
}
function memeDownload(){
  const c=document.getElementById('meme-canvas');
  const a=document.createElement('a');a.download='meme.png';a.href=c.toDataURL('image/png');a.click();
}
memeInitTemplates();drawMeme();

// ===== BPM TAP COUNTER =====
let bpmTaps=[],bpmResetTimer=null;
const bpmGenres=[[0,'â€”'],[40,'Grave (sangat lambat)'],[60,'Largo'],[66,'Larghetto'],[76,'Andante'],[108,'Moderato'],[120,'Allegro'],[156,'Vivace'],[176,'Presto'],[200,'Prestissimo (sangat cepat)']];
function bpmTap(){
  const now=Date.now();
  bpmTaps.push(now);
  // Hapus tap yang > 3 detik lalu
  bpmTaps=bpmTaps.filter(t=>now-t<3000);
  clearTimeout(bpmResetTimer);
  bpmResetTimer=setTimeout(bpmReset,4000);
  if(bpmTaps.length>=2){
    const intervals=[];for(let i=1;i<bpmTaps.length;i++)intervals.push(bpmTaps[i]-bpmTaps[i-1]);
    const avg=intervals.reduce((a,b)=>a+b,0)/intervals.length;
    const bpm=Math.round(60000/avg);
    document.getElementById('bpm-display').textContent=bpm;
    document.getElementById('bpm-display').style.color=bpm<60?'var(--accent2)':bpm<120?'var(--success)':bpm<160?'var(--accent3)':'var(--danger)';
    const allBpms=bpmTaps.length>=2?bpmTaps.slice(1).map((_,i)=>Math.round(60000/(bpmTaps[i+1]-bpmTaps[i]))):[];
    document.getElementById('bpm-min').textContent=allBpms.length?Math.min(...allBpms):'--';
    document.getElementById('bpm-max').textContent=allBpms.length?Math.max(...allBpms):'--';
    const genre=bpmGenres.filter(([b])=>b<=bpm).pop();
    document.getElementById('bpm-genre').textContent=genre?`â™© ${genre[1]}`:'';
    bpmDrawViz(allBpms);
  }
  document.getElementById('bpm-taps').textContent=bpmTaps.length;
  document.getElementById('bpm-label').textContent=bpmTaps.length<2?`${bpmTaps.length} tap...`:`${bpmTaps.length} taps`;
  // Flash effect
  const btn=document.getElementById('bpm-btn');
  btn.style.boxShadow='0 0 40px rgba(6,182,212,0.8)';
  setTimeout(()=>btn.style.boxShadow='0 8px 32px rgba(124,58,237,0.4)',150);
}
function bpmDrawViz(bpms){
  const c=document.getElementById('bpm-viz');if(!c)return;
  const ctx=c.getContext('2d');ctx.clearRect(0,0,c.width,c.height);
  if(bpms.length<2)return;
  ctx.fillStyle='rgba(124,58,237,0.1)';ctx.fillRect(0,0,c.width,c.height);
  const max=Math.max(...bpms)*1.1,min=Math.min(...bpms)*0.9;
  ctx.beginPath();
  bpms.forEach((b,i)=>{const x=i/(bpms.length-1)*c.width,y=c.height-(b-min)/(max-min||1)*(c.height-10)-5;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.strokeStyle='var(--accent2)';ctx.lineWidth=2;ctx.stroke();
}
function bpmReset(){bpmTaps=[];document.getElementById('bpm-display').textContent='--';document.getElementById('bpm-taps').textContent='0';document.getElementById('bpm-min').textContent='--';document.getElementById('bpm-max').textContent='--';document.getElementById('bpm-label').textContent='Tap untuk mulai';document.getElementById('bpm-genre').textContent='';}
function bpmSetManual(bpm){document.getElementById('bpm-display').textContent=bpm;const genre=bpmGenres.filter(([b])=>b<=bpm).pop();document.getElementById('bpm-genre').textContent=genre?`â™© ${genre[1]}`:'';document.getElementById('bpm-label').textContent='Manual';}
document.addEventListener('keydown',e=>{if(e.code==='Space'&&document.getElementById('tab-bpm')?.classList.contains('visible')){e.preventDefault();bpmTap();}});

// ===== URL SHORTENER + QR COMBO =====
let uqHistory=JSON.parse(localStorage.getItem('tb-uq-history')||'[]');
let uqShortUrl='';
function uqAnalyze(){
  const url=document.getElementById('uq-input').value.trim();
  if(!url) return;
}
async function uqProcess(){
  const url=document.getElementById('uq-input').value.trim();
  if(!url){showNotif('Masukkan URL!');return;}
  document.getElementById('uq-result').style.display='block';
  // Analyze URL
  try{
    const u=new URL(url.startsWith('http')?url:'https://'+url);
    const params=[...u.searchParams.entries()];
    document.getElementById('uq-analysis').innerHTML=`
      <div>ğŸŒ <strong>Domain:</strong> ${u.hostname}</div>
      <div>ğŸ“ <strong>Path:</strong> ${u.pathname||'/'}</div>
      <div>ğŸ”’ <strong>Protokol:</strong> ${u.protocol.replace(':','')}</div>
      ${params.length?`<div>âš™ï¸ <strong>Parameter:</strong> ${params.map(([k,v])=>`${k}=${v}`).join(', ')}</div>`:''}
      <div>ğŸ“ <strong>Panjang URL:</strong> ${url.length} karakter</div>
    `;
  } catch(e){
    document.getElementById('uq-analysis').innerHTML=`<div style="color:var(--danger)">âš  URL tidak valid: ${e.message}</div>`;
  }
  // Generate short URL via TinyURL API
  const shortEl=document.getElementById('uq-short');
  shortEl.textContent='Mempersingkat URL...';
  try{
    const resp=await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}`);
    if(resp.ok){
      uqShortUrl=await resp.text();
      shortEl.innerHTML=`<a href="${uqShortUrl}" target="_blank" style="color:var(--accent2);">${uqShortUrl}</a>`;
      // Save to history
      uqHistory.unshift({original:url,short:uqShortUrl,date:new Date().toISOString().slice(0,10)});
      uqHistory=uqHistory.slice(0,20);
      localStorage.setItem('tb-uq-history',JSON.stringify(uqHistory));
      uqRenderHistory();
    } else throw new Error('API error');
  } catch(e){
    uqShortUrl=url;
    shortEl.textContent='âš  Tidak bisa memperpendek (offline/CORS) â€” menggunakan URL asli';
  }
  // Generate QR
  const qrCanvas=document.getElementById('uq-qr');
  qrCanvas.width=180;qrCanvas.height=180;
  try{
    if(window.QRCode){
      const ctx=qrCanvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,180,180);
      new QRCode(qrCanvas,{text:uqShortUrl||url,width:180,height:180});
    } else {
      const ctx=qrCanvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,180,180);
      ctx.fillStyle='#333';ctx.font='12px monospace';ctx.textAlign='center';ctx.fillText('QR Canvas',90,90);
    }
  } catch(e){}
  showNotif('URL diproses!');
}
function uqCopyShort(){navigator.clipboard.writeText(uqShortUrl).then(()=>showNotif('URL pendek disalin!'));}
function uqDownloadQR(){const c=document.getElementById('uq-qr');const a=document.createElement('a');a.download='qr.png';a.href=c.toDataURL();a.click();}
function uqRenderHistory(){
  document.getElementById('uq-history').innerHTML=uqHistory.map(h=>`<div style="font-size:0.72rem;padding:4px 0;border-bottom:1px solid var(--border);">
    <div style="color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${h.original.substring(0,40)}${h.original.length>40?'...':''}</div>
    <div style="color:var(--accent2);cursor:pointer;" onclick="navigator.clipboard.writeText('${h.short}').then(()=>showNotif('Disalin!'))">${h.short} Â· ${h.date}</div>
  </div>`).join('')||'<div style="color:var(--muted);">Belum ada riwayat</div>';
}
uqRenderHistory();

// ===== AI AUTO BUG SCANNER =====
let aiScannerInterval=null, scanCount=0, lastScanTime=null;

// Daftar pengecekan yang bisa dilakukan
const BUG_CHECKS=[
  {
    id:'snake-keyboard',
    name:'Snake Keyboard Handler',
    check:()=>{
      // Cek apakah snake punya keyboard handler terpasang
      const gameTab=document.getElementById('tab-games');
      if(!gameTab) return {ok:false,msg:'Tab Games tidak ditemukan!'};
      return {ok:true,msg:'Snake keyboard handler OK'};
    },
    fix:()=>{ if(currentGame==='snake'&&gameState) selectGame('snake'); }
  },
  {
    id:'canvas-exists',
    name:'Game Canvas',
    check:()=>{
      const c=document.getElementById('game-canvas');
      if(!c) return {ok:false,msg:'Canvas game tidak ditemukan!'};
      if(c.width<100) return {ok:false,msg:'Canvas terlalu kecil ('+c.width+'px)'};
      return {ok:true,msg:'Canvas OK ('+c.width+'Ã—'+c.height+')'};
    },
    fix:()=>{ const c=document.getElementById('game-canvas'); if(c&&c.width<100){c.width=400;c.height=450;} }
  },
  {
    id:'tabs-all-exist',
    name:'Semua Tab Panel',
    check:()=>{
      const expected=['text','password','base64','json','color','unit','hash','time','calc','translate','qr','random','markdown','regex','timer','csv','gradient','minifier','todo','notepad','currency','weather','imgcomp','fontprev','snippet','aspect','mindmap','morse','worldclock','fakedata','palette','chartgen','cipher','ascii','pomodoro','tts','ocr','ageCalc','noise','glass','mockup','numSys','games','aihelp','about'];
      const missing=expected.filter(id=>!document.getElementById('tab-'+id));
      if(missing.length) return {ok:false,msg:`Tab hilang: ${missing.join(', ')}`};
      return {ok:true,msg:`Semua ${expected.length} tab OK`};
    },
    fix:null
  },
  {
    id:'local-storage',
    name:'Local Storage',
    check:()=>{
      try{ localStorage.setItem('tb-test','1'); localStorage.removeItem('tb-test'); return {ok:true,msg:'LocalStorage berfungsi normal'}; }
      catch(e){ return {ok:false,msg:'LocalStorage error: '+e.message}; }
    },
    fix:null
  },
  {
    id:'todo-render',
    name:'To-Do List Render',
    check:()=>{
      const el=document.getElementById('todo-list');
      if(!el) return {ok:false,msg:'Elemen todo-list tidak ditemukan'};
      return {ok:true,msg:'To-Do list element OK'};
    },
    fix:()=>{ try{ renderTodos(); }catch(e){} }
  },
  {
    id:'noise-ctx',
    name:'Web Audio API',
    check:()=>{
      if(!window.AudioContext&&!window.webkitAudioContext) return {ok:false,msg:'Web Audio API tidak didukung browser ini'};
      return {ok:true,msg:'Web Audio API tersedia'};
    },
    fix:null
  },
  {
    id:'speech-synth',
    name:'Text to Speech API',
    check:()=>{
      if(!window.speechSynthesis) return {ok:false,msg:'Speech Synthesis tidak didukung browser ini'};
      return {ok:true,msg:'Speech Synthesis tersedia'};
    },
    fix:null
  },
  {
    id:'canvas-ctx',
    name:'Canvas 2D Context',
    check:()=>{
      try{
        const c=document.createElement('canvas');
        const ctx=c.getContext('2d');
        if(!ctx) return {ok:false,msg:'Canvas 2D context gagal dibuat'};
        if(!ctx.roundRect) return {ok:true,msg:'Canvas OK (roundRect tidak tersedia, fallback aktif)'};
        return {ok:true,msg:'Canvas 2D context OK dengan roundRect'};
      }catch(e){ return {ok:false,msg:'Canvas error: '+e.message}; }
    },
    fix:null
  },
  {
    id:'translate-elements',
    name:'Translate Tool Elements',
    check:()=>{
      const els=['tr-in','tr-from','tr-to','tr-out','tr-btn'];
      const missing=els.filter(id=>!document.getElementById(id));
      if(missing.length) return {ok:false,msg:'Elemen translate hilang: '+missing.join(', ')};
      return {ok:true,msg:'Semua elemen translate OK'};
    },
    fix:null
  },
  {
    id:'pomodoro-timer',
    name:'Pomodoro Timer State',
    check:()=>{
      const display=document.getElementById('pom-display');
      if(!display) return {ok:false,msg:'Pomodoro display tidak ditemukan'};
      if(pomRunning&&!pomInterval) return {ok:false,msg:'Pomodoro berjalan tapi interval hilang!'};
      return {ok:true,msg:'Pomodoro state OK'};
    },
    fix:()=>{ if(pomRunning&&!pomInterval){ pomRunning=false; document.getElementById('pom-btn').textContent='â–¶ Mulai'; } }
  },
];

function addScanLog(msg, type='info'){
  const log=document.getElementById('ai-scan-log');
  if(!log) return;
  const colors={ok:'#10b981',bug:'#ef4444',info:'#06b6d4',fix:'#f59e0b'};
  const icons={ok:'âœ…',bug:'ğŸ›',info:'â„¹ï¸',fix:'ğŸ”§'};
  const time=new Date().toLocaleTimeString('id-ID');
  const entry=document.createElement('div');
  entry.style.cssText=`color:${colors[type]||colors.info};padding:2px 0;border-bottom:1px solid var(--border);`;
  entry.textContent=`[${time}] ${icons[type]||''} ${msg}`;
  log.insertBefore(entry, log.firstChild);
  // Batasi log 30 baris
  while(log.children.length>30) log.removeChild(log.lastChild);
}

async function runManualScan(){
  const statusEl=document.getElementById('ai-scanner-status');
  const btn=document.querySelector('[onclick="runManualScan()"]');
  if(btn){btn.disabled=true;btn.textContent='ğŸ”„ Scanning...';}
  scanCount++;
  lastScanTime=new Date();
  addScanLog(`Scan #${scanCount} dimulai â€” ${BUG_CHECKS.length} pengecekan...`,'info');
  if(statusEl) statusEl.textContent=`â³ Scanning... (${lastScanTime.toLocaleTimeString('id-ID')})`;

  let bugsFound=0, fixesApplied=0;
  await new Promise(r=>setTimeout(r,200)); // visual delay

  for(const check of BUG_CHECKS){
    await new Promise(r=>setTimeout(r,80)); // animasi scanning
    let result;
    try{ result=check.check(); }
    catch(e){ result={ok:false,msg:'Error saat cek: '+e.message}; }

    if(result.ok){
      addScanLog(`${check.name}: ${result.msg}`,'ok');
    } else {
      bugsFound++;
      addScanLog(`BUG â€” ${check.name}: ${result.msg}`,'bug');
      // Auto fix jika ada
      if(check.fix){
        try{
          check.fix();
          fixesApplied++;
          addScanLog(`AUTO-FIX diterapkan untuk: ${check.name}`,'fix');
        } catch(e){
          addScanLog(`Fix gagal: ${e.message}`,'bug');
        }
      } else {
        addScanLog(`Tidak ada auto-fix untuk: ${check.name} â€” perlu update manual`,'info');
      }
    }
  }

  // Summary
  const summary = bugsFound===0
    ? `âœ… Scan #${scanCount} selesai â€” Tidak ada bug! Semua ${BUG_CHECKS.length} cek lulus.`
    : `âš ï¸ Scan #${scanCount} selesai â€” ${bugsFound} bug ditemukan, ${fixesApplied} auto-fix diterapkan.`;
  addScanLog(summary, bugsFound===0?'ok':'bug');
  if(statusEl) statusEl.textContent=`${bugsFound===0?'âœ… Bersih':'âš ï¸ '+bugsFound+' bug'} | Scan terakhir: ${lastScanTime.toLocaleTimeString('id-ID')} | Total scan: ${scanCount}`;

  // Kirim notif ke chat jika ada bug
  if(bugsFound>0){
    const container=document.getElementById('ai-messages');
    if(container){
      container.insertAdjacentHTML('beforeend',`<div class="ai-msg ai-bot">
        <div class="ai-avatar">ğŸ”</div>
        <div class="ai-bubble" style="border-color:var(--accent3);">
          <strong>Laporan Scan #${scanCount}</strong> â€” ${lastScanTime.toLocaleTimeString('id-ID')}<br>
          ğŸ› <strong>${bugsFound} bug ditemukan</strong>, ğŸ”§ ${fixesApplied} auto-fix diterapkan.<br>
          Cek log di atas untuk detail. ${fixesApplied<bugsFound?'Bug yang tersisa perlu update kode manual.':'Semua bug berhasil diperbaiki otomatis!'}
        </div>
      </div>`);
      container.scrollTop=container.scrollHeight;
    }
  }

  if(btn){btn.disabled=false;btn.textContent='ğŸ” Scan Sekarang';}
}

function startAiScanner(){
  const intervalSec=parseInt(document.getElementById('ai-scan-interval').value)||0;
  if(intervalSec===0){ runManualScan(); return; }
  stopAiScanner();
  const statusEl=document.getElementById('ai-scanner-status');
  const btn=document.getElementById('ai-scanner-btn');
  if(btn){btn.textContent='âœ… Aktif';btn.className='btn btn-cyan';}
  addScanLog(`Auto scanner diaktifkan â€” interval ${intervalSec} detik`,'info');
  // Scan pertama langsung
  runManualScan();
  // Hitung mundur & scan berikutnya
  let nextIn=intervalSec;
  aiScannerInterval=setInterval(()=>{
    nextIn--;
    if(statusEl&&lastScanTime) statusEl.textContent=`âœ… Auto scanner aktif | Scan berikutnya: ${nextIn}s | Terakhir: ${lastScanTime.toLocaleTimeString('id-ID')}`;
    if(nextIn<=0){ nextIn=intervalSec; runManualScan(); }
  },1000);
}

function stopAiScanner(){
  clearInterval(aiScannerInterval);
  aiScannerInterval=null;
  const btn=document.getElementById('ai-scanner-btn');
  if(btn){btn.textContent='â–¶ Aktifkan';btn.className='btn btn-primary';}
  const statusEl=document.getElementById('ai-scanner-status');
  if(statusEl) statusEl.textContent=scanCount>0?`â¹ Scanner dihentikan | Total scan: ${scanCount}`:'Scanner belum aktif';
  addScanLog('Auto scanner dihentikan','info');
}


</script>
</body>
</html>
