<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToolBox ‚Äî Adam yang Ganteng</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=Space+Mono:wght@400;700&family=Noto+Sans:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Noto+Sans+Thai:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0a0f;--surface:#13131a;--surface2:#1c1c28;--border:#2a2a3d;--accent:#7c3aed;--accent2:#06b6d4;--accent3:#f59e0b;--text:#e8e8f0;--muted:#6b6b8a;--success:#10b981;--danger:#ef4444;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Space Mono',monospace;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(124,58,237,0.05) 1px,transparent 1px),linear-gradient(90deg,rgba(124,58,237,0.05) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
.container{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 20px;} .container.home-container{max-width:100%;padding:0;}
header{padding:40px 0 20px;text-align:center;border-bottom:1px solid var(--border);margin-bottom:32px;}
header h1{font-family:'Syne',sans-serif;font-size:clamp(2rem,6vw,3.5rem);font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-2px;}
header p{color:var(--muted);margin-top:8px;font-size:0.8rem;letter-spacing:2px;text-transform:uppercase;}
.tool-tabs{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:28px;justify-content:center;}
/* tab-btn moved to animation block */


/* tool-panel moved to animation block */

@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
.shake{animation:shake 0.4s ease;}
.panel-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:28px;margin-bottom:16px;}
.panel-title{font-family:'Syne',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:4px;}
.panel-desc{color:var(--muted);font-size:0.75rem;margin-bottom:20px;letter-spacing:1px;}
textarea,input[type="text"],input[type="number"],select{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);font-family:'Space Mono',monospace;font-size:0.82rem;padding:10px 14px;border-radius:8px;outline:none;transition:border-color 0.2s;resize:vertical;}
textarea:focus,input[type="text"]:focus,input[type="number"]:focus,select:focus{border-color:var(--accent);}
textarea{min-height:100px;}
label{display:block;font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px;margin-top:14px;}
label:first-child{margin-top:0;}
.btn{padding:9px 18px;border:none;border-radius:6px;font-family:'Space Mono',monospace;font-size:0.75rem;font-weight:700;cursor:pointer;transition:all 0.2s;text-transform:uppercase;letter-spacing:1px;}
.btn-primary{background:var(--accent);color:#fff;}.btn-primary:hover{background:#6d28d9;transform:translateY(-1px);}
.btn-secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border);}.btn-secondary:hover{border-color:var(--accent);}
.btn-cyan{background:var(--accent2);color:#000;}.btn-cyan:hover{opacity:0.9;}
.btn-group{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;}
.output-box{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;font-size:0.82rem;line-height:1.7;margin-top:14px;word-break:break-all;min-height:56px;color:var(--accent2);white-space:pre-wrap;position:relative;}
.copy-btn{position:absolute;top:8px;right:8px;background:var(--surface2);border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.65rem;padding:3px 9px;border-radius:4px;cursor:pointer;transition:all 0.2s;}
.copy-btn:hover{color:var(--text);border-color:var(--accent);}
.copy-btn.copied{color:var(--success);border-color:var(--success);}
.stats-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;}
.stat-chip{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:6px 12px;font-size:0.72rem;}
.stat-chip span{color:var(--accent3);font-weight:700;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
@media(max-width:600px){.grid-2{grid-template-columns:1fr;}}
.strength-bar{height:4px;background:var(--border);border-radius:2px;margin-top:10px;overflow:hidden;}
.strength-fill{height:100%;border-radius:2px;transition:width 0.3s,background 0.3s;}
input[type="color"]{width:54px;height:38px;border:1px solid var(--border);border-radius:6px;background:var(--bg);cursor:pointer;padding:2px;}
input[type="range"]{width:100%;accent-color:var(--accent);background:transparent;margin:6px 0;}
.toggle-row{display:flex;align-items:center;gap:10px;margin-top:10px;font-size:0.78rem;color:var(--muted);}
.toggle-row input[type="checkbox"]{width:14px;height:14px;accent-color:var(--accent);}
/* Calc */
.calc-btn{padding:14px 6px;background:var(--surface2);border:1px solid var(--border);color:var(--text);font-family:'Space Mono',monospace;font-size:0.95rem;font-weight:700;border-radius:8px;cursor:pointer;transition:all 0.15s;width:100%;}
.calc-btn:hover{background:var(--border);transform:scale(1.04);}
.calc-btn:active{transform:scale(0.96);}
.calc-btn.calc-op{background:rgba(124,58,237,0.2);border-color:var(--accent);color:var(--accent2);}
.calc-btn.calc-eq{background:var(--accent);border-color:var(--accent);color:#fff;font-size:1.1rem;}
.calc-btn.calc-eq:hover{background:#6d28d9;}
.calc-btn.calc-fn{background:var(--surface);color:var(--muted);font-size:0.75rem;}
.calc-btn.calc-fn:hover{color:var(--text);border-color:var(--accent);}
/* Translate */
.lang-output{font-family:'Noto Sans SC','Noto Sans JP','Noto Sans KR','Noto Sans Arabic','Noto Sans Thai','Noto Sans Devanagari','Noto Sans','Space Mono',sans-serif;font-size:0.9rem;line-height:2;}
.phrase-btn{background:var(--surface2);border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.7rem;padding:5px 11px;border-radius:20px;cursor:pointer;transition:all 0.2s;}
.phrase-btn:hover{border-color:var(--accent2);color:var(--accent2);}
@keyframes spin{to{transform:rotate(360deg)}}
.tr-spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;display:inline-block;margin-right:8px;vertical-align:middle;}
/* About badge */
.about-badge{background:var(--surface2);border:1px solid var(--border);color:var(--muted);font-size:0.7rem;padding:4px 11px;border-radius:20px;cursor:default;transition:all 0.2s;}
.about-badge:hover{border-color:var(--accent);color:var(--text);}
/* Gradient presets */
.gr-preset{height:36px;border-radius:6px;cursor:pointer;border:1px solid var(--border);transition:transform 0.2s;}
.gr-preset:hover{transform:scale(1.06);}
/* CSV table */
#csv-table-wrap table{width:100%;border-collapse:collapse;font-size:0.8rem;}
#csv-table-wrap th{background:var(--surface2);border:1px solid var(--border);padding:7px 11px;text-align:left;color:var(--accent2);}
#csv-table-wrap td{border:1px solid var(--border);padding:5px 11px;color:var(--text);}
/* Markdown */
.md-body h1,.md-body h2,.md-body h3{font-family:'Syne',sans-serif;color:var(--accent2);margin:12px 0 6px;}
.md-body p{margin:6px 0;line-height:1.8;}
.md-body code{background:var(--surface2);padding:2px 5px;border-radius:4px;color:var(--accent3);font-size:0.82rem;}
.md-body pre{background:var(--surface2);padding:12px;border-radius:6px;overflow-x:auto;margin:8px 0;}
.md-body blockquote{border-left:3px solid var(--accent);padding-left:12px;color:var(--muted);margin:6px 0;}
.md-body hr{border:none;border-top:1px solid var(--border);margin:14px 0;}
.md-body a{color:var(--accent2);text-decoration:underline;}
.md-body li{margin-left:20px;margin-bottom:3px;}
.md-body mark{background:rgba(124,58,237,0.35);color:var(--text);border-radius:3px;padding:1px 2px;}
/* Notif */
.notif{position:fixed;bottom:22px;right:22px;background:var(--success);color:#000;font-family:'Space Mono',monospace;font-size:0.78rem;padding:10px 18px;border-radius:8px;z-index:1000;opacity:0;transform:translateY(10px);transition:all 0.3s;pointer-events:none;}
.notif.show{opacity:1;transform:translateY(0);}
/* Badge */
.badge{display:inline-block;background:var(--surface2);border:1px solid var(--border);padding:3px 9px;border-radius:20px;font-size:0.68rem;color:var(--muted);margin:3px;}
footer{text-align:center;padding:36px 0;color:var(--muted);font-size:0.72rem;letter-spacing:2px;border-top:1px solid var(--border);margin-top:50px;}
.active-filter{border-color:var(--accent)!important;color:var(--accent2)!important;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:600px){.grid-2{grid-template-columns:1fr;}}

/* AI Chat */
.ai-msg{display:flex;gap:10px;align-items:flex-start;}
.ai-msg.ai-user{flex-direction:row-reverse;}
.ai-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;background:var(--surface2);border:1px solid var(--border);}
.ai-bubble{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:10px 14px;font-size:0.83rem;line-height:1.6;color:var(--text);max-width:85%;}
.ai-msg.ai-user .ai-bubble{background:rgba(124,58,237,0.15);border-color:var(--accent);}
.ai-msg.ai-bot .ai-bubble{border-color:var(--border);}
.ai-typing span{display:inline-block;width:6px;height:6px;background:var(--muted);border-radius:50%;animation:typing 1s infinite;}
.ai-typing span:nth-child(2){animation-delay:0.2s;}
.ai-typing span:nth-child(3){animation-delay:0.4s;}
@keyframes typing{0%,80%,100%{transform:scale(0.7);opacity:0.5;}40%{transform:scale(1);opacity:1;}}

/* Noise cards */
.noise-card.active{border-color:var(--accent)!important;background:rgba(124,58,237,0.1)!important;}

/* Game canvas */
#game-canvas{cursor:pointer;}


/* ‚îÄ‚îÄ SMOOTH TOOL ANIMATIONS ‚îÄ‚îÄ */
.tool-panel{display:none;animation:none;}
.tool-panel.active{display:block;animation:panelIn 0.38s cubic-bezier(0.34,1.56,0.64,1) both;}
.tool-panel.leaving{animation:panelOut 0.22s ease-in both;}
@keyframes panelIn{from{opacity:0;transform:translateY(18px) scale(0.97)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes panelOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-12px)}}
.tab-btn{padding:7px 13px;background:var(--surface);border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.7rem;cursor:pointer;border-radius:4px;transition:all 0.2s;text-transform:uppercase;letter-spacing:1px;position:relative;overflow:hidden;}
.tab-btn::after{content:'';position:absolute;inset:0;background:rgba(124,58,237,0.15);transform:scaleX(0);transform-origin:left;transition:transform 0.25s ease;}
.tab-btn:hover::after{transform:scaleX(1);}
.tab-btn.active{background:var(--accent);border-color:var(--accent);color:#fff;transform:scale(1.04);box-shadow:0 4px 16px rgba(124,58,237,0.35);}

/* ‚îÄ‚îÄ MAXIMIZE MODE ‚îÄ‚îÄ */
body.maximized-mode .tool-tabs,.tool-panel.maximized ~ .tool-tabs{display:none!important;}
.tool-panel.maximized{position:fixed;inset:0;z-index:9000;background:var(--bg);overflow-y:auto;padding:20px;animation:maximizeIn 0.35s cubic-bezier(0.34,1.26,0.64,1) both;}
@keyframes maximizeIn{from{transform:scale(0.92);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes maximizeOut{from{transform:scale(1);opacity:1}to{transform:scale(0.92);opacity:0}}
.maximize-btn{display:none;}

.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;}

/* ‚îÄ‚îÄ AITOOLS POPUP ‚îÄ‚îÄ */
#aitools-btn{position:fixed;bottom:24px;right:24px;z-index:99998;width:52px;height:52px;border-radius:50%;background:conic-gradient(from 0deg,#7c3aed,#06b6d4,#10b981,#f59e0b,#7c3aed);cursor:pointer;box-shadow:0 0 22px rgba(124,58,237,0.55);display:flex;align-items:center;justify-content:center;font-size:20px;user-select:none;transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.2s;animation:guardianSpin 3s linear infinite,guardianPulse 2s ease-in-out infinite alternate;border:none;outline:none;}
#aitools-btn:hover{transform:scale(1.15);box-shadow:0 0 36px rgba(124,58,237,0.75);}
#aitools-popup{position:fixed;bottom:88px;right:24px;z-index:99999;width:340px;max-height:520px;background:#13131a;border:1px solid rgba(124,58,237,0.45);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.7);display:flex;flex-direction:column;overflow:hidden;transform:scale(0.85) translateY(20px);opacity:0;pointer-events:none;transform-origin:bottom right;transition:transform 0.32s cubic-bezier(0.34,1.46,0.64,1),opacity 0.28s ease;}
#aitools-popup.open{transform:scale(1) translateY(0);opacity:1;pointer-events:all;}
#aitools-popup-header{padding:12px 14px;background:linear-gradient(135deg,rgba(124,58,237,0.25),rgba(6,182,212,0.12));border-bottom:1px solid rgba(124,58,237,0.2);display:flex;align-items:center;gap:8px;flex-shrink:0;}
#aitools-messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px;min-height:120px;max-height:300px;}
#aitools-messages::-webkit-scrollbar{width:3px;}
#aitools-messages::-webkit-scrollbar-thumb{background:rgba(124,58,237,0.4);border-radius:3px;}
.ait-msg-user{align-self:flex-end;background:rgba(124,58,237,0.2);border:1px solid rgba(124,58,237,0.35);border-radius:12px 12px 2px 12px;padding:8px 12px;font-size:0.75rem;max-width:86%;color:var(--text);}
.ait-msg-ai{align-self:flex-start;background:rgba(6,182,212,0.08);border:1px solid rgba(6,182,212,0.2);border-radius:2px 12px 12px 12px;padding:8px 12px;font-size:0.75rem;max-width:92%;color:var(--text);line-height:1.5;}
.ait-msg-ai.typing::after{content:'‚ñã';animation:aitBlink 0.7s infinite;}
@keyframes aitBlink{0%,100%{opacity:1}50%{opacity:0}}
#aitools-input-row{padding:10px 12px;border-top:1px solid rgba(124,58,237,0.2);display:flex;gap:8px;align-items:center;flex-shrink:0;}
#aitools-input{flex:1;background:rgba(255,255,255,0.05);border:1px solid rgba(124,58,237,0.3);border-radius:8px;padding:8px 10px;color:var(--text);font-size:0.75rem;font-family:'Space Mono',monospace;outline:none;resize:none;height:36px;}
#aitools-input:focus{border-color:rgba(124,58,237,0.6);background:rgba(124,58,237,0.08);}
#aitools-send-btn{background:linear-gradient(135deg,#7c3aed,#06b6d4);border:none;border-radius:8px;width:36px;height:36px;cursor:pointer;color:#fff;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:transform 0.15s,opacity 0.15s;flex-shrink:0;}
#aitools-send-btn:hover{transform:scale(1.1);}
#aitools-send-btn:disabled{opacity:0.4;}
.aitools-quick-btn{background:rgba(124,58,237,0.1);border:1px solid rgba(124,58,237,0.25);border-radius:6px;padding:4px 8px;font-size:0.62rem;cursor:pointer;color:var(--accent2);transition:all 0.15s;font-family:'Space Mono',monospace;}
.aitools-quick-btn:hover{background:rgba(124,58,237,0.22);border-color:var(--accent);}

/* ‚îÄ‚îÄ FULLSCREEN TOOL MODE ‚îÄ‚îÄ */
body.tool-fullscreen header,
body.tool-fullscreen .tool-tabs { display:none!important; }
body.tool-fullscreen #tb-back-bar { display:flex!important; }
body.tool-fullscreen .tool-panel.active {
  position:fixed; inset:0; z-index:8990;
  padding:70px 0 0 0; overflow-y:auto;
  background:var(--bg);
  animation:fsIn 0.32s cubic-bezier(0.34,1.46,0.64,1) both;
}
body.tool-fullscreen .tool-panel.active .panel-card {
  border-radius:0; border-left:none; border-right:none; max-width:100%;
  min-height:calc(100vh - 70px);
}
body.tool-fullscreen footer { display:none; }
@keyframes fsIn {
  from{opacity:0;transform:scale(0.97) translateY(14px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}
@keyframes fsOut {
  from{opacity:1;transform:scale(1)}
  to{opacity:0;transform:scale(0.96)}
}
/* Back bar hover effect */
#tb-back-btn:hover { background:rgba(124,58,237,0.3); transform:translateX(-2px); }

/* ‚ïê‚ïê HYPRLAND UI SYSTEM ‚ïê‚ïê */
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Outfit:wght@300;400;600;800&display=swap');

:root {
  --hy-blur: blur(20px) saturate(1.4);
  --hy-glass: rgba(19,19,26,0.75);
  --hy-border: rgba(124,58,237,0.18);
  --hy-glow: 0 0 24px rgba(124,58,237,0.2);
  --hy-radius: 16px;
  --hy-widget-bg: rgba(13,13,20,0.85);
}

/* ‚îÄ‚îÄ BASE BODY ‚îÄ‚îÄ */
body { font-family: 'Outfit', 'Space Mono', monospace; overflow-x: hidden; }
body::before {
  content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
  background: radial-gradient(ellipse 80% 60% at 20% 0%, rgba(124,58,237,0.12) 0%, transparent 60%),
              radial-gradient(ellipse 60% 40% at 80% 100%, rgba(6,182,212,0.08) 0%, transparent 60%),
              linear-gradient(rgba(124,58,237,0.04) 1px, transparent 1px),
              linear-gradient(90deg, rgba(124,58,237,0.04) 1px, transparent 1px);
  background-size: 100% 100%, 100% 100%, 32px 32px, 32px 32px;
}

/* ‚îÄ‚îÄ TOP BAR (Hyprland waybar style) ‚îÄ‚îÄ */
#hy-topbar {
  position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
  z-index: 9100; width: calc(100% - 40px); max-width: 1200px;
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px;
  background: var(--hy-widget-bg);
  backdrop-filter: var(--hy-blur);
  -webkit-backdrop-filter: var(--hy-blur);
  border: 1px solid var(--hy-border);
  border-radius: 50px;
  box-shadow: var(--hy-glow), 0 8px 32px rgba(0,0,0,0.4);
  animation: topbarIn 0.6s cubic-bezier(0.34,1.46,0.64,1) both;
}
@keyframes topbarIn {
  from { opacity:0; transform:translateX(-50%) translateY(-20px) scale(0.95); }
  to   { opacity:1; transform:translateX(-50%) translateY(0) scale(1); }
}
body.tool-fullscreen #hy-topbar { display:none!important; }

/* ‚îÄ‚îÄ NAV MENU BALL (3 dots) ‚îÄ‚îÄ */
#hy-menu-btn {
  width: 38px; height: 38px; border-radius: 50%;
  background: linear-gradient(135deg, rgba(124,58,237,0.4), rgba(6,182,212,0.3));
  border: 1px solid rgba(124,58,237,0.5);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  flex-direction: column; gap: 3px; padding: 0;
  transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
  flex-shrink: 0;
}
#hy-menu-btn:hover { transform:scale(1.1); box-shadow:0 0 18px rgba(124,58,237,0.5); }
#hy-menu-btn span {
  width: 14px; height: 2px; background: #e8e8f0; border-radius: 2px;
  transition: all 0.25s ease;
}
#hy-menu-btn.open span:nth-child(1) { transform: rotate(45deg) translate(3px,3px); }
#hy-menu-btn.open span:nth-child(2) { opacity:0; transform:scaleX(0); }
#hy-menu-btn.open span:nth-child(3) { transform: rotate(-45deg) translate(3px,-3px); }

/* ‚îÄ‚îÄ TITLE CENTER ‚îÄ‚îÄ */
#hy-title {
  flex: 1; text-align: center;
  font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 0.88rem;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: 1px; text-transform: uppercase;
}

/* ‚îÄ‚îÄ WIDGETS (clock + weather) ‚îÄ‚îÄ */
.hy-widget {
  display: flex; align-items: center; gap: 7px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 40px; padding: 5px 13px;
  cursor: pointer; transition: all 0.2s ease;
  flex-shrink: 0;
}
.hy-widget:hover {
  background: rgba(124,58,237,0.15);
  border-color: rgba(124,58,237,0.4);
  transform: scale(1.03);
}
.hy-widget-icon { font-size: 0.85rem; }
.hy-widget-text { font-size: 0.7rem; color: var(--text); font-family:'JetBrains Mono',monospace; font-weight:400; white-space:nowrap; }
.hy-widget-sub { font-size: 0.58rem; color: var(--muted); line-height:1; }

/* ‚îÄ‚îÄ WIDGET POPUP ‚îÄ‚îÄ */
.hy-widget-popup {
  position: fixed; z-index: 9500;
  background: var(--hy-widget-bg);
  backdrop-filter: var(--hy-blur); -webkit-backdrop-filter: var(--hy-blur);
  border: 1px solid var(--hy-border);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6), var(--hy-glow);
  padding: 18px 20px; min-width: 260px;
  transform: scale(0.9) translateY(-8px); opacity: 0; pointer-events: none;
  transition: transform 0.25s cubic-bezier(0.34,1.46,0.64,1), opacity 0.2s;
}
.hy-widget-popup.open { transform: scale(1) translateY(0); opacity:1; pointer-events:all; }

/* ‚îÄ‚îÄ FLYOUT NAV MENU ‚îÄ‚îÄ */
#hy-nav-menu {
  position: fixed; top: 62px; left: 20px; z-index: 9200;
  width: 320px;
  background: var(--hy-widget-bg);
  backdrop-filter: var(--hy-blur); -webkit-backdrop-filter: var(--hy-blur);
  border: 1px solid var(--hy-border);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6), var(--hy-glow);
  padding: 14px;
  transform: scale(0.9) translateX(-10px) translateY(-10px);
  opacity: 0; pointer-events: none;
  transition: transform 0.28s cubic-bezier(0.34,1.46,0.64,1), opacity 0.2s;
  max-height: calc(100vh - 80px); overflow-y: auto;
}
#hy-nav-menu::-webkit-scrollbar { width:3px; }
#hy-nav-menu::-webkit-scrollbar-thumb { background:rgba(124,58,237,0.4); border-radius:3px; }
#hy-nav-menu.open { transform:scale(1) translateX(0) translateY(0); opacity:1; pointer-events:all; }

.hy-nav-section { margin-bottom: 12px; }
.hy-nav-section-title {
  font-size: 0.58rem; text-transform: uppercase; letter-spacing: 2px;
  color: var(--accent2); margin-bottom: 6px; padding: 0 4px;
  font-family: 'JetBrains Mono', monospace;
}
.hy-nav-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
.hy-nav-btn {
  background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07);
  border-radius: 10px; padding: 8px 10px; cursor: pointer; text-align: left;
  transition: all 0.18s ease; display: flex; align-items: center; gap: 7px;
  color: var(--text);
}
.hy-nav-btn:hover {
  background: rgba(124,58,237,0.18); border-color: rgba(124,58,237,0.4);
  transform: translateY(-1px);
}
.hy-nav-btn .icon { font-size: 1rem; flex-shrink:0; }
.hy-nav-btn .label { font-size: 0.65rem; font-family:'Outfit',sans-serif; font-weight:600; line-height:1.2; }
.hy-nav-btn .label small { display:block; font-weight:400; color:var(--muted); font-size:0.55rem; margin-top:1px; }

/* ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ */
#hy-home {
  position: relative; z-index: 1;
  padding-top: 76px;
  min-height: 100vh;
  max-width: 1200px; margin: 0 auto; padding-left: 20px; padding-right: 20px;
}
#hy-home-hero {
  text-align: center; padding: 40px 0 30px;
}
#hy-home-hero h1 {
  font-family: 'Outfit', sans-serif; font-size: clamp(2.2rem,6vw,4rem); font-weight:800;
  background: linear-gradient(135deg, var(--accent), var(--accent2), #f59e0b);
  background-size: 200%; animation: gradShift 4s ease infinite;
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: -2px; line-height: 1.1;
}
@keyframes gradShift { 0%,100%{background-position:0%} 50%{background-position:100%} }
#hy-home-hero p {
  color: var(--muted); font-size: 0.78rem; margin-top: 8px;
  letter-spacing: 3px; text-transform: uppercase; font-family:'JetBrains Mono',monospace;
}

/* ‚îÄ‚îÄ SEARCH BAR (home) ‚îÄ‚îÄ */
#hy-search-wrap {
  max-width: 520px; margin: 20px auto 30px; position: relative;
}
#hy-search {
  width: 100%; background: rgba(255,255,255,0.04);
  border: 1px solid var(--hy-border); border-radius: 50px;
  padding: 13px 24px 13px 48px; color: var(--text);
  font-family: 'Outfit', sans-serif; font-size: 0.9rem; outline:none;
  transition: all 0.2s; backdrop-filter: blur(10px);
}
#hy-search:focus { border-color: rgba(124,58,237,0.5); background: rgba(124,58,237,0.07); box-shadow: 0 0 0 3px rgba(124,58,237,0.15); }
#hy-search-icon {
  position: absolute; left:17px; top:50%; transform:translateY(-50%);
  color: var(--muted); font-size: 1rem; pointer-events: none;
}

/* ‚îÄ‚îÄ TOOL CARDS GRID ‚îÄ‚îÄ */
.hy-tools-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 10px; margin-bottom: 30px;
}
.hy-tool-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 14px; padding: 16px 12px 14px;
  cursor: pointer; text-align: center;
  transition: all 0.22s cubic-bezier(0.34,1.36,0.64,1);
  position: relative; overflow: hidden;
  animation: cardIn 0.5s cubic-bezier(0.34,1.26,0.64,1) both;
}
.hy-tool-card::before {
  content:''; position:absolute; inset:0;
  background: linear-gradient(135deg, rgba(124,58,237,0.12), transparent 60%);
  opacity:0; transition:opacity 0.2s;
}
.hy-tool-card:hover { transform:translateY(-4px) scale(1.03); border-color:rgba(124,58,237,0.4); box-shadow:0 8px 28px rgba(124,58,237,0.2); }
.hy-tool-card:hover::before { opacity:1; }
.hy-tool-card:active { transform:scale(0.97); }
@keyframes cardIn {
  from { opacity:0; transform:translateY(12px) scale(0.95); }
  to   { opacity:1; transform:translateY(0) scale(1); }
}
.hy-card-icon { font-size: 1.8rem; margin-bottom: 8px; display:block; }
.hy-card-label { font-size: 0.68rem; font-family:'Outfit',sans-serif; font-weight:600; color:var(--text); line-height:1.3; }
.hy-card-tag { font-size:0.55rem; color:var(--muted); margin-top:3px; font-family:'JetBrains Mono',monospace; }

/* ‚îÄ‚îÄ SECTION HEADINGS ‚îÄ‚îÄ */
.hy-section-heading {
  font-family:'JetBrains Mono',monospace; font-size:0.62rem; font-weight:700;
  text-transform:uppercase; letter-spacing:3px; color:var(--accent2);
  margin: 24px 0 12px; display:flex; align-items:center; gap:10px;
}
.hy-section-heading::after {
  content:''; flex:1; height:1px; background:linear-gradient(90deg,rgba(6,182,212,0.3),transparent);
}

/* ‚îÄ‚îÄ HOME visible / hidden ‚îÄ‚îÄ */
#hy-home { display:block; }
#hy-home.hidden { display:none; }

/* Old header/tabs hidden in new mode */
header { display:none!important; }
.tool-tabs.tab-list { display:none!important; }
.container { max-width: 100%; padding: 0; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HYPRLAND-INSPIRED HOME SCREEN & WIDGET SYSTEM
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Override body for new layout */
body.home-mode { overflow: hidden; }

/* Animated background mesh */
body::before {
  content:'';position:fixed;inset:0;
  background-image:
    radial-gradient(ellipse 80% 60% at 20% 10%, rgba(124,58,237,0.08) 0%, transparent 60%),
    radial-gradient(ellipse 60% 80% at 80% 90%, rgba(6,182,212,0.06) 0%, transparent 60%),
    linear-gradient(rgba(124,58,237,0.03) 1px,transparent 1px),
    linear-gradient(90deg,rgba(124,58,237,0.03) 1px,transparent 1px);
  background-size:100% 100%,100% 100%,32px 32px,32px 32px;
  pointer-events:none;z-index:0;
  animation:bgShift 20s ease-in-out infinite alternate;
}
@keyframes bgShift {
  0%{opacity:0.7} 50%{opacity:1} 100%{opacity:0.8}
}

/* ‚îÄ‚îÄ TOP NAV BAR ‚îÄ‚îÄ */
#tb-topnav {
  position:fixed;top:0;left:0;right:0;height:54px;
  z-index:8990;
  display:flex;align-items:center;padding:0 18px;gap:14px;
  background:rgba(8,8,16,0.75);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(124,58,237,0.15);
}
body.tool-fullscreen #tb-topnav { display:none; }

#tb-nav-3dot {
  display:flex;flex-direction:column;gap:4px;padding:8px 10px;
  background:rgba(124,58,237,0.1);border:1px solid rgba(124,58,237,0.25);
  border-radius:10px;cursor:pointer;transition:all 0.2s;flex-shrink:0;
}
#tb-nav-3dot span {
  display:block;width:16px;height:2px;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  border-radius:2px;transition:all 0.25s;
}
#tb-nav-3dot:hover { background:rgba(124,58,237,0.2);transform:scale(1.05); }
#tb-nav-3dot.open span:nth-child(1){ transform:translateY(6px) rotate(45deg); }
#tb-nav-3dot.open span:nth-child(2){ opacity:0;transform:scaleX(0); }
#tb-nav-3dot.open span:nth-child(3){ transform:translateY(-6px) rotate(-45deg); }

#tb-brand {
  font-family:'Syne',sans-serif;font-size:1rem;font-weight:800;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  letter-spacing:-0.5px;flex:1;
}
#tb-brand span { font-size:0.6rem;color:var(--muted);-webkit-text-fill-color:var(--muted);font-family:'Space Mono',monospace;display:block;letter-spacing:2px; }

#tb-widgets-row {
  display:flex;gap:8px;align-items:center;flex-shrink:0;
}

/* Hyprland pill widget */
.hypr-widget {
  display:flex;align-items:center;gap:8px;
  background:rgba(19,19,26,0.9);
  border:1px solid rgba(124,58,237,0.2);
  border-radius:20px;padding:5px 14px;
  cursor:pointer;transition:all 0.25s;
  backdrop-filter:blur(12px);position:relative;
}
.hypr-widget:hover {
  border-color:rgba(124,58,237,0.5);
  background:rgba(124,58,237,0.12);
  transform:translateY(-1px);
  box-shadow:0 4px 20px rgba(124,58,237,0.2);
}
.hypr-widget .w-icon { font-size:0.85rem;flex-shrink:0; }
.hypr-widget .w-main { font-family:'Space Mono',monospace;font-size:0.78rem;font-weight:700;color:var(--text);line-height:1.2; }
.hypr-widget .w-sub { font-size:0.58rem;color:var(--muted);line-height:1; }
.hypr-widget .w-dot {
  width:6px;height:6px;border-radius:50%;
  background:var(--success);box-shadow:0 0 6px var(--success);
  flex-shrink:0;animation:wdotPulse 2s ease-in-out infinite;
}
@keyframes wdotPulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

/* Widget dropdown popup */
.widget-popup {
  position:absolute;top:calc(100% + 10px);right:0;
  background:rgba(13,13,20,0.95);
  border:1px solid rgba(124,58,237,0.3);
  border-radius:14px;padding:16px;
  min-width:240px;z-index:9100;
  backdrop-filter:blur(20px);
  box-shadow:0 20px 60px rgba(0,0,0,0.6);
  transform-origin:top right;
  animation:widgetPop 0.22s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes widgetPop { from{opacity:0;transform:scale(0.85) translateY(-8px)} to{opacity:1;transform:scale(1) translateY(0)} }
.widget-popup h4 { font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:12px; }
.tz-btn {
  display:flex;justify-content:space-between;align-items:center;
  padding:8px 12px;border-radius:8px;cursor:pointer;
  transition:all 0.15s;border:1px solid transparent;margin-bottom:4px;
}
.tz-btn:hover { background:rgba(124,58,237,0.12);border-color:rgba(124,58,237,0.3); }
.tz-btn.active { background:rgba(124,58,237,0.2);border-color:rgba(124,58,237,0.5); }
.tz-btn .tz-name { font-size:0.73rem;font-weight:700;color:var(--text); }
.tz-btn .tz-time { font-family:'Space Mono',monospace;font-size:0.7rem;color:var(--accent2); }
.w-input-row { display:flex;gap:6px;margin-top:8px; }
.w-input-row input { flex:1;font-size:0.72rem;padding:7px 10px; }
.w-input-row button { padding:7px 12px;font-size:0.7rem;flex-shrink:0; }

/* ‚îÄ‚îÄ NAV SIDE PANEL ‚îÄ‚îÄ */
#tb-nav-panel {
  position:fixed;top:54px;left:0;bottom:0;width:260px;
  background:rgba(9,9,16,0.96);
  border-right:1px solid rgba(124,58,237,0.15);
  z-index:8980;padding:20px 0;overflow-y:auto;
  transform:translateX(-100%);
  transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);
  backdrop-filter:blur(20px);
}
#tb-nav-panel.open { transform:translateX(0); }
#tb-nav-panel h3 {
  font-size:0.58rem;color:var(--muted);text-transform:uppercase;
  letter-spacing:2.5px;padding:10px 20px 6px;
}
.nav-cat-btn {
  display:flex;align-items:center;gap:10px;
  width:100%;padding:9px 20px;background:none;
  border:none;color:var(--muted);cursor:pointer;
  font-family:'Space Mono',monospace;font-size:0.72rem;
  transition:all 0.15s;text-align:left;
}
.nav-cat-btn:hover { color:var(--text);background:rgba(124,58,237,0.08); }
.nav-cat-btn.active { color:var(--accent2);background:rgba(124,58,237,0.12);border-left:2px solid var(--accent); }
.nav-cat-btn .cat-icon { font-size:1rem;width:24px;flex-shrink:0; }
.nav-cat-btn .cat-count { margin-left:auto;font-size:0.6rem;color:var(--muted);background:rgba(255,255,255,0.06);padding:2px 6px;border-radius:10px; }
#tb-nav-overlay {
  position:fixed;inset:0;top:54px;z-index:8970;background:rgba(0,0,0,0.4);
  opacity:0;pointer-events:none;transition:opacity 0.3s;backdrop-filter:blur(2px);
}
#tb-nav-overlay.open { opacity:1;pointer-events:all; }

/* ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ */
#tb-home {
  padding-top:68px;min-height:100vh;
  animation:homeIn 0.4s ease both;
}
@keyframes homeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
body.tool-fullscreen #tb-home { display:none; }
#tb-home.nav-open { margin-left:260px;transition:margin-left 0.3s cubic-bezier(0.4,0,0.2,1); }

/* Search bar */
#tb-search-wrap {
  max-width:640px;margin:0 auto 24px;padding:0 20px;
}
#tb-home-search {
  width:100%;background:rgba(19,19,26,0.8);
  border:1px solid rgba(124,58,237,0.2);
  border-radius:14px;padding:12px 18px 12px 46px;
  font-family:'Space Mono',monospace;font-size:0.82rem;
  color:var(--text);outline:none;
  transition:all 0.25s;
  backdrop-filter:blur(10px);
}
#tb-home-search:focus { border-color:rgba(124,58,237,0.5);box-shadow:0 0 0 3px rgba(124,58,237,0.1); }
#tb-search-icon {
  position:absolute;left:34px;top:50%;transform:translateY(-50%);
  color:var(--muted);font-size:0.85rem;pointer-events:none;
}
#tb-search-wrap { position:relative; }

/* Category filter pills */
#tb-cat-filter {
  display:flex;gap:8px;padding:0 20px 20px;
  overflow-x:auto;scrollbar-width:none;flex-wrap:nowrap;
  max-width:1140px;margin:0 auto;
}
#tb-cat-filter::-webkit-scrollbar { display:none; }
.cat-pill {
  padding:5px 14px;border-radius:20px;font-size:0.68rem;font-family:'Space Mono',monospace;
  font-weight:700;cursor:pointer;white-space:nowrap;
  background:rgba(19,19,26,0.8);border:1px solid rgba(255,255,255,0.08);
  color:var(--muted);transition:all 0.2s;text-transform:uppercase;letter-spacing:0.8px;
}
.cat-pill:hover { border-color:rgba(124,58,237,0.4);color:var(--accent2); }
.cat-pill.active {
  background:rgba(124,58,237,0.2);border-color:var(--accent);
  color:var(--text);box-shadow:0 0 12px rgba(124,58,237,0.2);
}

/* Tool card grid */
#tb-cards-area {
  max-width:1140px;margin:0 auto;padding:0 20px 80px;
}
.tb-section { margin-bottom:32px; }
.tb-section-title {
  font-family:'Syne',sans-serif;font-size:0.72rem;font-weight:800;
  color:var(--muted);text-transform:uppercase;letter-spacing:3px;
  margin-bottom:14px;display:flex;align-items:center;gap:10px;
}
.tb-section-title::after {
  content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(124,58,237,0.3),transparent);
}
.tb-cards-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:10px;
}

/* Tool card */
.tool-card {
  position:relative;padding:16px 14px 14px;
  background:rgba(19,19,26,0.7);
  border:1px solid rgba(255,255,255,0.06);
  border-radius:14px;cursor:pointer;
  transition:all 0.25s cubic-bezier(0.34,1.2,0.64,1);
  backdrop-filter:blur(8px);overflow:hidden;
  animation:cardIn 0.4s ease both;
}
.tool-card::before {
  content:'';position:absolute;inset:0;
  background:radial-gradient(circle at 50% 0%,var(--card-color,rgba(124,58,237,0.12)) 0%,transparent 70%);
  opacity:0;transition:opacity 0.3s;border-radius:inherit;
}
.tool-card:hover {
  transform:translateY(-4px) scale(1.02);
  border-color:rgba(124,58,237,0.35);
  box-shadow:0 12px 40px rgba(0,0,0,0.4),0 0 20px var(--card-glow,rgba(124,58,237,0.15));
}
.tool-card:hover::before { opacity:1; }
.tool-card:active { transform:translateY(-1px) scale(0.99); }
@keyframes cardIn {
  from{opacity:0;transform:translateY(16px) scale(0.95)}
  to{opacity:1;transform:translateY(0) scale(1)}
}
.tc-icon { font-size:1.6rem;margin-bottom:10px;display:block; }
.tc-name {
  font-family:'Syne',sans-serif;font-size:0.76rem;font-weight:700;
  color:var(--text);margin-bottom:4px;line-height:1.3;
}
.tc-desc {
  font-size:0.6rem;color:var(--muted);line-height:1.4;
}
.tc-badge {
  position:absolute;top:8px;right:8px;
  font-size:0.52rem;padding:2px 6px;border-radius:8px;
  background:rgba(124,58,237,0.3);color:var(--accent2);
  font-family:'Space Mono',monospace;
}
.tool-card.ai-card { --card-color:rgba(6,182,212,0.12);--card-glow:rgba(6,182,212,0.15); }
.tool-card.security-card { --card-color:rgba(245,158,11,0.12);--card-glow:rgba(245,158,11,0.15); }
.tool-card.design-card { --card-color:rgba(236,72,153,0.12);--card-glow:rgba(236,72,153,0.15); }
.tool-card.productivity-card { --card-color:rgba(16,185,129,0.12);--card-glow:rgba(16,185,129,0.15); }

/* Search highlight */
.tool-card.hidden-card { display:none; }

/* ‚îÄ‚îÄ FULLSCREEN tweaks ‚îÄ‚îÄ */
body.tool-fullscreen #tb-back-bar { display:flex!important; }

/* stagger animation untuk cards */
.tb-cards-grid .tool-card:nth-child(1){animation-delay:0.02s}
.tb-cards-grid .tool-card:nth-child(2){animation-delay:0.04s}
.tb-cards-grid .tool-card:nth-child(3){animation-delay:0.06s}
.tb-cards-grid .tool-card:nth-child(4){animation-delay:0.08s}
.tb-cards-grid .tool-card:nth-child(5){animation-delay:0.1s}
.tb-cards-grid .tool-card:nth-child(6){animation-delay:0.12s}
.tb-cards-grid .tool-card:nth-child(7){animation-delay:0.14s}
.tb-cards-grid .tool-card:nth-child(8){animation-delay:0.16s}

</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê HYPRLAND TOPBAR ‚ïê‚ïê‚ïê -->
<div id="hy-topbar">
  <button id="hy-menu-btn" onclick="hyToggleMenu()" title="Menu Tools">
    <span></span><span></span><span></span>
  </button>
  <div id="hy-title">‚ö° TOOLBOX</div>
  <!-- Clock Widget -->
  <div class="hy-widget" id="hy-clock-widget" onclick="hyToggleWidget('clock')">
    <span class="hy-widget-icon">üïê</span>
    <div><div class="hy-widget-text" id="hy-clock-time">--:--</div><div class="hy-widget-sub" id="hy-clock-zone">WIB</div></div>
  </div>
  <!-- Weather Widget (no cuaca tab) -->
  <div class="hy-widget" id="hy-weather-widget" onclick="hyToggleWidget('weather')">
    <span class="hy-widget-icon" id="hy-wx-icon">üå§Ô∏è</span>
    <div><div class="hy-widget-text" id="hy-wx-temp">--¬∞C</div><div class="hy-widget-sub" id="hy-wx-city">Jakarta</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê FLYOUT NAV MENU ‚ïê‚ïê‚ïê -->
<div id="hy-nav-menu">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding:0 4px;">
    <div style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;font-weight:700;color:var(--text);">‚ö° Tools Menu</div>
    <button onclick="hyToggleMenu()" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.9rem;">‚úï</button>
  </div>
  <div style="position:relative;margin-bottom:10px;">
    <input id="hy-nav-search" placeholder="Cari tool..." style="border-radius:20px;padding:7px 12px 7px 32px;font-size:0.72rem;width:100%;" oninput="hyNavSearch(this.value)">
    <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:0.75rem;">üîç</span>
  </div>
  <div id="hy-nav-content">
    <div class="hy-nav-section">
      <div class="hy-nav-section-title">üìã Teks & Kode</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('text')">
          <span class="icon">üìù</span>
          <span class="label">Text Analyzer<small>Analisis & konversi teks</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('password')">
          <span class="icon">üîê</span>
          <span class="label">Password Gen<small>Generate password kuat</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('base64')">
          <span class="icon">üîÑ</span>
          <span class="label">Base64<small>Encode & decode</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('json')">
          <span class="icon">üì¶</span>
          <span class="label">JSON Tools<small>Format & validasi JSON</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('regex')">
          <span class="icon">üîç</span>
          <span class="label">Regex Tester<small>Test ekspresi reguler</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('markdown')">
          <span class="icon">üìÑ</span>
          <span class="label">Markdown<small>Preview markdown live</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('minifier')">
          <span class="icon">üóúÔ∏è</span>
          <span class="label">Minifier<small>Compress HTML/CSS/JS</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('snippet')">
          <span class="icon">üíª</span>
          <span class="label">Snippet<small>Simpan kode snippet</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('cipher')">
          <span class="icon">üîê</span>
          <span class="label">Cipher<small>Enkripsi teks</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('ascii')">
          <span class="icon">üñãÔ∏è</span>
          <span class="label">ASCII Art<small>Generator ASCII art</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üî¢ Konversi</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('hash')">
          <span class="icon">üîë</span>
          <span class="label">Hash<small>SHA256, MD5, dll</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('numSys')">
          <span class="icon">üî¢</span>
          <span class="label">Bilangan<small>Biner, hex, oktal</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('unit')">
          <span class="icon">üìè</span>
          <span class="label">Unit<small>Konversi satuan</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('color')">
          <span class="icon">üé®</span>
          <span class="label">Color<small>HEX, RGB, HSL</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('time')">
          <span class="icon">‚è∞</span>
          <span class="label">Timestamp<small>Unix timestamp</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('aspect')">
          <span class="icon">üìê</span>
          <span class="label">Aspek Rasio<small>Hitung aspek rasio</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üì° Generate</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('qr')">
          <span class="icon">üì∑</span>
          <span class="label">QR Code<small>Buat QR code</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('gradient')">
          <span class="icon">üåà</span>
          <span class="label">Gradient<small>CSS gradient</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('glass')">
          <span class="icon">ü™ü</span>
          <span class="label">Glassmorphism<small>CSS glass effect</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('noise')">
          <span class="icon">üåä</span>
          <span class="label">Noise<small>Background noise</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('fakedata')">
          <span class="icon">üîÆ</span>
          <span class="label">Fake Data<small>Data dummy</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('palette')">
          <span class="icon">üé®</span>
          <span class="label">Palette<small>Generate color palette</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('random')">
          <span class="icon">üé≤</span>
          <span class="label">Random<small>UUID, angka, dll</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üñºÔ∏è Media</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('imgcomp')">
          <span class="icon">üñºÔ∏è</span>
          <span class="label">Kompres<small>Kompres gambar</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('meme')">
          <span class="icon">üñºÔ∏è</span>
          <span class="label">Meme Maker<small>Buat meme</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('videogif')">
          <span class="icon">üé¨</span>
          <span class="label">Video‚ÜíGIF<small>Konversi video ke GIF</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('ocr')">
          <span class="icon">üì∏</span>
          <span class="label">OCR<small>Baca teks dari gambar</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('mockup')">
          <span class="icon">üì±</span>
          <span class="label">Mockup<small>Device mockup</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('imgEditor')">
          <span class="icon">üñºÔ∏è</span>
          <span class="label">Image Editor<small>Edit & filter gambar</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('svgEditor')">
          <span class="icon">üé®</span>
          <span class="label">SVG Editor<small>Buat & edit SVG</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('annotator')">
          <span class="icon">üì∏</span>
          <span class="label">Annotator<small>Anotasi screenshot</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üîä Audio</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('tts')">
          <span class="icon">üé§</span>
          <span class="label">TTS<small>Text to speech</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('bpm')">
          <span class="icon">üéµ</span>
          <span class="label">BPM Counter<small>Ketuk tempo lagu</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('morse')">
          <span class="icon">üéµ</span>
          <span class="label">Morse<small>Kode morse</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('audioviz')">
          <span class="icon">üéµ</span>
          <span class="label">Audio Viz<small>Visualizer audio</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('playlist')">
          <span class="icon">üéµ</span>
          <span class="label">Playlist<small>Buat playlist fokus</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üßÆ Hitung</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('calc')">
          <span class="icon">üßÆ</span>
          <span class="label">Kalkulator<small>Kalkulator saintifik</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('ageCalc')">
          <span class="icon">üßÆ</span>
          <span class="label">Hitung Umur<small>Kalkulator umur</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('currency')">
          <span class="icon">üí±</span>
          <span class="label">Kurs<small>Konversi mata uang</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('formula')">
          <span class="icon">üßÆ</span>
          <span class="label">Formula<small>Builder rumus matematika</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">‚è±Ô∏è Waktu</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('timer')">
          <span class="icon">‚è±Ô∏è</span>
          <span class="label">Timer<small>Stopwatch & hitung mundur</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('worldclock')">
          <span class="icon">üåç</span>
          <span class="label">World Clock<small>Jam dunia</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('pomodoro')">
          <span class="icon">üéØ</span>
          <span class="label">Pomodoro<small>Timer Pomodoro</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('focus')">
          <span class="icon">‚è∞</span>
          <span class="label">Focus Mode<small>Mode fokus penuh</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('calendar')">
          <span class="icon">üìÖ</span>
          <span class="label">Kalender<small>Kalender interaktif</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('reminder')">
          <span class="icon">üîî</span>
          <span class="label">Reminder<small>Set reminder</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üìã Produktivitas</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('todo')">
          <span class="icon">üìã</span>
          <span class="label">To-Do<small>Daftar tugas</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('notepad')">
          <span class="icon">üóíÔ∏è</span>
          <span class="label">Notepad<small>Catatan cepat</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('habit')">
          <span class="icon">üéØ</span>
          <span class="label">Habit Tracker<small>Lacak kebiasaan</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('budget')">
          <span class="icon">üí∞</span>
          <span class="label">Budget<small>Lacak keuangan</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('flashcard')">
          <span class="icon">üìñ</span>
          <span class="label">Flashcard<small>Kartu belajar</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('weeklyPlanner')">
          <span class="icon">üóìÔ∏è</span>
          <span class="label">Weekly Planner<small>Jadwal mingguan</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('expenseTracker')">
          <span class="icon">üìà</span>
          <span class="label">Expense Tracker<small>Lacak pengeluaran</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">ü§ñ AI Tools</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('translate')">
          <span class="icon">üåê</span>
          <span class="label">Translate<small>Terjemah 20+ bahasa</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('summarizer')">
          <span class="icon">üß†</span>
          <span class="label">AI Summarizer<small>Ringkas artikel</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('aiwriting')">
          <span class="icon">‚úçÔ∏è</span>
          <span class="label">AI Writing<small>Bantu nulis konten</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('aicode')">
          <span class="icon">üêõ</span>
          <span class="label">AI Code Review<small>Review kode kamu</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('aitranslator')">
          <span class="icon">üåê</span>
          <span class="label">AI Translator Pro<small>Terjemah + nuansa budaya</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('aigoal')">
          <span class="icon">üéØ</span>
          <span class="label">AI Goal Planner<small>Buat rencana goals</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('aihelp')">
          <span class="icon">ü§ñ</span>
          <span class="label">AI Assistant<small>Asisten AI serbaguna</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üîí Keamanan</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('vault')">
          <span class="icon">üîê</span>
          <span class="label">Password Vault<small>Simpan password AES</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('emailtpl')">
          <span class="icon">üìß</span>
          <span class="label">Email Template<small>Template email profesional</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üìù Buat</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('resume')">
          <span class="icon">üìù</span>
          <span class="label">Resume Builder<small>Buat CV keren</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('biolink')">
          <span class="icon">üîó</span>
          <span class="label">Bio Link Page<small>Halaman link Linktree</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üìä Data</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('chartgen')">
          <span class="icon">üìä</span>
          <span class="label">Chart Gen<small>Generate grafik</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('csv')">
          <span class="icon">üìä</span>
          <span class="label">CSV‚ÜíTabel<small>Tabel dari CSV</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('dataviz')">
          <span class="icon">üìä</span>
          <span class="label">Data Viz<small>Visualisasi data CSV/JSON</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('apiTester')">
          <span class="icon">üîÑ</span>
          <span class="label">API Tester<small>Test REST API</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('mindmap')">
          <span class="icon">üß†</span>
          <span class="label">Mindmap<small>Peta pikiran</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('dashboard')">
          <span class="icon">üìä</span>
          <span class="label">Dashboard<small>Analitik penggunaan</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üé® Desain</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('fontprev')">
          <span class="icon">üî§</span>
          <span class="label">Font Preview<small>Preview Google Fonts</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('theme')">
          <span class="icon">üé®</span>
          <span class="label">Theme<small>Kustomisasi tampilan</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('urlqr')">
          <span class="icon">üåê</span>
          <span class="label">URL+QR<small>URL + QR combo</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">üéÆ Hiburan</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('games')">
          <span class="icon">üéÆ</span>
          <span class="label">Games<small>Snake, Flappy, 2048</small></span>
        </button></div></div><div class="hy-nav-section">
      <div class="hy-nav-section-title">‚öôÔ∏è Lainnya</div>
      <div class="hy-nav-grid"><button class="hy-nav-btn" onclick="hyOpenTool('about')">
          <span class="icon">üë§</span>
          <span class="label">Tentang<small>Tentang Toolbox</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('i18n')">
          <span class="icon">üåç</span>
          <span class="label">Bahasa<small>Ganti bahasa UI</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('share')">
          <span class="icon">üîó</span>
          <span class="label">Share<small>Bagikan Toolbox</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('settings')">
          <span class="icon">üì¶</span>
          <span class="label">Settings<small>Export/import settings</small></span>
        </button><button class="hy-nav-btn" onclick="hyOpenTool('plugins')">
          <span class="icon">üß©</span>
          <span class="label">Plugins<small>Tambah plugin custom</small></span>
        </button></div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê CLOCK WIDGET POPUP ‚ïê‚ïê‚ïê -->
<div class="hy-widget-popup" id="hy-popup-clock" style="top:62px;right:20px;">
  <div style="font-size:0.65rem;text-transform:uppercase;letter-spacing:2px;color:var(--accent2);margin-bottom:12px;font-family:'JetBrains Mono',monospace;">üïê Jam & Zona Waktu</div>
  <div id="hy-clock-zones" style="display:flex;flex-direction:column;gap:6px;"></div>
  <div style="margin-top:14px;border-top:1px solid var(--hy-border);padding-top:12px;">
    <div style="font-size:0.62rem;color:var(--muted);margin-bottom:6px;">Tambah kota:</div>
    <div style="display:flex;gap:6px;">
      <input id="hy-clock-add" placeholder="cth: Tokyo, New York..." style="flex:1;font-size:0.72rem;padding:7px 10px;border-radius:8px;">
      <button onclick="hyAddClockZone()" class="btn btn-primary" style="padding:7px 12px;font-size:0.68rem;">+</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê WEATHER WIDGET POPUP ‚ïê‚ïê‚ïê -->
<div class="hy-widget-popup" id="hy-popup-weather" style="top:62px;right:20px;">
  <div style="font-size:0.65rem;text-transform:uppercase;letter-spacing:2px;color:var(--accent2);margin-bottom:12px;font-family:'JetBrains Mono',monospace;">üå§Ô∏è Cuaca</div>
  <div id="hy-weather-detail" style="margin-bottom:12px;"></div>
  <div style="border-top:1px solid var(--hy-border);padding-top:12px;">
    <div style="font-size:0.62rem;color:var(--muted);margin-bottom:6px;">Ganti kota:</div>
    <div style="display:flex;gap:6px;">
      <input id="hy-wx-input" placeholder="Jakarta, London..." style="flex:1;font-size:0.72rem;padding:7px 10px;border-radius:8px;" onkeydown="if(event.key==='Enter')hyFetchWeather()">
      <button onclick="hyFetchWeather()" class="btn btn-primary" style="padding:7px 12px;font-size:0.68rem;">Go</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê BACK BAR (fullscreen mode) ‚ïê‚ïê‚ïê -->
<div id="tb-back-bar" style="display:none;position:fixed;top:0;left:0;right:0;z-index:8999;padding:10px 18px;background:rgba(10,10,15,0.92);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid rgba(124,58,237,0.3);align-items:center;gap:14px;">
  <button id="tb-back-btn" onclick="swBack()" style="background:rgba(124,58,237,0.15);border:1px solid rgba(124,58,237,0.4);color:var(--accent2);padding:7px 16px;font-family:'Space Mono',monospace;font-size:0.72rem;cursor:pointer;border-radius:6px;transition:all 0.2s;display:flex;align-items:center;gap:6px;">‚Üê Kembali</button>
  <div id="tb-back-title" style="font-size:0.82rem;font-weight:700;color:var(--text);flex:1;"></div>
  <div style="font-size:0.65rem;color:var(--muted);">ESC untuk kembali</div>
</div>

<!-- ‚ïê‚ïê‚ïê HOME SCREEN ‚ïê‚ïê‚ïê -->
<div id="hy-home">
  <div id="hy-home-hero">
    <h1>‚ö° TOOLBOX</h1>
    <p>All-in-one tools ‚Ä¢ gratis ‚Ä¢ browser-only ‚Ä¢ by Adam</p>
  </div>
  <div id="hy-search-wrap">
    <span id="hy-search-icon">üîç</span>
    <input id="hy-search" placeholder="Cari tool... (ketik nama atau fungsi)" oninput="hySearch(this.value)">
  </div>

  <div id="hy-search-results" style="display:none;margin-bottom:20px;">
    <div class="hy-section-heading">Hasil Pencarian</div>
    <div class="hy-tools-grid" id="hy-search-grid"></div>
  </div>

  <div id="hy-featured-section">
    <div class="hy-section-heading">‚≠ê Tools Populer</div>
    <div class="hy-tools-grid"><div class="hy-tool-card" onclick="hyOpenTool('text')" style="animation-delay:0ms">
      <span class="hy-card-icon">üìù</span>
      <div class="hy-card-label">Text Analyzer</div>
      <div class="hy-card-tag">Teks</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('password')" style="animation-delay:30ms">
      <span class="hy-card-icon">üîê</span>
      <div class="hy-card-label">Password</div>
      <div class="hy-card-tag">Keamanan</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('json')" style="animation-delay:60ms">
      <span class="hy-card-icon">üì¶</span>
      <div class="hy-card-label">JSON Tools</div>
      <div class="hy-card-tag">Dev</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('calc')" style="animation-delay:90ms">
      <span class="hy-card-icon">üßÆ</span>
      <div class="hy-card-label">Kalkulator</div>
      <div class="hy-card-tag">Hitung</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('qr')" style="animation-delay:120ms">
      <span class="hy-card-icon">üì∑</span>
      <div class="hy-card-label">QR Code</div>
      <div class="hy-card-tag">Generate</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('color')" style="animation-delay:150ms">
      <span class="hy-card-icon">üé®</span>
      <div class="hy-card-label">Color</div>
      <div class="hy-card-tag">Desain</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('todo')" style="animation-delay:180ms">
      <span class="hy-card-icon">üìã</span>
      <div class="hy-card-label">To-Do</div>
      <div class="hy-card-tag">Produktif</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('hash')" style="animation-delay:210ms">
      <span class="hy-card-icon">üîë</span>
      <div class="hy-card-label">Hash</div>
      <div class="hy-card-tag">Crypto</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('translate')" style="animation-delay:240ms">
      <span class="hy-card-icon">üåê</span>
      <div class="hy-card-label">Translate</div>
      <div class="hy-card-tag">AI</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('regex')" style="animation-delay:270ms">
      <span class="hy-card-icon">üîç</span>
      <div class="hy-card-label">Regex</div>
      <div class="hy-card-tag">Dev</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('timer')" style="animation-delay:300ms">
      <span class="hy-card-icon">‚è±Ô∏è</span>
      <div class="hy-card-label">Timer</div>
      <div class="hy-card-tag">Waktu</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('vault')" style="animation-delay:330ms">
      <span class="hy-card-icon">üîê</span>
      <div class="hy-card-label">Vault</div>
      <div class="hy-card-tag">Aman</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('imgcomp')" style="animation-delay:360ms">
      <span class="hy-card-icon">üñºÔ∏è</span>
      <div class="hy-card-label">Kompres</div>
      <div class="hy-card-tag">Media</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('summarizer')" style="animation-delay:390ms">
      <span class="hy-card-icon">üß†</span>
      <div class="hy-card-label">AI Ringkas</div>
      <div class="hy-card-tag">AI</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('aiwriting')" style="animation-delay:420ms">
      <span class="hy-card-icon">‚úçÔ∏è</span>
      <div class="hy-card-label">AI Write</div>
      <div class="hy-card-tag">AI</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('aicode')" style="animation-delay:450ms">
      <span class="hy-card-icon">üêõ</span>
      <div class="hy-card-label">AI Code</div>
      <div class="hy-card-tag">AI</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('resume')" style="animation-delay:480ms">
      <span class="hy-card-icon">üìù</span>
      <div class="hy-card-label">Resume</div>
      <div class="hy-card-tag">Buat</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('biolink')" style="animation-delay:510ms">
      <span class="hy-card-icon">üîó</span>
      <div class="hy-card-label">Bio Link</div>
      <div class="hy-card-tag">Share</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('dataviz')" style="animation-delay:540ms">
      <span class="hy-card-icon">üìä</span>
      <div class="hy-card-label">Data Viz</div>
      <div class="hy-card-tag">Data</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('apiTester')" style="animation-delay:570ms">
      <span class="hy-card-icon">üîÑ</span>
      <div class="hy-card-label">API Test</div>
      <div class="hy-card-tag">Dev</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('games')" style="animation-delay:600ms">
      <span class="hy-card-icon">üéÆ</span>
      <div class="hy-card-label">Games</div>
      <div class="hy-card-tag">Fun</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('focus')" style="animation-delay:630ms">
      <span class="hy-card-icon">‚è∞</span>
      <div class="hy-card-label">Focus</div>
      <div class="hy-card-tag">Produktif</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('expenseTracker')" style="animation-delay:660ms">
      <span class="hy-card-icon">üìà</span>
      <div class="hy-card-label">Expenses</div>
      <div class="hy-card-tag">Uang</div>
    </div><div class="hy-tool-card" onclick="hyOpenTool('weeklyPlanner')" style="animation-delay:690ms">
      <span class="hy-card-icon">üóìÔ∏è</span>
      <div class="hy-card-label">Planner</div>
      <div class="hy-card-tag">Jadwal</div>
    </div></div>
  </div>
</div>

<div class="container">

  <!-- TEXT -->
  <div id="tab-text" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Text Analyzer & Converter</div>
      <div class="panel-desc">// Hitung & ubah format teks</div>
      <label>Masukkan Teks</label>
      <textarea id="text-input" placeholder="Ketik atau paste teks..." oninput="analyzeText()"></textarea>
      <div class="stats-row">
        <div class="stat-chip">Karakter: <span id="sc">0</span></div>
        <div class="stat-chip">Kata: <span id="sw2">0</span></div>
        <div class="stat-chip">Kalimat: <span id="ss">0</span></div>
        <div class="stat-chip">Baris: <span id="sl">0</span></div>
        <div class="stat-chip">No Spasi: <span id="sn">0</span></div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="cvCase('upper')">UPPERCASE</button>
        <button class="btn btn-primary" onclick="cvCase('lower')">lowercase</button>
        <button class="btn btn-primary" onclick="cvCase('title')">Title Case</button>
        <button class="btn btn-secondary" onclick="cvCase('reverse')">esreveR</button>
        <button class="btn btn-secondary" onclick="cvCase('trim')">Trim Spasi</button>
        <button class="btn btn-secondary" onclick="cvCase('slug')">slug-case</button>
      </div>
      <div class="output-box" id="text-out">‚Äî<button class="copy-btn" onclick="cpOut('text-out')">COPY</button></div>
    </div>
  </div>

  <!-- PASSWORD -->
  <div id="tab-password" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Password Generator</div>
      <div class="panel-desc">// Buat password kuat secara kriptografis aman</div>
      <label>Panjang: <span id="pld">16</span> karakter</label>
      <input type="range" id="plen" min="6" max="128" value="16" oninput="document.getElementById('pld').textContent=this.value;genPass()">
      <div class="toggle-row"><input type="checkbox" id="pu" checked onchange="genPass()"> Huruf Besar (A-Z)</div>
      <div class="toggle-row"><input type="checkbox" id="pl" checked onchange="genPass()"> Huruf Kecil (a-z)</div>
      <div class="toggle-row"><input type="checkbox" id="pn" checked onchange="genPass()"> Angka (0-9)</div>
      <div class="toggle-row"><input type="checkbox" id="ps" onchange="genPass()"> Simbol (!@#$...)</div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="genPass()">üé≤ Generate</button>
        <button class="btn btn-secondary" onclick="genPassMulti()">Generate 5x</button>
      </div>
      <div class="output-box" id="pass-out">‚Äî<button class="copy-btn" onclick="cpOut('pass-out')">COPY</button></div>
      <div class="strength-bar"><div class="strength-fill" id="sfill" style="width:0%"></div></div>
      <div style="margin-top:5px;font-size:0.72rem;color:var(--muted)" id="slabel"></div>
    </div>
  </div>

  <!-- BASE64 -->
  <div id="tab-base64" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Base64 & URL Encoder</div>
      <div class="panel-desc">// Encode & decode Base64 dan URL</div>
      <label>Input</label>
      <textarea id="b64-in" placeholder="Teks atau Base64..."></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="b64('encode')">Encode ‚Üí Base64</button>
        <button class="btn btn-cyan" onclick="b64('decode')">Decode ‚Üê Base64</button>
        <button class="btn btn-secondary" onclick="b64('url-enc')">URL Encode</button>
        <button class="btn btn-secondary" onclick="b64('url-dec')">URL Decode</button>
      </div>
      <div class="output-box" id="b64-out">‚Äî<button class="copy-btn" onclick="cpOut('b64-out')">COPY</button></div>
    </div>
  </div>

  <!-- JSON -->
  <div id="tab-json" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">JSON Formatter & Validator</div>
      <div class="panel-desc">// Format, minify, validasi JSON</div>
      <textarea id="json-in" placeholder='{"nama":"Adam","ganteng":true}' style="min-height:160px;"></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="fmtJson('pretty')">‚ú® Beautify</button>
        <button class="btn btn-secondary" onclick="fmtJson('minify')">Minify</button>
        <button class="btn btn-secondary" onclick="fmtJson('validate')">Validasi</button>
        <button class="btn btn-secondary" onclick="fmtJson('keys')">Keys</button>
      </div>
      <div class="output-box" id="json-out" style="min-height:120px;">‚Äî<button class="copy-btn" onclick="cpOut('json-out')">COPY</button></div>
    </div>
  </div>

  <!-- COLOR -->
  <div id="tab-color" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Color Converter</div>
      <div class="panel-desc">// Konversi HEX, RGB, HSL</div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:8px;">
        <input type="color" id="cpicker" value="#7c3aed" oninput="fromPicker()">
        <input type="text" id="chex" value="#7c3aed" style="width:160px" oninput="fromHex()">
        <button class="btn btn-cyan" onclick="randColor()">üé≤ Random</button>
      </div>
      <div id="cpreview" style="height:80px;border-radius:8px;margin-top:14px;border:1px solid var(--border);background:#7c3aed;transition:background 0.3s;"></div>
      <div class="stats-row">
        <div class="stat-chip">HEX: <span id="cvhex">#7c3aed</span></div>
        <div class="stat-chip">RGB: <span id="cvrgb">rgb(124,58,237)</span></div>
        <div class="stat-chip">HSL: <span id="cvhsl">hsl(262,84%,58%)</span></div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="copyText(document.getElementById('cvhex').textContent)">Copy HEX</button>
        <button class="btn btn-secondary" onclick="copyText(document.getElementById('cvrgb').textContent)">Copy RGB</button>
        <button class="btn btn-secondary" onclick="copyText(document.getElementById('cvhsl').textContent)">Copy HSL</button>
      </div>
    </div>
  </div>

  <!-- UNIT -->
  <div id="tab-unit" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Unit Converter</div>
      <div class="panel-desc">// Konversi berbagai satuan</div>
      <label>Kategori</label>
      <select id="ucat" onchange="updateUnits()">
        <option value="length">Panjang</option><option value="weight">Berat</option>
        <option value="temp">Suhu</option><option value="area">Luas</option>
        <option value="speed">Kecepatan</option><option value="data">Data Digital</option>
      </select>
      <div class="grid-2" style="margin-top:14px;">
        <div><label>Dari</label><select id="ufrom"></select><input type="number" id="uval" value="1" oninput="cvUnit()" style="margin-top:8px;"></div>
        <div><label>Ke</label><select id="uto"></select><div class="output-box" id="uout" style="margin-top:8px;min-height:44px;">‚Äî</div></div>
      </div>
      <button class="btn btn-secondary" onclick="swapUnit()" style="margin-top:10px;">‚áÑ Swap</button>
    </div>
  </div>

  <!-- HASH -->
  <div id="tab-hash" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Hash Generator</div>
      <div class="panel-desc">// DJB2, FNV-1a, CRC32, SHA-256</div>
      <textarea id="hash-in" placeholder="Teks untuk di-hash..."></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="doHash('djb2')">DJB2</button>
        <button class="btn btn-primary" onclick="doHash('fnv')">FNV-1a</button>
        <button class="btn btn-cyan" onclick="doHash('sha256')">SHA-256</button>
        <button class="btn btn-secondary" onclick="doHash('crc32')">CRC32</button>
      </div>
      <div class="output-box" id="hash-out">‚Äî<button class="copy-btn" onclick="cpOut('hash-out')">COPY</button></div>
    </div>
  </div>

  <!-- TIME -->
  <div id="tab-time" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Timestamp & Waktu</div>
      <div class="panel-desc">// Konversi Unix timestamp & selisih tanggal</div>
      <div class="stats-row">
        <div class="stat-chip">Unix Now: <span id="tsn">‚Äî</span></div>
        <div class="stat-chip">ISO: <span id="tsiso">‚Äî</span></div>
        <div class="stat-chip">WIB: <span id="tswib">‚Äî</span></div>
      </div>
      <label style="margin-top:20px;">Unix Timestamp ‚Üí Tanggal</label>
      <input type="number" id="tsin" placeholder="1700000000">
      <div class="btn-group">
        <button class="btn btn-primary" onclick="cvTs()">Konversi</button>
        <button class="btn btn-secondary" onclick="document.getElementById('tsin').value=Math.floor(Date.now()/1000)">Sekarang</button>
      </div>
      <div class="output-box" id="ts-out">‚Äî<button class="copy-btn" onclick="cpOut('ts-out')">COPY</button></div>
      <label style="margin-top:20px;">Selisih 2 Tanggal</label>
      <div class="grid-2">
        <div><label>Dari</label><input type="text" id="dfrom" placeholder="2024-01-01"></div>
        <div><label>Sampai</label><input type="text" id="dto" placeholder="2025-01-01"></div>
      </div>
      <div class="btn-group"><button class="btn btn-cyan" onclick="cvDiff()">Hitung</button></div>
      <div class="output-box" id="diff-out">‚Äî</div>
    </div>
  </div>

  <!-- CALCULATOR -->
  <div id="tab-calc" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Kalkulator</div>
      <div class="panel-desc">// Standar, Saintifik, Persen, Cicilan</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;">
        <button class="btn btn-primary" id="cm-std" onclick="setCalcMode('std')">Standar</button>
        <button class="btn btn-secondary" id="cm-sci" onclick="setCalcMode('sci')">Saintifik</button>
        <button class="btn btn-secondary" id="cm-pct" onclick="setCalcMode('pct')">Persen</button>
        <button class="btn btn-secondary" id="cm-loan" onclick="setCalcMode('loan')">Cicilan</button>
      </div>
      <!-- Standard -->
      <div id="calc-std">
        <div id="chist" style="min-height:20px;font-size:0.7rem;color:var(--muted);text-align:right;"></div>
        <div id="cdisp" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 18px;font-size:2rem;text-align:right;color:var(--accent2);margin-bottom:10px;min-height:66px;word-break:break-all;">0</div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:7px;">
          <button class="calc-btn calc-fn" onclick="cFn('AC')">AC</button><button class="calc-btn calc-fn" onclick="cFn('+/-')">+/-</button><button class="calc-btn calc-fn" onclick="cFn('%')">%</button><button class="calc-btn calc-op" onclick="cOp('/')">√∑</button>
          <button class="calc-btn" onclick="cNum('7')">7</button><button class="calc-btn" onclick="cNum('8')">8</button><button class="calc-btn" onclick="cNum('9')">9</button><button class="calc-btn calc-op" onclick="cOp('*')">√ó</button>
          <button class="calc-btn" onclick="cNum('4')">4</button><button class="calc-btn" onclick="cNum('5')">5</button><button class="calc-btn" onclick="cNum('6')">6</button><button class="calc-btn calc-op" onclick="cOp('-')">‚àí</button>
          <button class="calc-btn" onclick="cNum('1')">1</button><button class="calc-btn" onclick="cNum('2')">2</button><button class="calc-btn" onclick="cNum('3')">3</button><button class="calc-btn calc-op" onclick="cOp('+')">+</button>
          <button class="calc-btn" onclick="cNum('0')" style="grid-column:span 2;">0</button><button class="calc-btn" onclick="cNum('.')">.</button><button class="calc-btn calc-eq" onclick="cEq()">=</button>
        </div>
        <div style="text-align:right;margin-top:7px;"><button class="calc-btn calc-fn" onclick="cFn('back')" style="width:auto;padding:7px 18px;">‚å´</button></div>
      </div>
      <!-- Scientific -->
      <div id="calc-sci" style="display:none;">
        <div id="schist" style="min-height:20px;font-size:0.7rem;color:var(--muted);text-align:right;"></div>
        <div id="scdisp" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 18px;font-size:1.7rem;text-align:right;color:var(--accent2);margin-bottom:10px;min-height:66px;">0</div>
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;">
          <button class="calc-btn calc-fn" onclick="scFn('sin')">sin</button><button class="calc-btn calc-fn" onclick="scFn('cos')">cos</button><button class="calc-btn calc-fn" onclick="scFn('tan')">tan</button><button class="calc-btn calc-fn" onclick="scFn('log')">log</button><button class="calc-btn calc-fn" onclick="scFn('ln')">ln</button>
          <button class="calc-btn calc-fn" onclick="scFn('sqrt')">‚àö</button><button class="calc-btn calc-fn" onclick="scFn('pow2')">x¬≤</button><button class="calc-btn calc-fn" onclick="scFn('pow3')">x¬≥</button><button class="calc-btn calc-op" onclick="scOp('**')">x‚Åø</button><button class="calc-btn calc-fn" onclick="scFn('inv')">1/x</button>
          <button class="calc-btn calc-fn" onclick="scFn('pi')">œÄ</button><button class="calc-btn calc-fn" onclick="scFn('e')">e</button><button class="calc-btn calc-fn" onclick="scFn('abs')">|x|</button><button class="calc-btn calc-fn" onclick="scFn('fact')">n!</button><button class="calc-btn calc-fn" onclick="scFn('AC')">AC</button>
          <button class="calc-btn" onclick="scNum('7')">7</button><button class="calc-btn" onclick="scNum('8')">8</button><button class="calc-btn" onclick="scNum('9')">9</button><button class="calc-btn calc-op" onclick="scOp('/')">√∑</button><button class="calc-btn calc-op" onclick="scOp('*')">√ó</button>
          <button class="calc-btn" onclick="scNum('4')">4</button><button class="calc-btn" onclick="scNum('5')">5</button><button class="calc-btn" onclick="scNum('6')">6</button><button class="calc-btn calc-op" onclick="scOp('-')">‚àí</button><button class="calc-btn calc-op" onclick="scOp('+')">+</button>
          <button class="calc-btn" onclick="scNum('1')">1</button><button class="calc-btn" onclick="scNum('2')">2</button><button class="calc-btn" onclick="scNum('3')">3</button><button class="calc-btn" onclick="scNum('0')">0</button><button class="calc-btn" onclick="scNum('.')">.</button>
          <button class="calc-btn calc-fn" onclick="scFn('back')">‚å´</button><button class="calc-btn calc-fn" onclick="scFn('+/-')">+/-</button><button class="calc-btn calc-fn" onclick="scFn('%')">%</button><button class="calc-btn calc-eq" onclick="scEq()" style="grid-column:span 2;">=</button>
        </div>
      </div>
      <!-- Percent -->
      <div id="calc-pct" style="display:none;">
        <div class="grid-2">
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:18px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:12px;">Hitung Diskon</div>
            <label>Harga Asli (Rp)</label><input type="number" id="disc-p" placeholder="100000" oninput="calcDisc()">
            <label>Diskon (%)</label><input type="number" id="disc-pct" placeholder="20" oninput="calcDisc()">
            <div class="output-box" id="disc-out" style="margin-top:10px;">‚Äî</div>
          </div>
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:18px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:12px;">Persentase Perubahan</div>
            <label>Nilai Awal</label><input type="number" id="chg-f" placeholder="80" oninput="calcChg()">
            <label>Nilai Akhir</label><input type="number" id="chg-t" placeholder="100" oninput="calcChg()">
            <div class="output-box" id="chg-out" style="margin-top:10px;">‚Äî</div>
          </div>
        </div>
      </div>
      <!-- Loan -->
      <div id="calc-loan" style="display:none;">
        <div class="grid-2">
          <div><label>Total Pinjaman (Rp)</label><input type="number" id="la" placeholder="500000000" oninput="calcLoan()"></div>
          <div><label>Bunga/Tahun (%)</label><input type="number" id="lr" placeholder="7.5" step="0.1" oninput="calcLoan()"></div>
          <div><label>Tenor (Tahun)</label><input type="number" id="ly" placeholder="15" oninput="calcLoan()"></div>
          <div><label>DP (Rp)</label><input type="number" id="ldp" placeholder="0" oninput="calcLoan()"></div>
        </div>
        <div class="output-box" id="loan-out" style="min-height:100px;">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- TRANSLATE -->
  <div id="tab-translate" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">AI Translator</div>
      <div class="panel-desc">// Powered by Claude AI ‚Äî akurat & natural</div>
      <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:end;margin-bottom:14px;">
        <div><label>Dari</label>
          <select id="tr-from">
            <option value="auto">üîç Deteksi Otomatis</option>
            <option value="Indonesia">Indonesia</option><option value="Inggris">Inggris</option>
            <option value="Jepang">Jepang</option><option value="Korea">Korea</option>
            <option value="Mandarin">Mandarin</option><option value="Arab">Arab</option>
            <option value="Spanyol">Spanyol</option><option value="Prancis">Prancis</option>
            <option value="Jerman">Jerman</option><option value="Hindi">Hindi</option>
            <option value="Thailand">Thailand</option><option value="Vietnam">Vietnam</option>
            <option value="Jawa">Jawa</option><option value="Sunda">Sunda</option>
          </select>
        </div>
        <button class="btn btn-secondary" onclick="swapLang()" style="padding:9px 12px;margin-bottom:0;">‚áÑ</button>
        <div><label>Ke</label>
          <select id="tr-to">
            <option value="Indonesia">Indonesia</option><option value="Inggris" selected>Inggris</option>
            <option value="Jepang">Jepang</option><option value="Korea">Korea</option>
            <option value="Mandarin">Mandarin</option><option value="Arab">Arab</option>
            <option value="Spanyol">Spanyol</option><option value="Prancis">Prancis</option>
            <option value="Jerman">Jerman</option><option value="Hindi">Hindi</option>
            <option value="Thailand">Thailand</option><option value="Vietnam">Vietnam</option>
            <option value="Jawa">Jawa</option><option value="Sunda">Sunda</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div>
          <label>Teks Asli</label>
          <textarea id="tr-in" placeholder="Ketik teks..." style="min-height:180px;" oninput="trCharCount()"></textarea>
          <div style="display:flex;justify-content:space-between;margin-top:6px;"><span id="tr-cc" style="font-size:0.72rem;color:var(--muted);">0 karakter</span><button class="btn btn-secondary" onclick="clearTr()" style="padding:4px 10px;font-size:0.68rem;">Hapus</button></div>
        </div>
        <div>
          <label>Hasil</label>
          <div id="tr-out" class="lang-output" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;min-height:180px;color:var(--accent2);white-space:pre-wrap;word-break:break-word;"><span style="color:var(--muted);font-size:0.78rem;">‚Äî hasil terjemahan ‚Äî</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px;"><span id="tr-det" style="font-size:0.72rem;color:var(--muted);"></span><button class="btn btn-secondary" id="tr-cp" onclick="cpTranslate()" style="padding:4px 10px;font-size:0.68rem;">Copy</button></div>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="doTranslate()" id="tr-btn">üåê Terjemahkan</button>
        <label style="margin:0;display:flex;align-items:center;gap:8px;text-transform:none;letter-spacing:0;font-size:0.72rem;"><input type="checkbox" id="tr-auto" style="width:13px;height:13px;accent-color:var(--accent);"> Auto translate</label>
      </div>
      <div id="tr-load" style="display:none;margin-top:12px;text-align:center;color:var(--muted);font-size:0.82rem;"><div class="tr-spinner"></div>Menerjemahkan...</div>
      <div style="margin-top:20px;border-top:1px solid var(--border);padding-top:16px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Frasa Cepat</div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;">
          <button class="phrase-btn" onclick="quickTr('Halo, apa kabar?')">Halo, apa kabar?</button>
          <button class="phrase-btn" onclick="quickTr('Terima kasih banyak')">Terima kasih</button>
          <button class="phrase-btn" onclick="quickTr('Di mana stasiun terdekat?')">Di mana stasiun?</button>
          <button class="phrase-btn" onclick="quickTr('Berapa harganya?')">Berapa harganya?</button>
          <button class="phrase-btn" onclick="quickTr('Saya tidak mengerti')">Tidak mengerti</button>
          <button class="phrase-btn" onclick="quickTr('Selamat pagi')">Selamat pagi</button>
        </div>
      </div>
    </div>
  </div>

  <!-- QR CODE -->
  <div id="tab-qr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">QR Code Generator</div>
      <div class="panel-desc">// Buat QR Code dari teks atau URL</div>
      <label>Teks / URL</label>
      <textarea id="qr-in" placeholder="https://example.com atau teks apapun..." style="min-height:80px;" oninput="qrLive()"></textarea>
      <div class="grid-2" style="margin-top:12px;">
        <div><label>Ukuran</label>
          <select id="qr-size" onchange="genQR()">
            <option value="150">150px</option><option value="200" selected>200px</option>
            <option value="300">300px</option><option value="400">400px</option>
          </select>
        </div>
        <div><label>Error Correction</label>
          <select id="qr-ec" onchange="genQR()">
            <option value="L">L ‚Äî 7%</option><option value="M" selected>M ‚Äî 15%</option>
            <option value="Q">Q ‚Äî 25%</option><option value="H">H ‚Äî 30%</option>
          </select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="genQR()">üì∑ Generate QR</button>
        <button class="btn btn-secondary" onclick="dlQR()">‚¨á Download PNG</button>
      </div>
      <div style="margin-top:18px;text-align:center;">
        <canvas id="qr-canvas" style="border:1px solid var(--border);border-radius:8px;display:none;background:#fff;"></canvas>
        <div id="qr-ph" style="color:var(--muted);font-size:0.78rem;margin-top:10px;">‚Äî QR Code akan muncul di sini ‚Äî</div>
      </div>
    </div>
  </div>

  <!-- RANDOM -->
  <div id="tab-random" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Random Generator</div>
      <div class="panel-desc">// UUID, angka, warna, nama, dadu, koin</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:14px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:10px;">üîë UUID v4</div>
          <div id="r-uuid" style="font-size:0.68rem;color:var(--accent2);word-break:break-all;min-height:28px;">‚Äî</div>
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-primary" onclick="rUUID()" style="padding:5px 10px;font-size:0.68rem;">Gen</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('r-uuid').textContent)" style="padding:5px 10px;font-size:0.68rem;">Copy</button>
          </div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:10px;">üé≤ Angka Random</div>
          <div class="grid-2" style="gap:7px;">
            <div><label style="margin:0 0 3px;font-size:0.62rem;">Min</label><input type="number" id="r-min" value="1" style="padding:5px;font-size:0.78rem;"></div>
            <div><label style="margin:0 0 3px;font-size:0.62rem;">Max</label><input type="number" id="r-max" value="100" style="padding:5px;font-size:0.78rem;"></div>
          </div>
          <div id="r-num" style="font-size:2rem;font-weight:800;color:var(--accent3);text-align:center;margin:7px 0;transition:transform 0.2s;">‚Äî</div>
          <button class="btn btn-secondary" onclick="rNum()" style="width:100%;padding:5px;font-size:0.68rem;">üé≤ Roll!</button>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--success);margin-bottom:10px;">üé® Warna Random</div>
          <div id="r-cbox" style="height:56px;border-radius:8px;background:#7c3aed;margin-bottom:7px;transition:background 0.4s;"></div>
          <div id="r-cval" style="font-size:0.72rem;color:var(--muted);text-align:center;margin-bottom:7px;">#7c3aed</div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="rColor()" style="flex:1;padding:5px;font-size:0.68rem;">Random</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('r-cval').textContent)" style="flex:1;padding:5px;font-size:0.68rem;">Copy</button>
          </div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent);margin-bottom:10px;">ü™ô Koin & üé≤ Dadu</div>
          <div id="r-coin" style="font-size:2.5rem;text-align:center;margin:4px 0;transition:transform 0.3s;">ü™ô</div>
          <div id="r-coinlbl" style="text-align:center;font-size:0.78rem;color:var(--muted);margin-bottom:7px;">‚Äî</div>
          <button class="btn btn-primary" onclick="rCoin()" style="width:100%;padding:5px;font-size:0.68rem;margin-bottom:8px;">Lempar Koin!</button>
          <select id="r-dice" style="margin-bottom:6px;font-size:0.78rem;"><option value="6" selected>D6</option><option value="4">D4</option><option value="8">D8</option><option value="12">D12</option><option value="20">D20</option><option value="100">D100</option></select>
          <div id="r-dres" style="font-size:1.8rem;text-align:center;">üé≤</div>
          <button class="btn btn-secondary" onclick="rDice()" style="width:100%;padding:5px;font-size:0.68rem;margin-top:5px;">Roll Dadu!</button>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:10px;">üë§ Nama Random</div>
          <select id="r-ntype" style="margin-bottom:7px;font-size:0.78rem;"><option value="id">Indonesia</option><option value="en">Inggris</option><option value="jp">Jepang</option></select>
          <div id="r-name" style="font-size:1rem;font-weight:700;color:var(--accent2);min-height:24px;margin-bottom:7px;">‚Äî</div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="rName()" style="flex:1;padding:5px;font-size:0.68rem;">Gen</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('r-name').textContent)" style="flex:1;padding:5px;font-size:0.68rem;">Copy</button>
          </div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:10px;">üìã Pilih Acak dari List</div>
          <textarea id="r-list" placeholder="Pizza&#10;Bakso&#10;Nasi Goreng&#10;Soto" style="min-height:80px;font-size:0.78rem;"></textarea>
          <div class="btn-group" style="margin-top:7px;">
            <button class="btn btn-primary" onclick="rPick(1)" style="flex:1;padding:5px;font-size:0.68rem;">Pilih 1</button>
            <button class="btn btn-secondary" onclick="rPick(3)" style="flex:1;padding:5px;font-size:0.68rem;">Pilih 3</button>
          </div>
          <div class="output-box" id="r-pick" style="margin-top:8px;min-height:44px;">‚Äî</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MARKDOWN -->
  <div id="tab-markdown" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Markdown Preview</div>
      <div class="panel-desc">// Tulis & preview Markdown secara live</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;">
        <button class="btn btn-secondary" onclick="mdIns('**bold**')" style="padding:4px 9px;font-size:0.68rem;"><b>B</b></button>
        <button class="btn btn-secondary" onclick="mdIns('*italic*')" style="padding:4px 9px;font-size:0.68rem;"><i>I</i></button>
        <button class="btn btn-secondary" onclick="mdIns('# Heading')" style="padding:4px 9px;font-size:0.68rem;">H1</button>
        <button class="btn btn-secondary" onclick="mdIns('## Heading')" style="padding:4px 9px;font-size:0.68rem;">H2</button>
        <button class="btn btn-secondary" onclick="mdIns('[teks](url)')" style="padding:4px 9px;font-size:0.68rem;">üîó</button>
        <button class="btn btn-secondary" onclick="mdIns('\`kode\`')" style="padding:4px 9px;font-size:0.68rem;">&lt;&gt;</button>
        <button class="btn btn-secondary" onclick="mdIns('- item')" style="padding:4px 9px;font-size:0.68rem;">‚Ä¢ List</button>
        <button class="btn btn-secondary" onclick="mdIns('> quote')" style="padding:4px 9px;font-size:0.68rem;">" Quote</button>
        <button class="btn btn-secondary" onclick="mdIns('---')" style="padding:4px 9px;font-size:0.68rem;">HR</button>
        <button class="btn btn-primary" onclick="mdSample()" style="padding:4px 9px;font-size:0.68rem;">üìÑ Contoh</button>
      </div>
      <div class="grid-2">
        <div><label>Editor</label><textarea id="md-in" placeholder="# Judul&#10;&#10;Tulis **markdown** di sini..." style="min-height:380px;font-size:0.8rem;" oninput="renderMd()"></textarea></div>
        <div><label>Preview</label><div id="md-prev" class="md-body" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:16px;min-height:380px;overflow-y:auto;line-height:1.8;color:var(--text);"></div></div>
      </div>
    </div>
  </div>

  <!-- REGEX -->
  <div id="tab-regex" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Regex Tester</div>
      <div class="panel-desc">// Uji ekspresi reguler dengan highlight real-time</div>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
        <span style="color:var(--muted);font-size:1.1rem;">/</span>
        <input type="text" id="rx-pat" placeholder="pattern..." style="flex:1;" oninput="testRx()">
        <span style="color:var(--muted);font-size:1.1rem;">/</span>
        <input type="text" id="rx-flags" value="gi" style="width:65px;" oninput="testRx()">
      </div>
      <label>Teks Uji</label>
      <textarea id="rx-in" placeholder="Teks untuk diuji..." style="min-height:100px;" oninput="testRx()"></textarea>
      <label>Hasil (Match Dihighlight)</label>
      <div id="rx-out" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;min-height:70px;font-size:0.82rem;line-height:1.8;white-space:pre-wrap;word-break:break-word;">‚Äî</div>
      <div id="rx-stat" style="margin-top:7px;font-size:0.72rem;color:var(--muted);"></div>
      <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:9px;">Preset</div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;">
          <button class="phrase-btn" onclick="rxPreset('Email','[a-zA-Z0-9._%+\\-]+@[a-zA-Z0-9.\\-]+\\.[a-zA-Z]{2,}','gi','Kirim ke adam@example.com atau winda@test.co.id')">üìß Email</button>
          <button class="phrase-btn" onclick="rxPreset('URL','https?:\\/\\/[\\w\\-\\.]+\\.[a-z]{2,}[\\w\\-\\._~:\\/?#\\[\\]@!$&\'\\(\\)\\*\\+,;=]*','gi','Cek https://google.com dan https://github.com')">üîó URL</button>
          <button class="phrase-btn" onclick="rxPreset('No HP','(\\+62|0)[0-9]{9,12}','g','Hub. Adam 081234567890 atau +6281234567891')">üì± No. HP</button>
          <button class="phrase-btn" onclick="rxPreset('Angka','\\d+','g','Harga Rp 150000 diskon 20% bayar Rp 120000')">üî¢ Angka</button>
          <button class="phrase-btn" onclick="rxPreset('Hashtag','#[\\w]+','g','#toolbox #adam #coding sangat keren!')">üè∑Ô∏è Hashtag</button>
          <button class="phrase-btn" onclick="rxPreset('IP','\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b','g','Server di 192.168.1.1 backup 10.0.0.1')">üåê IP Address</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TIMER -->
  <div id="tab-timer" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Stopwatch & Countdown Timer</div>
      <div class="panel-desc">// Stopwatch presisi & countdown dengan preset</div>
      <div class="grid-2">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:22px;text-align:center;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:14px;font-size:0.75rem;letter-spacing:2px;">‚è± STOPWATCH</div>
          <div id="sw-d" style="font-family:'Space Mono',monospace;font-size:2.5rem;font-weight:700;color:var(--text);letter-spacing:2px;margin-bottom:18px;">00:00:00.000</div>
          <div class="btn-group" style="justify-content:center;">
            <button class="btn btn-primary" id="sw-btn" onclick="swToggle()">‚ñ∂ Start</button>
            <button class="btn btn-secondary" onclick="swReset()">‚Ü∫ Reset</button>
            <button class="btn btn-secondary" onclick="swLap()">‚öë Lap</button>
          </div>
          <div id="sw-laps" style="margin-top:14px;max-height:130px;overflow-y:auto;font-size:0.72rem;text-align:left;"></div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:22px;text-align:center;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:14px;font-size:0.75rem;letter-spacing:2px;">‚è≥ COUNTDOWN</div>
          <div style="display:flex;gap:7px;justify-content:center;margin-bottom:14px;">
            <div><label style="font-size:0.6rem;">Jam</label><input type="number" id="cd-h" value="0" min="0" max="23" style="width:55px;text-align:center;padding:7px 3px;font-size:1.1rem;"></div>
            <div style="font-size:1.8rem;padding-top:14px;color:var(--muted);">:</div>
            <div><label style="font-size:0.6rem;">Menit</label><input type="number" id="cd-m" value="5" min="0" max="59" style="width:55px;text-align:center;padding:7px 3px;font-size:1.1rem;"></div>
            <div style="font-size:1.8rem;padding-top:14px;color:var(--muted);">:</div>
            <div><label style="font-size:0.6rem;">Detik</label><input type="number" id="cd-s" value="0" min="0" max="59" style="width:55px;text-align:center;padding:7px 3px;font-size:1.1rem;"></div>
          </div>
          <div id="cd-d" style="font-family:'Space Mono',monospace;font-size:2.5rem;font-weight:700;color:var(--accent3);letter-spacing:2px;margin-bottom:18px;">00:05:00</div>
          <div class="btn-group" style="justify-content:center;">
            <button class="btn btn-cyan" id="cd-btn" onclick="cdToggle()">‚ñ∂ Start</button>
            <button class="btn btn-secondary" onclick="cdReset()">‚Ü∫ Reset</button>
          </div>
          <div style="margin-top:12px;">
            <div style="font-size:0.68rem;color:var(--muted);margin-bottom:7px;">Preset Cepat</div>
            <div style="display:flex;gap:5px;flex-wrap:wrap;justify-content:center;">
              <button class="phrase-btn" onclick="cdPreset(1,0,0)">1 Menit</button>
              <button class="phrase-btn" onclick="cdPreset(5,0,0)">5 Menit</button>
              <button class="phrase-btn" onclick="cdPreset(25,0,0)">üçÖ Pomodoro</button>
              <button class="phrase-btn" onclick="cdPreset(60,0,0)">1 Jam</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CSV TO TABLE -->
  <div id="tab-csv" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">CSV ‚Üí Tabel</div>
      <div class="panel-desc">// Konversi CSV / TSV menjadi tabel rapi</div>
      <div class="grid-2">
        <div><label>Separator</label>
          <select id="csv-sep" onchange="renderCsv()">
            <option value=",">Koma (,)</option><option value=";">Titik koma (;)</option>
            <option value="	">Tab (TSV)</option><option value="|">Pipe (|)</option>
          </select>
        </div>
        <div style="display:flex;align-items:flex-end;gap:10px;padding-bottom:2px;">
          <label class="toggle-row" style="margin:0;"><input type="checkbox" id="csv-hdr" checked onchange="renderCsv()"> Baris pertama = header</label>
        </div>
      </div>
      <label>Input CSV</label>
      <textarea id="csv-in" style="min-height:120px;font-size:0.8rem;" placeholder="Nama,Umur,Kota&#10;Adam,25,Jakarta&#10;Winda,22,Bandung" oninput="renderCsv()"></textarea>
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="csvSample()">üìÑ Contoh</button>
        <button class="btn btn-secondary" onclick="csvExport('markdown')">Export Markdown</button>
        <button class="btn btn-secondary" onclick="csvExport('html')">Export HTML</button>
      </div>
      <div id="csv-wrap" style="overflow-x:auto;margin-top:12px;border:1px solid var(--border);border-radius:8px;min-height:60px;"></div>
      <div id="csv-stat" style="margin-top:7px;font-size:0.72rem;color:var(--muted);"></div>
    </div>
  </div>

  <!-- GRADIENT -->
  <div id="tab-gradient" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">CSS Gradient Generator</div>
      <div class="panel-desc">// Buat gradient cantik & salin CSS-nya</div>
      <div class="grid-2">
        <div>
          <label>Tipe</label><select id="gr-type" onchange="renderGr()"><option value="linear">Linear</option><option value="radial">Radial</option><option value="conic">Conic</option></select>
          <label>Arah</label>
          <select id="gr-dir" onchange="renderGr()">
            <option value="to right">‚Üí Kanan</option><option value="to left">‚Üê Kiri</option>
            <option value="to bottom">‚Üì Bawah</option><option value="to top">‚Üë Atas</option>
            <option value="135deg">135¬∞</option><option value="45deg">45¬∞</option>
          </select>
        </div>
        <div>
          <label>Warna 1</label>
          <div style="display:flex;gap:7px;align-items:center;"><input type="color" id="gr-c1" value="#7c3aed" oninput="renderGr()" style="width:46px;height:34px;"><input type="text" id="gr-c1t" value="#7c3aed" style="flex:1;" oninput="syncGr(1)"></div>
          <label>Warna 2</label>
          <div style="display:flex;gap:7px;align-items:center;"><input type="color" id="gr-c2" value="#06b6d4" oninput="renderGr()" style="width:46px;height:34px;"><input type="text" id="gr-c2t" value="#06b6d4" style="flex:1;" oninput="syncGr(2)"></div>
          <label>Warna 3 <input type="checkbox" id="gr-c3on" onchange="renderGr()" style="width:12px;height:12px;accent-color:var(--accent);vertical-align:middle;"> aktif</label>
          <div style="display:flex;gap:7px;align-items:center;"><input type="color" id="gr-c3" value="#f59e0b" oninput="renderGr()" style="width:46px;height:34px;"><input type="text" id="gr-c3t" value="#f59e0b" style="flex:1;" oninput="syncGr(3)"></div>
        </div>
      </div>
      <div id="gr-prev" style="height:130px;border-radius:10px;margin-top:14px;border:1px solid var(--border);transition:background 0.3s;"></div>
      <div class="btn-group" style="margin-top:12px;">
        <button class="btn btn-primary" onclick="copyText(document.getElementById('gr-css').value)">üìã Copy CSS</button>
        <button class="btn btn-secondary" onclick="randGr()">üé≤ Random</button>
      </div>
      <label>CSS Output</label>
      <input type="text" id="gr-css" readonly style="font-size:0.76rem;color:var(--accent2);">
      <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Preset</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(72px,1fr));gap:7px;" id="gr-presets"></div>
      </div>
    </div>
  </div>

  <!-- MINIFIER -->
  <div id="tab-minifier" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">CSS / JS Minifier</div>
      <div class="panel-desc">// Kompres kode, hapus whitespace & komentar</div>
      <div style="display:flex;gap:8px;margin-bottom:12px;">
        <button class="btn btn-primary" id="mini-css" onclick="setMini('css')">CSS</button>
        <button class="btn btn-secondary" id="mini-js" onclick="setMini('js')">JavaScript</button>
      </div>
      <label>Kode Input</label>
      <textarea id="mini-in" placeholder="Paste kode CSS atau JS..." style="min-height:180px;font-size:0.8rem;"></textarea>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="doMinify()">üóúÔ∏è Minify!</button>
        <button class="btn btn-secondary" onclick="doBeautify()">‚ú® Beautify</button>
        <button class="btn btn-secondary" onclick="miniSample()">üìÑ Contoh</button>
      </div>
      <div class="stats-row" id="mini-stat" style="margin-top:12px;"></div>
      <label>Hasil</label>
      <div class="output-box" id="mini-out" style="min-height:100px;font-size:0.8rem;">‚Äî<button class="copy-btn" onclick="cpOut('mini-out')">COPY</button></div>
    </div>
  </div>

  <!-- TODO -->
  <div id="tab-todo" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">To-Do List</div>
      <div class="panel-desc">// Catat tugas, prioritas & status ‚Äî tersimpan otomatis</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <input type="text" id="todo-input" placeholder="Tugas baru..." style="flex:1;" onkeydown="if(event.key==='Enter')addTodo()">
        <select id="todo-pri" style="width:110px;">
          <option value="high">üî¥ Tinggi</option>
          <option value="med" selected>üü° Sedang</option>
          <option value="low">üü¢ Rendah</option>
        </select>
        <button class="btn btn-primary" onclick="addTodo()">+ Tambah</button>
      </div>
      <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
        <button class="phrase-btn active-filter" id="tf-all" onclick="filterTodo('all',this)">Semua</button>
        <button class="phrase-btn" id="tf-active" onclick="filterTodo('active',this)">Aktif</button>
        <button class="phrase-btn" id="tf-done" onclick="filterTodo('done',this)">Selesai</button>
        <button class="phrase-btn" id="tf-high" onclick="filterTodo('high',this)">üî¥ Tinggi</button>
        <span style="flex:1"></span>
        <button class="btn btn-secondary" onclick="clearDoneTodo()" style="font-size:0.72rem;padding:5px 10px;">Hapus selesai</button>
      </div>
      <div id="todo-list" style="display:flex;flex-direction:column;gap:6px;min-height:60px;"></div>
      <div id="todo-empty" style="color:var(--muted);font-size:0.8rem;text-align:center;padding:20px;display:none;">Belum ada tugas üéâ</div>
      <div style="display:flex;justify-content:space-between;margin-top:12px;font-size:0.75rem;color:var(--muted);">
        <span id="todo-stats"></span>
        <button onclick="clearAllTodo()" style="background:none;border:none;color:var(--danger);cursor:pointer;font-size:0.72rem;">Hapus semua</button>
      </div>
    </div>
  </div>

  <!-- NOTEPAD -->
  <div id="tab-notepad" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Notepad</div>
      <div class="panel-desc">// Catatan cepat ‚Äî tersimpan otomatis di browser</div>
      <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;">
        <input type="text" id="np-title" placeholder="Judul catatan..." style="flex:1;font-weight:700;">
        <button class="btn btn-primary" onclick="saveNote()">üíæ Simpan</button>
        <button class="btn btn-secondary" onclick="newNote()">+ Baru</button>
      </div>
      <div style="display:grid;grid-template-columns:200px 1fr;gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Catatan Tersimpan</div>
          <div id="np-list" style="display:flex;flex-direction:column;gap:4px;max-height:380px;overflow-y:auto;"></div>
          <div id="np-empty-list" style="color:var(--muted);font-size:0.75rem;text-align:center;padding:12px;">Belum ada catatan</div>
        </div>
        <div>
          <textarea id="np-body" placeholder="Mulai menulis di sini...

Catatan kamu tersimpan otomatis di browser.
Tidak perlu login, tidak ada data yang dikirim." style="min-height:380px;font-size:0.9rem;line-height:1.7;" oninput="npAutoSave()"></textarea>
          <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:0.72rem;color:var(--muted);">
            <span id="np-wordcount">0 kata</span>
            <span id="np-saved-status">‚Äî</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CURRENCY -->
  <div id="tab-currency" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Konversi Kurs Mata Uang</div>
      <div class="panel-desc">// Kurs live dari ExchangeRate API (update harian)</div>
      <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:end;margin-bottom:16px;">
        <div>
          <label>Dari</label>
          <select id="cur-from" onchange="convertCur()">
            <option value="IDR" selected>üáÆüá© IDR ‚Äî Rupiah</option>
            <option value="USD">üá∫üá∏ USD ‚Äî Dollar AS</option>
            <option value="EUR">üá™üá∫ EUR ‚Äî Euro</option>
            <option value="GBP">üá¨üáß GBP ‚Äî Pound</option>
            <option value="JPY">üáØüáµ JPY ‚Äî Yen</option>
            <option value="SGD">üá∏üá¨ SGD ‚Äî Dollar Singapura</option>
            <option value="MYR">üá≤üáæ MYR ‚Äî Ringgit</option>
            <option value="AUD">üá¶üá∫ AUD ‚Äî Dollar Australia</option>
            <option value="CNY">üá®üá≥ CNY ‚Äî Yuan</option>
            <option value="SAR">üá∏üá¶ SAR ‚Äî Riyal</option>
            <option value="KRW">üá∞üá∑ KRW ‚Äî Won</option>
            <option value="HKD">üá≠üá∞ HKD ‚Äî Dollar HK</option>
          </select>
          <input type="number" id="cur-amount" value="1000000" oninput="convertCur()" style="margin-top:8px;">
        </div>
        <button onclick="swapCur()" class="btn btn-secondary" style="margin-bottom:0;padding:10px 14px;">‚áÑ</button>
        <div>
          <label>Ke</label>
          <select id="cur-to" onchange="convertCur()">
            <option value="IDR">üáÆüá© IDR ‚Äî Rupiah</option>
            <option value="USD" selected>üá∫üá∏ USD ‚Äî Dollar AS</option>
            <option value="EUR">üá™üá∫ EUR ‚Äî Euro</option>
            <option value="GBP">üá¨üáß GBP ‚Äî Pound</option>
            <option value="JPY">üáØüáµ JPY ‚Äî Yen</option>
            <option value="SGD">üá∏üá¨ SGD ‚Äî Dollar Singapura</option>
            <option value="MYR">üá≤üáæ MYR ‚Äî Ringgit</option>
            <option value="AUD">üá¶üá∫ AUD ‚Äî Dollar Australia</option>
            <option value="CNY">üá®üá≥ CNY ‚Äî Yuan</option>
            <option value="SAR">üá∏üá¶ SAR ‚Äî Riyal</option>
            <option value="KRW">üá∞üá∑ KRW ‚Äî Won</option>
            <option value="HKD">üá≠üá∞ HKD ‚Äî Dollar HK</option>
          </select>
          <div id="cur-result" style="margin-top:8px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px 16px;font-size:1.1rem;color:var(--accent2);font-family:'Syne',sans-serif;font-weight:700;min-height:48px;">‚Äî</div>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="loadRates()">üîÑ Update Kurs</button>
      </div>
      <div id="cur-rate-info" style="margin-top:12px;font-size:0.75rem;color:var(--muted);">Klik "Update Kurs" untuk mengambil data terbaru</div>
      <div id="cur-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:16px;"></div>
    </div>
  </div>

  <!-- WEATHER -->
  <div id="tab-weather" class="tool-panel" style="display:none;" aria-hidden="true"><!-- Replaced by widget -->
    <div class="panel-card">
      <div class="panel-title">Cek Cuaca</div>
      <div class="panel-desc">// Info cuaca real-time via Open-Meteo (gratis, no key)</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <input type="text" id="wx-city" placeholder="Nama kota, contoh: Jakarta" style="flex:1;" onkeydown="if(event.key==='Enter')searchWeather()">
        <button class="btn btn-primary" onclick="searchWeather()">üîç Cari</button>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <button class="phrase-btn" onclick="quickWeather('Jakarta')">Jakarta</button>
        <button class="phrase-btn" onclick="quickWeather('Bandung')">Bandung</button>
        <button class="phrase-btn" onclick="quickWeather('Surabaya')">Surabaya</button>
        <button class="phrase-btn" onclick="quickWeather('Yogyakarta')">Yogyakarta</button>
        <button class="phrase-btn" onclick="quickWeather('Bali')">Bali</button>
        <button class="phrase-btn" onclick="quickWeather('Medan')">Medan</button>
        <button class="phrase-btn" onclick="quickWeather('Makassar')">Makassar</button>
      </div>
      <div id="wx-loading" style="display:none;text-align:center;color:var(--muted);font-size:0.85rem;padding:20px;">üåç Mencari data cuaca...</div>
      <div id="wx-result" style="display:none;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:24px;text-align:center;">
          <div id="wx-city-name" style="font-family:'Syne',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:4px;"></div>
          <div id="wx-icon" style="font-size:4rem;margin:12px 0;"></div>
          <div id="wx-temp" style="font-size:3rem;font-weight:800;font-family:'Syne',sans-serif;color:var(--accent2);"></div>
          <div id="wx-desc" style="color:var(--muted);margin-top:6px;font-size:0.9rem;"></div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-top:12px;" id="wx-details"></div>
      </div>
      <div id="wx-error" style="display:none;color:var(--danger);font-size:0.85rem;padding:12px;"></div>
    </div>
  </div>

  <!-- IMAGE COMPRESSOR -->
  <div id="tab-imgcomp" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Image Compressor</div>
      <div class="panel-desc">// Kompres gambar langsung di browser ‚Äî privat, no upload</div>
      <div id="ic-drop" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;transition:all 0.2s;" onclick="document.getElementById('ic-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="icDrop(event)">
        <div style="font-size:2.5rem;">üñºÔ∏è</div>
        <div style="color:var(--muted);margin-top:8px;font-size:0.85rem;">Klik atau drag & drop gambar di sini</div>
        <div style="color:var(--muted);font-size:0.72rem;margin-top:4px;">JPG, PNG, WebP ‚Äî max 20MB</div>
        <input type="file" id="ic-file" accept="image/*" style="display:none;" onchange="icLoad(this)">
      </div>
      <div id="ic-controls" style="display:none;margin-top:16px;">
        <div class="grid-2">
          <div>
            <label>Kualitas: <span id="ic-q-val">80</span>%</label>
            <input type="range" id="ic-quality" min="10" max="100" value="80" oninput="document.getElementById('ic-q-val').textContent=this.value;icPreview()">
            <label>Format Output</label>
            <select id="ic-format" onchange="icPreview()">
              <option value="image/jpeg">JPEG</option>
              <option value="image/png">PNG</option>
              <option value="image/webp">WebP</option>
            </select>
            <label>Resize (0 = original)</label>
            <div style="display:flex;gap:8px;">
              <input type="number" id="ic-w" placeholder="Lebar px" oninput="icPreview()">
              <input type="number" id="ic-h" placeholder="Tinggi px" oninput="icPreview()">
            </div>
          </div>
          <div>
            <label>Preview Hasil</label>
            <canvas id="ic-canvas" style="max-width:100%;border:1px solid var(--border);border-radius:8px;display:block;"></canvas>
          </div>
        </div>
        <div class="stats-row" style="margin-top:12px;">
          <div class="stat-chip">Asli: <span id="ic-orig-size" style="color:var(--accent3);">‚Äî</span></div>
          <div class="stat-chip">Hasil: <span id="ic-new-size" style="color:var(--success);">‚Äî</span></div>
          <div class="stat-chip">Hemat: <span id="ic-saved" style="color:var(--success);">‚Äî</span></div>
          <div class="stat-chip">Dimensi: <span id="ic-dims">‚Äî</span></div>
        </div>
        <div class="btn-group" style="margin-top:12px;">
          <button class="btn btn-primary" onclick="icDownload()">‚¨á Download</button>
          <button class="btn btn-secondary" onclick="icReset()">Ganti Gambar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FONT PREVIEW -->
  <div id="tab-fontprev" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Font Preview</div>
      <div class="panel-desc">// Preview 40+ Google Fonts dengan teks kustom</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <input type="text" id="fp-text" value="Halo Dunia! The quick brown fox." style="flex:1;" oninput="renderFonts()">
        <div style="display:flex;align-items:center;gap:8px;">
          <label style="margin:0;white-space:nowrap;">Ukuran:</label>
          <input type="number" id="fp-size" value="28" min="12" max="80" style="width:70px;" oninput="renderFonts()">
        </div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <button class="phrase-btn" onclick="fpCategory('all')">Semua</button>
        <button class="phrase-btn" onclick="fpCategory('serif')">Serif</button>
        <button class="phrase-btn" onclick="fpCategory('sans')">Sans-Serif</button>
        <button class="phrase-btn" onclick="fpCategory('mono')">Monospace</button>
        <button class="phrase-btn" onclick="fpCategory('display')">Display</button>
      </div>
      <div id="fp-grid" style="display:flex;flex-direction:column;gap:2px;max-height:480px;overflow-y:auto;"></div>
    </div>
  </div>

  <!-- SNIPPET MANAGER -->
  <div id="tab-snippet" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Snippet Manager</div>
      <div class="panel-desc">// Simpan dan kelola potongan kode favorit</div>
      <div style="display:grid;grid-template-columns:260px 1fr;gap:16px;">
        <div>
          <div style="display:flex;gap:6px;margin-bottom:10px;">
            <input type="text" id="snip-search" placeholder="Cari snippet..." style="flex:1;font-size:0.8rem;" oninput="renderSnippets()">
            <button class="btn btn-primary" onclick="newSnippet()" style="padding:8px 12px;">+</button>
          </div>
          <div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px;">
            <button class="phrase-btn" onclick="filterSnip('all')">Semua</button>
            <button class="phrase-btn" onclick="filterSnip('js')">JS</button>
            <button class="phrase-btn" onclick="filterSnip('css')">CSS</button>
            <button class="phrase-btn" onclick="filterSnip('html')">HTML</button>
            <button class="phrase-btn" onclick="filterSnip('python')">Python</button>
            <button class="phrase-btn" onclick="filterSnip('other')">Lain</button>
          </div>
          <div id="snip-list" style="display:flex;flex-direction:column;gap:4px;max-height:380px;overflow-y:auto;"></div>
          <div id="snip-empty" style="color:var(--muted);font-size:0.78rem;text-align:center;padding:16px;">Belum ada snippet</div>
        </div>
        <div id="snip-editor" style="display:flex;flex-direction:column;gap:8px;">
          <div style="display:flex;gap:8px;">
            <input type="text" id="snip-name" placeholder="Nama snippet..." style="flex:1;">
            <select id="snip-lang" style="width:100px;">
              <option value="js">JavaScript</option>
              <option value="css">CSS</option>
              <option value="html">HTML</option>
              <option value="python">Python</option>
              <option value="sql">SQL</option>
              <option value="bash">Bash</option>
              <option value="other">Lainnya</option>
            </select>
          </div>
          <input type="text" id="snip-desc" placeholder="Deskripsi singkat...">
          <textarea id="snip-code" placeholder="Paste kode di sini..." style="min-height:300px;font-size:0.82rem;font-family:'Space Mono',monospace;"></textarea>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" onclick="saveSnippet()">üíæ Simpan</button>
            <button class="btn btn-cyan" onclick="copySnippet()" id="snip-copy-btn">üìã Copy Kode</button>
            <button class="btn btn-secondary" onclick="deleteSnippet()" style="margin-left:auto;">üóë Hapus</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ASPECT RATIO -->
  <div id="tab-aspect" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Aspect Ratio & Dimensi</div>
      <div class="panel-desc">// Hitung rasio gambar, skala dimensi, & resize proporsional</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:20px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-bottom:14px;">üìê Hitung Rasio</div>
          <label>Lebar (W)</label><input type="number" id="ar-w" placeholder="1920" oninput="calcAR()">
          <label>Tinggi (H)</label><input type="number" id="ar-h" placeholder="1080" oninput="calcAR()">
          <div class="output-box" id="ar-out" style="margin-top:12px;min-height:60px;">‚Äî</div>
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:20px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);margin-bottom:14px;">üìè Skala Proporsional</div>
          <label>Lebar Asli</label><input type="number" id="sc-ow" placeholder="1920" oninput="calcScale()">
          <label>Tinggi Asli</label><input type="number" id="sc-oh" placeholder="1080" oninput="calcScale()">
          <label>Target Lebar (isi salah satu)</label><input type="number" id="sc-tw" placeholder="800" oninput="calcScale()">
          <label>Target Tinggi</label><input type="number" id="sc-th" placeholder="" oninput="calcScale()">
          <div class="output-box" id="sc-out" style="margin-top:12px;min-height:60px;">‚Äî</div>
        </div>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:20px;margin-top:16px;">
        <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--success);margin-bottom:14px;">üéØ Preset Rasio Umum</div>
        <div style="display:flex;flex-wrap:wrap;gap:8px;">
          <button class="phrase-btn" onclick="setAR(16,9)">16:9 (HD/YouTube)</button>
          <button class="phrase-btn" onclick="setAR(4,3)">4:3 (Klasik)</button>
          <button class="phrase-btn" onclick="setAR(1,1)">1:1 (Square)</button>
          <button class="phrase-btn" onclick="setAR(9,16)">9:16 (Story/TikTok)</button>
          <button class="phrase-btn" onclick="setAR(3,2)">3:2 (Foto DSLR)</button>
          <button class="phrase-btn" onclick="setAR(21,9)">21:9 (Ultrawide)</button>
          <button class="phrase-btn" onclick="setAR(2,1)">2:1 (Banner)</button>
          <button class="phrase-btn" onclick="setAR(4,5)">4:5 (Instagram)</button>
          <button class="phrase-btn" onclick="setAR(1200,630)">1200:630 (OG Image)</button>
        </div>
        <div class="output-box" id="ar-preset-out" style="margin-top:12px;min-height:50px;display:none;">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- MINDMAP -->
  <div id="tab-mindmap" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Teks ‚Üí Mindmap</div>
      <div class="panel-desc">// Tulis bullet points, otomatis jadi visualisasi mindmap</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div>
          <label>Input (gunakan indentasi 2 spasi)</label>
          <textarea id="mm-input" style="min-height:340px;font-size:0.82rem;font-family:'Space Mono',monospace;" oninput="renderMindmap()" placeholder="Topik Utama
  Subtopik 1
    Detail A
    Detail B
  Subtopik 2
    Detail C
  Subtopik 3
    Detail D
    Detail E"></textarea>
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-secondary" onclick="mmExample()">Contoh</button>
            <button class="btn btn-secondary" onclick="mmDownload()">‚¨á SVG</button>
          </div>
        </div>
        <div>
          <label>Preview Mindmap</label>
          <div id="mm-canvas" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;min-height:340px;overflow:auto;position:relative;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MORSE CODE -->
  <div id="tab-morse" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">Text ‚Üî Morse Code</div>
      <div class="panel-desc">// Konversi teks ke morse dan putar suaranya via Web Audio API</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Teks</label>
          <textarea id="morse-text" style="min-height:120px;" placeholder="Ketik teks..." oninput="textToMorse()"></textarea>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="textToMorse()">‚Üí Ke Morse</button>
            <button class="btn btn-secondary" onclick="morseToText()">‚Üê Dari Morse</button>
          </div>
        </div>
        <div>
          <label>Morse Code</label>
          <textarea id="morse-code" style="min-height:120px;letter-spacing:2px;font-size:1rem;" placeholder="... --- ..." oninput="morseToText()"></textarea>
          <div class="btn-group">
            <button class="btn btn-cyan" onclick="playMorse()" id="morse-play-btn">‚ñ∂ Putar Suara</button>
            <button class="btn btn-secondary" onclick="stopMorse()">‚èπ Stop</button>
          </div>
        </div>
      </div>
      <div style="margin-top:16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <div><label style="margin:0;margin-right:8px;">Speed:</label>
          <input type="range" id="morse-speed" min="5" max="30" value="15" style="width:120px;vertical-align:middle;"> <span id="morse-speed-val">15 WPM</span>
        </div>
        <div><label style="margin:0;margin-right:8px;">Frekuensi:</label>
          <input type="range" id="morse-freq" min="400" max="1000" value="600" style="width:120px;vertical-align:middle;"> <span id="morse-freq-val">600 Hz</span>
        </div>
      </div>
      <div id="morse-visual" style="margin-top:16px;min-height:32px;display:flex;gap:3px;flex-wrap:wrap;align-items:center;"></div>
      <details style="margin-top:16px;">
        <summary style="font-size:0.78rem;color:var(--muted);cursor:pointer;">Tabel Morse</summary>
        <div id="morse-table" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:10px;font-size:0.72rem;"></div>
      </details>
    </div>
  </div>

  <!-- WORLD CLOCK -->
  <div id="tab-worldclock" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üåç World Clock</div>
      <div class="panel-desc">// Jam langsung dari 15+ kota di seluruh dunia</div>
      <div id="wc-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;"></div>
      <div style="margin-top:20px;border-top:1px solid var(--border);padding-top:16px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;">Tambah Kota Custom</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <input type="text" id="wc-city-name" placeholder="Nama Kota" style="width:160px;">
          <select id="wc-tz" style="flex:1;min-width:200px;"></select>
          <button class="btn btn-primary" onclick="addWCCity()">+ Tambah</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FAKE DATA GENERATOR -->
  <div id="tab-fakedata" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üîÆ Fake Data Generator Indonesia</div>
      <div class="panel-desc">// Buat data dummy realistis untuk testing & development</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:flex-end;">
        <div><label>Jumlah Data</label><input type="number" id="fd-count" value="5" min="1" max="50" style="width:80px;"></div>
        <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;padding-bottom:2px;">
          <label style="margin:0;text-transform:none;letter-spacing:0;font-size:0.78rem;color:var(--muted);">Kolom:</label>
          <label class="fd-check"><input type="checkbox" id="fd-nama" checked> Nama</label>
          <label class="fd-check"><input type="checkbox" id="fd-nik" checked> NIK</label>
          <label class="fd-check"><input type="checkbox" id="fd-email" checked> Email</label>
          <label class="fd-check"><input type="checkbox" id="fd-phone" checked> Telepon</label>
          <label class="fd-check"><input type="checkbox" id="fd-alamat" checked> Alamat</label>
          <label class="fd-check"><input type="checkbox" id="fd-dob"> Tgl Lahir</label>
          <label class="fd-check"><input type="checkbox" id="fd-job"> Pekerjaan</label>
          <label class="fd-check"><input type="checkbox" id="fd-bank"> Rekening</label>
        </div>
        <button class="btn btn-primary" onclick="genFakeData()">üîÆ Generate</button>
        <button class="btn btn-secondary" onclick="copyFakeData()">Copy JSON</button>
        <button class="btn btn-secondary" onclick="exportFakeCSV()">Export CSV</button>
      </div>
      <div id="fd-table-wrap" style="overflow-x:auto;"></div>
      <div id="fd-json-out" style="display:none;"></div>
    </div>
  </div>

  <!-- PALETTE EXTRACTOR -->
  <div id="tab-palette" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üé® Color Palette Extractor</div>
      <div class="panel-desc">// Upload foto, ambil warna dominan otomatis</div>
      <div id="pal-drop" style="border:2px dashed var(--border);border-radius:12px;padding:36px;text-align:center;cursor:pointer;" onclick="document.getElementById('pal-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="palDrop(event)">
        <div style="font-size:2.5rem;">üñºÔ∏è</div>
        <div style="color:var(--muted);font-size:0.85rem;margin-top:8px;">Klik atau drag & drop gambar</div>
        <input type="file" id="pal-file" accept="image/*" style="display:none;" onchange="palLoad(this)">
      </div>
      <div id="pal-result" style="display:none;margin-top:16px;">
        <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:start;">
          <img id="pal-img" style="max-width:200px;max-height:200px;border-radius:8px;border:1px solid var(--border);">
          <div>
            <div style="font-size:0.78rem;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;">Warna Dominan</div>
            <div id="pal-colors" style="display:flex;flex-direction:column;gap:8px;"></div>
          </div>
        </div>
        <div style="margin-top:16px;">
          <div style="font-size:0.78rem;color:var(--muted);margin-bottom:8px;">Jumlah Warna: <input type="range" id="pal-count" min="3" max="12" value="6" style="width:100px;vertical-align:middle;" oninput="palReExtract()"> <span id="pal-count-val">6</span></div>
          <div id="pal-swatches" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHART GENERATOR -->
  <div id="tab-chartgen" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üìä Text ‚Üí Chart Generator</div>
      <div class="panel-desc">// Input data sederhana, langsung jadi grafik cantik</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div>
          <label>Tipe Chart</label>
          <select id="cg-type" onchange="renderChart()">
            <option value="bar">Bar Chart</option>
            <option value="horizontal-bar">Horizontal Bar</option>
            <option value="line">Line Chart</option>
            <option value="pie">Pie Chart</option>
            <option value="donut">Donut Chart</option>
          </select>
          <label>Data (Label,Nilai ‚Äî satu per baris)</label>
          <textarea id="cg-data" style="min-height:200px;font-size:0.82rem;" oninput="renderChart()" placeholder="Januari,120
Februari,95
Maret,180
April,145
Mei,210
Juni,175"></textarea>
          <label>Judul Chart</label>
          <input type="text" id="cg-title" value="Data Saya" oninput="renderChart()">
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-secondary" onclick="cgDownload()">‚¨á Download PNG</button>
          </div>
        </div>
        <div>
          <label>Preview</label>
          <canvas id="cg-canvas" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;width:100%;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- CIPHER / ENKRIPSI -->
  <div id="tab-cipher" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üîê Enkripsi Teks</div>
      <div class="panel-desc">// Caesar, ROT13, Vigenere, Atbash, Base85 cipher</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
        <button class="btn btn-primary" id="ci-caesar" onclick="setCipher('caesar')">Caesar</button>
        <button class="btn btn-secondary" id="ci-rot13" onclick="setCipher('rot13')">ROT13</button>
        <button class="btn btn-secondary" id="ci-vigenere" onclick="setCipher('vigenere')">Vigenere</button>
        <button class="btn btn-secondary" id="ci-atbash" onclick="setCipher('atbash')">Atbash</button>
        <button class="btn btn-secondary" id="ci-morse2" onclick="setCipher('binary')">Binary</button>
      </div>
      <div id="ci-caesar-opts" style="margin-bottom:12px;">
        <label>Geser: <span id="ci-shift-val">3</span></label>
        <input type="range" id="ci-shift" min="1" max="25" value="3" oninput="document.getElementById('ci-shift-val').textContent=this.value;doCipher()">
      </div>
      <div id="ci-vigenere-opts" style="display:none;margin-bottom:12px;">
        <label>Kunci (huruf saja)</label>
        <input type="text" id="ci-key" placeholder="contoh: RAHASIA" oninput="doCipher()" style="width:200px;">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Teks Input</label>
          <textarea id="ci-input" style="min-height:160px;" oninput="doCipher()" placeholder="Tulis teks yang ingin dienkripsi..."></textarea>
          <div class="btn-group" style="margin-top:8px;">
            <button class="btn btn-primary" onclick="doCipher()">üîê Enkripsi</button>
            <button class="btn btn-cyan" onclick="doCipherDecrypt()">üîì Dekripsi</button>
          </div>
        </div>
        <div>
          <label>Hasil</label>
          <div class="output-box" id="ci-output" style="min-height:160px;">‚Äî
            <button class="copy-btn" onclick="cpOut('ci-output')">COPY</button>
          </div>
          <div style="margin-top:8px;font-size:0.75rem;color:var(--muted);" id="ci-info"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ASCII ART -->
  <div id="tab-ascii" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üñãÔ∏è ASCII Art Generator</div>
      <div class="panel-desc">// Konversi teks jadi ASCII art berbagai style font</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:flex-end;">
        <div style="flex:1;min-width:200px;">
          <label>Teks</label>
          <input type="text" id="aa-input" value="TOOLBOX" placeholder="Maks 10 karakter" maxlength="10" oninput="genAsciiArt()">
        </div>
        <div>
          <label>Style Font</label>
          <select id="aa-font" onchange="genAsciiArt()" style="min-width:160px;"></select>
        </div>
      </div>
      <div class="output-box" id="aa-output" style="font-size:0.62rem;line-height:1.2;min-height:120px;font-family:'Space Mono',monospace;white-space:pre;overflow-x:auto;color:var(--accent2);">‚Äî
        <button class="copy-btn" onclick="cpOut('aa-output')">COPY</button>
      </div>
      <div style="margin-top:12px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:8px;">Preview Semua Style:</div>
        <div id="aa-all-preview" style="display:flex;flex-direction:column;gap:12px;max-height:400px;overflow-y:auto;"></div>
      </div>
    </div>
  </div>

  <!-- POMODORO -->
  <div id="tab-pomodoro" class="tool-panel">
    <div class="panel-card" style="text-align:center;max-width:500px;margin:0 auto;">
      <div class="panel-title">üéØ Pomodoro Timer</div>
      <div class="panel-desc">// Teknik fokus 25 menit kerja, 5 menit istirahat</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-bottom:20px;">
        <button class="phrase-btn" id="pom-work-btn" onclick="pomSetMode('work')">üéØ Fokus</button>
        <button class="phrase-btn" id="pom-short-btn" onclick="pomSetMode('short')">‚òï Istirahat Pendek</button>
        <button class="phrase-btn" id="pom-long-btn" onclick="pomSetMode('long')">üò¥ Istirahat Panjang</button>
      </div>
      <div id="pom-display" style="font-family:'Space Mono',monospace;font-size:5rem;font-weight:700;color:var(--accent2);letter-spacing:4px;margin:20px 0;line-height:1;">25:00</div>
      <div id="pom-mode-label" style="font-size:0.85rem;color:var(--muted);margin-bottom:20px;">Mode: Fokus</div>
      <div style="display:flex;gap:10px;justify-content:center;margin-bottom:24px;">
        <button class="btn btn-primary" id="pom-btn" onclick="pomToggle()" style="min-width:120px;font-size:1rem;">‚ñ∂ Mulai</button>
        <button class="btn btn-secondary" onclick="pomReset()">‚Ü∫ Reset</button>
        <button class="btn btn-secondary" onclick="pomSkip()">‚è≠ Skip</button>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.78rem;color:var(--muted);">
          <span>Progres Sesi</span><span id="pom-count">0 / 4 sesi</span>
        </div>
        <div style="display:flex;gap:6px;justify-content:center;" id="pom-dots"></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:16px;justify-content:center;flex-wrap:wrap;">
        <div><label style="display:block;font-size:0.72rem;margin-bottom:4px;">Fokus (menit)</label><input type="number" id="pom-work-min" value="25" min="1" max="90" style="width:70px;text-align:center;" onchange="pomReset()"></div>
        <div><label style="display:block;font-size:0.72rem;margin-bottom:4px;">Istirahat Pendek</label><input type="number" id="pom-short-min" value="5" min="1" max="30" style="width:70px;text-align:center;" onchange="pomReset()"></div>
        <div><label style="display:block;font-size:0.72rem;margin-bottom:4px;">Istirahat Panjang</label><input type="number" id="pom-long-min" value="15" min="1" max="60" style="width:70px;text-align:center;" onchange="pomReset()"></div>
      </div>
    </div>
  </div>

  <!-- TEXT TO SPEECH -->
  <div id="tab-tts" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üé§ Text to Speech</div>
      <div class="panel-desc">// Ubah teks menjadi suara dengan berbagai pilihan</div>
      <label>Teks</label>
      <textarea id="tts-text" style="min-height:140px;" placeholder="Ketik teks yang ingin dibaca...">Halo! Selamat datang di Toolbox, kumpulan tools berguna buatan Adam yang ganteng.</textarea>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:12px;">
        <div>
          <label>Suara / Bahasa</label>
          <select id="tts-voice" style="width:100%;"></select>
        </div>
        <div>
          <label>Kecepatan: <span id="tts-rate-val">1x</span></label>
          <input type="range" id="tts-rate" min="0.5" max="2" value="1" step="0.1" oninput="document.getElementById('tts-rate-val').textContent=this.value+'x'">
          <label>Nada: <span id="tts-pitch-val">1</span></label>
          <input type="range" id="tts-pitch" min="0.5" max="2" value="1" step="0.1" oninput="document.getElementById('tts-pitch-val').textContent=this.value">
        </div>
      </div>
      <div class="btn-group" style="margin-top:16px;">
        <button class="btn btn-primary" onclick="ttsSpeak()" id="tts-btn">‚ñ∂ Mulai Baca</button>
        <button class="btn btn-secondary" onclick="ttsPause()" id="tts-pause">‚è∏ Pause</button>
        <button class="btn btn-secondary" onclick="ttsStop()">‚èπ Stop</button>
      </div>
      <div id="tts-status" style="margin-top:10px;font-size:0.78rem;color:var(--muted);">Siap membaca...</div>
      <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:8px;">Teks Cepat:</div>
        <div style="display:flex;flex-wrap:wrap;gap:6px;">
          <button class="phrase-btn" onclick="ttsQuick('Halo, selamat pagi!')">Selamat Pagi</button>
          <button class="phrase-btn" onclick="ttsQuick('Terima kasih banyak.')">Terima Kasih</button>
          <button class="phrase-btn" onclick="ttsQuick('Satu dua tiga empat lima enam tujuh delapan sembilan sepuluh.')">1-10</button>
          <button class="phrase-btn" onclick="ttsQuick('Waktunya istirahat!')">Waktunya Istirahat</button>
        </div>
      </div>
    </div>
  </div>

  <!-- OCR -->
  <div id="tab-ocr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üì∏ Screenshot to Text (OCR)</div>
      <div class="panel-desc">// Ekstrak teks dari gambar ‚Äî powered by Tesseract.js (offline)</div>
      <div id="ocr-drop" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;" onclick="document.getElementById('ocr-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="ocrDrop(event)">
        <div style="font-size:2.5rem;">üì∏</div>
        <div style="color:var(--muted);margin-top:8px;font-size:0.85rem;">Klik atau drag & drop gambar screenshot</div>
        <div style="color:var(--muted);font-size:0.72rem;margin-top:4px;">JPG, PNG, WebP ‚Äî teks apapun di gambar akan diekstrak</div>
        <input type="file" id="ocr-file" accept="image/*" style="display:none;" onchange="ocrProcess(this)">
      </div>
      <div id="ocr-preview-wrap" style="display:none;margin-top:16px;">
        <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:start;">
          <img id="ocr-img" style="max-width:220px;max-height:220px;border-radius:8px;border:1px solid var(--border);">
          <div style="flex:1;">
            <label>Bahasa OCR</label>
            <select id="ocr-lang" style="width:100%;margin-bottom:8px;">
              <option value="eng">Inggris</option>
              <option value="ind" selected>Indonesia</option>
            </select>
            <button class="btn btn-primary" onclick="runOCR()" id="ocr-run-btn" style="width:100%;">üîç Ekstrak Teks</button>
            <div id="ocr-progress" style="display:none;margin-top:10px;">
              <div style="background:var(--border);border-radius:4px;height:6px;overflow:hidden;"><div id="ocr-bar" style="height:100%;background:var(--accent);width:0%;transition:width 0.3s;border-radius:4px;"></div></div>
              <div id="ocr-prog-text" style="font-size:0.75rem;color:var(--muted);margin-top:4px;">Memuat...</div>
            </div>
          </div>
        </div>
        <label style="margin-top:16px;">Hasil Teks</label>
        <div class="output-box" id="ocr-output" style="min-height:120px;white-space:pre-wrap;">‚Äî klik Ekstrak Teks untuk memulai ‚Äî
          <button class="copy-btn" onclick="cpOut('ocr-output')">COPY</button>
        </div>
        <div class="btn-group" style="margin-top:8px;">
          <button class="btn btn-secondary" onclick="ocrReset()">Ganti Gambar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AGE CALCULATOR -->
  <div id="tab-ageCalc" class="tool-panel">
    <div class="panel-card" style="max-width:600px;margin:0 auto;">
      <div class="panel-title">üßÆ Kalkulator Umur</div>
      <div class="panel-desc">// Hitung umur tepat, hari ulang tahun, dan milestone</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label>Tanggal Lahir</label>
          <input type="date" id="age-dob" oninput="calcAge()">
          <label style="margin-top:12px;">Hitung Sampai Tanggal</label>
          <input type="date" id="age-to" oninput="calcAge()">
          <button class="btn btn-secondary" onclick="document.getElementById('age-to').value=new Date().toISOString().slice(0,10);calcAge()" style="margin-top:8px;width:100%;">üìÖ Pakai Hari Ini</button>
        </div>
        <div id="age-result" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;min-height:160px;">
          <div style="color:var(--muted);font-size:0.8rem;text-align:center;padding-top:30px;">Isi tanggal lahir untuk melihat hasil</div>
        </div>
      </div>
      <div id="age-milestones" style="margin-top:16px;display:none;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Milestone Umur</div>
        <div id="age-milestone-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px;"></div>
      </div>
      <div id="age-bday" style="margin-top:12px;display:none;background:rgba(124,58,237,0.1);border:1px solid var(--accent);border-radius:10px;padding:14px;text-align:center;font-size:0.85rem;color:var(--accent2);"></div>
    </div>
  </div>

  <!-- NOISE GENERATOR -->
  <div id="tab-noise" class="tool-panel">
    <div class="panel-card" style="max-width:540px;margin:0 auto;text-align:center;">
      <div class="panel-title">üåä Noise Generator</div>
      <div class="panel-desc">// White, brown, pink noise ‚Äî bantu fokus & relaksasi</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:20px 0;">
        <div id="noise-white-card" class="noise-card" onclick="toggleNoise('white')" style="background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;">
          <div style="font-size:2.5rem;">‚¨ú</div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-top:8px;">White Noise</div>
          <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Semua frekuensi rata</div>
        </div>
        <div id="noise-pink-card" class="noise-card" onclick="toggleNoise('pink')" style="background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;">
          <div style="font-size:2.5rem;">üå∏</div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-top:8px;">Pink Noise</div>
          <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Lembut & alami</div>
        </div>
        <div id="noise-brown-card" class="noise-card" onclick="toggleNoise('brown')" style="background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;">
          <div style="font-size:2.5rem;">üü§</div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-top:8px;">Brown Noise</div>
          <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">Dalam & berumur</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:16px;">
        <span style="font-size:0.8rem;color:var(--muted);">üîà</span>
        <input type="range" id="noise-vol" min="0" max="1" value="0.3" step="0.01" style="width:200px;" oninput="noiseSetVolume(this.value)">
        <span style="font-size:0.8rem;color:var(--muted);">üîä</span>
        <span id="noise-vol-pct" style="font-size:0.78rem;color:var(--muted);min-width:35px;">30%</span>
      </div>
      <div id="noise-status" style="font-size:0.85rem;color:var(--muted);margin-bottom:12px;">Pilih noise untuk mulai</div>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
        <button class="phrase-btn" onclick="noiseTimer(25)">‚è± 25 menit</button>
        <button class="phrase-btn" onclick="noiseTimer(45)">‚è± 45 menit</button>
        <button class="phrase-btn" onclick="noiseTimer(60)">‚è± 1 jam</button>
        <button class="phrase-btn" onclick="stopAllNoise()">‚èπ Stop Semua</button>
      </div>
      <div id="noise-timer-display" style="display:none;margin-top:12px;font-size:1.2rem;color:var(--accent3);font-family:'Space Mono',monospace;"></div>
    </div>
  </div>

  <!-- GLASSMORPHISM BUILDER -->
  <div id="tab-glass" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üé® CSS Glassmorphism Builder</div>
      <div class="panel-desc">// Buat efek kaca (glassmorphism) dan copy CSS-nya</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:20px;">
        <div>
          <label>Blur: <span id="gl-blur-v">12px</span></label>
          <input type="range" id="gl-blur" min="0" max="40" value="12" oninput="renderGlass()">
          <label>Transparansi: <span id="gl-alpha-v">0.15</span></label>
          <input type="range" id="gl-alpha" min="0" max="1" value="0.15" step="0.01" oninput="renderGlass()">
          <label>Border Opacity: <span id="gl-border-v">0.3</span></label>
          <input type="range" id="gl-border" min="0" max="1" value="0.3" step="0.01" oninput="renderGlass()">
          <label>Border Radius: <span id="gl-radius-v">16px</span></label>
          <input type="range" id="gl-radius" min="0" max="50" value="16" oninput="renderGlass()">
          <label>Shadow Intensity: <span id="gl-shadow-v">0.3</span></label>
          <input type="range" id="gl-shadow" min="0" max="1" value="0.3" step="0.01" oninput="renderGlass()">
          <label>Warna Tint</label>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
            <input type="color" id="gl-color" value="#ffffff" oninput="renderGlass()" style="width:50px;height:36px;">
            <span style="font-size:0.75rem;color:var(--muted);">Warna dasar kaca</span>
          </div>
          <label style="margin-top:12px;">Background Scene</label>
          <select id="gl-bg" onchange="renderGlass()">
            <option value="gradient1">üåà Gradient Purple-Cyan</option>
            <option value="gradient2">üåÖ Gradient Sunset</option>
            <option value="gradient3">üåø Gradient Forest</option>
            <option value="dots">‚ú¶ Dark with Dots</option>
          </select>
        </div>
        <div>
          <label>Preview</label>
          <div id="gl-scene" style="height:280px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;">
            <div id="gl-card" style="padding:28px 36px;text-align:center;">
              <div style="font-size:2rem;">‚ú®</div>
              <div style="font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700;margin:8px 0;">Glass Card</div>
              <div style="font-size:0.82rem;opacity:0.8;">Efek glassmorphism yang cantik</div>
            </div>
          </div>
          <label style="margin-top:16px;">CSS Code</label>
          <div class="output-box" id="gl-code" style="font-size:0.78rem;min-height:80px;">‚Äî
            <button class="copy-btn" onclick="cpOut('gl-code')">COPY</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DEVICE MOCKUP -->
  <div id="tab-mockup" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üì± Device Mockup Preview</div>
      <div class="panel-desc">// Preview URL atau HTML kamu di dalam frame perangkat</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:20px;">
        <div>
          <label>Perangkat</label>
          <select id="mk-device" onchange="renderMockup()">
            <option value="phone">üì± Smartphone</option>
            <option value="tablet">üìü Tablet</option>
            <option value="laptop">üíª Laptop</option>
          </select>
          <label>Warna Frame</label>
          <select id="mk-color" onchange="renderMockup()">
            <option value="#1a1a2e">üñ§ Dark</option>
            <option value="#f0f0f0">ü§ç Silver</option>
            <option value="#ffd700">ü•á Gold</option>
            <option value="#7c3aed">üü£ Purple</option>
          </select>
          <label style="margin-top:12px;">URL untuk Preview</label>
          <input type="text" id="mk-url" placeholder="https://example.com" value="https://example.com">
          <button class="btn btn-primary" onclick="renderMockup()" style="width:100%;margin-top:8px;">üîÑ Load Preview</button>
          <div style="margin-top:12px;font-size:0.72rem;color:var(--muted);">‚ö† Beberapa website tidak bisa di-embed karena kebijakan CORS mereka.</div>
          <div class="btn-group" style="margin-top:10px;">
            <button class="btn btn-secondary" onclick="mkQuick('https://google.com')">Google</button>
            <button class="btn btn-secondary" onclick="mkQuick('https://example.com')">Example</button>
          </div>
        </div>
        <div style="display:flex;align-items:center;justify-content:center;min-height:400px;" id="mk-preview-wrap">
          <div id="mk-frame-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- NUMBER SYSTEM -->
  <div id="tab-numSys" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üî¢ Konversi Sistem Bilangan</div>
      <div class="panel-desc">// Konversi antara biner, oktal, desimal, dan heksadesimal</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
        <div>
          <label>Desimal (Basis 10)</label>
          <input type="text" id="ns-dec" placeholder="255" oninput="nsConvert('dec')">
          <label>Biner (Basis 2)</label>
          <input type="text" id="ns-bin" placeholder="11111111" oninput="nsConvert('bin')">
        </div>
        <div>
          <label>Oktal (Basis 8)</label>
          <input type="text" id="ns-oct" placeholder="377" oninput="nsConvert('oct')">
          <label>Heksadesimal (Basis 16)</label>
          <input type="text" id="ns-hex" placeholder="FF" oninput="nsConvert('hex')">
        </div>
      </div>
      <div id="ns-info" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;font-size:0.82rem;color:var(--muted);min-height:50px;margin-bottom:16px;"></div>
      <div style="border-top:1px solid var(--border);padding-top:16px;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Operasi Bitwise</div>
        <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:end;">
          <div><label>A (desimal)</label><input type="number" id="bw-a" placeholder="12" oninput="calcBitwise()"></div>
          <div><label>B (desimal)</label><input type="number" id="bw-b" placeholder="10" oninput="calcBitwise()"></div>
          <div><label>&nbsp;</label><button class="btn btn-primary" onclick="calcBitwise()">Hitung</button></div>
        </div>
        <div id="bw-result" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <!-- GAMES -->
  <div id="tab-games" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üéÆ Mini Games</div>
      <div class="panel-desc">// Istirahat sejenak dengan game seru</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
        <button class="btn btn-primary" id="game-snake-btn" onclick="selectGame('snake')">üêç Snake</button>
        <button class="btn btn-secondary" id="game-flappy-btn" onclick="selectGame('flappy')">üê¶ Flappy Bird</button>
        <button class="btn btn-secondary" id="game-2048-btn" onclick="selectGame('2048')">üî¢ 2048</button>
        <button class="btn btn-secondary" id="game-breakout-btn" onclick="selectGame('breakout')">üß± Breakout</button>
      </div>
      <div style="display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;">
        <div style="text-align:center;">
          <canvas id="game-canvas" width="400" height="450" style="border:2px solid var(--border);border-radius:10px;background:#0a0a0f;display:block;"></canvas>
          <div id="game-score" style="font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700;color:var(--accent2);margin-top:8px;">Skor: 0</div>
          <div id="game-controls-hint" style="font-size:0.72rem;color:var(--muted);margin-top:4px;"></div>
        </div>
        <div style="flex:1;min-width:200px;">
          <div id="game-info" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;font-size:0.82rem;color:var(--muted);line-height:1.8;"></div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="startGame()" id="game-start-btn">‚ñ∂ Mulai</button>
            <button class="btn btn-secondary" onclick="pauseGame()" id="game-pause-btn">‚è∏ Pause</button>
            <button class="btn btn-secondary" onclick="openCheatMenu()" id="game-cheat-btn" style="border-color:#f59e0b;color:#f59e0b;" title="Developer Cheat Menu">üõ†Ô∏è Dev</button>
          </div>

          <!-- CHEAT PANEL (hidden by default) -->
          <div id="cheat-panel" style="display:none;margin-top:12px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.4);border-radius:10px;padding:14px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.82rem;color:#f59e0b;margin-bottom:10px;">üõ†Ô∏è Developer Cheat Mode ‚Äî <span id="cheat-game-label" style="color:var(--accent2);"></span></div>
            <div id="cheat-snake" style="display:none;flex-direction:column;gap:6px;">
              <div style="font-size:0.72rem;color:var(--muted);margin-bottom:4px;">üêç Snake Cheats</div>
              <button class="btn" onclick="cheat('snake','godmode')" style="background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger);font-size:0.78rem;">‚ò†Ô∏è God Mode (Tembus dinding & ekor)</button>
              <button class="btn" onclick="cheat('snake','grow')" style="background:rgba(124,58,237,0.15);border:1px solid var(--accent);color:var(--accent2);font-size:0.78rem;">üìà Tambah Panjang +10</button>
              <button class="btn" onclick="cheat('snake','speed')" style="background:rgba(6,182,212,0.15);border:1px solid var(--accent2);color:var(--accent2);font-size:0.78rem;">‚ö° Turbo Speed (2x)</button>
              <button class="btn" onclick="cheat('snake','score')" style="background:rgba(16,185,129,0.15);border:1px solid var(--success);color:var(--success);font-size:0.78rem;">üíØ +500 Skor Instan</button>
              <button class="btn" onclick="cheat('snake','slow')" style="background:rgba(107,107,138,0.15);border:1px solid var(--muted);color:var(--muted);font-size:0.78rem;">üê¢ Slow Motion</button>
            </div>
            <div id="cheat-flappy" style="display:none;flex-direction:column;gap:6px;">
              <div style="font-size:0.72rem;color:var(--muted);margin-bottom:4px;">üê¶ Flappy Bird Cheats</div>
              <button class="btn" onclick="cheat('flappy','noclip')" style="background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger);font-size:0.78rem;">üëª No Clip (Tembus Pipa)</button>
              <button class="btn" onclick="cheat('flappy','autojump')" style="background:rgba(124,58,237,0.15);border:1px solid var(--accent);color:var(--accent2);font-size:0.78rem;">ü§ñ Auto Jump (Bot Mode)</button>
              <button class="btn" onclick="cheat('flappy','nogravity')" style="background:rgba(6,182,212,0.15);border:1px solid var(--accent2);color:var(--accent2);font-size:0.78rem;">ü™Ç Anti Gravity</button>
              <button class="btn" onclick="cheat('flappy','score')" style="background:rgba(16,185,129,0.15);border:1px solid var(--success);color:var(--success);font-size:0.78rem;">üíØ +100 Skor Instan</button>
              <button class="btn" onclick="cheat('flappy','widegap')" style="background:rgba(245,158,11,0.15);border:1px solid #f59e0b;color:#f59e0b;font-size:0.78rem;">üö™ Wide Gap (Celah Lebar)</button>
            </div>
            <div id="cheat-2048" style="display:none;flex-direction:column;gap:6px;">
              <div style="font-size:0.72rem;color:var(--muted);margin-bottom:4px;">üî¢ 2048 Cheats</div>
              <button class="btn" onclick="cheat('2048','win')" style="background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger);font-size:0.78rem;">üèÜ Langsung Menang (Spawn 2048)</button>
              <button class="btn" onclick="cheat('2048','clear')" style="background:rgba(124,58,237,0.15);border:1px solid var(--accent);color:var(--accent2);font-size:0.78rem;">‚ú® Clear Board (Semua jadi 2)</button>
              <button class="btn" onclick="cheat('2048','maxscore')" style="background:rgba(16,185,129,0.15);border:1px solid var(--success);color:var(--success);font-size:0.78rem;">üíØ +10000 Skor</button>
              <button class="btn" onclick="cheat('2048','fill')" style="background:rgba(6,182,212,0.15);border:1px solid var(--accent2);color:var(--accent2);font-size:0.78rem;">üî¢ Fill Board (Semua 1024)</button>
            </div>
            <div id="cheat-breakout" style="display:none;flex-direction:column;gap:6px;">
              <div style="font-size:0.72rem;color:var(--muted);margin-bottom:4px;">üß± Breakout Cheats</div>
              <button class="btn" onclick="cheat('breakout','ballgod')" style="background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger);font-size:0.78rem;">‚ò†Ô∏è Bola Tidak Jatuh</button>
              <button class="btn" onclick="cheat('breakout','bigpaddle')" style="background:rgba(124,58,237,0.15);border:1px solid var(--accent);color:var(--accent2);font-size:0.78rem;">üìè Paddle Super Lebar</button>
              <button class="btn" onclick="cheat('breakout','destroyall')" style="background:rgba(16,185,129,0.15);border:1px solid var(--success);color:var(--success);font-size:0.78rem;">üí• Hancurkan Semua Bata</button>
              <button class="btn" onclick="cheat('breakout','multiball')" style="background:rgba(6,182,212,0.15);border:1px solid var(--accent2);color:var(--accent2);font-size:0.78rem;">‚öΩ Multi Ball (3 Bola)</button>
              <button class="btn" onclick="cheat('breakout','slowball')" style="background:rgba(107,107,138,0.15);border:1px solid var(--muted);color:var(--muted);font-size:0.78rem;">üê¢ Bola Lambat</button>
            </div>
            <div id="cheat-status" style="margin-top:8px;font-size:0.72rem;color:#f59e0b;min-height:18px;font-family:'Space Mono',monospace;"></div>
          </div>

          <!-- CHEAT PASSWORD MODAL -->
          <div id="cheat-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:9999;display:none;align-items:center;justify-content:center;" onkeydown="event.stopPropagation()" onkeyup="event.stopPropagation()" onkeypress="event.stopPropagation()">
            <div style="background:var(--surface);border:2px solid #f59e0b;border-radius:16px;padding:32px;max-width:360px;width:90%;text-align:center;box-shadow:0 0 60px rgba(245,158,11,0.3);">
              <div style="font-size:2.5rem;margin-bottom:8px;">üõ†Ô∏è</div>
              <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:1.1rem;color:#f59e0b;margin-bottom:6px;">Developer Cheat Mode</div>
              <div style="font-size:0.78rem;color:var(--muted);margin-bottom:20px;">Masukkan password developer untuk mengakses cheat</div>
              <input type="password" id="cheat-pass-input" placeholder="Password..." style="width:100%;text-align:center;font-size:1rem;letter-spacing:3px;margin-bottom:12px;" onkeydown="event.stopPropagation();if(event.key==='Enter')submitCheatPass()">
              <div id="cheat-pass-error" style="color:var(--danger);font-size:0.75rem;min-height:18px;margin-bottom:10px;"></div>
              <div style="display:flex;gap:8px;justify-content:center;">
                <button class="btn btn-primary" onclick="submitCheatPass()" style="border-color:#f59e0b;background:rgba(245,158,11,0.2);color:#f59e0b;">üîì Masuk</button>
                <button class="btn btn-secondary" onclick="closeCheatModal()">Batal</button>
              </div>
            </div>
          </div>
          <div id="game-highscore" style="margin-top:12px;font-size:0.78rem;color:var(--muted);"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI SUPPORT -->
  <div id="tab-aihelp" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">ü§ñ AI Assistant ‚Äî Powered by Claude</div>
      <div class="panel-desc">// AI asli yang bisa mengelola & memperbaiki toolbox secara otomatis</div>

      <!-- Auto Scanner Strip -->
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px 16px;margin-bottom:12px;">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.82rem;color:var(--accent2);">üîç Auto Bug Scanner</div>
          <select id="ai-scan-interval" style="width:110px;font-size:0.75rem;padding:4px 8px;">
            <option value="0">Manual saja</option>
            <option value="30">30 detik</option>
            <option value="60" selected>1 menit</option>
            <option value="120">2 menit</option>
            <option value="300">5 menit</option>
          </select>
          <button class="btn btn-primary" onclick="startAiScanner()" id="ai-scanner-btn" style="font-size:0.75rem;padding:5px 10px;">‚ñ∂ Aktifkan</button>
          <button class="btn btn-secondary" onclick="stopAiScanner()" style="font-size:0.75rem;padding:5px 10px;">‚èπ Stop</button>
          <button class="btn btn-cyan" onclick="runManualScan()" style="font-size:0.75rem;padding:5px 10px;">üîç Scan Now</button>
        </div>
        <div id="ai-scanner-status" style="margin-top:6px;font-size:0.72rem;color:var(--muted);">Scanner belum aktif</div>
        <div id="ai-scan-log" style="margin-top:6px;max-height:80px;overflow-y:auto;font-size:0.68rem;font-family:'Space Mono',monospace;display:flex;flex-direction:column;gap:2px;"></div>
      </div>

      <!-- Chat -->
      <div id="ai-messages" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:320px;max-height:420px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;">
        <div class="ai-msg ai-bot">
          <div class="ai-avatar">ü§ñ</div>
          <div class="ai-bubble">Halo! Saya <strong>Claude AI</strong> ‚Äî AI asli yang terintegrasi di Toolbox ini.<br><br>Saya bisa:<br>‚Ä¢ üí¨ Menjawab pertanyaan apapun dengan cerdas<br>‚Ä¢ üîß Mendeteksi & memperbaiki bug otomatis<br>‚Ä¢ üöÄ Membuka tool, menjelaskan fitur, membantu tugas<br>‚Ä¢ üìä Menganalisis data & memberi saran<br><br>Tanya apapun ‚Äî saya siap membantu! ‚ú®</div>
        </div>
      </div>

      <!-- Input area -->
      <div style="display:flex;gap:8px;margin-top:10px;">
        <textarea id="ai-input" placeholder="Tanya apapun ke Claude AI... (Enter = kirim, Shift+Enter = baris baru)" style="flex:1;min-height:44px;max-height:120px;resize:vertical;font-size:0.85rem;line-height:1.5;" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendAI();}"></textarea>
        <button class="btn btn-primary" onclick="sendAI()" id="ai-send-btn" style="align-self:flex-end;padding:12px 18px;">‚û§</button>
      </div>

      <!-- Quick actions -->
      <div style="display:flex;flex-wrap:wrap;gap:5px;margin-top:8px;">
        <button class="phrase-btn" onclick="aiQuick('Buka tab translate')">Buka Translate</button>
        <button class="phrase-btn" onclick="aiQuick('Scan dan perbaiki semua bug di toolbox ini')">Scan Bug</button>
        <button class="phrase-btn" onclick="aiQuick('Tools apa saja yang ada di toolbox ini?')">List Tools</button>
        <button class="phrase-btn" onclick="aiQuick('Generate password yang kuat untuk saya')">Generate Password</button>
        <button class="phrase-btn" onclick="aiQuick('Analisis keadaan toolbox sekarang ‚Äî apakah ada yang perlu diperbaiki?')">Analisis Toolbox</button>
        <button class="phrase-btn" onclick="aiQuick('Buatkan to-do list untuk hari ini')">Buat To-Do</button>
        <button class="phrase-btn" onclick="aiQuick('Reset semua game ke kondisi awal')">Reset Games</button>
      </div>
    </div>
  </div>

  <!-- CALENDAR -->
  <div id="tab-calendar" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üìÖ Kalender & Event Planner</div>
      <div class="panel-desc">// Catat jadwal & event ‚Äî tersimpan otomatis di browser</div>
      <div style="display:grid;grid-template-columns:1fr 300px;gap:16px;">
        <div>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
            <button class="btn btn-secondary" onclick="calNav(-1)" style="padding:6px 14px;">‚óÄ</button>
            <div id="cal-title" style="font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem;color:var(--text);"></div>
            <button class="btn btn-secondary" onclick="calNav(1)" style="padding:6px 14px;">‚ñ∂</button>
          </div>
          <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:4px;">
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Min</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Sen</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Sel</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Rab</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Kam</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Jum</div>
            <div style="text-align:center;font-size:0.68rem;color:var(--muted);padding:4px;">Sab</div>
          </div>
          <div id="cal-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;"></div>
        </div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.85rem;color:var(--accent2);margin-bottom:10px;" id="cal-selected-date">Pilih tanggal</div>
          <input type="text" id="cal-event-title" placeholder="Judul event..." style="width:100%;margin-bottom:8px;">
          <div style="display:flex;gap:6px;margin-bottom:8px;">
            <input type="time" id="cal-event-time" style="flex:1;">
            <input type="color" id="cal-event-color" value="#7c3aed" style="width:44px;height:38px;">
          </div>
          <select id="cal-event-cat" style="width:100%;margin-bottom:8px;">
            <option value="kerja">üíº Kerja</option><option value="personal">üë§ Personal</option>
            <option value="kesehatan">üè• Kesehatan</option><option value="belajar">üìö Belajar</option>
            <option value="lainnya">üìå Lainnya</option>
          </select>
          <button class="btn btn-primary" onclick="calAddEvent()" style="width:100%;">+ Tambah Event</button>
          <div id="cal-day-events" style="margin-top:12px;display:flex;flex-direction:column;gap:6px;max-height:260px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- BUDGET TRACKER -->
  <div id="tab-budget" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üí∞ Budget Tracker</div>
      <div class="panel-desc">// Catat pemasukan & pengeluaran, lihat grafik keuangan</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:20px;">
        <div style="background:rgba(16,185,129,0.1);border:1px solid var(--success);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:0.7rem;color:var(--success);text-transform:uppercase;letter-spacing:1px;">Total Pemasukan</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--success);" id="bgt-income">Rp 0</div>
        </div>
        <div style="background:rgba(239,68,68,0.1);border:1px solid var(--danger);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:0.7rem;color:var(--danger);text-transform:uppercase;letter-spacing:1px;">Total Pengeluaran</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--danger);" id="bgt-expense">Rp 0</div>
        </div>
        <div id="bgt-balance-card" style="background:rgba(124,58,237,0.1);border:1px solid var(--accent);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:0.7rem;color:var(--accent2);text-transform:uppercase;letter-spacing:1px;">Saldo</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--accent2);" id="bgt-balance">Rp 0</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.85rem;color:var(--text);margin-bottom:12px;">+ Tambah Transaksi</div>
          <div style="display:flex;gap:6px;margin-bottom:10px;">
            <button class="btn" id="bgt-type-in" onclick="setBgtType('income')" style="flex:1;background:rgba(16,185,129,0.2);border:1px solid var(--success);color:var(--success);">+ Masuk</button>
            <button class="btn" id="bgt-type-out" onclick="setBgtType('expense')" style="flex:1;background:var(--surface2);border:1px solid var(--border);color:var(--muted);">‚àí Keluar</button>
          </div>
          <input type="text" id="bgt-desc" placeholder="Keterangan..." style="width:100%;margin-bottom:8px;">
          <input type="number" id="bgt-amount" placeholder="Jumlah (Rp)" style="width:100%;margin-bottom:8px;">
          <select id="bgt-cat" style="width:100%;margin-bottom:8px;">
            <option value="gaji">üíº Gaji/Usaha</option><option value="makanan">üçî Makanan</option>
            <option value="transport">üöó Transport</option><option value="belanja">üõçÔ∏è Belanja</option>
            <option value="tagihan">üìÑ Tagihan</option><option value="hiburan">üéÆ Hiburan</option>
            <option value="lainnya">üìå Lainnya</option>
          </select>
          <input type="date" id="bgt-date" style="width:100%;margin-bottom:10px;">
          <button class="btn btn-primary" onclick="bgtAdd()" style="width:100%;">Simpan</button>
        </div>
        <div>
          <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center;flex-wrap:wrap;">
            <button class="phrase-btn" onclick="bgtFilter('all')">Semua</button>
            <button class="phrase-btn" onclick="bgtFilter('income')">Pemasukan</button>
            <button class="phrase-btn" onclick="bgtFilter('expense')">Pengeluaran</button>
            <button class="btn btn-secondary" onclick="bgtExport()" style="margin-left:auto;font-size:0.72rem;padding:5px 10px;">Export CSV</button>
            <button class="btn btn-secondary" onclick="if(confirm('Hapus semua?'))bgtClear()" style="font-size:0.72rem;padding:5px 10px;color:var(--danger);">Hapus Semua</button>
          </div>
          <canvas id="bgt-chart" height="120" style="width:100%;margin-bottom:12px;"></canvas>
          <div id="bgt-list" style="display:flex;flex-direction:column;gap:6px;max-height:300px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- HABIT TRACKER -->
  <div id="tab-habit" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üéØ Habit Tracker</div>
      <div class="panel-desc">// Pantau kebiasaan harian ‚Äî streak & statistik 30 hari</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;align-items:flex-end;flex-wrap:wrap;">
        <input type="text" id="habit-name" placeholder="Nama kebiasaan baru..." style="flex:1;min-width:180px;">
        <input type="color" id="habit-color" value="#7c3aed" style="width:44px;height:38px;">
        <select id="habit-icon" style="width:80px;">
          <option>üí™</option><option>üìö</option><option>üèÉ</option><option>üíß</option>
          <option>üßò</option><option>ü•ó</option><option>üò¥</option><option>üéØ</option>
          <option>‚úçÔ∏è</option><option>üé∏</option>
        </select>
        <button class="btn btn-primary" onclick="habitAdd()">+ Tambah</button>
      </div>
      <div id="habit-list" style="display:flex;flex-direction:column;gap:10px;"></div>
      <div id="habit-empty" style="text-align:center;color:var(--muted);padding:30px;font-size:0.85rem;display:none;">Belum ada kebiasaan. Tambahkan di atas!</div>
    </div>
  </div>

  <!-- FLASHCARD -->
  <div id="tab-flashcard" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üìñ Flashcard & Quiz Maker</div>
      <div class="panel-desc">// Buat kartu belajar dan kuis interaktif</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <button class="btn btn-primary" id="fc-mode-create" onclick="setFcMode('create')">‚úèÔ∏è Buat Kartu</button>
        <button class="btn btn-secondary" id="fc-mode-study" onclick="setFcMode('study')">üìñ Belajar</button>
        <button class="btn btn-secondary" id="fc-mode-quiz" onclick="setFcMode('quiz')">üéØ Kuis</button>
      </div>
      <!-- CREATE MODE -->
      <div id="fc-create">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px;">
          <div><label>Pertanyaan / Depan</label><textarea id="fc-q" style="min-height:80px;" placeholder="Apa itu fotosintesis?"></textarea></div>
          <div><label>Jawaban / Belakang</label><textarea id="fc-a" style="min-height:80px;" placeholder="Proses tumbuhan mengubah cahaya matahari jadi makanan..."></textarea></div>
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end;">
          <div style="flex:1;"><label>Deck / Kategori</label><input type="text" id="fc-deck" placeholder="Nama deck..."></div>
          <button class="btn btn-primary" onclick="fcAddCard()">+ Tambah Kartu</button>
          <button class="btn btn-secondary" onclick="fcImport()">Import CSV</button>
        </div>
        <div id="fc-card-list" style="margin-top:16px;display:flex;flex-direction:column;gap:6px;max-height:300px;overflow-y:auto;"></div>
      </div>
      <!-- STUDY MODE -->
      <div id="fc-study" style="display:none;text-align:center;">
        <div style="margin-bottom:12px;"><label>Deck: </label>
          <select id="fc-study-deck" style="width:200px;" onchange="fcStudyInit()"></select>
        </div>
        <div id="fc-flip-card" onclick="fcFlip()" style="cursor:pointer;background:var(--bg);border:2px solid var(--border);border-radius:16px;padding:40px 24px;min-height:180px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;position:relative;margin-bottom:16px;">
          <div id="fc-flip-content" style="font-size:1.2rem;color:var(--text);text-align:center;"></div>
          <div style="position:absolute;bottom:10px;right:14px;font-size:0.68rem;color:var(--muted);">Klik untuk balik</div>
        </div>
        <div style="display:flex;gap:8px;justify-content:center;margin-bottom:12px;">
          <button class="btn btn-secondary" onclick="fcStudyNav(-1)">‚óÄ Prev</button>
          <span id="fc-study-progress" style="line-height:2.2;font-size:0.82rem;color:var(--muted);"></span>
          <button class="btn btn-secondary" onclick="fcStudyNav(1)">Next ‚ñ∂</button>
        </div>
        <div style="display:flex;gap:8px;justify-content:center;">
          <button class="btn btn-secondary" onclick="fcStudyInit()">üîÄ Acak Ulang</button>
        </div>
      </div>
      <!-- QUIZ MODE -->
      <div id="fc-quiz" style="display:none;">
        <div id="fc-quiz-setup" style="text-align:center;">
          <label>Deck: </label><select id="fc-quiz-deck" style="width:200px;"></select>
          <button class="btn btn-primary" onclick="fcQuizStart()" style="margin-left:10px;">Mulai Kuis</button>
        </div>
        <div id="fc-quiz-play" style="display:none;">
          <div id="fc-quiz-q" style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:24px;text-align:center;font-size:1.1rem;min-height:80px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;"></div>
          <input type="text" id="fc-quiz-ans" placeholder="Ketik jawaban..." style="width:100%;margin-bottom:8px;" onkeydown="if(event.key==='Enter')fcQuizCheck()">
          <div style="display:flex;gap:8px;justify-content:center;">
            <button class="btn btn-primary" onclick="fcQuizCheck()">‚úì Cek</button>
            <button class="btn btn-secondary" onclick="fcQuizSkip()">Skip ‚ñ∂</button>
          </div>
          <div id="fc-quiz-feedback" style="text-align:center;margin-top:12px;font-size:0.9rem;min-height:32px;"></div>
          <div style="margin-top:8px;font-size:0.78rem;color:var(--muted);text-align:center;" id="fc-quiz-score"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- VIDEO TO GIF -->
  <div id="tab-videogif" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üé¨ Video ‚Üí GIF Converter</div>
      <div class="panel-desc">// Konversi video pendek jadi GIF langsung di browser</div>
      <div id="vg-drop" style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;cursor:pointer;" onclick="document.getElementById('vg-file').click()" ondragover="event.preventDefault();this.style.borderColor='var(--accent)'" ondragleave="this.style.borderColor='var(--border)'" ondrop="vgDrop(event)">
        <div style="font-size:2.5rem;">üé¨</div>
        <div style="color:var(--muted);margin-top:8px;font-size:0.85rem;">Klik atau drag & drop video</div>
        <div style="color:var(--muted);font-size:0.72rem;margin-top:4px;">MP4, WebM, MOV ‚Äî max 50MB</div>
        <input type="file" id="vg-file" accept="video/*" style="display:none;" onchange="vgLoad(this)">
      </div>
      <div id="vg-controls" style="display:none;margin-top:16px;">
        <video id="vg-video" style="max-width:100%;border-radius:8px;margin-bottom:12px;" controls></video>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px;">
          <div>
            <label>Mulai (detik): <span id="vg-start-v">0</span></label>
            <input type="range" id="vg-start" min="0" max="30" value="0" step="0.1" oninput="document.getElementById('vg-start-v').textContent=parseFloat(this.value).toFixed(1)">
            <label>Selesai (detik): <span id="vg-end-v">5</span></label>
            <input type="range" id="vg-end" min="0" max="30" value="5" step="0.1" oninput="document.getElementById('vg-end-v').textContent=parseFloat(this.value).toFixed(1)">
          </div>
          <div>
            <label>FPS: <span id="vg-fps-v">10</span></label>
            <input type="range" id="vg-fps" min="5" max="24" value="10" oninput="document.getElementById('vg-fps-v').textContent=this.value">
            <label>Lebar output (px): <span id="vg-w-v">320</span></label>
            <input type="range" id="vg-w" min="120" max="640" value="320" step="10" oninput="document.getElementById('vg-w-v').textContent=this.value">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="vgConvert()" id="vg-btn">üé¨ Convert ke GIF</button>
          <button class="btn btn-secondary" onclick="vgReset()">Ganti Video</button>
        </div>
        <div id="vg-progress" style="display:none;margin-top:12px;">
          <div style="background:var(--border);border-radius:4px;height:8px;overflow:hidden;"><div id="vg-prog-bar" style="height:100%;background:var(--accent);width:0%;transition:width 0.2s;border-radius:4px;"></div></div>
          <div id="vg-prog-text" style="font-size:0.75rem;color:var(--muted);margin-top:4px;text-align:center;"></div>
        </div>
        <div id="vg-result" style="display:none;margin-top:12px;text-align:center;">
          <img id="vg-gif" style="max-width:100%;border-radius:8px;border:1px solid var(--border);">
          <div class="btn-group" style="justify-content:center;margin-top:10px;">
            <button class="btn btn-primary" onclick="vgDownload()">‚¨á Download GIF</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MEME GENERATOR -->
  <div id="tab-meme" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üñºÔ∏è Meme Generator</div>
      <div class="panel-desc">// Tambah teks ke gambar & buat meme sendiri</div>
      <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
        <div>
          <label>Template Meme</label>
          <div id="meme-templates" style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-bottom:10px;max-height:140px;overflow-y:auto;"></div>
          <div style="text-align:center;margin-bottom:8px;font-size:0.72rem;color:var(--muted);">atau</div>
          <button class="btn btn-secondary" onclick="document.getElementById('meme-file').click()" style="width:100%;margin-bottom:12px;">üìÅ Upload Gambar</button>
          <input type="file" id="meme-file" accept="image/*" style="display:none;" onchange="memeLoadFile(this)">
          <label>Teks Atas</label>
          <input type="text" id="meme-top" placeholder="TEKS ATAS" oninput="drawMeme()">
          <label>Teks Bawah</label>
          <input type="text" id="meme-bottom" placeholder="TEKS BAWAH" oninput="drawMeme()">
          <label>Ukuran Font: <span id="meme-fs-v">40</span></label>
          <input type="range" id="meme-fs" min="16" max="80" value="40" oninput="document.getElementById('meme-fs-v').textContent=this.value;drawMeme()">
          <label>Warna Teks</label>
          <div style="display:flex;gap:8px;">
            <input type="color" id="meme-color" value="#ffffff" oninput="drawMeme()" style="width:50px;height:36px;">
            <input type="color" id="meme-stroke" value="#000000" oninput="drawMeme()" style="width:50px;height:36px;">
            <span style="font-size:0.72rem;color:var(--muted);line-height:2.2;">Fill / Stroke</span>
          </div>
          <div class="btn-group" style="margin-top:12px;">
            <button class="btn btn-primary" onclick="memeDownload()">‚¨á Download</button>
          </div>
        </div>
        <div>
          <label>Preview</label>
          <canvas id="meme-canvas" style="max-width:100%;border:1px solid var(--border);border-radius:8px;display:block;background:#111;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- BPM TAP COUNTER -->
  <div id="tab-bpm" class="tool-panel">
    <div class="panel-card" style="max-width:480px;margin:0 auto;text-align:center;">
      <div class="panel-title">üéµ BPM Tap Counter</div>
      <div class="panel-desc">// Tap sesuai irama untuk menghitung tempo lagu (BPM)</div>
      <div id="bpm-display" style="font-family:'Syne',sans-serif;font-size:6rem;font-weight:800;color:var(--accent2);letter-spacing:-2px;margin:20px 0;line-height:1;transition:color 0.1s;">--</div>
      <div style="font-size:0.85rem;color:var(--muted);margin-bottom:24px;" id="bpm-label">Tap untuk mulai</div>
      <button id="bpm-btn" onclick="bpmTap()" style="width:200px;height:200px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:white;font-size:1.4rem;font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;transition:transform 0.08s,box-shadow 0.08s;box-shadow:0 8px 32px rgba(124,58,237,0.4);" onmousedown="this.style.transform='scale(0.94)';this.style.boxShadow='0 4px 16px rgba(124,58,237,0.3)'" onmouseup="this.style.transform='';this.style.boxShadow='0 8px 32px rgba(124,58,237,0.4)'">TAP</button>
      <div style="margin-top:24px;display:flex;gap:16px;justify-content:center;flex-wrap:wrap;">
        <div style="text-align:center;"><div id="bpm-taps" style="font-size:1.2rem;font-weight:700;color:var(--accent3);">0</div><div style="font-size:0.68rem;color:var(--muted);">Taps</div></div>
        <div style="text-align:center;"><div id="bpm-min" style="font-size:1.2rem;font-weight:700;color:var(--success);">--</div><div style="font-size:0.68rem;color:var(--muted);">Min BPM</div></div>
        <div style="text-align:center;"><div id="bpm-max" style="font-size:1.2rem;font-weight:700;color:var(--danger);">--</div><div style="font-size:0.68rem;color:var(--muted);">Max BPM</div></div>
      </div>
      <div style="margin-top:20px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-secondary" onclick="bpmReset()">‚Ü∫ Reset</button>
        <button class="phrase-btn" onclick="bpmSetManual(60)">60 BPM</button>
        <button class="phrase-btn" onclick="bpmSetManual(90)">90 BPM</button>
        <button class="phrase-btn" onclick="bpmSetManual(120)">120 BPM</button>
        <button class="phrase-btn" onclick="bpmSetManual(140)">140 BPM</button>
      </div>
      <div id="bpm-genre" style="margin-top:12px;font-size:0.78rem;color:var(--accent);font-style:italic;min-height:20px;"></div>
      <canvas id="bpm-viz" width="400" height="60" style="margin-top:16px;border-radius:8px;"></canvas>
    </div>
  </div>

  <!-- URL SHORTENER + QR COMBO -->
  <div id="tab-urlqr" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üåê URL Shortener + QR Combo</div>
      <div class="panel-desc">// Analisis URL + langsung buat QR code-nya</div>
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <input type="text" id="uq-input" placeholder="https://example.com/path/to/very/long/url" style="flex:1;" oninput="uqAnalyze()">
        <button class="btn btn-primary" onclick="uqProcess()">üîç Proses</button>
      </div>
      <div id="uq-result" style="display:none;">
        <div style="display:grid;grid-template-columns:1fr auto;gap:20px;align-items:start;">
          <div>
            <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;">
              <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Analisis URL</div>
              <div id="uq-analysis" style="font-size:0.82rem;line-height:1.9;color:var(--text);"></div>
            </div>
            <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;">
              <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">URL Pendek (via TinyURL)</div>
              <div id="uq-short" style="color:var(--accent2);font-size:0.9rem;word-break:break-all;"></div>
              <button class="btn btn-secondary" onclick="uqCopyShort()" style="margin-top:8px;font-size:0.72rem;padding:5px 10px;">Copy</button>
            </div>
            <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
              <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Riwayat (tersimpan lokal)</div>
              <div id="uq-history" style="display:flex;flex-direction:column;gap:6px;max-height:160px;overflow-y:auto;"></div>
            </div>
          </div>
          <div style="text-align:center;">
            <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">QR Code</div>
            <canvas id="uq-qr" style="border:1px solid var(--border);border-radius:8px;background:#fff;"></canvas>
            <div class="btn-group" style="justify-content:center;margin-top:8px;">
              <button class="btn btn-secondary" onclick="uqDownloadQR()" style="font-size:0.72rem;">‚¨á QR</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ABOUT -->
  <div id="tab-about" class="tool-panel">
    <div class="panel-card" style="text-align:center;padding:44px 28px;">
      <div style="font-size:3rem;margin-bottom:10px;">‚ö°</div>
      <div style="font-family:'Syne',sans-serif;font-size:2rem;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-1px;">TOOLBOX</div>
      <div style="color:var(--muted);font-size:0.72rem;letter-spacing:3px;text-transform:uppercase;margin-bottom:36px;">Kumpulan Tools Berguna</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;max-width:580px;margin:0 auto 36px;">
        <!-- Adam -->
        <div style="background:var(--bg);border:2px solid var(--accent);border-radius:16px;padding:26px 18px;position:relative;overflow:hidden;">
          <div style="position:absolute;top:-20px;right:-20px;width:70px;height:70px;background:var(--accent);opacity:0.1;border-radius:50%;"></div>
          <div style="font-size:2.8rem;margin-bottom:10px;">üëë</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:800;color:var(--accent2);margin-bottom:6px;">Adam</div>
          <div style="display:inline-block;background:rgba(124,58,237,0.2);border:1px solid var(--accent);color:var(--accent);font-size:0.68rem;padding:2px 9px;border-radius:20px;margin-bottom:10px;">‚ú® YANG GANTENG</div>
          <div style="color:var(--muted);font-size:0.76rem;line-height:1.7;">Pembuat & Developer<br>Pemilik ide brilliant<br><span style="color:var(--accent3);">üèÜ Main Creator</span></div>
        </div>
        <!-- Winda -->
        <div style="background:var(--bg);border:2px solid var(--border);border-radius:16px;padding:26px 18px;position:relative;overflow:hidden;">
          <div style="position:absolute;top:-20px;right:-20px;width:70px;height:70px;background:var(--muted);opacity:0.08;border-radius:50%;"></div>
          <div style="font-size:2.8rem;margin-bottom:10px;">üò¨</div>
          <div style="font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:800;color:var(--muted);margin-bottom:6px;">Winda</div>
          <div style="display:inline-block;background:rgba(107,107,138,0.15);border:1px solid var(--border);color:var(--muted);font-size:0.68rem;padding:2px 9px;border-radius:20px;margin-bottom:10px;">üíÄ SI JELEK</div>
          <div style="color:var(--muted);font-size:0.76rem;line-height:1.7;">Saudara Adam<br>Tester tidak resmi<br><span style="opacity:0.5;">ü•à Supporter (katanya)</span></div>
        </div>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:18px 24px;max-width:480px;margin:0 auto 32px;font-size:0.82rem;color:var(--muted);line-height:1.8;font-style:italic;">
        "Dibuat dengan ‚ù§Ô∏è oleh Adam yang ganteng,<br>didukung (mungkin) oleh Winda si jelek." üòÑ
      </div>
      <div style="border-top:1px solid var(--border);padding-top:24px;">
        <div style="font-size:0.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px;">53 Tools Tersedia</div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;justify-content:center;">
          <span class="about-badge">üìù Text</span><span class="about-badge">üîê Password</span><span class="about-badge">üîÑ Base64</span>
          <span class="about-badge">üì¶ JSON</span><span class="about-badge">üé® Warna</span><span class="about-badge">üìè Unit</span>
          <span class="about-badge">üîë Hash</span><span class="about-badge">‚è∞ Waktu</span><span class="about-badge">üßÆ Kalkulator</span>
          <span class="about-badge">üåê Translate</span><span class="about-badge">üì∑ QR Code</span><span class="about-badge">üé≤ Random</span>
          <span class="about-badge">üìÑ Markdown</span><span class="about-badge">üîç Regex</span><span class="about-badge">‚è±Ô∏è Timer</span>
          <span class="about-badge">üìä CSV‚ÜíTabel</span><span class="about-badge">üåà Gradient</span><span class="about-badge">üóúÔ∏è Minifier</span>
          <span class="about-badge">üìã To-Do</span><span class="about-badge">üóíÔ∏è Notepad</span><span class="about-badge">üí± Kurs</span>
          <span class="about-badge">üå§Ô∏è Cuaca</span><span class="about-badge">üñºÔ∏è Kompres</span><span class="about-badge">üî§ Font</span>
          <span class="about-badge">üíª Snippet</span><span class="about-badge">üìê Aspek Rasio</span>
          <span class="about-badge">üß† Mindmap</span><span class="about-badge">üéµ Morse</span><span class="about-badge">üåç World Clock</span>
          <span class="about-badge">üîÆ Fake Data</span><span class="about-badge">üé® Palette</span><span class="about-badge">üìä Chart</span>
          <span class="about-badge">üîê Enkripsi</span><span class="about-badge">üñãÔ∏è ASCII Art</span>
          <span class="about-badge">üéØ Pomodoro</span><span class="about-badge">üé§ TTS</span><span class="about-badge">üì∏ OCR</span>
          <span class="about-badge">üßÆ Kalkulator Umur</span><span class="about-badge">üåä Noise</span><span class="about-badge">üé® Glassmorphism</span>
          <span class="about-badge">üì± Mockup</span><span class="about-badge">üî¢ Bilangan</span><span class="about-badge">üéÆ Games</span>
          <span class="about-badge">ü§ñ AI Claude</span>
          <span class="about-badge">üìÖ Kalender</span><span class="about-badge">üí∞ Budget</span><span class="about-badge">üéØ Habit</span>
          <span class="about-badge">üìñ Flashcard</span><span class="about-badge">üé¨ Video‚ÜíGIF</span><span class="about-badge">üñºÔ∏è Meme</span>
          <span class="about-badge">üéµ BPM</span><span class="about-badge">üåê URL+QR</span>
        </div>
      </div>
    </div>
  </div>

  <!-- THEME CUSTOMIZER -->
  <div id="tab-theme" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üé® Theme Customizer</div>
      <div class="panel-desc">// Atur tampilan Toolbox sesukamu ‚Äî tersimpan permanen</div>
      <div class="grid-2" style="gap:20px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">üé≠ Preset Tema</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;" id="theme-presets"></div>
          <div style="margin-top:16px;font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">üî§ Font UI</div>
          <select id="theme-font" onchange="themeApply()">
            <option value="'Space Mono',monospace">Space Mono (Default)</option>
            <option value="'Syne',sans-serif">Syne</option>
            <option value="'Courier New',monospace">Courier New</option>
            <option value="system-ui,sans-serif">System UI</option>
            <option value="Georgia,serif">Georgia</option>
          </select>
          <div style="margin-top:12px;font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">üìê Border Radius</div>
          <input type="range" id="theme-radius" min="0" max="20" value="8" oninput="themeApply()">
          <div style="font-size:0.7rem;color:var(--muted);margin-top:4px;">Radius: <span id="theme-radius-val">8</span>px</div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">üé® Warna Custom</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <div><label>Accent Utama</label><input type="color" id="tc-accent" value="#7c3aed" oninput="themeApply()"></div>
            <div><label>Accent 2</label><input type="color" id="tc-accent2" value="#06b6d4" oninput="themeApply()"></div>
            <div><label>Background</label><input type="color" id="tc-bg" value="#0a0a0f" oninput="themeApply()"></div>
            <div><label>Surface</label><input type="color" id="tc-surface" value="#13131a" oninput="themeApply()"></div>
            <div><label>Teks</label><input type="color" id="tc-text" value="#e8e8f0" oninput="themeApply()"></div>
            <div><label>Highlight</label><input type="color" id="tc-accent3" value="#f59e0b" oninput="themeApply()"></div>
          </div>
          <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="themeSave()">üíæ Simpan Tema</button>
            <button class="btn btn-secondary" onclick="themeReset()">‚Ü∫ Reset Default</button>
            <button class="btn btn-secondary" onclick="themeExportCSS()">üìã Copy CSS</button>
          </div>
          <div id="theme-saved-msg" style="margin-top:8px;font-size:0.72rem;color:var(--success);min-height:18px;"></div>
        </div>
      </div>
      <div style="margin-top:20px;padding:16px;background:var(--bg);border:1px solid var(--border);border-radius:10px;">
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:8px;">PREVIEW KOMPONEN</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;">
          <button class="btn btn-primary">Primary</button>
          <button class="btn btn-secondary">Secondary</button>
          <span class="badge">Badge</span>
        </div>
        <div class="output-box" style="min-height:40px;">Preview ‚Äî <span style="color:var(--accent3);">warna highlight</span></div>
      </div>
    </div>
  </div>

  <!-- REMINDER -->
  <div id="tab-reminder" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üîî Notifikasi &amp; Reminder</div>
      <div class="panel-desc">// Set reminder dengan bunyi &amp; browser notification</div>
      <div class="grid-2">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">Tambah Reminder</div>
          <label>Judul</label>
          <input type="text" id="rem-title" placeholder="Contoh: Meeting jam 3...">
          <label>Waktu</label>
          <input type="datetime-local" id="rem-time" style="color-scheme:dark;">
          <label>Pesan (opsional)</label>
          <textarea id="rem-msg" style="min-height:60px;" placeholder="Detail reminder..."></textarea>
          <label>Suara</label>
          <select id="rem-sound">
            <option value="beep">Beep</option>
            <option value="chime">Chime</option>
            <option value="alarm">Alarm</option>
            <option value="none">Tidak Ada</option>
          </select>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="remAdd()">Tambah</button>
            <button class="btn btn-secondary" onclick="remRequestPermission()">Izin Notif</button>
          </div>
          <div id="rem-notif-status" style="margin-top:8px;font-size:0.72rem;color:var(--muted);"></div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">Daftar Reminder</div>
          <div id="rem-list" style="display:flex;flex-direction:column;gap:8px;max-height:380px;overflow-y:auto;"></div>
          <div id="rem-empty" style="color:var(--muted);font-size:0.78rem;text-align:center;padding:20px;">Belum ada reminder</div>
        </div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD ANALYTICS -->
  <div id="tab-dashboard" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üìä Dashboard Analytics</div>
      <div class="panel-desc">// Statistik penggunaan Toolbox kamu</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:20px;" id="dash-stats-row"></div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Top Tools Sering Dipakai</div>
          <div id="dash-top-tools" style="display:flex;flex-direction:column;gap:6px;"></div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Aktivitas 7 Hari Terakhir</div>
          <canvas id="dash-chart" height="180" style="width:100%;border:1px solid var(--border);border-radius:8px;background:var(--bg);"></canvas>
        </div>
      </div>
      <div style="margin-top:16px;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Sesi Terakhir</div>
        <div id="dash-sessions" style="display:flex;flex-direction:column;gap:4px;max-height:200px;overflow-y:auto;font-size:0.72rem;color:var(--muted);"></div>
      </div>
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="dashUpdate()">Refresh</button>
        <button class="btn btn-secondary" onclick="dashReset()">Reset Data</button>
      </div>
    </div>
  </div>

  <!-- MULTI-LANGUAGE -->
  <div id="tab-i18n" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üåç Multi-Language UI</div>
      <div class="panel-desc">// Ganti bahasa antarmuka seluruh Toolbox ‚Äî sidebar, header, tombol, label</div>
      <div id="i18n-picker" style="display:flex;flex-direction:column;gap:10px;max-width:500px;margin-bottom:20px;"></div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">Preview terjemahan</div>
        <div id="i18n-kv" style="display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:0.78rem;"></div>
        <div style="margin-top:10px;font-size:0.72rem;color:var(--muted);">Bahasa aktif: <strong id="i18n-active-lang" style="color:var(--accent2);">üáÆüá© Bahasa Indonesia</strong></div>
      </div>
    </div>
  </div>

  <!-- SHARE -->
  <div id="tab-share" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üîó Share &amp; Kolaborasi</div>
      <div class="panel-desc">// Buat link share dari konten tool kamu</div>
      <div class="grid-2">
        <div>
          <label>Judul Share</label>
          <input type="text" id="share-title" placeholder="Contoh: Hash SHA256 password saya...">
          <label>Tipe Konten</label>
          <select id="share-type">
            <option value="text">Teks Biasa</option>
            <option value="code">Kode / Snippet</option>
            <option value="json">JSON</option>
            <option value="markdown">Markdown</option>
            <option value="color">Warna</option>
          </select>
          <label>Konten</label>
          <textarea id="share-content" style="min-height:110px;" placeholder="Paste konten yang ingin di-share..."></textarea>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="shareCreate()">üîó Buat Link Share</button>
          </div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Share Tersimpan</div>
          <div id="share-list" style="max-height:300px;overflow-y:auto;"></div>
          <div id="share-qr-preview" style="margin-top:12px;display:none;text-align:center;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- EXPORT/IMPORT SETTINGS -->
  <div id="tab-settings" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üì¶ Export/Import Settings</div>
      <div class="panel-desc">// Backup &amp; restore semua data Toolbox kamu</div>
      <div class="grid-2">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">Data Tersimpan</div>
          <div id="settings-data-list" style="display:flex;flex-direction:column;gap:6px;max-height:320px;overflow-y:auto;"></div>
          <div class="btn-group" style="margin-top:14px;">
            <button class="btn btn-primary" onclick="settingsExport()">Export Semua (JSON)</button>
            <button class="btn btn-secondary" onclick="settingsClear()">Hapus Semua</button>
          </div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">Import Backup</div>
          <div id="settings-drop-zone" onclick="document.getElementById('settings-file-input').click()" style="border:2px dashed var(--border);border-radius:10px;padding:32px;text-align:center;cursor:pointer;color:var(--muted);" ondragover="this.style.borderColor='var(--accent)';event.preventDefault();" ondragleave="this.style.borderColor='var(--border)'" ondrop="settingsDropImport(event)">
            <div style="font-size:2rem;margin-bottom:8px;">üìÇ</div>
            <div style="font-size:0.78rem;">Drag file backup.json atau klik</div>
          </div>
          <input type="file" id="settings-file-input" accept=".json" style="display:none;" onchange="settingsFileImport(this)">
          <div id="settings-import-status" style="margin-top:10px;font-size:0.78rem;color:var(--muted);min-height:20px;"></div>
          <div style="margin-top:12px;">
            <label class="toggle-row"><input type="checkbox" id="settings-keep-existing"> Gabung dengan data yang ada</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PLUGIN SYSTEM -->
  <div id="tab-plugins" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üß© Plugin System</div>
      <div class="panel-desc">// Tambahkan tool custom sendiri via JSON config</div>
      <div class="grid-2">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Install Plugin Baru</div>
          <label>Plugin JSON Config</label>
          <textarea id="plugin-json" style="min-height:220px;font-size:0.75rem;"></textarea>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="pluginInstall()">Install Plugin</button>
            <button class="btn btn-secondary" onclick="pluginLoadExample()">Contoh</button>
          </div>
          <div id="plugin-install-msg" style="margin-top:8px;font-size:0.72rem;min-height:18px;"></div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Plugin Terinstall (<span id="plugin-count">0</span>)</div>
          <div id="plugin-list" style="display:flex;flex-direction:column;gap:8px;max-height:320px;overflow-y:auto;"></div>
          <div id="plugin-empty" style="color:var(--muted);font-size:0.78rem;padding:20px;text-align:center;">Belum ada plugin</div>
        </div>
      </div>
      <div style="margin-top:16px;background:rgba(124,58,237,0.08);border:1px solid rgba(124,58,237,0.3);border-radius:8px;padding:14px;">
        <div style="font-size:0.72rem;font-weight:700;color:var(--accent2);margin-bottom:6px;">Format Plugin JSON</div>
        <pre style="font-size:0.68rem;color:var(--muted);line-height:1.6;overflow-x:auto;">{"id":"myTool","name":"üîß Tool Saya","desc":"Deskripsi","html":"&lt;div&gt;...&lt;/div&gt;","js":"function run(){...}"}</pre>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üéµ AUDIO VISUALIZER ‚ïê‚ïê‚ïê -->
  <div id="tab-audioviz" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üéµ Audio Visualizer</div><button class="maximize-btn" onclick="toggleMaximize('audioviz')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Rekam mic atau upload audio ‚Äî gelombang & spektrum real-time</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
        <button class="btn btn-primary" id="av-mic-btn" onclick="avToggleMic()">üéôÔ∏è Rekam Mic</button>
        <label class="btn btn-secondary" style="cursor:pointer;">üìÅ Upload Audio<input type="file" id="av-file" accept="audio/*" style="display:none" onchange="avLoadFile(this)"></label>
        <button class="btn btn-secondary" onclick="avStop()" id="av-stop-btn" style="display:none">‚èπ Stop</button>
        <select id="av-mode" onchange="avSetMode(this.value)" style="width:auto;">
          <option value="bars">Bars Frekuensi</option>
          <option value="wave">Gelombang</option>
          <option value="circle">Lingkaran</option>
        </select>
        <select id="av-color" style="width:auto;">
          <option value="rainbow">Rainbow</option>
          <option value="purple">Purple Neon</option>
          <option value="cyan">Cyan Ice</option>
          <option value="fire">Fire</option>
        </select>
      </div>
      <canvas id="av-canvas" style="width:100%;height:220px;background:#050508;border-radius:10px;border:1px solid var(--border);display:block;"></canvas>
      <div id="av-status" style="margin-top:8px;font-size:0.72rem;color:var(--muted);text-align:center;">Klik Rekam Mic atau upload file audio</div>
      <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <label style="font-size:0.72rem;color:var(--muted);">Sensitivitas:</label>
        <input type="range" id="av-gain" min="1" max="5" value="2" step="0.1" style="width:120px;">
        <label style="font-size:0.72rem;color:var(--muted);">Smoothing:</label>
        <input type="range" id="av-smooth" min="0" max="0.95" value="0.75" step="0.05" style="width:120px;">
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üì∏ SCREENSHOT ANNOTATOR ‚ïê‚ïê‚ïê -->
  <div id="tab-annotator" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üì∏ Screenshot Annotator</div><button class="maximize-btn" onclick="toggleMaximize('annotator')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Paste screenshot (Ctrl+V) atau upload ‚Äî beri arrow, kotak, teks, blur</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;align-items:center;">
        <label class="btn btn-primary" style="cursor:pointer;">üìÅ Upload<input type="file" id="ann-file" accept="image/*" style="display:none" onchange="annLoad(this)"></label>
        <button class="btn btn-secondary" id="ann-tool-arrow" onclick="annSetTool('arrow')" style="border-color:var(--accent);">‚Üí Arrow</button>
        <button class="btn btn-secondary" id="ann-tool-rect" onclick="annSetTool('rect')">‚¨ú Kotak</button>
        <button class="btn btn-secondary" id="ann-tool-text" onclick="annSetTool('text')">T Teks</button>
        <button class="btn btn-secondary" id="ann-tool-blur" onclick="annSetTool('blur')">üå´ Blur</button>
        <button class="btn btn-secondary" id="ann-tool-pen" onclick="annSetTool('pen')">‚úèÔ∏è Pen</button>
        <input type="color" id="ann-color" value="#ff0000" title="Warna" style="width:32px;height:32px;padding:2px;cursor:pointer;">
        <select id="ann-size" style="width:auto;">
          <option value="2">Tipis</option>
          <option value="4" selected>Normal</option>
          <option value="8">Tebal</option>
        </select>
        <button class="btn btn-secondary" onclick="annUndo()">‚Ü© Undo</button>
        <button class="btn btn-primary" onclick="annDownload()">üíæ Download</button>
        <button class="btn btn-secondary" onclick="annClear()">üóë Clear</button>
      </div>
      <div id="ann-drop" style="border:2px dashed var(--border);border-radius:10px;min-height:300px;position:relative;overflow:hidden;cursor:crosshair;background:#050508;">
        <canvas id="ann-canvas" style="display:block;max-width:100%;"></canvas>
        <div id="ann-placeholder" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--muted);pointer-events:none;">
          <div style="font-size:3rem;">üìã</div>
          <div style="font-size:0.82rem;margin-top:8px;">Ctrl+V untuk paste screenshot</div>
          <div style="font-size:0.72rem;margin-top:4px;">atau upload file gambar</div>
        </div>
      </div>
      <input type="text" id="ann-text-input" placeholder="Ketik teks lalu klik di kanvas..." style="margin-top:8px;display:none;">
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üîê PASSWORD VAULT ‚ïê‚ïê‚ïê -->
  <div id="tab-vault" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üîê Password Vault</div><button class="maximize-btn" onclick="toggleMaximize('vault')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Simpan kredensial terenkripsi AES-256 di browser kamu</div>
      <div id="vault-lock-screen">
        <div style="max-width:360px;margin:0 auto;text-align:center;padding:20px;">
          <div style="font-size:3rem;margin-bottom:12px;">üîí</div>
          <div style="font-size:0.88rem;color:var(--muted);margin-bottom:16px;" id="vault-lock-msg">Masukkan master password untuk membuka vault</div>
          <input type="password" id="vault-master-input" placeholder="Master Password..." style="text-align:center;" onkeydown="if(event.key==='Enter')vaultUnlock()">
          <div class="btn-group" style="justify-content:center;">
            <button class="btn btn-primary" onclick="vaultUnlock()">üîì Buka Vault</button>
            <button class="btn btn-secondary" onclick="vaultCreate()" id="vault-create-btn">‚ú® Buat Vault Baru</button>
          </div>
          <div id="vault-lock-err" style="color:var(--danger);font-size:0.72rem;margin-top:8px;min-height:16px;"></div>
        </div>
      </div>
      <div id="vault-main" style="display:none;">
        <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;">
          <input type="text" id="vault-search" placeholder="üîç Cari..." style="flex:1;" oninput="vaultRender()">
          <button class="btn btn-primary" onclick="vaultShowAdd()">+ Tambah</button>
          <button class="btn btn-secondary" onclick="vaultLock()">üîí Kunci</button>
          <button class="btn btn-secondary" onclick="vaultExport()">üì§ Export</button>
        </div>
        <div id="vault-add-form" style="display:none;background:var(--bg);border:1px solid rgba(124,58,237,0.3);border-radius:10px;padding:14px;margin-bottom:12px;">
          <div class="grid-2">
            <div><label>Website/App</label><input type="text" id="v-site" placeholder="google.com"></div>
            <div><label>Username / Email</label><input type="text" id="v-user" placeholder="email@example.com"></div>
            <div><label>Password</label>
              <div style="display:flex;gap:4px;">
                <input type="password" id="v-pass" placeholder="Password..." style="flex:1;">
                <button class="btn btn-secondary" style="padding:6px 8px;" onclick="document.getElementById('v-pass').type=document.getElementById('v-pass').type==='password'?'text':'password'">üëÅ</button>
                <button class="btn btn-secondary" style="padding:6px 8px;" onclick="vaultGenPass()">üé≤</button>
              </div>
            </div>
            <div><label>Catatan</label><input type="text" id="v-note" placeholder="Opsional..."></div>
          </div>
          <div class="btn-group" style="margin-top:10px;">
            <button class="btn btn-primary" onclick="vaultSaveEntry()">üíæ Simpan</button>
            <button class="btn btn-secondary" onclick="vaultHideAdd()">Batal</button>
          </div>
        </div>
        <div id="vault-list" style="display:flex;flex-direction:column;gap:8px;"></div>
        <div id="vault-empty" style="text-align:center;color:var(--muted);padding:30px;font-size:0.78rem;">Vault kosong ‚Äî tambah kredensial pertama kamu!</div>
        <div style="margin-top:12px;font-size:0.65rem;color:var(--muted);text-align:center;">üîí Dienkripsi AES-GCM 256-bit ‚Ä¢ Tersimpan lokal di browser ‚Ä¢ Tidak pernah keluar perangkat</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üßÆ FORMULA BUILDER ‚ïê‚ïê‚ïê -->
  <div id="tab-formula" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üßÆ Formula Builder</div><button class="maximize-btn" onclick="toggleMaximize('formula')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Tulis rumus matematika/fisika ‚Äî preview LaTeX & evaluasi langsung</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Input Rumus</div>
          <textarea id="formula-input" style="min-height:120px;font-size:0.85rem;" placeholder="Contoh: x = (-b ¬± ‚àö(b¬≤-4ac)) / 2a&#10;E = mc¬≤&#10;F = ma&#10;&#10;Atau tulis LaTeX: \frac{-b \pm \sqrt{b^2-4ac}}{2a}" oninput="formulaRender()"></textarea>
          <div style="margin-top:10px;">
            <div style="font-size:0.72rem;color:var(--muted);margin-bottom:6px;">Variabel (untuk evaluasi)</div>
            <div id="formula-vars" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
          </div>
          <button class="btn btn-primary" style="margin-top:10px;" onclick="formulaEval()">= Hitung Nilai</button>
          <div id="formula-result" style="margin-top:8px;font-size:0.82rem;color:var(--accent2);min-height:20px;"></div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Preview</div>
          <div id="formula-preview" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;min-height:130px;font-size:1.1rem;line-height:1.8;overflow-x:auto;"></div>
          <div style="margin-top:12px;font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px;">Rumus Cepat</div>
          <div style="display:flex;flex-wrap:wrap;gap:4px;" id="formula-quick"></div>
        </div>
      </div>
      <div style="margin-top:12px;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px;">Riwayat Perhitungan</div>
        <div id="formula-history" style="max-height:130px;overflow-y:auto;display:flex;flex-direction:column;gap:4px;"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üß† AI SUMMARIZER ‚ïê‚ïê‚ïê -->
  <div id="tab-summarizer" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üß† AI Summarizer</div><button class="maximize-btn" onclick="toggleMaximize('summarizer')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Paste artikel panjang ‚Üí AI rangkum jadi poin-poin kunci</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <label>Teks / Artikel</label>
          <textarea id="sum-input" style="min-height:220px;" placeholder="Paste artikel, dokumen, atau teks panjang di sini...&#10;&#10;Mendukung berbagai bahasa (Indonesia, Inggris, dll)"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;align-items:center;">
            <select id="sum-style" style="width:auto;">
              <option value="points">3 Poin Utama</option>
              <option value="summary">Ringkasan Paragraf</option>
              <option value="tldr">TL;DR (1 kalimat)</option>
              <option value="bullets">Bullet Points Detail</option>
              <option value="keywords">Kata Kunci Penting</option>
            </select>
            <select id="sum-lang" style="width:auto;">
              <option value="id">Hasil: Bahasa Indonesia</option>
              <option value="en">Hasil: English</option>
              <option value="same">Sama dengan input</option>
            </select>
            <button class="btn btn-primary" id="sum-btn" onclick="summarizeText()">üß† Ringkas Sekarang</button>
            <button class="btn btn-secondary" onclick="document.getElementById('sum-input').value='';document.getElementById('sum-out').innerHTML='';">üóë Clear</button>
          </div>
          <div id="sum-chars" style="font-size:0.65rem;color:var(--muted);margin-top:4px;">0 karakter</div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Hasil Ringkasan</div>
          <div id="sum-out" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:220px;font-size:0.82rem;line-height:1.7;white-space:pre-wrap;overflow-y:auto;"></div>
          <div style="margin-top:8px;display:flex;gap:6px;">
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('sum-out').textContent)">üìã Copy</button>
            <button class="btn btn-secondary" id="sum-tts-btn" onclick="sumSpeak()">üîä Dengarkan</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üìß EMAIL TEMPLATE BUILDER ‚ïê‚ïê‚ïê -->
  <div id="tab-emailtpl" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üìß Email Template Builder</div><button class="maximize-btn" onclick="toggleMaximize('emailtpl')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Buat template email dengan variabel {{nama}} ‚Äî isi & kirim langsung</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Template</div>
          <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;">
            <select id="etpl-presets" style="flex:1;width:auto;" onchange="etplLoadPreset(this.value)">
              <option value="">-- Pilih Preset --</option>
              <option value="intro">Perkenalan Profesional</option>
              <option value="followup">Follow Up Meeting</option>
              <option value="invoice">Invoice / Tagihan</option>
              <option value="thanks">Ucapan Terima Kasih</option>
              <option value="collab">Ajakan Kolaborasi</option>
            </select>
            <button class="btn btn-secondary" onclick="etplSaveTemplate()">üíæ Simpan</button>
          </div>
          <input type="text" id="etpl-subject" placeholder="Subject email..." style="margin-bottom:8px;">
          <textarea id="etpl-body" style="min-height:220px;font-size:0.8rem;" placeholder="Tulis template email...&#10;&#10;Gunakan {{variabel}} untuk teks yang bisa diisi.&#10;Contoh: Halo {{nama}}, terima kasih atas {{hal}}..." oninput="etplDetectVars()"></textarea>
          <div id="etpl-vars-row" style="margin-top:10px;"></div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Preview & Isi Variabel</div>
          <div id="etpl-preview" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:200px;font-size:0.82rem;line-height:1.7;white-space:pre-wrap;margin-bottom:10px;overflow-y:auto;max-height:260px;"></div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="etplCopyFinal()">üìã Copy Final</button>
            <button class="btn btn-secondary" onclick="etplOpenMailto()">‚úâÔ∏è Buka di Mail</button>
            <button class="btn btn-secondary" onclick="etplWhatsapp()">üí¨ WhatsApp</button>
          </div>
          <div style="margin-top:12px;">
            <div style="font-size:0.72rem;color:var(--muted);margin-bottom:6px;">Template Tersimpan</div>
            <div id="etpl-saved-list" style="max-height:100px;overflow-y:auto;display:flex;flex-direction:column;gap:4px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê ‚è∞ FOCUS MODE ‚ïê‚ïê‚ïê -->
  <div id="tab-focus" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">‚è∞ Focus Mode</div><button class="maximize-btn" onclick="toggleMaximize('focus')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Masuk mode fokus penuh ‚Äî satu layar, satu tujuan</div>
      <div style="text-align:center;padding:20px 0;">
        <div id="focus-timer-display" style="font-family:'Syne',sans-serif;font-size:clamp(3rem,12vw,6rem);font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-2px;line-height:1;">25:00</div>
        <div id="focus-session-label" style="font-size:0.8rem;color:var(--muted);margin-top:6px;text-transform:uppercase;letter-spacing:2px;">Fokus</div>
        <div style="display:flex;justify-content:center;gap:10px;margin-top:16px;">
          <button class="btn btn-primary" id="focus-start-btn" onclick="focusToggle()" style="font-size:0.9rem;padding:10px 24px;">‚ñ∂ Mulai Fokus</button>
          <button class="btn btn-secondary" onclick="focusReset()">‚Ü∫ Reset</button>
          <button class="btn btn-secondary" onclick="focusSkip()">‚è≠ Skip</button>
        </div>
        <div style="margin-top:16px;display:flex;justify-content:center;gap:6px;" id="focus-sessions-dots"></div>
      </div>
      <div style="max-width:480px;margin:0 auto;">
        <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Pengaturan</div>
        <div class="grid-2" style="gap:10px;">
          <div><label>Durasi Fokus (mnt)</label><input type="number" id="focus-dur" value="25" min="1" max="120"></div>
          <div><label>Istirahat Pendek (mnt)</label><input type="number" id="focus-short" value="5" min="1" max="30"></div>
          <div><label>Istirahat Panjang (mnt)</label><input type="number" id="focus-long" value="15" min="5" max="60"></div>
          <div><label>Sesi sebelum istirahat panjang</label><input type="number" id="focus-sessions" value="4" min="2" max="8"></div>
        </div>
        <div style="margin-top:10px;"><label class="toggle-row"><input type="checkbox" id="focus-sound" checked> Bunyi notifikasi</label></div>
        <div style="margin-top:6px;"><label class="toggle-row"><input type="checkbox" id="focus-notif"> Browser notification</label></div>
        <div style="margin-top:14px;">
          <div style="font-size:0.72rem;color:var(--muted);margin-bottom:6px;">Tugas Fokus Saat Ini</div>
          <input type="text" id="focus-task" placeholder="Apa yang mau kamu kerjakan sekarang?">
        </div>
        <div style="margin-top:14px;">
          <div style="font-size:0.72rem;color:var(--muted);margin-bottom:6px;">Riwayat Sesi Hari Ini</div>
          <div id="focus-history" style="max-height:100px;overflow-y:auto;font-size:0.72rem;color:var(--muted);"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üìä DATA VIZ STUDIO ‚ïê‚ïê‚ïê -->
  <div id="tab-dataviz" class="tool-panel">
    <div class="panel-card">
      <div class="panel-header"><div class="panel-title">üìä Data Viz Studio</div><button class="maximize-btn" onclick="toggleMaximize('dataviz')">‚õ∂ Maximize</button></div>
      <div class="panel-desc">// Input CSV atau JSON ‚Üí pilih chart type ‚Üí export PNG</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;">
            <select id="dv-type" onchange="dvRender()" style="width:auto;">
              <option value="bar">Bar Chart</option>
              <option value="line">Line Chart</option>
              <option value="pie">Pie Chart</option>
              <option value="doughnut">Doughnut</option>
              <option value="area">Area Chart</option>
              <option value="scatter">Scatter Plot</option>
            </select>
            <select id="dv-theme" onchange="dvRender()" style="width:auto;">
              <option value="neon">Neon</option>
              <option value="pastel">Pastel</option>
              <option value="mono">Monochrome</option>
              <option value="fire">Fire</option>
            </select>
            <button class="btn btn-secondary" onclick="dvLoadSample()">üìã Contoh Data</button>
          </div>
          <div style="font-size:0.72rem;color:var(--muted);margin-bottom:4px;">Input Data (CSV / JSON)</div>
          <textarea id="dv-input" style="min-height:200px;font-size:0.75rem;" placeholder="Format CSV:&#10;Label,Nilai&#10;Januari,120&#10;Februari,85&#10;Maret,200&#10;&#10;Atau JSON:&#10;[{&quot;label&quot;:&quot;A&quot;,&quot;value&quot;:10},{&quot;label&quot;:&quot;B&quot;,&quot;value&quot;:20}]" oninput="dvRender()"></textarea>
          <div style="margin-top:8px;">
            <label>Judul Chart</label>
            <input type="text" id="dv-title" placeholder="Masukkan judul..." oninput="dvRender()">
          </div>
          <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;">
            <label class="toggle-row"><input type="checkbox" id="dv-legend" checked onchange="dvRender()"> Legend</label>
            <label class="toggle-row"><input type="checkbox" id="dv-grid" checked onchange="dvRender()"> Grid</label>
            <label class="toggle-row"><input type="checkbox" id="dv-values" onchange="dvRender()"> Nilai di atas bar</label>
          </div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Preview Chart</div>
          <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:10px;position:relative;">
            <canvas id="dv-canvas" style="max-width:100%;display:block;"></canvas>
            <div id="dv-placeholder" style="text-align:center;padding:60px 0;color:var(--muted);font-size:0.78rem;">Input data untuk melihat chart</div>
          </div>
          <div style="margin-top:10px;display:flex;gap:6px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="dvExport()">üíæ Export PNG</button>
            <button class="btn btn-secondary" onclick="dvCopySVG()">üìã Copy Data</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
</div>

  <!-- ‚ïê‚ïê‚ïê üñºÔ∏è IMAGE EDITOR ‚ïê‚ïê‚ïê -->
  <div id="tab-imgEditor" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üñºÔ∏è Image Editor</div>
      <div class="panel-desc">// Crop, resize, filter, brightness/contrast, flip ‚Äî langsung di browser</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center;">
        <label class="btn btn-primary" style="cursor:pointer;">üìÅ Buka Gambar<input type="file" id="ie-file" accept="image/*" style="display:none" onchange="ieLoad(this)"></label>
        <button class="btn btn-secondary" onclick="ieSave()">üíæ Simpan PNG</button>
        <button class="btn btn-secondary" onclick="ieReset()">‚Ü∫ Reset</button>
      </div>
      <div style="display:flex;gap:16px;flex-wrap:wrap;">
        <div style="flex:1;min-width:200px;">
          <div class="panel-card" style="padding:12px;margin-bottom:0;">
            <div style="font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">üéõÔ∏è Adjustment</div>
            <div id="ie-controls">
              <label>Brightness <span id="ie-br-v">100</span>%</label>
              <input type="range" id="ie-brightness" min="0" max="200" value="100" oninput="ieApply();document.getElementById('ie-br-v').textContent=this.value">
              <label style="margin-top:8px;display:block;">Contrast <span id="ie-co-v">100</span>%</label>
              <input type="range" id="ie-contrast" min="0" max="200" value="100" oninput="ieApply();document.getElementById('ie-co-v').textContent=this.value">
              <label style="margin-top:8px;display:block;">Saturate <span id="ie-sa-v">100</span>%</label>
              <input type="range" id="ie-saturate" min="0" max="200" value="100" oninput="ieApply();document.getElementById('ie-sa-v').textContent=this.value">
              <label style="margin-top:8px;display:block;">Blur <span id="ie-bl-v">0</span>px</label>
              <input type="range" id="ie-blur" min="0" max="20" value="0" oninput="ieApply();document.getElementById('ie-bl-v').textContent=this.value">
              <label style="margin-top:8px;display:block;">Hue Rotate <span id="ie-hu-v">0</span>¬∞</label>
              <input type="range" id="ie-hue" min="0" max="360" value="0" oninput="ieApply();document.getElementById('ie-hu-v').textContent=this.value">
              <label style="margin-top:8px;display:block;">Opacity <span id="ie-op-v">100</span>%</label>
              <input type="range" id="ie-opacity" min="0" max="100" value="100" oninput="ieApply();document.getElementById('ie-op-v').textContent=this.value">
            </div>
            <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:6px;">
              <button class="btn btn-secondary" onclick="ieFlip('h')" style="font-size:0.7rem;padding:7px;">‚Üî Flip H</button>
              <button class="btn btn-secondary" onclick="ieFlip('v')" style="font-size:0.7rem;padding:7px;">‚Üï Flip V</button>
              <button class="btn btn-secondary" onclick="ieRotate(90)" style="font-size:0.7rem;padding:7px;">‚Üª Putar 90¬∞</button>
              <button class="btn btn-secondary" onclick="ieRotate(-90)" style="font-size:0.7rem;padding:7px;">‚Ü∫ Putar -90¬∞</button>
            </div>
            <div style="margin-top:10px;">
              <div style="font-size:0.62rem;color:var(--muted);margin-bottom:6px;">Filter Preset:</div>
              <div style="display:flex;flex-wrap:wrap;gap:4px;">
                <button class="btn btn-secondary" onclick="iePreset('none')" style="font-size:0.65rem;padding:4px 8px;">Normal</button>
                <button class="btn btn-secondary" onclick="iePreset('grayscale')" style="font-size:0.65rem;padding:4px 8px;">B&W</button>
                <button class="btn btn-secondary" onclick="iePreset('sepia')" style="font-size:0.65rem;padding:4px 8px;">Sepia</button>
                <button class="btn btn-secondary" onclick="iePreset('vivid')" style="font-size:0.65rem;padding:4px 8px;">Vivid</button>
                <button class="btn btn-secondary" onclick="iePreset('cool')" style="font-size:0.65rem;padding:4px 8px;">Cool</button>
                <button class="btn btn-secondary" onclick="iePreset('warm')" style="font-size:0.65rem;padding:4px 8px;">Warm</button>
                <button class="btn btn-secondary" onclick="iePreset('dramatic')" style="font-size:0.65rem;padding:4px 8px;">Dramatic</button>
                <button class="btn btn-secondary" onclick="iePreset('vintage')" style="font-size:0.65rem;padding:4px 8px;">Vintage</button>
              </div>
            </div>
            <div style="margin-top:10px;">
              <div style="font-size:0.62rem;color:var(--muted);margin-bottom:4px;">Resize:</div>
              <div style="display:flex;gap:6px;align-items:center;">
                <input type="number" id="ie-rw" placeholder="W" style="width:70px;">
                <span style="color:var(--muted);">√ó</span>
                <input type="number" id="ie-rh" placeholder="H" style="width:70px;">
                <button class="btn btn-secondary" onclick="ieResize()" style="font-size:0.68rem;padding:6px 10px;">Apply</button>
              </div>
            </div>
          </div>
        </div>
        <div style="flex:2;min-width:280px;">
          <div id="ie-placeholder" style="background:#050508;border:2px dashed var(--border);border-radius:12px;min-height:320px;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--muted);">
            <div style="font-size:3rem;">üñºÔ∏è</div>
            <div style="font-size:0.8rem;margin-top:8px;">Upload atau drag gambar</div>
          </div>
          <canvas id="ie-canvas" style="display:none;max-width:100%;border-radius:12px;border:1px solid var(--border);"></canvas>
          <div id="ie-info" style="font-size:0.65rem;color:var(--muted);margin-top:6px;text-align:center;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üìù RESUME BUILDER ‚ïê‚ïê‚ïê -->
  <div id="tab-resume" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üìù Resume Builder</div>
      <div class="panel-desc">// Buat CV profesional dengan template, export PDF atau HTML</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Data Pribadi</div>
          <input type="text" id="rv-name" placeholder="Nama Lengkap" style="margin-bottom:6px;">
          <input type="text" id="rv-title" placeholder="Jabatan / Profesi" style="margin-bottom:6px;">
          <input type="email" id="rv-email" placeholder="Email" style="margin-bottom:6px;">
          <input type="text" id="rv-phone" placeholder="Nomor HP" style="margin-bottom:6px;">
          <input type="text" id="rv-location" placeholder="Kota, Negara" style="margin-bottom:6px;">
          <input type="url" id="rv-linkedin" placeholder="LinkedIn URL" style="margin-bottom:6px;">
          <input type="url" id="rv-github" placeholder="GitHub / Portfolio URL" style="margin-bottom:10px;">
          <label>Ringkasan Profil</label>
          <textarea id="rv-summary" style="min-height:80px;" placeholder="Ceritakan diri kamu dalam 2-3 kalimat..."></textarea>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
            <button class="btn btn-secondary" onclick="rvAddEntry('exp')">+ Pengalaman</button>
            <button class="btn btn-secondary" onclick="rvAddEntry('edu')">+ Pendidikan</button>
            <button class="btn btn-secondary" onclick="rvAddEntry('skill')">+ Skill</button>
            <button class="btn btn-secondary" onclick="rvAddEntry('project')">+ Project</button>
          </div>
          <div id="rv-entries" style="margin-top:10px;"></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:12px;">
            <select id="rv-template">
              <option value="modern">Modern Dark</option>
              <option value="clean">Clean White</option>
              <option value="minimal">Minimal</option>
              <option value="bold">Bold</option>
            </select>
            <select id="rv-color">
              <option value="#7c3aed">Purple</option>
              <option value="#0891b2">Cyan</option>
              <option value="#059669">Emerald</option>
              <option value="#dc2626">Red</option>
              <option value="#1e40af">Blue</option>
            </select>
          </div>
          <div class="btn-group" style="margin-top:10px;">
            <button class="btn btn-primary" onclick="rvPreview()">üëÅÔ∏è Preview</button>
            <button class="btn btn-secondary" onclick="rvExport()">üìÑ Export HTML</button>
          </div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Preview Resume</div>
          <div id="rv-preview" style="background:#fff;border-radius:10px;min-height:500px;overflow-y:auto;padding:0;border:1px solid var(--border);"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üîó BIO LINK PAGE ‚ïê‚ïê‚ïê -->
  <div id="tab-biolink" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üîó Bio Link Page</div>
      <div class="panel-desc">// Buat halaman bio link ala Linktree ‚Äî simpan & share</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Profil</div>
          <input type="text" id="bl-name" placeholder="Nama / Username" style="margin-bottom:6px;" oninput="blPreview()">
          <textarea id="bl-bio" style="min-height:60px;margin-bottom:6px;" placeholder="Bio singkat..." oninput="blPreview()"></textarea>
          <input type="text" id="bl-avatar" placeholder="URL foto profil (opsional)" style="margin-bottom:10px;" oninput="blPreview()">
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Links</div>
          <div id="bl-links-wrap"></div>
          <button class="btn btn-secondary" onclick="blAddLink()" style="margin-top:8px;width:100%;">+ Tambah Link</button>
          <div style="margin-top:12px;">
            <label style="font-size:0.72rem;color:var(--muted);">Tema Warna:</label>
            <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;" id="bl-themes">
              <button onclick="blSetTheme('purple')" style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#7c3aed,#06b6d4);border:none;cursor:pointer;"></button>
              <button onclick="blSetTheme('dark')" style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#111,#333);border:none;cursor:pointer;"></button>
              <button onclick="blSetTheme('neon')" style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#10b981,#06b6d4);border:none;cursor:pointer;"></button>
              <button onclick="blSetTheme('fire')" style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#ef4444,#f59e0b);border:none;cursor:pointer;"></button>
              <button onclick="blSetTheme('rose')" style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#e11d48,#a21caf);border:none;cursor:pointer;"></button>
            </div>
          </div>
          <div class="btn-group" style="margin-top:12px;">
            <button class="btn btn-primary" onclick="blExport()">üíæ Export HTML</button>
            <button class="btn btn-secondary" onclick="blSave()">üîí Simpan Draft</button>
          </div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Preview</div>
          <div id="bl-preview" style="border-radius:14px;overflow:hidden;border:1px solid var(--border);min-height:450px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üé® SVG EDITOR ‚ïê‚ïê‚ïê -->
  <div id="tab-svgEditor" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üé® SVG Editor</div>
      <div class="panel-desc">// Buat & edit vector shapes ‚Äî export SVG atau PNG</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center;">
        <button class="btn btn-secondary" id="svg-tool-rect" onclick="svgSetTool('rect')">‚¨ú Rect</button>
        <button class="btn btn-secondary" id="svg-tool-circle" onclick="svgSetTool('circle')">‚≠ï Circle</button>
        <button class="btn btn-secondary" id="svg-tool-line" onclick="svgSetTool('line')">‚ï± Line</button>
        <button class="btn btn-secondary" id="svg-tool-text" onclick="svgSetTool('text')">T Text</button>
        <button class="btn btn-secondary" id="svg-tool-path" onclick="svgSetTool('path')">‚úèÔ∏è Path</button>
        <input type="color" id="svg-fill" value="#7c3aed" title="Fill">
        <input type="color" id="svg-stroke" value="#06b6d4" title="Stroke">
        <select id="svg-stroke-w" style="width:auto;"><option value="0">No stroke</option><option value="1">1px</option><option value="2" selected>2px</option><option value="4">4px</option><option value="8">8px</option></select>
        <button class="btn btn-secondary" onclick="svgUndo()">‚Ü© Undo</button>
        <button class="btn btn-secondary" onclick="svgClear()">üóë Clear</button>
        <button class="btn btn-primary" onclick="svgExportSVG()">üíæ SVG</button>
        <button class="btn btn-secondary" onclick="svgExportPNG()">üñº PNG</button>
        <input type="number" id="svg-canvas-w" value="600" style="width:70px;" placeholder="W">
        <input type="number" id="svg-canvas-h" value="400" style="width:70px;" placeholder="H">
        <button class="btn btn-secondary" onclick="svgResize()" style="font-size:0.68rem;padding:6px 10px;">Resize</button>
      </div>
      <svg id="svg-canvas" width="600" height="400" style="background:#1c1c28;border-radius:10px;border:1px solid var(--border);cursor:crosshair;display:block;max-width:100%;touch-action:none;"></svg>
      <input type="text" id="svg-text-input" placeholder="Ketik teks lalu klik di canvas..." style="margin-top:8px;display:none;">
      <div id="svg-status" style="font-size:0.65rem;color:var(--muted);margin-top:6px;">Tool: Rect | Klik dan drag untuk menggambar</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê ‚úçÔ∏è AI WRITING ASSISTANT ‚ïê‚ïê‚ïê -->
  <div id="tab-aiwriting" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">‚úçÔ∏è AI Writing Assistant</div>
      <div class="panel-desc">// Bantu nulis email, caption, essay, artikel dengan AI</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;">
            <select id="aw-type" style="flex:1;width:auto;">
              <option value="email">Email Profesional</option>
              <option value="caption">Caption Media Sosial</option>
              <option value="essay">Essay / Artikel</option>
              <option value="cover">Cover Letter</option>
              <option value="bio">Bio Profil</option>
              <option value="pitch">Pitch Produk</option>
              <option value="story">Cerita Pendek</option>
              <option value="custom">Custom Prompt</option>
            </select>
            <select id="aw-tone" style="width:auto;">
              <option value="professional">Professional</option>
              <option value="casual">Casual & Friendly</option>
              <option value="formal">Formal</option>
              <option value="creative">Creative</option>
              <option value="persuasive">Persuasive</option>
              <option value="empathetic">Empathetic</option>
            </select>
          </div>
          <select id="aw-lang" style="margin-bottom:8px;">
            <option value="id">Bahasa Indonesia</option>
            <option value="en">English</option>
            <option value="mixed">Indonesia + English</option>
          </select>
          <label>Topik / Instruksi</label>
          <textarea id="aw-prompt" style="min-height:120px;" placeholder="Contoh: Tulis email untuk meminta meeting dengan klien baru tentang proyek website e-commerce..."></textarea>
          <div style="margin-top:8px;">
            <label>Panjang:</label>
            <div style="display:flex;gap:6px;margin-top:4px;">
              <button class="btn btn-secondary" id="aw-len-short" onclick="awSetLen('short')" style="font-size:0.68rem;padding:5px 10px;">Pendek</button>
              <button class="btn btn-primary" id="aw-len-medium" onclick="awSetLen('medium')" style="font-size:0.68rem;padding:5px 10px;">Sedang</button>
              <button class="btn btn-secondary" id="aw-len-long" onclick="awSetLen('long')" style="font-size:0.68rem;padding:5px 10px;">Panjang</button>
            </div>
          </div>
          <button class="btn btn-primary" onclick="awGenerate()" id="aw-btn" style="margin-top:12px;width:100%;">‚úçÔ∏è Generate Sekarang</button>
          <div style="margin-top:10px;font-size:0.68rem;color:var(--muted);">Quick templates:</div>
          <div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:4px;" id="aw-quick-btns"></div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Hasil</div>
          <div id="aw-out" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:280px;font-size:0.82rem;line-height:1.8;white-space:pre-wrap;overflow-y:auto;max-height:400px;"></div>
          <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('aw-out').textContent)">üìã Copy</button>
            <button class="btn btn-secondary" onclick="awImprove()">‚ú® Improve</button>
            <button class="btn btn-secondary" onclick="awShorten()">‚úÇÔ∏è Persingkat</button>
            <button class="btn btn-secondary" onclick="awExpand()">üìñ Kembangkan</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üêõ AI CODE REVIEWER ‚ïê‚ïê‚ïê -->
  <div id="tab-aicode" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üêõ AI Code Reviewer</div>
      <div class="panel-desc">// Paste kode, AI review bug, saran improvement & best practice</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;">
            <select id="acr-lang" style="flex:1;width:auto;">
              <option value="auto">Auto Detect</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="java">Java</option>
              <option value="typescript">TypeScript</option>
              <option value="php">PHP</option>
              <option value="css">CSS</option>
              <option value="html">HTML</option>
              <option value="sql">SQL</option>
              <option value="rust">Rust</option>
              <option value="go">Go</option>
            </select>
            <select id="acr-focus" style="width:auto;">
              <option value="all">Review Lengkap</option>
              <option value="bugs">Bug & Error</option>
              <option value="security">Security</option>
              <option value="performance">Performance</option>
              <option value="style">Code Style</option>
              <option value="refactor">Refactoring</option>
            </select>
          </div>
          <textarea id="acr-code" style="min-height:300px;font-size:0.78rem;font-family:'JetBrains Mono',monospace;" placeholder="Paste kode kamu di sini...&#10;&#10;Contoh:&#10;function calculateTotal(items) {&#10;  var total = 0;&#10;  for (var i = 0; i &lt;= items.length; i++) {&#10;    total += items[i].price&#10;  }&#10;  return total&#10;}"></textarea>
          <button class="btn btn-primary" onclick="acrReview()" id="acr-btn" style="width:100%;margin-top:8px;">üîç Review Kode</button>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Hasil Review</div>
          <div id="acr-out" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:340px;font-size:0.78rem;line-height:1.7;overflow-y:auto;max-height:450px;white-space:pre-wrap;"></div>
          <div style="margin-top:8px;display:flex;gap:6px;">
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('acr-out').textContent)">üìã Copy</button>
            <button class="btn btn-secondary" onclick="acrFixCode()">üîß Auto Fix</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üåê AI TRANSLATOR PRO ‚ïê‚ïê‚ïê -->
  <div id="tab-aitranslator" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üåê AI Translator Pro</div>
      <div class="panel-desc">// Terjemah + jelaskan nuansa budaya, idiom, & konteks</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;">
            <select id="atp-from" style="flex:1;width:auto;"><option value="auto">Auto Detect</option><option value="id">Indonesia</option><option value="en">English</option><option value="ja">Êó•Êú¨Ë™û</option><option value="zh">‰∏≠Êñá</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option><option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="fr">Fran√ßais</option><option value="de">Deutsch</option><option value="es">Espa√±ol</option><option value="pt">Portugu√™s</option><option value="ru">–†—É—Å—Å–∫–∏–π</option></select>
            <button onclick="atpSwap()" class="btn btn-secondary" style="padding:6px 10px;">‚áÑ</button>
            <select id="atp-to" style="flex:1;width:auto;"><option value="en">English</option><option value="id">Indonesia</option><option value="ja">Êó•Êú¨Ë™û</option><option value="zh">‰∏≠Êñá</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option><option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="fr">Fran√ßais</option><option value="de">Deutsch</option><option value="es">Espa√±ol</option></select>
          </div>
          <textarea id="atp-input" style="min-height:160px;" placeholder="Masukkan teks untuk diterjemah...&#10;&#10;AI akan memberikan:&#10;‚Ä¢ Terjemahan utama&#10;‚Ä¢ Nuansa & konteks budaya&#10;‚Ä¢ Idiom & ungkapan setara&#10;‚Ä¢ Catatan penting"></textarea>
          <label class="toggle-row" style="margin-top:8px;"><input type="checkbox" id="atp-culture" checked> Jelaskan nuansa budaya</label>
          <label class="toggle-row"><input type="checkbox" id="atp-idiom" checked> Alternatif idiom</label>
          <label class="toggle-row"><input type="checkbox" id="atp-formal"> Versi formal & informal</label>
          <button class="btn btn-primary" onclick="atpTranslate()" id="atp-btn" style="width:100%;margin-top:10px;">üåê Terjemah Sekarang</button>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Hasil Terjemahan</div>
          <div id="atp-out" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:320px;font-size:0.82rem;line-height:1.7;overflow-y:auto;max-height:420px;white-space:pre-wrap;"></div>
          <button class="btn btn-secondary" onclick="copyText(document.getElementById('atp-out').textContent)" style="margin-top:8px;">üìã Copy</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üéØ AI GOAL PLANNER ‚ïê‚ïê‚ïê -->
  <div id="tab-aigoal" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üéØ AI Goal Planner</div>
      <div class="panel-desc">// Input goal kamu, AI buat rencana harian/mingguan yang realistis</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <label>Goal Utama</label>
          <input type="text" id="ag-goal" placeholder="cth: Belajar JavaScript dalam 3 bulan" style="margin-bottom:8px;">
          <label>Deadline</label>
          <input type="date" id="ag-deadline" style="margin-bottom:8px;">
          <label>Waktu tersedia per hari</label>
          <select id="ag-time" style="margin-bottom:8px;">
            <option value="30">30 menit/hari</option><option value="60" selected>1 jam/hari</option>
            <option value="120">2 jam/hari</option><option value="180">3 jam/hari</option><option value="240">4+ jam/hari</option>
          </select>
          <label>Level saat ini</label>
          <select id="ag-level" style="margin-bottom:8px;">
            <option value="beginner">Pemula</option><option value="intermediate">Menengah</option><option value="advanced">Lanjutan</option>
          </select>
          <label>Hambatan / Kendala (opsional)</label>
          <textarea id="ag-obstacles" style="min-height:60px;" placeholder="cth: Sibuk kerja sampai sore, tidak punya mentor..."></textarea>
          <button class="btn btn-primary" onclick="agPlan()" id="ag-btn" style="width:100%;margin-top:10px;">üéØ Buat Rencana</button>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;">Rencana AI</div>
          <div id="ag-out" style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:320px;font-size:0.8rem;line-height:1.8;overflow-y:auto;max-height:420px;white-space:pre-wrap;"></div>
          <div style="display:flex;gap:6px;margin-top:8px;">
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('ag-out').textContent)">üìã Copy</button>
            <button class="btn btn-secondary" onclick="agExport()">üìÑ Export</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üìà EXPENSE TRACKER ‚ïê‚ïê‚ïê -->
  <div id="tab-expenseTracker" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üìà Expense Tracker</div>
      <div class="panel-desc">// Catat pengeluaran, visualisasi grafik, export CSV</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Tambah Transaksi</div>
          <input type="text" id="et-desc" placeholder="Deskripsi (cth: Makan siang)" style="margin-bottom:6px;">
          <div style="display:flex;gap:6px;margin-bottom:6px;">
            <input type="number" id="et-amount" placeholder="Jumlah (Rp)" style="flex:1;">
            <select id="et-type" style="width:auto;"><option value="expense">Pengeluaran</option><option value="income">Pemasukan</option></select>
          </div>
          <div style="display:flex;gap:6px;margin-bottom:6px;">
            <select id="et-cat" style="flex:1;width:auto;">
              <option>üçî Makanan</option><option>üöó Transport</option><option>üè† Rumah</option>
              <option>üëï Belanja</option><option>üéÆ Hiburan</option><option>üíä Kesehatan</option>
              <option>üìö Pendidikan</option><option>üíº Bisnis</option><option>üì± Tagihan</option><option>‚ûï Lainnya</option>
            </select>
            <input type="date" id="et-date" style="width:auto;">
          </div>
          <button class="btn btn-primary" onclick="etAdd()" style="width:100%;margin-bottom:12px;">+ Tambah</button>
          <div style="display:flex;justify-content:space-between;margin-bottom:8px;flex-wrap:wrap;gap:4px;">
            <div style="font-size:0.72rem;color:var(--success);">Masuk: <b id="et-total-in">Rp 0</b></div>
            <div style="font-size:0.72rem;color:var(--danger);">Keluar: <b id="et-total-out">Rp 0</b></div>
            <div style="font-size:0.72rem;color:var(--accent2);">Saldo: <b id="et-balance">Rp 0</b></div>
          </div>
          <canvas id="et-chart" style="max-width:100%;border-radius:8px;background:#050508;border:1px solid var(--border);"></canvas>
          <div style="display:flex;gap:6px;margin-top:8px;">
            <button class="btn btn-secondary" onclick="etExport()">üì§ Export CSV</button>
            <button class="btn btn-secondary" onclick="etClear()">üóë Clear</button>
          </div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Riwayat</div>
          <input type="text" id="et-search" placeholder="üîç Cari..." style="margin-bottom:8px;" oninput="etRender()">
          <div id="et-list" style="max-height:420px;overflow-y:auto;display:flex;flex-direction:column;gap:5px;"></div>
          <div id="et-empty" style="text-align:center;color:var(--muted);padding:30px;font-size:0.78rem;">Belum ada transaksi</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üîÑ API TESTER ‚ïê‚ïê‚ïê -->
  <div id="tab-apiTester" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üîÑ API Tester</div>
      <div class="panel-desc">// Kirim GET/POST/PUT/DELETE request, lihat response langsung</div>
      <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;align-items:center;">
        <select id="at-method" style="width:100px;font-weight:700;">
          <option style="color:#10b981">GET</option>
          <option style="color:#f59e0b">POST</option>
          <option style="color:#06b6d4">PUT</option>
          <option style="color:#ef4444">DELETE</option>
          <option>PATCH</option>
          <option>HEAD</option>
        </select>
        <input type="url" id="at-url" placeholder="https://api.example.com/endpoint" style="flex:1;">
        <button class="btn btn-primary" onclick="atSend()" id="at-send-btn">‚ñ∂ Send</button>
      </div>
      <div class="grid-2" style="gap:12px;">
        <div>
          <div style="font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px;">Headers</div>
          <textarea id="at-headers" style="min-height:100px;font-size:0.72rem;font-family:'JetBrains Mono',monospace;" placeholder='Content-Type: application/json&#10;Authorization: Bearer TOKEN&#10;X-Custom: value'></textarea>
          <div style="font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin:8px 0 4px;">Body (JSON)</div>
          <textarea id="at-body" style="min-height:120px;font-size:0.72rem;font-family:'JetBrains Mono',monospace;" placeholder='{"key": "value"}'></textarea>
          <div style="margin-top:8px;">
            <div style="font-size:0.62rem;color:var(--muted);margin-bottom:4px;">History:</div>
            <div id="at-history" style="max-height:80px;overflow-y:auto;font-size:0.65rem;"></div>
          </div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
            <div style="font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;">Response</div>
            <div id="at-status" style="font-size:0.72rem;font-weight:700;font-family:'JetBrains Mono',monospace;"></div>
          </div>
          <div style="display:flex;gap:4px;margin-bottom:6px;">
            <button class="btn btn-secondary" onclick="atViewTab('body')" id="at-tab-body" style="font-size:0.65rem;padding:4px 10px;">Body</button>
            <button class="btn btn-secondary" onclick="atViewTab('headers')" id="at-tab-headers" style="font-size:0.65rem;padding:4px 10px;">Headers</button>
            <button class="btn btn-secondary" onclick="copyText(document.getElementById('at-response').textContent)" style="font-size:0.65rem;padding:4px 10px;margin-left:auto;">üìã</button>
          </div>
          <pre id="at-response" style="background:#050508;border:1px solid var(--border);border-radius:8px;padding:12px;min-height:280px;font-size:0.7rem;font-family:'JetBrains Mono',monospace;overflow:auto;white-space:pre-wrap;word-break:break-all;max-height:380px;color:var(--accent2);">// Response akan muncul di sini</pre>
          <div id="at-info" style="font-size:0.62rem;color:var(--muted);margin-top:4px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üéµ PLAYLIST MAKER ‚ïê‚ïê‚ïê -->
  <div id="tab-playlist" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üéµ Playlist Maker</div>
      <div class="panel-desc">// Buat playlist dengan mood tag & timer musik fokus</div>
      <div class="grid-2" style="gap:16px;">
        <div>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Tambah Lagu</div>
          <input type="text" id="pl-title" placeholder="Judul Lagu" style="margin-bottom:6px;">
          <input type="text" id="pl-artist" placeholder="Artis" style="margin-bottom:6px;">
          <div style="display:flex;gap:6px;margin-bottom:6px;">
            <input type="number" id="pl-dur" placeholder="Durasi (detik)" style="flex:1;">
            <select id="pl-mood" style="width:auto;">
              <option value="focus">üéØ Focus</option><option value="chill">üòå Chill</option>
              <option value="energy">‚ö° Energy</option><option value="sad">üòî Sad</option>
              <option value="happy">üòÑ Happy</option><option value="sleep">üåô Sleep</option>
            </select>
          </div>
          <input type="url" id="pl-url" placeholder="URL Spotify/YouTube (opsional)" style="margin-bottom:8px;">
          <button class="btn btn-primary" onclick="plAdd()" style="width:100%;margin-bottom:12px;">+ Tambah ke Playlist</button>
          <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px;">Filter Mood:</div>
          <div style="display:flex;flex-wrap:wrap;gap:4px;" id="pl-mood-filter">
            <button class="btn btn-primary" onclick="plFilter('all')" style="font-size:0.65rem;padding:4px 10px;">Semua</button>
            <button class="btn btn-secondary" onclick="plFilter('focus')" style="font-size:0.65rem;padding:4px 10px;">üéØ Focus</button>
            <button class="btn btn-secondary" onclick="plFilter('chill')" style="font-size:0.65rem;padding:4px 10px;">üòå Chill</button>
            <button class="btn btn-secondary" onclick="plFilter('energy')" style="font-size:0.65rem;padding:4px 10px;">‚ö° Energy</button>
            <button class="btn btn-secondary" onclick="plFilter('happy')" style="font-size:0.65rem;padding:4px 10px;">üòÑ Happy</button>
          </div>
          <div style="margin-top:14px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:10px;">
            <div style="font-size:0.68rem;color:var(--muted);margin-bottom:6px;">‚è±Ô∏è Musik Timer</div>
            <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
              <input type="number" id="pl-timer-min" placeholder="Menit" style="width:80px;" value="25">
              <button class="btn btn-secondary" onclick="plStartTimer()" id="pl-timer-btn" style="font-size:0.68rem;padding:6px 12px;">‚ñ∂ Mulai</button>
              <div id="pl-timer-display" style="font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--accent2);"></div>
            </div>
          </div>
          <div style="display:flex;gap:6px;margin-top:10px;">
            <button class="btn btn-secondary" onclick="plExport()">üì§ Export JSON</button>
            <button class="btn btn-secondary" onclick="plClear()">üóë Clear</button>
          </div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <div style="font-size:0.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;">Playlist (<span id="pl-count">0</span> lagu)</div>
            <div style="font-size:0.65rem;color:var(--accent2);" id="pl-total-dur"></div>
          </div>
          <div id="pl-list" style="max-height:460px;overflow-y:auto;display:flex;flex-direction:column;gap:6px;"></div>
          <div id="pl-empty" style="text-align:center;color:var(--muted);padding:30px;font-size:0.78rem;">Belum ada lagu ‚Äî tambah di form kiri</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê üóìÔ∏è WEEKLY PLANNER ‚ïê‚ïê‚ïê -->
  <div id="tab-weeklyPlanner" class="tool-panel">
    <div class="panel-card">
      <div class="panel-title">üóìÔ∏è Weekly Planner</div>
      <div class="panel-desc">// Rencanakan minggumu ‚Äî drag & drop jadwal, reminder otomatis</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;">
        <div style="display:flex;gap:6px;">
          <button class="btn btn-secondary" onclick="wpPrevWeek()">‚Üê Sebelumnya</button>
          <button class="btn btn-primary" onclick="wpThisWeek()">Minggu Ini</button>
          <button class="btn btn-secondary" onclick="wpNextWeek()">Selanjutnya ‚Üí</button>
        </div>
        <div id="wp-week-label" style="font-size:0.8rem;font-weight:700;color:var(--accent2);font-family:'JetBrains Mono',monospace;"></div>
        <div style="display:flex;gap:6px;">
          <button class="btn btn-secondary" onclick="wpExport()">üì§ Export</button>
          <button class="btn btn-secondary" onclick="wpClear()">üóë Clear</button>
        </div>
      </div>
      <div id="wp-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;"></div>
      <!-- Add task form -->
      <div id="wp-add-form" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center;">
        <div style="background:var(--surface);border:1px solid rgba(124,58,237,0.4);border-radius:16px;padding:24px;max-width:360px;width:90%;">
          <div style="font-weight:700;margin-bottom:12px;color:var(--accent2);" id="wp-form-day">Tambah Tugas</div>
          <input type="text" id="wp-task-title" placeholder="Judul tugas..." style="margin-bottom:8px;">
          <div style="display:flex;gap:6px;margin-bottom:8px;">
            <input type="time" id="wp-task-time" style="flex:1;">
            <select id="wp-task-color" style="width:auto;">
              <option value="#7c3aed">Purple</option><option value="#06b6d4">Cyan</option>
              <option value="#10b981">Green</option><option value="#f59e0b">Orange</option>
              <option value="#ef4444">Red</option>
            </select>
          </div>
          <textarea id="wp-task-note" style="min-height:60px;" placeholder="Catatan (opsional)..."></textarea>
          <div class="btn-group" style="margin-top:10px;">
            <button class="btn btn-primary" onclick="wpSaveTask()">üíæ Simpan</button>
            <button class="btn btn-secondary" onclick="document.getElementById('wp-add-form').style.display='none'">Batal</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div><!-- /container -->


<footer>
  <div class="container">
    <p>‚ö° TOOLBOX by Adam yang Ganteng ‚Äî Semua proses di browser, data aman</p>
    <div style="margin-top:10px;">
      <span class="badge">üîí Client-Side</span><span class="badge">‚ö° Tanpa Login</span>
      <span class="badge">üÜì Gratis</span><span class="badge">‚ù§Ô∏è by Adam</span>
    </div>
  </div>
</footer>
<div class="notif" id="notif">‚úì Disalin!</div>

<script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
<script>
// ===== TAB SWITCH =====
let _currentToolName = 'text';

function sw(name, btn, title){
  const outgoing = document.querySelector('.tool-panel.active');
  const incoming = document.getElementById('tab-'+name);
  if(!incoming) return;

  // If already on same tool and fullscreen ‚Äî do nothing
  if(outgoing === incoming && document.body.classList.contains('tool-fullscreen')) return;

  _currentToolName = name;

  // Update back bar title
  const backTitle = document.getElementById('tb-back-title');
  if(backTitle) backTitle.textContent = title || (btn ? btn.textContent : name);

  // Swap active panel
  if(outgoing && outgoing !== incoming){
    outgoing.style.animation='panelOut 0.18s ease-in both';
    setTimeout(()=>{ outgoing.classList.remove('active'); outgoing.style.animation=''; }, 160);
  }

  setTimeout(()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    incoming.classList.add('active');
    if(btn) btn.classList.add('active');

    // Enter fullscreen mode + hide home
    document.body.classList.add('tool-fullscreen');
    const homeEl = document.getElementById('tb-home');
    if(homeEl) homeEl.style.display = 'none';
    incoming.style.animation='fsIn 0.32s cubic-bezier(0.34,1.46,0.64,1) both';
    window.scrollTo(0,0);

    // Tab-specific init
    const _n = name;
    if(_n==='dashboard'){try{dashUpdate();}catch(e){}}
    if(_n==='reminder'){try{remRender();}catch(e){}}
    if(_n==='share'){try{shareRender();}catch(e){}}
    if(_n==='settings'){try{settingsRenderData();}catch(e){}}
    if(_n==='plugins'){try{pluginRender();}catch(e){}}
    if(_n==='i18n'){try{i18nRenderPicker();}catch(e){}}
    if(_n==='theme'){try{themeInitPresets();}catch(e){}}
    if(_n==='vault'){try{vaultCheckState();}catch(e){}}
    if(_n==='dataviz'){try{dvRender();}catch(e){}}
    if(_n==='focus'){try{focusUpdateDots();}catch(e){}}
    if(_n==='resume'){try{rvRenderEntries();}catch(e){}}
    if(_n==='biolink'){try{blRenderLinks();blPreview();}catch(e){}}
    if(_n==='aiwriting'){try{awInitQuick();}catch(e){}}
    if(_n==='expenseTracker'){try{etRender();}catch(e){}}
    if(_n==='playlist'){try{plRender();}catch(e){}}
    if(_n==='weeklyPlanner'){try{wpRender();}catch(e){}}
    if(_n==='svgEditor'){try{svgInit();}catch(e){}}
  }, outgoing && outgoing !== incoming ? 150 : 0);

  trackTool(name);
}

function swBack(){
  const active = document.querySelector('.tool-panel.active');
  if(active){
    active.style.animation='fsOut 0.22s ease-in both';
    setTimeout(()=>{
      active.classList.remove('active');
      active.style.animation='';
    }, 220);
  }
  document.body.classList.remove('tool-fullscreen');
  // Show home screen
  document.getElementById('hy-home')?.classList.remove('hidden');
  const tbBack = document.getElementById('tb-back-bar');
  if(tbBack) tbBack.style.display = 'none';
  window.scrollTo({top:0,behavior:'smooth'});
}

// ESC key to go back from any tool
document.addEventListener('keydown', e => {
  if(e.key !== 'Escape') return;
  if(!document.body.classList.contains('tool-fullscreen')) return;
  // Don't trigger if user is typing
  const tag = e.target.tagName;
  if(tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
  // Don't trigger if a modal is actually visible (check computed style, not attribute)
  const modals = document.querySelectorAll('[id$="-modal"]');
  const anyModalOpen = Array.from(modals).some(m => {
    const disp = m.style.display;
    return disp && disp !== 'none';
  });
  if(anyModalOpen) return;
  swBack();
});

function toggleMaximize(tabId){
  const panel = document.getElementById('tab-'+tabId);
  if(!panel) return;
  if(panel.classList.contains('maximized')){
    panel.style.animation='maximizeOut 0.25s ease-in both';
    setTimeout(()=>{panel.classList.remove('maximized');panel.style.animation='';},220);
  } else {
    panel.classList.add('maximized');
    panel.style.animation='maximizeIn 0.35s cubic-bezier(0.34,1.26,0.64,1) both';
    // Escape key to exit
    const esc = (e)=>{if(e.key==='Escape'){toggleMaximize(tabId);document.removeEventListener('keydown',esc);}};
    document.addEventListener('keydown',esc);
  }
}
// ===== NOTIF =====
function showNotif(m='‚úì Disalin!'){const n=document.getElementById('notif');n.textContent=m;n.classList.add('show');setTimeout(()=>n.classList.remove('show'),2000);}
function copyText(t){navigator.clipboard.writeText(t).then(()=>showNotif());}
function cpOut(id){const el=document.getElementById(id);const text=el.innerText.replace(/COPY$|COPIED!$/,'').trim();navigator.clipboard.writeText(text).then(()=>{const b=el.querySelector('.copy-btn');if(b){b.textContent='COPIED!';b.classList.add('copied');setTimeout(()=>{b.textContent='COPY';b.classList.remove('copied');},2000);}showNotif();});}

// ===== TEXT =====
function analyzeText(){const t=document.getElementById('text-input').value;document.getElementById('sc').textContent=t.length;document.getElementById('sw2').textContent=t.trim()?t.trim().split(/\s+/).length:0;document.getElementById('ss').textContent=(t.match(/[.!?]+/g)||[]).length;document.getElementById('sl').textContent=t?t.split('\n').length:0;document.getElementById('sn').textContent=t.replace(/\s/g,'').length;}
function cvCase(type){const t=document.getElementById('text-input').value;let o='';switch(type){case'upper':o=t.toUpperCase();break;case'lower':o=t.toLowerCase();break;case'title':o=t.toLowerCase().replace(/\b\w/g,c=>c.toUpperCase());break;case'reverse':o=t.split('').reverse().join('');break;case'trim':o=t.replace(/\s+/g,' ').trim();break;case'slug':o=t.toLowerCase().trim().replace(/[^\w\s-]/g,'').replace(/[\s_]+/g,'-').replace(/^-+|-+$/g,'');break;}const b=document.getElementById('text-out');b.childNodes[0].textContent=o||'(kosong)';}

// ===== PASSWORD =====
function genPass(){const len=parseInt(document.getElementById('plen').value);let chars='';if(document.getElementById('pu').checked)chars+='ABCDEFGHIJKLMNOPQRSTUVWXYZ';if(document.getElementById('pl').checked)chars+='abcdefghijklmnopqrstuvwxyz';if(document.getElementById('pn').checked)chars+='0123456789';if(document.getElementById('ps').checked)chars+='!@#$%^&*()_+-=[]{}|;:,.<>?';if(!chars){document.getElementById('pass-out').childNodes[0].textContent='‚ö† Pilih satu opsi';return;}const arr=new Uint32Array(len);crypto.getRandomValues(arr);const p=Array.from(arr).map(v=>chars[v%chars.length]).join('');document.getElementById('pass-out').childNodes[0].textContent=p;pwStrength(p);}
function genPassMulti(){const a=[];for(let i=0;i<5;i++){genPass();a.push(document.getElementById('pass-out').childNodes[0].textContent);}document.getElementById('pass-out').childNodes[0].textContent=a.join('\n');}
function pwStrength(p){let s=0;if(p.length>=8)s++;if(p.length>=12)s++;if(p.length>=20)s++;if(/[A-Z]/.test(p))s++;if(/[a-z]/.test(p))s++;if(/[0-9]/.test(p))s++;if(/[^A-Za-z0-9]/.test(p))s++;const pct=Math.min(100,(s/7)*100);const f=document.getElementById('sfill');const l=document.getElementById('slabel');f.style.width=pct+'%';if(pct<30){f.style.background='#ef4444';l.textContent='Lemah';}else if(pct<60){f.style.background='#f59e0b';l.textContent='Sedang';}else if(pct<85){f.style.background='#10b981';l.textContent='Kuat';}else{f.style.background='#06b6d4';l.textContent='‚ö° Sangat Kuat';}}

// ===== BASE64 =====
function b64(type){const inp=document.getElementById('b64-in').value;let o='';try{if(type==='encode')o=btoa(unescape(encodeURIComponent(inp)));else if(type==='decode')o=decodeURIComponent(escape(atob(inp)));else if(type==='url-enc')o=encodeURIComponent(inp);else o=decodeURIComponent(inp);}catch(e){o='‚ö† Error: '+e.message;}document.getElementById('b64-out').childNodes[0].textContent=o;}

// ===== JSON =====
function fmtJson(type){const inp=document.getElementById('json-in').value;const b=document.getElementById('json-out');try{const p=JSON.parse(inp);if(type==='pretty')b.childNodes[0].textContent=JSON.stringify(p,null,2);else if(type==='minify')b.childNodes[0].textContent=JSON.stringify(p);else if(type==='validate')b.childNodes[0].textContent='‚úÖ Valid! Tipe: '+(Array.isArray(p)?'Array':typeof p)+' | Keys: '+(typeof p==='object'?Object.keys(p).length:'N/A');else b.childNodes[0].textContent='Keys:\n'+Object.keys(p).map((k,i)=>(i+1)+'. '+k+' ('+typeof p[k]+')').join('\n');}catch(e){b.childNodes[0].textContent='‚ùå Invalid: '+e.message;}}

// ===== COLOR =====
function h2rgb(h){return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16)};}
function rgb2h(r,g,b){return'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');}
function rgb2hsl(r,g,b){r/=255;g/=255;b/=255;const max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max===min){h=s=0;}else{const d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;}h/=6;}return{h:Math.round(h*360),s:Math.round(s*100),l:Math.round(l*100)};}
function setColor(hex){document.getElementById('cpreview').style.background=hex;document.getElementById('cpicker').value=hex;document.getElementById('chex').value=hex;const{r,g,b}=h2rgb(hex);const{h,s,l}=rgb2hsl(r,g,b);document.getElementById('cvhex').textContent=hex;document.getElementById('cvrgb').textContent=`rgb(${r},${g},${b})`;document.getElementById('cvhsl').textContent=`hsl(${h},${s}%,${l}%)`;}
function fromPicker(){setColor(document.getElementById('cpicker').value);}
function fromHex(){const h=document.getElementById('chex').value;if(/^#[0-9A-Fa-f]{6}$/.test(h))setColor(h);}
function randColor(){setColor('#'+[...crypto.getRandomValues(new Uint8Array(3))].map(b=>b.toString(16).padStart(2,'0')).join(''));}

// ===== UNIT =====
const UD={length:{units:['mm','cm','m','km','inch','feet','yard','mile'],toBase:{'mm':0.001,'cm':0.01,'m':1,'km':1000,'inch':0.0254,'feet':0.3048,'yard':0.9144,'mile':1609.34}},weight:{units:['mg','g','kg','ton','oz','lb'],toBase:{'mg':0.000001,'g':0.001,'kg':1,'ton':1000,'oz':0.0283495,'lb':0.453592}},temp:{units:['Celsius','Fahrenheit','Kelvin'],toBase:null},area:{units:['mm¬≤','cm¬≤','m¬≤','km¬≤','hectare','acre','ft¬≤'],toBase:{'mm¬≤':0.000001,'cm¬≤':0.0001,'m¬≤':1,'km¬≤':1000000,'hectare':10000,'acre':4046.86,'ft¬≤':0.092903}},speed:{units:['m/s','km/h','mph','knot'],toBase:{'m/s':1,'km/h':0.277778,'mph':0.44704,'knot':0.514444}},data:{units:['bit','byte','KB','MB','GB','TB'],toBase:{'bit':0.125,'byte':1,'KB':1024,'MB':1048576,'GB':1073741824,'TB':1099511627776}}};
function updateUnits(){const cat=document.getElementById('ucat').value;const u=UD[cat].units;document.getElementById('ufrom').innerHTML=u.map(x=>`<option>${x}</option>`).join('');document.getElementById('uto').innerHTML=u.map((x,i)=>`<option${i===1?' selected':''}>${x}</option>`).join('');cvUnit();}
function cvUnit(){const cat=document.getElementById('ucat').value;const val=parseFloat(document.getElementById('uval').value);const from=document.getElementById('ufrom').value;const to=document.getElementById('uto').value;let res;if(cat==='temp'){let c;if(from==='Celsius')c=val;else if(from==='Fahrenheit')c=(val-32)*5/9;else c=val-273.15;if(to==='Celsius')res=c;else if(to==='Fahrenheit')res=c*9/5+32;else res=c+273.15;}else{const base=val*UD[cat].toBase[from];res=base/UD[cat].toBase[to];}document.getElementById('uout').textContent=isNaN(res)?'‚Äî':(parseFloat(res.toFixed(8)))+' '+to;}
function swapUnit(){const f=document.getElementById('ufrom');const t=document.getElementById('uto');const tmp=f.value;f.value=t.value;t.value=tmp;cvUnit();}

// ===== HASH =====
function djb2(s){let h=5381;for(let i=0;i<s.length;i++)h=((h<<5)+h)+s.charCodeAt(i);return(h>>>0).toString(16).padStart(8,'0');}
function fnv(s){let h=2166136261;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=(h*16777619)>>>0;}return h.toString(16).padStart(8,'0');}
function crc32(s){let t=[];for(let n=0;n<256;n++){let c=n;for(let k=0;k<8;k++)c=(c&1)?0xEDB88320^(c>>>1):c>>>1;t[n]=c;}let c=0xFFFFFFFF;for(let i=0;i<s.length;i++)c=(c>>>8)^t[(c^s.charCodeAt(i))&0xFF];return((c^0xFFFFFFFF)>>>0).toString(16).padStart(8,'0');}
async function doHash(type){const inp=document.getElementById('hash-in').value;const b=document.getElementById('hash-out');let o='';if(type==='djb2')o='DJB2:    '+djb2(inp);else if(type==='fnv')o='FNV-1a:  '+fnv(inp);else if(type==='crc32')o='CRC32:   '+crc32(inp);else{try{const e=new TextEncoder().encode(inp);const buf=await crypto.subtle.digest('SHA-256',e);o='SHA-256:\n'+Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');}catch(e){o='‚ö† '+e.message;}}b.childNodes[0].textContent=o;}

// ===== TIME =====
function updTime(){const n=new Date();document.getElementById('tsn').textContent=Math.floor(n.getTime()/1000);document.getElementById('tsiso').textContent=n.toISOString().slice(0,19);document.getElementById('tswib').textContent=n.toLocaleString('id-ID',{timeZone:'Asia/Jakarta'});}
setInterval(updTime,1000);updTime();
function cvTs(){const ts=parseInt(document.getElementById('tsin').value);if(isNaN(ts)){document.getElementById('ts-out').childNodes[0].textContent='‚ö† Masukkan angka valid';return;}const d=new Date(ts*1000);const o=['UTC:   '+d.toUTCString(),'ISO:   '+d.toISOString(),'WIB:   '+d.toLocaleString('id-ID',{timeZone:'Asia/Jakarta'}),'WITA:  '+d.toLocaleString('id-ID',{timeZone:'Asia/Makassar'}),'WIT:   '+d.toLocaleString('id-ID',{timeZone:'Asia/Jayapura'})].join('\n');document.getElementById('ts-out').childNodes[0].textContent=o;}
function cvDiff(){const a=new Date(document.getElementById('dfrom').value);const b=new Date(document.getElementById('dto').value);if(isNaN(a)||isNaN(b)){document.getElementById('diff-out').textContent='‚ö† Format: YYYY-MM-DD';return;}const ms=Math.abs(b-a);const days=Math.floor(ms/86400000);document.getElementById('diff-out').textContent=`${days} hari\n${Math.floor(days/7)} minggu\n${Math.floor(days/30.4375)} bulan (~)\n${Math.floor(days/365.25)} tahun (~)`;}

// ===== CALCULATOR =====
let cMode='std';
let cS={d:'0',p:null,op:null,new:true,h:''};
let scS={d:'0',p:null,op:null,new:true,h:''};
function setCalcMode(m){cMode=m;['std','sci','pct','loan'].forEach(x=>{document.getElementById('calc-'+x).style.display=x===m?'block':'none';document.getElementById('cm-'+x).className='btn '+(x===m?'btn-primary':'btn-secondary');});}
function updDisp(){const d=document.getElementById('cdisp');const h=document.getElementById('chist');let v=cS.d;if(!isNaN(v)&&!v.includes('.')&&Math.abs(parseFloat(v))<1e15)v=parseFloat(v).toLocaleString('id-ID',{maximumFractionDigits:10});d.textContent=v;h.textContent=cS.h;d.style.fontSize=v.length>14?'1.1rem':v.length>10?'1.6rem':'2rem';}
function cNum(n){if(cS.new){cS.d=n==='.'?'0.':n;cS.new=false;}else if(n==='.'&&cS.d.includes('.'))return;else cS.d+=n;updDisp();}
function cOp(op){if(cS.op&&!cS.new)cEq(true);cS.p=parseFloat(cS.d.replace(/[^0-9.-]/g,''));cS.op=op;cS.h=cS.d+' '+{'+':'+','-':'‚àí','*':'√ó','/':'√∑','**':'^'}[op];cS.new=true;updDisp();}
function cEq(chain=false){if(!cS.op)return;const a=cS.p,b=parseFloat(cS.d.replace(/[^0-9.-]/g,''));let r;switch(cS.op){case'+':r=a+b;break;case'-':r=a-b;break;case'*':r=a*b;break;case'/':r=b===0?'Error:√∑0':a/b;break;case'**':r=Math.pow(a,b);}if(!chain)cS.h+=(' '+cS.d+' =');cS.d=typeof r==='string'?r:String(parseFloat(r.toFixed(10)));if(!chain){cS.op=null;cS.p=null;}cS.new=true;updDisp();}
function cFn(fn){const cur=parseFloat(cS.d.replace(/[^0-9.-]/g,''))||0;if(fn==='AC'){cS={d:'0',p:null,op:null,new:true,h:''};}else if(fn==='+/-'){cS.d=String(-cur);cS.new=false;}else if(fn==='%'){cS.d=String(cur/100);cS.new=false;}else if(fn==='back'){cS.d=cS.d.length>1?cS.d.slice(0,-1):'0';cS.new=false;}updDisp();}
// Scientific
function updScDisp(){const d=document.getElementById('scdisp');d.textContent=scS.d;document.getElementById('schist').textContent=scS.h;d.style.fontSize=scS.d.length>14?'1rem':scS.d.length>10?'1.4rem':'1.7rem';}
function scNum(n){if(scS.new){scS.d=n==='.'?'0.':n;scS.new=false;}else if(n==='.'&&scS.d.includes('.'))return;else scS.d+=n;updScDisp();}
function scOp(op){if(scS.op&&!scS.new)scEq(true);scS.p=parseFloat(scS.d);scS.op=op;scS.h=scS.d+' '+{'+':'+','-':'‚àí','*':'√ó','/':'√∑','**':'^'}[op];scS.new=true;updScDisp();}
function scEq(chain=false){if(!scS.op)return;const a=scS.p,b=parseFloat(scS.d);let r;switch(scS.op){case'+':r=a+b;break;case'-':r=a-b;break;case'*':r=a*b;break;case'/':r=b===0?'Error':a/b;break;case'**':r=Math.pow(a,b);}if(!chain)scS.h+=(' '+scS.d+' =');scS.d=typeof r==='string'?r:String(parseFloat(r.toPrecision(12)));if(!chain){scS.op=null;scS.p=null;}scS.new=true;updScDisp();}
function fact(n){if(n<0)return NaN;if(n<=1)return 1;if(n>170)return Infinity;let r=1;for(let i=2;i<=n;i++)r*=i;return r;}
function scFn(fn){const cur=parseFloat(scS.d)||0;let r;switch(fn){case'sin':r=Math.sin(cur*Math.PI/180);break;case'cos':r=Math.cos(cur*Math.PI/180);break;case'tan':r=Math.tan(cur*Math.PI/180);break;case'log':r=cur<=0?'Error':Math.log10(cur);break;case'ln':r=cur<=0?'Error':Math.log(cur);break;case'sqrt':r=cur<0?'Error':Math.sqrt(cur);break;case'pow2':r=Math.pow(cur,2);break;case'pow3':r=Math.pow(cur,3);break;case'inv':r=cur===0?'Error':1/cur;break;case'abs':r=Math.abs(cur);break;case'fact':r=fact(Math.round(cur));break;case'pi':scS.d=String(Math.PI);scS.new=true;updScDisp();return;case'e':scS.d=String(Math.E);scS.new=true;updScDisp();return;case'+/-':r=-cur;break;case'%':r=cur/100;break;case'back':scS.d=scS.d.length>1?scS.d.slice(0,-1):'0';scS.new=false;updScDisp();return;case'AC':scS={d:'0',p:null,op:null,new:true,h:''};updScDisp();return;}scS.d=typeof r==='string'?r:String(parseFloat(r.toPrecision(12)));scS.new=true;updScDisp();}
function calcDisc(){const p=parseFloat(document.getElementById('disc-p').value)||0;const pct=parseFloat(document.getElementById('disc-pct').value)||0;const save=p*pct/100;document.getElementById('disc-out').textContent=`Hemat: Rp ${save.toLocaleString('id-ID')}\nHarga Akhir: Rp ${(p-save).toLocaleString('id-ID')}`;}
function calcChg(){const f=parseFloat(document.getElementById('chg-f').value)||0;const t=parseFloat(document.getElementById('chg-t').value)||0;if(f===0){document.getElementById('chg-out').textContent='‚ö† Nilai awal tidak boleh 0';return;}const pct=((t-f)/Math.abs(f))*100;document.getElementById('chg-out').textContent=`${pct>=0?'üìà Naik':'üìâ Turun'} ${Math.abs(pct).toFixed(2)}%\n${f.toLocaleString('id-ID')} ‚Üí ${t.toLocaleString('id-ID')}`;}
function calcLoan(){const total=parseFloat(document.getElementById('la').value)||0;const dp=parseFloat(document.getElementById('ldp').value)||0;const ry=parseFloat(document.getElementById('lr').value)||0;const y=parseFloat(document.getElementById('ly').value)||0;const pokok=total-dp;const rm=ry/100/12;const n=y*12;if(!pokok||!n||!ry){document.getElementById('loan-out').textContent='‚Äî isi semua kolom ‚Äî';return;}const cic=pokok*(rm*Math.pow(1+rm,n))/(Math.pow(1+rm,n)-1);const tot=cic*n;const flat=pokok/n+(pokok*ry/100/12);document.getElementById('loan-out').textContent=`‚îÅ ANUITAS (Efektif) ‚îÅ\nCicilan/bulan: Rp ${Math.round(cic).toLocaleString('id-ID')}\nTotal bayar:   Rp ${Math.round(tot).toLocaleString('id-ID')}\nTotal bunga:   Rp ${Math.round(tot-pokok).toLocaleString('id-ID')}\n\n‚îÅ FLAT ‚îÅ\nCicilan/bulan: Rp ${Math.round(flat).toLocaleString('id-ID')}\nTotal bayar:   Rp ${Math.round(flat*n).toLocaleString('id-ID')}\n\nTenor: ${y}th (${n} bulan) | DP: Rp ${dp.toLocaleString('id-ID')}`;}
document.addEventListener('keydown',e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return; if(cMode==='std'&&document.getElementById('tab-calc')?.classList.contains('active')){'0123456789.'.includes(e.key)&&cNum(e.key);e.key==='+'&&cOp('+');e.key==='-'&&cOp('-');e.key==='*'&&cOp('*');e.key==='/'&&(e.preventDefault(),cOp('/'));(e.key==='Enter'||e.key==='=')&&cEq();e.key==='Backspace'&&cFn('back');e.key==='Escape'&&cFn('AC');}});

// ===== TRANSLATE =====
let trLast='',trTimer=null;
function trCharCount(){const v=document.getElementById('tr-in').value;document.getElementById('tr-cc').textContent=v.length+' karakter';if(document.getElementById('tr-auto').checked){clearTimeout(trTimer);trTimer=setTimeout(()=>{if(v.trim())doTranslate();},1200);}}
function swapLang(){const f=document.getElementById('tr-from');const t=document.getElementById('tr-to');const fv=f.value==='auto'?t.value:f.value;const tv=t.value;for(let o of f.options)if(o.value===tv){f.value=tv;break;}for(let o of t.options)if(o.value===fv){t.value=fv;break;}const out=document.getElementById('tr-out').textContent.replace('‚Äî hasil terjemahan ‚Äî','').trim();if(out){document.getElementById('tr-in').value=out;document.getElementById('tr-cc').textContent=out.length+' karakter';}document.getElementById('tr-out').innerHTML='<span style="color:var(--muted);font-size:0.78rem;">‚Äî hasil terjemahan ‚Äî</span>';document.getElementById('tr-det').textContent='';}
function clearTr(){document.getElementById('tr-in').value='';document.getElementById('tr-cc').textContent='0 karakter';document.getElementById('tr-out').innerHTML='<span style="color:var(--muted);font-size:0.78rem;">‚Äî hasil terjemahan ‚Äî</span>';document.getElementById('tr-det').textContent='';}
async function doTranslate(){
  const text=document.getElementById('tr-in').value.trim();
  if(!text||text===trLast)return;
  const fl=document.getElementById('tr-from').value;
  const tl=document.getElementById('tr-to').value;
  const btn=document.getElementById('tr-btn');
  const load=document.getElementById('tr-load');
  const out=document.getElementById('tr-out');
  btn.disabled=true;btn.textContent='‚è≥...';load.style.display='block';out.innerHTML='';

  // MyMemory language codes (free API, no key needed)
  const LC={'Indonesia':'id','Inggris':'en','Jepang':'ja','Korea':'ko','Mandarin':'zh-CN','Arab':'ar','Spanyol':'es','Prancis':'fr','Jerman':'de','Portugis':'pt','Italia':'it','Rusia':'ru','Hindi':'hi','Thailand':'th','Vietnam':'vi','Melayu':'ms','Belanda':'nl','Turki':'tr','Jawa':'jv','Sunda':'su'};
  const toCode=LC[tl]||'en';
  const fromCode=fl==='auto'?'':LC[fl]||'id';
  const rtlL=['Arab'];const cjkL=['Mandarin','Jepang','Korea'];

  try {
    // Chunk text (MyMemory limit ~500 chars)
    const chunks=[];let cur='';
    for(const seg of (text.match(/[^\n]{1,400}\n?/g)||[text])){
      if((cur+seg).length>450){if(cur)chunks.push(cur.trim());cur=seg;}else cur+=seg;
    }
    if(cur.trim())chunks.push(cur.trim());

    const parts=[];
    for(const chunk of chunks){
      const pair=fl==='auto'?`autodetect|${toCode}`:`${fromCode}|${toCode}`;
      const url=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(chunk)}&langpair=${pair}`;
      const r=await fetch(url);
      if(!r.ok)throw new Error('HTTP '+r.status);
      const d=await r.json();
      if(d.responseStatus===200||d.responseStatus==='200'){
        parts.push(d.responseData.translatedText);
        if(chunks.indexOf(chunk)===0&&fl==='auto'&&d.responseData.detectedLanguage){
          document.getElementById('tr-det').textContent='üîç Terdeteksi: '+d.responseData.detectedLanguage;
        }
      } else {
        throw new Error(d.responseDetails||'Terjemahan gagal ('+d.responseStatus+')');
      }
    }

    const res=parts.join(' ');
    out.setAttribute('data-rtl',rtlL.includes(tl)?'true':'false');
    out.style.direction=rtlL.includes(tl)?'rtl':'ltr';
    out.style.textAlign=rtlL.includes(tl)?'right':'left';
    out.textContent=res;
    trLast=text;

  } catch(e){
    out.innerHTML=`<span style="color:var(--danger)">‚ö† ${e.message}</span><br><span style="color:var(--muted);font-size:0.78rem;">Pastikan internet aktif. MyMemory gratis ~5000 kata/hari.</span>`;
  } finally {
    btn.disabled=false;btn.textContent='üåê Terjemahkan';load.style.display='none';
  }
}
function cpTranslate(){const t=document.getElementById('tr-out').textContent.replace('‚Äî hasil terjemahan ‚Äî','').trim();if(!t)return;navigator.clipboard.writeText(t).then(()=>{const b=document.getElementById('tr-cp');b.textContent='‚úì Copied!';setTimeout(()=>b.textContent='Copy',2000);});}
function quickTr(p){document.getElementById('tr-in').value=p;document.getElementById('tr-cc').textContent=p.length+' karakter';doTranslate();}

// ===== QR CODE =====
let qrTimer=null;
function qrLive(){clearTimeout(qrTimer);qrTimer=setTimeout(()=>{if(document.getElementById('qr-in').value.trim())genQR();},600);}
function genQR(){const text=document.getElementById('qr-in').value.trim();if(!text)return;const size=parseInt(document.getElementById('qr-size').value);const ec=document.getElementById('qr-ec').value;const canvas=document.getElementById('qr-canvas');const ph=document.getElementById('qr-ph');canvas.width=size;canvas.height=size;const url=`https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}&ecc=${ec}&format=png`;const img=new Image();img.crossOrigin='anonymous';img.onload=()=>{const ctx=canvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,size,size);ctx.drawImage(img,0,0,size,size);canvas.style.display='block';ph.style.display='none';};img.onerror=()=>{ph.textContent='‚ö† Gagal. Cek koneksi internet.';};img.src=url;}
function dlQR(){const c=document.getElementById('qr-canvas');if(c.style.display==='none'){genQR();return;}const a=document.createElement('a');a.download='qrcode.png';a.href=c.toDataURL('image/png');a.click();}

// ===== RANDOM =====
function rUUID(){const u=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16));document.getElementById('r-uuid').textContent=u;}
function rNum(){const mn=parseInt(document.getElementById('r-min').value);const mx=parseInt(document.getElementById('r-max').value);const a=new Uint32Array(1);crypto.getRandomValues(a);const n=mn+(a[0]%(mx-mn+1));const el=document.getElementById('r-num');el.style.transform='scale(1.3)';el.textContent=n;setTimeout(()=>el.style.transform='',200);}
function rColor(){const h='#'+[...crypto.getRandomValues(new Uint8Array(3))].map(b=>b.toString(16).padStart(2,'0')).join('');document.getElementById('r-cbox').style.background=h;document.getElementById('r-cval').textContent=h;}
function rCoin(){const el=document.getElementById('r-coin');const lbl=document.getElementById('r-coinlbl');el.style.transform='rotateY(720deg)';setTimeout(()=>{const r=Math.random()<0.5;el.textContent=r?'ü™ô':'üíø';lbl.textContent=r?'HEADS (Angka)':'TAILS (Gambar)';lbl.style.color=r?'var(--accent3)':'var(--accent2)';el.style.transform='';},300);}
function rDice(){const s=parseInt(document.getElementById('r-dice').value);const faces=['','‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];const a=new Uint32Array(1);crypto.getRandomValues(a);const r=(a[0]%s)+1;const el=document.getElementById('r-dres');el.style.transform='rotate(360deg)';setTimeout(()=>{el.textContent=s===6&&r<=6?faces[r]:r;el.style.transform='';},200);}
const NAMES={id:{f:['Adam','Budi','Citra','Dewi','Eko','Farah','Gilang','Hana','Irfan','Joko','Kiki','Lina','Mika','Nadia','Reza','Sari','Tono','Wahyu','Yusuf','Zahra'],l:['Santoso','Wijaya','Kusuma','Pratama','Saputra','Hidayat','Nugroho','Purnama','Suharto','Rahayu']},en:{f:['James','Emily','William','Sophia','Oliver','Ava','Noah','Mia','Liam','Charlotte','Lucas','Amelia'],l:['Smith','Johnson','Williams','Jones','Brown','Davis','Miller','Wilson','Moore','Taylor']},jp:{f:['Haruto','Sakura','Riku','Yui','Sota','Hina','Yuto','Mio','Hayato','Aoi'],l:['Sato','Suzuki','Tanaka','Watanabe','Ito','Yamamoto','Nakamura','Kobayashi']}};
function rName(){const t=document.getElementById('r-ntype').value;const n=NAMES[t];const a=crypto.getRandomValues(new Uint32Array(2));const f=n.f[a[0]%n.f.length];const l=n.l[a[1]%n.l.length];document.getElementById('r-name').textContent=t==='jp'?l+' '+f:f+' '+l;}
function rPick(count){const items=document.getElementById('r-list').value.split('\n').filter(l=>l.trim());if(!items.length)return;const shuffled=[...items].sort(()=>Math.random()-0.5);const picks=shuffled.slice(0,Math.min(count,items.length));document.getElementById('r-pick').textContent=(count===1?'üéØ '+picks[0].trim():picks.map((p,i)=>(i+1)+'. '+p.trim()).join('\n'));}

// ===== MARKDOWN =====
function renderMd(){const inp=document.getElementById('md-in').value;const prev=document.getElementById('md-prev');let h=inp.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/```([\s\S]*?)```/g,'<pre><code>$1</code></pre>').replace(/^###### (.+)$/gm,'<h6>$1</h6>').replace(/^##### (.+)$/gm,'<h5>$1</h5>').replace(/^#### (.+)$/gm,'<h4>$1</h4>').replace(/^### (.+)$/gm,'<h3>$1</h3>').replace(/^## (.+)$/gm,'<h2>$1</h2>').replace(/^# (.+)$/gm,'<h1>$1</h1>').replace(/\*\*\*(.+?)\*\*\*/g,'<strong><em>$1</em></strong>').replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>').replace(/`([^`]+)`/g,'<code>$1</code>').replace(/^&gt; (.+)$/gm,'<blockquote>$1</blockquote>').replace(/^---$/gm,'<hr>').replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/!\[(.+?)\]\((.+?)\)/g,'<img src="$2" alt="$1" style="max-width:100%;border-radius:6px;">').replace(/^- \[x\] (.+)$/gm,'<div style="display:flex;gap:8px;"><input type="checkbox" checked disabled><span style="text-decoration:line-through;opacity:0.6">$1</span></div>').replace(/^- \[ \] (.+)$/gm,'<div style="display:flex;gap:8px;"><input type="checkbox" disabled>$1</div>').replace(/^[-*+] (.+)$/gm,'<li>$1</li>').replace(/^\d+\. (.+)$/gm,'<li style="list-style:decimal;margin-left:20px;">$1</li>').replace(/~~(.+?)~~/g,'<del>$1</del>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');prev.innerHTML='<p>'+h+'</p>';}
function mdIns(t){const ta=document.getElementById('md-in');const s=ta.selectionStart;ta.value=ta.value.substring(0,s)+t+ta.value.substring(ta.selectionEnd);ta.focus();ta.selectionStart=ta.selectionEnd=s+t.length;renderMd();}
function mdSample(){document.getElementById('md-in').value=`# ‚ö° Toolbox oleh Adam yang Ganteng\n\nToolbox ini dibuat dengan **penuh semangat** dan *sedikit bantuan* dari Winda.\n\n## Fitur Tersedia\n\n- üìù Text Analyzer\n- üîê Password Generator\n- üåê AI Translator\n- üßÆ Kalkulator lengkap\n\n## Kode Contoh\n\n\`\`\`\nconst creator = "Adam yang ganteng";\nconsole.log("Dibuat oleh:", creator);\n\`\`\`\n\n> Semua tools 100% gratis dan berjalan di browser!\n\n---\n\n### To Do\n\n- [x] Buat toolbox keren\n- [x] Tambahkan AI translate\n- [ ] Ajarin Winda ~~yang jelek~~ üòÑ`;renderMd();}

// ===== REGEX =====
function testRx(){const pat=document.getElementById('rx-pat').value;const flags=document.getElementById('rx-flags').value;const inp=document.getElementById('rx-in').value;const out=document.getElementById('rx-out');const stat=document.getElementById('rx-stat');if(!pat){out.innerHTML=inp||'‚Äî';stat.textContent='';return;}try{const rx=new RegExp(pat,flags);const matches=[...inp.matchAll(new RegExp(pat,flags.includes('g')?flags:flags+'g'))];out.innerHTML=inp.replace(rx,m=>`<mark>${m.replace(/</g,'&lt;')}</mark>`)||'‚Äî';stat.textContent=`‚úÖ Valid ‚Äî ${matches.length} match`;stat.style.color='var(--success)';}catch(e){out.innerHTML=inp||'‚Äî';stat.textContent='‚ùå Error: '+e.message;stat.style.color='var(--danger)';}}
function rxPreset(name,pat,flags,sample){document.getElementById('rx-pat').value=pat;document.getElementById('rx-flags').value=flags;if(!document.getElementById('rx-in').value)document.getElementById('rx-in').value=sample;testRx();}

// ===== STOPWATCH =====
let swInt=null,swRun=false,swMs=0,swLapN=0;
function swToggle(){if(swRun){clearInterval(swInt);swRun=false;document.getElementById('sw-btn').textContent='‚ñ∂ Lanjut';}else{const start=Date.now()-swMs;swInt=setInterval(()=>{swMs=Date.now()-start;const m=swMs;const h=Math.floor(m/3600000).toString().padStart(2,'0');const mn=Math.floor((m%3600000)/60000).toString().padStart(2,'0');const s=Math.floor((m%60000)/1000).toString().padStart(2,'0');const ms=Math.floor(m%1000).toString().padStart(3,'0');document.getElementById('sw-d').textContent=`${h}:${mn}:${s}.${ms}`;},10);swRun=true;document.getElementById('sw-btn').textContent='‚è∏ Pause';}}
function swReset(){clearInterval(swInt);swRun=false;swMs=0;swLapN=0;document.getElementById('sw-d').textContent='00:00:00.000';document.getElementById('sw-btn').textContent='‚ñ∂ Start';document.getElementById('sw-laps').innerHTML='';}
function swLap(){if(!swRun&&swMs===0)return;swLapN++;const d=document.getElementById('sw-d').textContent;const laps=document.getElementById('sw-laps');const div=document.createElement('div');div.style.cssText='padding:3px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;';div.innerHTML=`<span style="color:var(--muted)">Lap ${swLapN}</span><span style="color:var(--accent2)">${d}</span>`;laps.insertBefore(div,laps.firstChild);}

// ===== COUNTDOWN =====
let cdInt=null,cdRun=false,cdRem=0;
function cdToggle(){if(cdRun){clearInterval(cdInt);cdRun=false;document.getElementById('cd-btn').textContent='‚ñ∂ Lanjut';}else{if(cdRem===0){const h=parseInt(document.getElementById('cd-h').value)||0;const m=parseInt(document.getElementById('cd-m').value)||0;const s=parseInt(document.getElementById('cd-s').value)||0;cdRem=h*3600+m*60+s;}if(cdRem<=0)return;const end=Date.now()+cdRem*1000;cdInt=setInterval(()=>{cdRem=Math.max(0,Math.round((end-Date.now())/1000));const h=Math.floor(cdRem/3600);const m=Math.floor((cdRem%3600)/60);const s=cdRem%60;document.getElementById('cd-d').textContent=`${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;if(cdRem===0){clearInterval(cdInt);cdRun=false;document.getElementById('cd-btn').textContent='‚ñ∂ Start';document.getElementById('cd-d').style.color='var(--danger)';showNotif('‚è∞ Waktu Habis!');}},250);cdRun=true;document.getElementById('cd-btn').textContent='‚è∏ Pause';document.getElementById('cd-d').style.color='var(--accent3)';}}
function cdReset(){clearInterval(cdInt);cdRun=false;cdRem=0;document.getElementById('cd-btn').textContent='‚ñ∂ Start';document.getElementById('cd-d').style.color='var(--accent3)';const h=parseInt(document.getElementById('cd-h').value)||0;const m=parseInt(document.getElementById('cd-m').value)||0;const s=parseInt(document.getElementById('cd-s').value)||0;cdRem=h*3600+m*60+s;const hh=Math.floor(cdRem/3600);const mm=Math.floor((cdRem%3600)/60);const ss=cdRem%60;document.getElementById('cd-d').textContent=`${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;}
function cdPreset(m,h=0,s=0){clearInterval(cdInt);cdRun=false;cdRem=0;document.getElementById('cd-h').value=h;document.getElementById('cd-m').value=m;document.getElementById('cd-s').value=s;document.getElementById('cd-btn').textContent='‚ñ∂ Start';document.getElementById('cd-d').style.color='var(--accent3)';cdRem=h*3600+m*60+s;const hh=Math.floor(cdRem/3600);const mm2=Math.floor((cdRem%3600)/60);const ss=cdRem%60;document.getElementById('cd-d').textContent=`${hh.toString().padStart(2,'0')}:${mm2.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;}

// ===== CSV TABLE =====
function renderCsv(){const raw=document.getElementById('csv-in').value;const sep=document.getElementById('csv-sep').value;const hdr=document.getElementById('csv-hdr').checked;const wrap=document.getElementById('csv-wrap');if(!raw.trim()){wrap.innerHTML='';document.getElementById('csv-stat').textContent='';return;}const rows=raw.trim().split('\n').map(r=>r.split(sep));let html='<table>';let ds=0;if(hdr&&rows.length>0){html+='<thead><tr>'+rows[0].map(h=>`<th>${h.trim()}</th>`).join('')+'</tr></thead>';ds=1;}html+='<tbody>';for(let i=ds;i<rows.length;i++){const odd=(i-ds)%2===0;html+=`<tr style="background:${odd?'var(--bg)':'var(--surface)'};">`+rows[i].map(c=>`<td>${c.trim()}</td>`).join('')+'</tr>';}html+='</tbody></table>';wrap.innerHTML=html;document.getElementById('csv-stat').textContent=`${rows.length-ds} baris √ó ${rows[0].length} kolom`;}
function csvSample(){document.getElementById('csv-in').value=`Nama,Umur,Kota,Pekerjaan\nAdam,25,Jakarta,Developer\nWinda,22,Bandung,Designer\nBudi,30,Surabaya,Manager\nSari,28,Yogyakarta,Analyst`;renderCsv();}
function csvExport(fmt){const raw=document.getElementById('csv-in').value;const sep=document.getElementById('csv-sep').value;const rows=raw.trim().split('\n').map(r=>r.split(sep));if(!rows.length)return;let out='';if(fmt==='markdown'){out='| '+rows[0].map(h=>h.trim()).join(' | ')+' |\n';out+='| '+rows[0].map(()=>'---').join(' | ')+' |\n';for(let i=1;i<rows.length;i++)out+='| '+rows[i].map(c=>c.trim()).join(' | ')+' |\n';}else{out='<table>\n<thead><tr>'+rows[0].map(h=>`<th>${h.trim()}</th>`).join('')+'</tr></thead>\n<tbody>\n';for(let i=1;i<rows.length;i++)out+='<tr>'+rows[i].map(c=>`<td>${c.trim()}</td>`).join('')+'</tr>\n';out+='</tbody>\n</table>';}navigator.clipboard.writeText(out).then(()=>showNotif('‚úì '+fmt.toUpperCase()+' disalin!'));}

// ===== GRADIENT =====
const GR_PRESETS=[['#667eea','#764ba2'],['#f093fb','#f5576c'],['#4facfe','#00f2fe'],['#43e97b','#38f9d7'],['#fa709a','#fee140'],['#30cfd0','#330867'],['#a18cd1','#fbc2eb'],['#fd7043','#ff8a65'],['#00b09b','#96c93d'],['#a1c4fd','#c2e9fb'],['#7c3aed','#06b6d4'],['#f59e0b','#ef4444']];
function renderGr(){const type=document.getElementById('gr-type').value;const dir=document.getElementById('gr-dir').value;const c1=document.getElementById('gr-c1').value;const c2=document.getElementById('gr-c2').value;const c3=document.getElementById('gr-c3').value;const use3=document.getElementById('gr-c3on').checked;document.getElementById('gr-c1t').value=c1;document.getElementById('gr-c2t').value=c2;document.getElementById('gr-c3t').value=c3;const stops=use3?`${c1}, ${c2}, ${c3}`:`${c1}, ${c2}`;let css;if(type==='linear')css=`linear-gradient(${dir}, ${stops})`;else if(type==='radial')css=`radial-gradient(circle, ${stops})`;else css=`conic-gradient(${stops})`;document.getElementById('gr-prev').style.background=css;document.getElementById('gr-css').value=`background: ${css};`;}
function syncGr(n){const t=document.getElementById('gr-c'+n+'t').value;if(/^#[0-9A-Fa-f]{6}$/.test(t)){document.getElementById('gr-c'+n).value=t;renderGr();}}
function randGr(){const a=crypto.getRandomValues(new Uint32Array(1));const p=GR_PRESETS[a[0]%GR_PRESETS.length];document.getElementById('gr-c1').value=p[0];document.getElementById('gr-c2').value=p[1];renderGr();}
function initGrPresets(){const c=document.getElementById('gr-presets');GR_PRESETS.forEach(([c1,c2])=>{const d=document.createElement('div');d.className='gr-preset';d.style.background=`linear-gradient(135deg,${c1},${c2})`;d.onclick=()=>{document.getElementById('gr-c1').value=c1;document.getElementById('gr-c2').value=c2;document.getElementById('gr-c3on').checked=false;renderGr();};c.appendChild(d);});}

// ===== MINIFIER =====
let miniMode='css';
function setMini(m){miniMode=m;document.getElementById('mini-css').className='btn '+(m==='css'?'btn-primary':'btn-secondary');document.getElementById('mini-js').className='btn '+(m==='js'?'btn-primary':'btn-secondary');}
function doMinify(){const inp=document.getElementById('mini-in').value;if(!inp.trim())return;let o;if(miniMode==='css'){o=inp.replace(/\/\*[\s\S]*?\*\//g,'').replace(/\s*([{}:;,>~+])\s*/g,'$1').replace(/\s+/g,' ').replace(/;\}/g,'}').trim();}else{o=inp.replace(/\/\/[^\n]*/g,'').replace(/\/\*[\s\S]*?\*\//g,'').replace(/\n\s*/g,' ').replace(/\s{2,}/g,' ').replace(/\s*([=+\-*/%&|^!<>?:;,{}()[\]])\s*/g,'$1').trim();}const ratio=((1-o.length/inp.length)*100).toFixed(1);document.getElementById('mini-out').childNodes[0].textContent=o;document.getElementById('mini-stat').innerHTML=`<div class="stat-chip">Asli: <span>${inp.length}</span></div><div class="stat-chip">Hasil: <span>${o.length}</span></div><div class="stat-chip">Hemat: <span>${ratio}%</span></div>`;}
function doBeautify(){const inp=document.getElementById('mini-in').value;let o;if(miniMode==='css'){o=inp.replace(/\s*{\s*/g,' {\n  ').replace(/;\s*/g,';\n  ').replace(/\s*}\s*/g,'\n}\n').trim();}else{o=inp.replace(/;/g,';\n').replace(/\{/g,' {\n  ').replace(/\}/g,'\n}\n').replace(/\n\s*\n/g,'\n').trim();}document.getElementById('mini-out').childNodes[0].textContent=o;document.getElementById('mini-stat').innerHTML='';}
function miniSample(){document.getElementById('mini-in').value=miniMode==='css'?`.btn {\n  background: #7c3aed;\n  color: white;\n  padding: 10px 20px;\n  border-radius: 8px;\n  /* Main button style */\n  font-size: 1rem;\n  transition: all 0.2s ease;\n}\n\n.btn:hover {\n  opacity: 0.9;\n  transform: translateY(-1px);\n}`:`// Fungsi greeting\nfunction greet(name) {\n  const msg = "Halo, " + name + "!";\n  console.log(msg);\n  return msg;\n}\n\n// Hitung total\nfunction total(items) {\n  let sum = 0;\n  for (let i = 0; i < items.length; i++) {\n    sum += items[i].price;\n  }\n  return sum;\n}`;}

// ===== INIT =====
updateUnits();
setColor('#7c3aed');
renderGr();
initGrPresets();

// ===== TODO LIST =====
let todos = JSON.parse(localStorage.getItem('tb-todos')||'[]');
let todoFilter = 'all';
function saveTodos(){ localStorage.setItem('tb-todos', JSON.stringify(todos)); }
function addTodo(){
  const v = document.getElementById('todo-input').value.trim();
  if(!v) return;
  todos.unshift({ id: Date.now(), text: v, pri: document.getElementById('todo-pri').value, done: false, date: new Date().toLocaleDateString('id-ID') });
  document.getElementById('todo-input').value = '';
  saveTodos(); renderTodos();
}
function toggleTodo(id){ const t = todos.find(t=>t.id===id); if(t){ t.done=!t.done; saveTodos(); renderTodos(); } }
function deleteTodo(id){ todos = todos.filter(t=>t.id!==id); saveTodos(); renderTodos(); }
function filterTodo(f, btn){ todoFilter=f; document.querySelectorAll('.active-filter').forEach(b=>b.classList.remove('active-filter')); if(btn)btn.classList.add('active-filter'); renderTodos(); }
function clearDoneTodo(){ todos = todos.filter(t=>!t.done); saveTodos(); renderTodos(); }
function clearAllTodo(){ if(confirm('Hapus semua tugas?')){ todos=[]; saveTodos(); renderTodos(); } }
function renderTodos(){
  const priColor = {high:'var(--danger)', med:'var(--accent3)', low:'var(--success)'};
  const priLabel = {high:'üî¥', med:'üü°', low:'üü¢'};
  let filtered = todos.filter(t => {
    if(todoFilter==='active') return !t.done;
    if(todoFilter==='done') return t.done;
    if(todoFilter==='high') return t.pri==='high';
    return true;
  });
  const list = document.getElementById('todo-list');
  const empty = document.getElementById('todo-empty');
  if(!filtered.length){ list.innerHTML=''; empty.style.display='block'; }
  else {
    empty.style.display='none';
    list.innerHTML = filtered.map(t=>`
      <div style="display:flex;align-items:center;gap:10px;background:var(--bg);border:1px solid ${t.done?'var(--border)':'var(--border)'};border-left:3px solid ${priColor[t.pri]};border-radius:8px;padding:10px 14px;opacity:${t.done?0.5:1};">
        <input type="checkbox" ${t.done?'checked':''} onchange="toggleTodo(${t.id})" style="width:16px;height:16px;accent-color:var(--accent);cursor:pointer;flex-shrink:0;">
        <span style="flex:1;font-size:0.88rem;${t.done?'text-decoration:line-through;color:var(--muted)':''}">${t.text}</span>
        <span style="font-size:0.7rem;color:var(--muted);">${t.date}</span>
        <span style="font-size:0.8rem;">${priLabel[t.pri]}</span>
        <button onclick="deleteTodo(${t.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem;padding:0 4px;" title="Hapus">‚úï</button>
      </div>`).join('');
  }
  const done = todos.filter(t=>t.done).length;
  document.getElementById('todo-stats').textContent = `${todos.length} tugas ¬∑ ${done} selesai ¬∑ ${todos.length-done} aktif`;
}
renderTodos();

// ===== NOTEPAD =====
let notes = JSON.parse(localStorage.getItem('tb-notes')||'[]');
let activeNoteId = null;
let npTimer = null;
function saveNotes(){ localStorage.setItem('tb-notes', JSON.stringify(notes)); }
function newNote(){
  activeNoteId = null;
  document.getElementById('np-title').value = '';
  document.getElementById('np-body').value = '';
  document.getElementById('np-saved-status').textContent = '‚Äî catatan baru ‚Äî';
  document.getElementById('np-wordcount').textContent = '0 kata';
}
function saveNote(){
  const title = document.getElementById('np-title').value.trim() || 'Tanpa Judul';
  const body = document.getElementById('np-body').value;
  if(!body.trim() && !activeNoteId) return;
  const now = new Date().toLocaleString('id-ID');
  if(activeNoteId){
    const n = notes.find(n=>n.id===activeNoteId);
    if(n){ n.title=title; n.body=body; n.updated=now; }
  } else {
    activeNoteId = Date.now();
    notes.unshift({ id: activeNoteId, title, body, created: now, updated: now });
  }
  saveNotes(); renderNoteList();
  document.getElementById('np-saved-status').textContent = '‚úÖ Tersimpan ' + now;
}
function loadNote(id){
  const n = notes.find(n=>n.id===id);
  if(!n) return;
  activeNoteId = id;
  document.getElementById('np-title').value = n.title;
  document.getElementById('np-body').value = n.body;
  npUpdateCount();
  document.getElementById('np-saved-status').textContent = 'Diupdate: ' + n.updated;
  renderNoteList();
}
function deleteNote(id){
  notes = notes.filter(n=>n.id!==id);
  saveNotes(); renderNoteList();
  if(activeNoteId===id) newNote();
}
function npAutoSave(){
  npUpdateCount();
  clearTimeout(npTimer);
  npTimer = setTimeout(saveNote, 1500);
  document.getElementById('np-saved-status').textContent = 'üíæ Menyimpan...';
}
function npUpdateCount(){
  const w = document.getElementById('np-body').value.trim().split(/\s+/).filter(Boolean).length;
  document.getElementById('np-wordcount').textContent = w + ' kata';
}
function renderNoteList(){
  const search = (document.getElementById('snip-search')||{value:''}).value;
  const list = document.getElementById('np-list');
  const empty = document.getElementById('np-empty-list');
  if(!notes.length){ list.innerHTML=''; empty.style.display='block'; return; }
  empty.style.display='none';
  list.innerHTML = notes.map(n=>`
    <div onclick="loadNote(${n.id})" style="cursor:pointer;padding:10px 12px;border-radius:8px;border:1px solid ${activeNoteId===n.id?'var(--accent)':'var(--border)'};background:${activeNoteId===n.id?'rgba(124,58,237,0.1)':'var(--bg)'};transition:all 0.15s;">
      <div style="font-size:0.82rem;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${n.title}</div>
      <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${n.body.substring(0,50)}...</div>
      <div style="display:flex;justify-content:space-between;margin-top:4px;">
        <span style="font-size:0.65rem;color:var(--muted);">${n.updated}</span>
        <button onclick="event.stopPropagation();deleteNote(${n.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.72rem;" title="Hapus">üóë</button>
      </div>
    </div>`).join('');
}
renderNoteList();

// ===== CURRENCY =====
let rates = {};
let ratesBase = 'USD';
async function loadRates(){
  const info = document.getElementById('cur-rate-info');
  info.textContent = '‚è≥ Mengambil data kurs...';
  try {
    const r = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
    const d = await r.json();
    rates = d.rates;
    ratesBase = 'USD';
    info.textContent = `‚úÖ Kurs update: ${new Date(d.time_last_updated*1000).toLocaleString('id-ID')} ¬∑ Sumber: ExchangeRate-API`;
    convertCur();
    renderRateGrid();
  } catch(e) {
    // fallback hardcoded approximate rates
    rates = {IDR:15800,USD:1,EUR:0.92,GBP:0.79,JPY:149,SGD:1.34,MYR:4.68,AUD:1.53,CNY:7.24,SAR:3.75,KRW:1330,HKD:7.82};
    info.textContent = '‚ö† Gagal update live ‚Äî menggunakan kurs perkiraan. Aktifkan internet untuk data terbaru.';
    convertCur();
    renderRateGrid();
  }
}
function convertCur(){
  if(!Object.keys(rates).length) return;
  const from = document.getElementById('cur-from').value;
  const to = document.getElementById('cur-to').value;
  const amount = parseFloat(document.getElementById('cur-amount').value)||0;
  const inUSD = amount / (rates[from]||1);
  const result = inUSD * (rates[to]||1);
  const fmt = (n,c) => n.toLocaleString('id-ID',{maximumFractionDigits:c>1000?0:c>10?2:4});
  document.getElementById('cur-result').textContent = `${fmt(result, result)} ${to}`;
}
function swapCur(){
  const f=document.getElementById('cur-from'),t=document.getElementById('cur-to'),v=f.value;
  f.value=t.value;t.value=v;convertCur();
}
function renderRateGrid(){
  const currs=['IDR','USD','EUR','GBP','JPY','SGD','MYR','AUD','CNY','SAR'];
  const flags={IDR:'üáÆüá©',USD:'üá∫üá∏',EUR:'üá™üá∫',GBP:'üá¨üáß',JPY:'üáØüáµ',SGD:'üá∏üá¨',MYR:'üá≤üáæ',AUD:'üá¶üá∫',CNY:'üá®üá≥',SAR:'üá∏üá¶'};
  const g=document.getElementById('cur-grid');
  g.innerHTML=currs.map(c=>{
    const v=(rates[c]||1).toLocaleString('id-ID',{maximumFractionDigits:2});
    return `<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 12px;">
      <div style="font-size:1rem;">${flags[c]||''}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.9rem;color:var(--accent2);">${c}</div>
      <div style="font-size:0.75rem;color:var(--muted);">${v} / USD</div>
    </div>`;
  }).join('');
}
// Load rates on tab open
document.querySelector('[onclick*="currency"]')?.addEventListener('click',()=>{ if(!Object.keys(rates).length) loadRates(); });

// ===== WEATHER =====
const wxCodes = {
  0:'‚òÄÔ∏è',1:'üå§Ô∏è',2:'‚õÖ',3:'‚òÅÔ∏è',45:'üå´Ô∏è',48:'üå´Ô∏è',
  51:'üå¶Ô∏è',53:'üå¶Ô∏è',55:'üåßÔ∏è',61:'üåßÔ∏è',63:'üåßÔ∏è',65:'üåßÔ∏è',
  71:'‚ùÑÔ∏è',73:'‚ùÑÔ∏è',75:'‚ùÑÔ∏è',80:'üå¶Ô∏è',81:'üå¶Ô∏è',82:'‚õàÔ∏è',
  95:'‚õàÔ∏è',96:'‚õàÔ∏è',99:'‚õàÔ∏è'
};
const wxDesc = {
  0:'Cerah',1:'Cerah berawan',2:'Berawan sebagian',3:'Mendung',
  45:'Berkabut',48:'Berkabut',51:'Gerimis ringan',53:'Gerimis',55:'Gerimis lebat',
  61:'Hujan ringan',63:'Hujan sedang',65:'Hujan lebat',
  71:'Salju ringan',73:'Salju sedang',75:'Salju lebat',
  80:'Hujan lokal',81:'Hujan lokal',82:'Hujan deras',
  95:'Badai petir',96:'Badai petir',99:'Badai petir besar'
};
async function searchWeather(){
  const city = document.getElementById('wx-city').value.trim();
  if(!city) return;
  document.getElementById('wx-loading').style.display='block';
  document.getElementById('wx-result').style.display='none';
  document.getElementById('wx-error').style.display='none';
  try {
    const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=id`);
    const gd = await geo.json();
    if(!gd.results?.length) throw new Error(`Kota "${city}" tidak ditemukan`);
    const {latitude:lat, longitude:lon, name, country} = gd.results[0];
    const wx = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m,windspeed_10m,apparent_temperature&timezone=auto&forecast_days=1`);
    const wd = await wx.json();
    const cw = wd.current_weather;
    const icon = wxCodes[cw.weathercode]||'üå°Ô∏è';
    const desc = wxDesc[cw.weathercode]||'‚Äî';
    const humidity = wd.hourly?.relativehumidity_2m?.[0]||'‚Äî';
    const feelsLike = wd.hourly?.apparent_temperature?.[0]||'‚Äî';
    document.getElementById('wx-city-name').textContent = `${name}, ${country}`;
    document.getElementById('wx-icon').textContent = icon;
    document.getElementById('wx-temp').textContent = `${cw.temperature}¬∞C`;
    document.getElementById('wx-desc').textContent = desc;
    document.getElementById('wx-details').innerHTML = [
      {icon:'üå°Ô∏è', label:'Terasa', val:`${feelsLike}¬∞C`},
      {icon:'üí®', label:'Angin', val:`${cw.windspeed} km/h`},
      {icon:'üíß', label:'Kelembapan', val:`${humidity}%`},
      {icon:'üìç', label:'Koordinat', val:`${lat.toFixed(2)}, ${lon.toFixed(2)}`},
    ].map(d=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center;">
      <div style="font-size:1.5rem;">${d.icon}</div>
      <div style="font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">${d.label}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent2);margin-top:2px;">${d.val}</div>
    </div>`).join('');
    document.getElementById('wx-result').style.display='block';
  } catch(e) {
    document.getElementById('wx-error').textContent = '‚ö† ' + e.message;
    document.getElementById('wx-error').style.display='block';
  } finally {
    document.getElementById('wx-loading').style.display='none';
  }
}
function quickWeather(city){ document.getElementById('wx-city').value=city; searchWeather(); }

// ===== IMAGE COMPRESSOR =====
let icOrigFile=null, icOrigSize=0;
function icLoad(input){ if(input.files[0]) icProcess(input.files[0]); }
function icDrop(e){ e.preventDefault(); document.getElementById('ic-drop').style.borderColor='var(--border)'; const f=e.dataTransfer.files[0]; if(f&&f.type.startsWith('image/')) icProcess(f); }
function icProcess(file){
  icOrigFile=file; icOrigSize=file.size;
  document.getElementById('ic-controls').style.display='block';
  document.getElementById('ic-drop').style.display='none';
  document.getElementById('ic-orig-size').textContent=fmtBytes(file.size);
  icPreview();
}
function icPreview(){
  if(!icOrigFile)return;
  const quality=parseInt(document.getElementById('ic-quality').value)/100;
  const format=document.getElementById('ic-format').value;
  const tw=parseInt(document.getElementById('ic-w').value)||0;
  const th=parseInt(document.getElementById('ic-h').value)||0;
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const canvas=document.getElementById('ic-canvas');
      let w=img.width,h=img.height;
      if(tw&&!th){h=Math.round(tw*h/w);w=tw;}
      else if(th&&!tw){w=Math.round(th*w/h);h=th;}
      else if(tw&&th){w=tw;h=th;}
      canvas.width=w;canvas.height=h;
      canvas.getContext('2d').drawImage(img,0,0,w,h);
      canvas.toBlob(blob=>{
        document.getElementById('ic-new-size').textContent=fmtBytes(blob.size);
        const saved=Math.max(0,(1-blob.size/icOrigSize)*100);
        document.getElementById('ic-saved').textContent=saved.toFixed(1)+'%';
        document.getElementById('ic-dims').textContent=`${w}√ó${h}px`;
      },format,quality);
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(icOrigFile);
}
function icDownload(){
  const canvas=document.getElementById('ic-canvas');
  const format=document.getElementById('ic-format').value;
  const quality=parseInt(document.getElementById('ic-quality').value)/100;
  const ext={'image/jpeg':'jpg','image/png':'png','image/webp':'webp'}[format]||'jpg';
  canvas.toBlob(blob=>{
    const a=document.createElement('a');
    a.download='compressed.'+ext;
    a.href=URL.createObjectURL(blob);
    a.click();
    showNotif('‚úÖ Gambar didownload!');
  },format,quality);
}
function icReset(){ icOrigFile=null; document.getElementById('ic-controls').style.display='none'; document.getElementById('ic-drop').style.display='block'; document.getElementById('ic-file').value=''; }
function fmtBytes(b){ if(b<1024)return b+'B'; if(b<1048576)return (b/1024).toFixed(1)+'KB'; return (b/1048576).toFixed(2)+'MB'; }

// ===== FONT PREVIEW =====
const fpFonts = [
  {name:'Playfair Display',cat:'serif'},{name:'Merriweather',cat:'serif'},{name:'Lora',cat:'serif'},
  {name:'Cormorant Garamond',cat:'serif'},{name:'EB Garamond',cat:'serif'},{name:'Libre Baskerville',cat:'serif'},
  {name:'Roboto',cat:'sans'},{name:'Open Sans',cat:'sans'},{name:'Lato',cat:'sans'},
  {name:'Nunito',cat:'sans'},{name:'Poppins',cat:'sans'},{name:'Raleway',cat:'sans'},
  {name:'Montserrat',cat:'sans'},{name:'Source Sans 3',cat:'sans'},{name:'DM Sans',cat:'sans'},
  {name:'Space Grotesk',cat:'sans'},{name:'Outfit',cat:'sans'},{name:'Plus Jakarta Sans',cat:'sans'},
  {name:'JetBrains Mono',cat:'mono'},{name:'Fira Code',cat:'mono'},{name:'Source Code Pro',cat:'mono'},
  {name:'IBM Plex Mono',cat:'mono'},{name:'Inconsolata',cat:'mono'},{name:'Courier Prime',cat:'mono'},
  {name:'Syne',cat:'display'},{name:'Bebas Neue',cat:'display'},{name:'Righteous',cat:'display'},
  {name:'Abril Fatface',cat:'display'},{name:'Permanent Marker',cat:'display'},{name:'Pacifico',cat:'display'},
  {name:'Dancing Script',cat:'display'},{name:'Great Vibes',cat:'display'},{name:'Lobster',cat:'display'},
];
let fpCat='all';
let fpLoaded={};
function fpCategory(c){ fpCat=c; renderFonts(); }
function renderFonts(){
  const text=document.getElementById('fp-text').value||'Halo Dunia!';
  const size=document.getElementById('fp-size').value||28;
  const filtered=fpFonts.filter(f=>fpCat==='all'||f.cat===fpCat);
  const grid=document.getElementById('fp-grid');
  grid.innerHTML=filtered.map(f=>{
    if(!fpLoaded[f.name]){
      const link=document.createElement('link');
      link.rel='stylesheet';
      link.href=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(f.name)}&display=swap`;
      document.head.appendChild(link);
      fpLoaded[f.name]=true;
    }
    return `<div style="display:flex;align-items:center;gap:16px;padding:12px 16px;border-bottom:1px solid var(--border);transition:background 0.15s;" onmouseover="this.style.background='var(--surface2)'" onmouseout="this.style.background=''" title="Klik untuk copy nama font" onclick="navigator.clipboard.writeText('${f.name}').then(()=>showNotif('${f.name} disalin!'));this.style.borderColor='var(--accent)'">
      <div style="width:120px;flex-shrink:0;">
        <div style="font-size:0.7rem;color:var(--muted);">${f.name}</div>
        <div style="font-size:0.62rem;color:var(--border);text-transform:uppercase;">${f.cat}</div>
      </div>
      <div style="font-family:'${f.name}',serif;font-size:${size}px;color:var(--text);flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer;">${text}</div>
    </div>`;
  }).join('');
}
renderFonts();

// ===== SNIPPET MANAGER =====
let snippets=JSON.parse(localStorage.getItem('tb-snippets')||'[]');
let activeSnipId=null;
let snipFilter='all';
function saveSnippets(){ localStorage.setItem('tb-snippets',JSON.stringify(snippets)); }
function newSnippet(){
  activeSnipId=null;
  document.getElementById('snip-name').value='';
  document.getElementById('snip-desc').value='';
  document.getElementById('snip-code').value='';
  document.getElementById('snip-lang').value='js';
}
function saveSnippet(){
  const name=document.getElementById('snip-name').value.trim()||'Snippet Baru';
  const code=document.getElementById('snip-code').value;
  const desc=document.getElementById('snip-desc').value;
  const lang=document.getElementById('snip-lang').value;
  if(!code.trim()) return;
  const now=new Date().toLocaleString('id-ID');
  if(activeSnipId){
    const s=snippets.find(s=>s.id===activeSnipId);
    if(s){s.name=name;s.code=code;s.desc=desc;s.lang=lang;s.updated=now;}
  } else {
    activeSnipId=Date.now();
    snippets.unshift({id:activeSnipId,name,code,desc,lang,created:now,updated:now});
  }
  saveSnippets(); renderSnippets(); showNotif('Snippet disimpan!');
}
function loadSnippet(id){
  const s=snippets.find(s=>s.id===id);
  if(!s) return;
  activeSnipId=id;
  document.getElementById('snip-name').value=s.name;
  document.getElementById('snip-desc').value=s.desc;
  document.getElementById('snip-code').value=s.code;
  document.getElementById('snip-lang').value=s.lang;
  renderSnippets();
}
function deleteSnippet(){
  if(!activeSnipId) return;
  if(confirm('Hapus snippet ini?')){ snippets=snippets.filter(s=>s.id!==activeSnipId); saveSnippets(); newSnippet(); renderSnippets(); }
}
function copySnippet(){ const c=document.getElementById('snip-code').value; if(c) navigator.clipboard.writeText(c).then(()=>showNotif('Kode disalin!')); }
function filterSnip(f){ snipFilter=f; renderSnippets(); }
function renderSnippets(){
  const q=(document.getElementById('snip-search').value||'').toLowerCase();
  const langColors={js:'#f7df1e',css:'#1572b6',html:'#e34c26',python:'#3776ab',sql:'#cc2927',bash:'#4eaa25',other:'var(--muted)'};
  let filtered=snippets.filter(s=>{
    if(snipFilter!=='all'&&s.lang!==snipFilter) return false;
    if(q&&!s.name.toLowerCase().includes(q)&&!s.desc.toLowerCase().includes(q)&&!s.code.toLowerCase().includes(q)) return false;
    return true;
  });
  const list=document.getElementById('snip-list');
  const empty=document.getElementById('snip-empty');
  if(!filtered.length){ list.innerHTML=''; empty.style.display='block'; return; }
  empty.style.display='none';
  list.innerHTML=filtered.map(s=>`
    <div onclick="loadSnippet(${s.id})" style="cursor:pointer;padding:10px 12px;border-radius:8px;border:1px solid ${activeSnipId===s.id?'var(--accent)':'var(--border)'};background:${activeSnipId===s.id?'rgba(124,58,237,0.1)':'var(--bg)'};transition:all 0.15s;">
      <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px;">
        <span style="width:8px;height:8px;background:${langColors[s.lang]||'var(--muted)'};border-radius:50%;flex-shrink:0;"></span>
        <span style="font-size:0.82rem;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.name}</span>
      </div>
      <div style="font-size:0.7rem;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.desc||s.lang.toUpperCase()}</div>
    </div>`).join('');
}
// Add some starter snippets
if(!snippets.length){
  snippets=[
    {id:1,name:'Fetch API',lang:'js',desc:'Ambil data dari API',code:`async function fetchData(url) {\n  try {\n    const res = await fetch(url);\n    const data = await res.json();\n    return data;\n  } catch(err) {\n    console.error('Error:', err);\n  }\n}`,created:'‚Äî',updated:'‚Äî'},
    {id:2,name:'Flexbox Center',lang:'css',desc:'Center dengan flexbox',code:`.container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n}`,created:'‚Äî',updated:'‚Äî'},
    {id:3,name:'HTML Template',lang:'html',desc:'Template HTML dasar',code:`<!DOCTYPE html>\n<html lang="id">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Halaman</title>\n</head>\n<body>\n  <h1>Halo Dunia!</h1>\n</body>\n</html>`,created:'‚Äî',updated:'‚Äî'},
  ];
  saveSnippets();
}
renderSnippets();

// ===== ASPECT RATIO =====
function gcd(a,b){ return b?gcd(b,a%b):a; }
function calcAR(){
  const w=parseInt(document.getElementById('ar-w').value)||0;
  const h=parseInt(document.getElementById('ar-h').value)||0;
  if(!w||!h){ document.getElementById('ar-out').textContent='‚Äî'; return; }
  const g=gcd(w,h);
  const rw=w/g, rh=h/g;
  const dec=(w/h).toFixed(4);
  document.getElementById('ar-out').textContent=`Rasio: ${rw}:${rh}\nDesimal: ${dec}:1\nTipe: ${rw===16&&rh===9?'Widescreen HD':rw===4&&rh===3?'Klasik TV':rw===1&&rh===1?'Square':rw===9&&rh===16?'Portrait/Story':rw===21&&rh===9?'Ultrawide':'Custom'}`;
}
function calcScale(){
  const ow=parseInt(document.getElementById('sc-ow').value)||0;
  const oh=parseInt(document.getElementById('sc-oh').value)||0;
  const tw=parseInt(document.getElementById('sc-tw').value)||0;
  const th=parseInt(document.getElementById('sc-th').value)||0;
  if(!ow||!oh){ document.getElementById('sc-out').textContent='‚Äî'; return; }
  if(tw){
    const nh=Math.round(tw*oh/ow);
    document.getElementById('sc-out').textContent=`Target: ${tw} √ó ${nh} px\nSkala: ${(tw/ow*100).toFixed(1)}%`;
  } else if(th){
    const nw=Math.round(th*ow/oh);
    document.getElementById('sc-out').textContent=`Target: ${nw} √ó ${th} px\nSkala: ${(th/oh*100).toFixed(1)}%`;
  }
}
function setAR(w,h){
  document.getElementById('ar-w').value=w;
  document.getElementById('ar-h').value=h;
  calcAR();
  const presets={
    '16:9':['1920√ó1080','1280√ó720','3840√ó2160','2560√ó1440'],
    '4:3':['1024√ó768','800√ó600','1400√ó1050'],
    '1:1':['1080√ó1080','500√ó500','800√ó800'],
    '9:16':['1080√ó1920','720√ó1280'],
    '3:2':['3000√ó2000','4500√ó3000'],
    '21:9':['2560√ó1080','3440√ó1440'],
    '2:1':['2000√ó1000','1200√ó600'],
    '4:5':['1080√ó1350','800√ó1000'],
    '1200:630':['1200√ó630'],
  };
  const g=gcd(w,h);
  const key=`${w/g}:${h/g}`;
  const ps=presets[key]||[];
  const pout=document.getElementById('ar-preset-out');
  if(ps.length){
    pout.style.display='block';
    pout.textContent=`Resolusi umum ${key}:\n${ps.join(' ¬∑ ')}`;
  } else { pout.style.display='none'; }
}

// ===== MINDMAP =====
function mmExample(){
  document.getElementById('mm-input').value=`Teknologi
  Artificial Intelligence
    Machine Learning
    Computer Vision
    NLP
  Web Development
    Frontend
      React
      Vue
    Backend
      Node.js
      Python
  Mobile
    Android
    iOS`;
  renderMindmap();
}
function renderMindmap(){
  const raw=document.getElementById('mm-input').value;
  const lines=raw.split('\n').filter(l=>l.trim());
  if(!lines.length) return;
  const canvas=document.getElementById('mm-canvas');
  // Parse tree
  const root={text:lines[0].trim(),children:[],level:0};
  const stack=[root];
  for(let i=1;i<lines.length;i++){
    const line=lines[i];
    const indent=line.search(/\S/);
    const level=Math.floor(indent/2)+1;
    const node={text:line.trim(),children:[],level};
    while(stack.length>level) stack.pop();
    if(stack.length) stack[stack.length-1].children.push(node);
    stack.push(node);
  }
  // Render as SVG
  const colors=['#7c3aed','#06b6d4','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899'];
  const W=700,H=500;
  let svg=`<svg width="${W}" height="${H}" xmlns="http://www.w3.org/2000/svg" style="font-family:Space Mono,monospace;">`;
  svg+=`<rect width="${W}" height="${H}" fill="#0a0a0f" rx="8"/>`;
  const cx=160,cy=H/2,rx=120,ry=26;
  // Draw root
  svg+=`<ellipse cx="${cx}" cy="${cy}" rx="${rx}" ry="${ry}" fill="#7c3aed" opacity="0.9"/>`;
  svg+=`<text x="${cx}" y="${cy+5}" text-anchor="middle" fill="white" font-size="13" font-weight="bold">${root.text.substring(0,18)}</text>`;
  // Draw branches
  const total=root.children.length;
  root.children.forEach((child,i)=>{
    const angle=((i/(total||1))*Math.PI*1.6)-(Math.PI*0.8);
    const bx=cx+rx+1;
    const by=cy;
    const ex=320,ey=80+(i*(H-80)/(total||1));
    const color=colors[i%colors.length];
    svg+=`<line x1="${bx}" y1="${by}" x2="${ex}" y2="${ey}" stroke="${color}" stroke-width="2" opacity="0.7"/>`;
    const tw=Math.min(child.text.length*7+16,160);
    svg+=`<rect x="${ex}" y="${ey-16}" width="${tw}" height="28" rx="8" fill="${color}" opacity="0.25"/>`;
    svg+=`<rect x="${ex}" y="${ey-16}" width="3" height="28" rx="1" fill="${color}"/>`;
    svg+=`<text x="${ex+10}" y="${ey+5}" fill="#e8e8f0" font-size="11.5">${child.text.substring(0,20)}</text>`;
    // Sub children
    child.children.forEach((sub,j)=>{
      const sx=ex+tw+10;
      const sy=ey-14*(child.children.length-1)/2+j*22;
      svg+=`<line x1="${ex+tw}" y1="${ey}" x2="${sx}" y2="${sy+6}" stroke="${color}" stroke-width="1.5" opacity="0.4"/>`;
      const stw=Math.min(sub.text.length*6+12,140);
      svg+=`<rect x="${sx}" y="${sy}" width="${stw}" height="20" rx="4" fill="${color}" opacity="0.12"/>`;
      svg+=`<text x="${sx+8}" y="${sy+13}" fill="#9999bb" font-size="10">${sub.text.substring(0,22)}</text>`;
    });
  });
  svg+=`</svg>`;
  canvas.innerHTML=svg;
}
function mmDownload(){
  const svg=document.getElementById('mm-canvas').innerHTML;
  if(!svg.includes('<svg')) return;
  const blob=new Blob([svg],{type:'image/svg+xml'});
  const a=document.createElement('a');a.download='mindmap.svg';a.href=URL.createObjectURL(blob);a.click();
}

// ===== MORSE CODE =====
const MORSE_MAP={A:'.-',B:'-...',C:'-.-.',D:'-..',E:'.',F:'..-.',G:'--.',H:'....',I:'..',J:'.---',K:'-.-',L:'.-..',M:'--',N:'-.',O:'---',P:'.--.',Q:'--.-',R:'.-.',S:'...',T:'-',U:'..-',V:'...-',W:'.--',X:'-..-',Y:'-.--',Z:'--..',0:'-----',1:'.----',2:'..---',3:'...--',4:'....-',5:'.....',6:'-....',7:'--...',8:'---..',9:'----.',' ':'/'};
const MORSE_REV=Object.fromEntries(Object.entries(MORSE_MAP).map(([k,v])=>[v,k]));
function textToMorse(){
  const t=document.getElementById('morse-text').value.toUpperCase();
  const m=t.split('').map(c=>MORSE_MAP[c]||'').filter(c=>c).join(' ');
  document.getElementById('morse-code').value=m;
  updateMorseVisual(m);
}
function morseToText(){
  const m=document.getElementById('morse-code').value.trim();
  const words=m.split(' / ');
  const t=words.map(w=>w.split(' ').map(s=>MORSE_REV[s]||'?').join('')).join(' ');
  document.getElementById('morse-text').value=t;
  updateMorseVisual(m);
}
function updateMorseVisual(m){
  const v=document.getElementById('morse-visual');
  v.innerHTML=m.split('').map(c=>{
    if(c==='.') return `<div style="width:8px;height:8px;background:var(--accent2);border-radius:50%;flex-shrink:0;"></div>`;
    if(c==='-') return `<div style="width:24px;height:8px;background:var(--accent);border-radius:4px;flex-shrink:0;"></div>`;
    if(c===' ') return `<div style="width:8px;"></div>`;
    if(c==='/') return `<div style="width:16px;height:8px;background:var(--border);border-radius:2px;flex-shrink:0;opacity:0.5;"></div>`;
    return '';
  }).join('');
}
let morseCtx=null,morseStop=false;
async function playMorse(){
  const code=document.getElementById('morse-code').value.trim();
  if(!code){showNotif('Isi teks dulu!');return;}
  morseStop=false;
  const wpm=parseInt(document.getElementById('morse-speed').value)||15;
  const freq=parseInt(document.getElementById('morse-freq').value)||600;
  const dot=1200/wpm;
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const btn=document.getElementById('morse-play-btn');
  btn.textContent='‚è∏ Playing...';
  const play=async(dur)=>{
    if(morseStop) return;
    const o=ctx.createOscillator(),g=ctx.createGain();
    o.connect(g);g.connect(ctx.destination);
    o.frequency.value=freq;g.gain.value=0.3;
    o.start();
    await new Promise(r=>setTimeout(r,dur));
    o.stop();
    await new Promise(r=>setTimeout(r,dot));
  };
  for(const char of code){
    if(morseStop) break;
    if(char==='.') await play(dot);
    else if(char==='-') await play(dot*3);
    else if(char===' ') await new Promise(r=>setTimeout(r,dot*2));
    else if(char==='/') await new Promise(r=>setTimeout(r,dot*5));
  }
  ctx.close();
  btn.textContent='‚ñ∂ Putar Suara';
}
function stopMorse(){ morseStop=true; document.getElementById('morse-play-btn').textContent='‚ñ∂ Putar Suara'; }
document.getElementById('morse-speed')?.addEventListener('input',e=>document.getElementById('morse-speed-val').textContent=e.target.value+' WPM');
document.getElementById('morse-freq')?.addEventListener('input',e=>document.getElementById('morse-freq-val').textContent=e.target.value+' Hz');
// Morse table
(()=>{
  const t=document.getElementById('morse-table');
  if(t) t.innerHTML=Object.entries(MORSE_MAP).map(([k,v])=>`<div style="background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:4px 8px;"><span style="color:var(--text);font-weight:700;">${k}</span><span style="color:var(--muted);margin-left:6px;">${v}</span></div>`).join('');
})();

// ===== WORLD CLOCK =====
const WC_CITIES=[
  {name:'Jakarta',tz:'Asia/Jakarta',flag:'üáÆüá©'},{name:'Bali',tz:'Asia/Makassar',flag:'üáÆüá©'},
  {name:'Tokyo',tz:'Asia/Tokyo',flag:'üáØüáµ'},{name:'Seoul',tz:'Asia/Seoul',flag:'üá∞üá∑'},
  {name:'Singapore',tz:'Asia/Singapore',flag:'üá∏üá¨'},{name:'Beijing',tz:'Asia/Shanghai',flag:'üá®üá≥'},
  {name:'Dubai',tz:'Asia/Dubai',flag:'üá¶üá™'},{name:'London',tz:'Europe/London',flag:'üá¨üáß'},
  {name:'Paris',tz:'Europe/Paris',flag:'üá´üá∑'},{name:'New York',tz:'America/New_York',flag:'üá∫üá∏'},
  {name:'Los Angeles',tz:'America/Los_Angeles',flag:'üá∫üá∏'},{name:'Sydney',tz:'Australia/Sydney',flag:'üá¶üá∫'},
  {name:'Mumbai',tz:'Asia/Kolkata',flag:'üáÆüá≥'},{name:'Moscow',tz:'Europe/Moscow',flag:'üá∑üá∫'},
  {name:'S√£o Paulo',tz:'America/Sao_Paulo',flag:'üáßüá∑'},
];
let wcCustom=JSON.parse(localStorage.getItem('tb-wc-custom')||'[]');
let wcInterval=null;
function renderWorldClock(){
  const all=[...WC_CITIES,...wcCustom];
  const grid=document.getElementById('wc-grid');
  if(!grid) return;
  const now=new Date();
  grid.innerHTML=all.map((c,i)=>{
    const t=now.toLocaleTimeString('id-ID',{timeZone:c.tz,hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const d=now.toLocaleDateString('id-ID',{timeZone:c.tz,weekday:'short',day:'numeric',month:'short'});
    const isCustom=i>=WC_CITIES.length;
    const h=parseInt(now.toLocaleTimeString('en-US',{timeZone:c.tz,hour:'2-digit',hour12:false}));
    const isDark=h<6||h>=20;
    return `<div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;position:relative;">
      ${isCustom?`<button onclick="removeWCCity(${i-WC_CITIES.length})" style="position:absolute;top:6px;right:8px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">‚úï</button>`:''}
      <div style="font-size:1.4rem;">${c.flag||'üåê'} ${isDark?'üåô':'‚òÄÔ∏è'}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.92rem;color:var(--text);margin:4px 0;">${c.name}</div>
      <div style="font-family:'Space Mono',monospace;font-size:1.4rem;font-weight:700;color:var(--accent2);letter-spacing:1px;">${t}</div>
      <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;">${d}</div>
      <div style="font-size:0.65rem;color:var(--border);margin-top:2px;">${c.tz}</div>
    </div>`;
  }).join('');
}
function addWCCity(){
  const name=document.getElementById('wc-city-name').value.trim();
  const tz=document.getElementById('wc-tz').value;
  if(!name||!tz) return;
  wcCustom.push({name,tz,flag:'üåê'});
  localStorage.setItem('tb-wc-custom',JSON.stringify(wcCustom));
  document.getElementById('wc-city-name').value='';
  renderWorldClock();
}
function removeWCCity(i){ wcCustom.splice(i,1); localStorage.setItem('tb-wc-custom',JSON.stringify(wcCustom)); renderWorldClock(); }
// Populate timezone select
(()=>{
  const tzs=['Africa/Cairo','America/Chicago','America/Denver','America/Los_Angeles','America/Mexico_City','America/New_York','America/Sao_Paulo','America/Toronto','Asia/Bangkok','Asia/Colombo','Asia/Dubai','Asia/Hong_Kong','Asia/Jakarta','Asia/Karachi','Asia/Kolkata','Asia/Kuala_Lumpur','Asia/Makassar','Asia/Manila','Asia/Riyadh','Asia/Seoul','Asia/Shanghai','Asia/Singapore','Asia/Taipei','Asia/Tehran','Asia/Tokyo','Australia/Melbourne','Australia/Sydney','Europe/Amsterdam','Europe/Berlin','Europe/Istanbul','Europe/London','Europe/Madrid','Europe/Moscow','Europe/Paris','Europe/Rome','Pacific/Auckland','Pacific/Honolulu'];
  const sel=document.getElementById('wc-tz');
  if(sel) sel.innerHTML=tzs.map(t=>`<option value="${t}">${t}</option>`).join('');
})();
// Start ticking when tab is opened
document.querySelector('[onclick*="worldclock"]')?.addEventListener('click',()=>{ clearInterval(wcInterval); renderWorldClock(); wcInterval=setInterval(renderWorldClock,1000); });

// ===== FAKE DATA =====
const FD={
  first:['Budi','Siti','Ahmad','Dewi','Rudi','Ayu','Hendra','Nur','Andi','Putri','Rizky','Indah','Wahyu','Mega','Dian','Bayu','Citra','Fajar','Gita','Irma','Joko','Kartika','Lena','Mulyadi','Nova','Oka','Prita','Rini','Surya','Tari','Yuni','Zahra','Agus','Eka','Firman'],
  last:['Santoso','Rahayu','Kusuma','Pratama','Wijaya','Sari','Putra','Susanto','Hidayat','Wahyudi','Nugroho','Lestari','Permata','Saputra','Wibowo','Handoko','Setiawan','Kurniawan','Gunawan','Hartono','Irawati','Juliani','Kristiawan','Lukito','Mulyono'],
  city:['Jakarta','Bandung','Surabaya','Yogyakarta','Semarang','Medan','Makassar','Palembang','Tangerang','Bekasi','Depok','Bogor','Malang','Denpasar','Balikpapan'],
  prov:{'Jakarta':'DKI Jakarta','Bandung':'Jawa Barat','Surabaya':'Jawa Timur','Yogyakarta':'DIY','Semarang':'Jawa Tengah','Medan':'Sumatera Utara','Makassar':'Sulawesi Selatan','Palembang':'Sumatera Selatan','Tangerang':'Banten','Bekasi':'Jawa Barat','Depok':'Jawa Barat','Bogor':'Jawa Barat','Malang':'Jawa Timur','Denpasar':'Bali','Balikpapan':'Kalimantan Timur'},
  street:['Jl. Sudirman','Jl. Thamrin','Jl. Gatot Subroto','Jl. Merdeka','Jl. Pahlawan','Jl. Ahmad Yani','Jl. Diponegoro','Jl. Imam Bonjol','Jl. Hayam Wuruk','Jl. Veteran'],
  job:['Software Engineer','Data Analyst','Product Manager','UI/UX Designer','Marketing Manager','Akuntan','Dokter','Guru','Pengacara','Arsitek','Fotografer','Jurnalis','Apoteker','Konsultan','HR Manager'],
  bank:['BCA','BNI','BRI','Mandiri','CIMB Niaga','Danamon','Permata','BTN'],
  domain:['gmail.com','yahoo.com','outlook.com','email.com','mail.com'],
};
function rndItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function rndInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function genNIK(city,dob,gender){
  const kodes={'Jakarta':'3174','Bandung':'3273','Surabaya':'3578','Yogyakarta':'3471','Semarang':'3374','Medan':'1275','Makassar':'7371','Palembang':'1671','Tangerang':'3603','Bekasi':'3275','Depok':'3276','Bogor':'3201','Malang':'3573','Denpasar':'5171','Balikpapan':'6471'};
  const kode=kodes[city]||'3174';
  const d=new Date(dob);
  let dd=d.getDate(),mm=d.getMonth()+1,yy=String(d.getFullYear()).slice(2);
  if(gender==='P') dd+=40;
  const dobStr=String(dd).padStart(2,'0')+String(mm).padStart(2,'0')+yy;
  const rand=String(rndInt(1000,9999));
  const seq=String(rndInt(100,999));
  return kode+'01'+dobStr+rand+seq.slice(0,3);
}
let fdData=[];
function genFakeData(){
  const count=Math.min(50,parseInt(document.getElementById('fd-count').value)||5);
  fdData=[];
  for(let i=0;i<count;i++){
    const fn=rndItem(FD.first),ln=rndItem(FD.last);
    const gender=Math.random()>0.5?'L':'P';
    const city=rndItem(FD.city);
    const year=rndInt(1970,2000),month=rndInt(1,12),day=rndInt(1,28);
    const dob=`${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const row={};
    if(document.getElementById('fd-nama').checked) row.nama=fn+' '+ln;
    if(document.getElementById('fd-nik').checked) row.nik=genNIK(city,dob,gender);
    if(document.getElementById('fd-email').checked) row.email=fn.toLowerCase()+'.'+ln.toLowerCase()+rndInt(1,99)+'@'+rndItem(FD.domain);
    if(document.getElementById('fd-phone').checked) row.telepon='08'+rndInt(1,9)+String(rndInt(10000000,99999999));
    if(document.getElementById('fd-alamat').checked) row.alamat=rndItem(FD.street)+' No.'+rndInt(1,200)+', '+city+', '+FD.prov[city];
    if(document.getElementById('fd-dob').checked) row.tgl_lahir=dob;
    if(document.getElementById('fd-job').checked) row.pekerjaan=rndItem(FD.job);
    if(document.getElementById('fd-bank').checked) row.rekening=rndItem(FD.bank)+' '+String(rndInt(100,999))+'-'+String(rndInt(100,999))+'-'+String(rndInt(1000,9999));
    fdData.push(row);
  }
  renderFDTable();
}
function renderFDTable(){
  if(!fdData.length) return;
  const keys=Object.keys(fdData[0]);
  let html=`<table class="csv-table"><thead><tr>${keys.map(k=>`<th>${k}</th>`).join('')}</tr></thead><tbody>`;
  fdData.forEach(r=>{ html+=`<tr>${keys.map(k=>`<td>${r[k]}</td>`).join('')}</tr>`; });
  html+=`</tbody></table>`;
  document.getElementById('fd-table-wrap').innerHTML=html;
}
function copyFakeData(){ navigator.clipboard.writeText(JSON.stringify(fdData,null,2)).then(()=>showNotif('JSON disalin!')); }
function exportFakeCSV(){
  if(!fdData.length) return;
  const keys=Object.keys(fdData[0]);
  const csv=[keys.join(','),...fdData.map(r=>keys.map(k=>`"${r[k]}"`).join(','))].join('\n');
  const a=document.createElement('a');a.download='fake-data.csv';a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.click();
  showNotif('CSV didownload!');
}

// ===== PALETTE EXTRACTOR =====
let palCanvas=null,palImgData=null;
function palDrop(e){ e.preventDefault(); document.getElementById('pal-drop').style.borderColor='var(--border)'; const f=e.dataTransfer.files[0]; if(f&&f.type.startsWith('image/')) palProcess(f); }
function palLoad(inp){ if(inp.files[0]) palProcess(inp.files[0]); }
function palProcess(file){
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      document.getElementById('pal-img').src=e.target.result;
      const c=document.createElement('canvas');
      c.width=Math.min(img.width,100);c.height=Math.min(img.height,100);
      const ctx=c.getContext('2d');ctx.drawImage(img,0,0,c.width,c.height);
      palImgData=ctx.getImageData(0,0,c.width,c.height);
      document.getElementById('pal-drop').style.display='none';
      document.getElementById('pal-result').style.display='block';
      palReExtract();
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(file);
}
function palReExtract(){
  const n=parseInt(document.getElementById('pal-count').value)||6;
  document.getElementById('pal-count-val').textContent=n;
  if(!palImgData) return;
  const d=palImgData.data;
  const pixels=[];
  for(let i=0;i<d.length;i+=16) pixels.push([d[i],d[i+1],d[i+2]]);
  // Simple k-means-like: bucket by quantized color
  const buckets={};
  pixels.forEach(([r,g,b])=>{
    const qr=Math.round(r/32)*32,qg=Math.round(g/32)*32,qb=Math.round(b/32)*32;
    const k=`${qr},${qg},${qb}`;
    if(!buckets[k]) buckets[k]={r:0,g:0,b:0,count:0,qr,qg,qb};
    buckets[k].r+=r;buckets[k].g+=g;buckets[k].b+=b;buckets[k].count++;
  });
  const sorted=Object.values(buckets).sort((a,b)=>b.count-a.count).slice(0,n);
  const colors=sorted.map(b=>({r:Math.round(b.r/b.count),g:Math.round(b.g/b.count),b:Math.round(b.b/b.count),count:b.count}));
  // Render
  const colorsEl=document.getElementById('pal-colors');
  const swatchEl=document.getElementById('pal-swatches');
  colorsEl.innerHTML=colors.map(c=>{
    const hex='#'+[c.r,c.g,c.b].map(x=>x.toString(16).padStart(2,'0')).join('');
    const {h,s,l}=rgbToHsl(c.r,c.g,c.b);
    const pct=((c.count/pixels.length)*100).toFixed(1);
    const textColor=(c.r*0.299+c.g*0.587+c.b*0.114)>140?'#000':'#fff';
    return `<div style="display:flex;align-items:center;gap:10px;cursor:pointer;" onclick="navigator.clipboard.writeText('${hex}').then(()=>showNotif('${hex} disalin!'))">
      <div style="width:48px;height:32px;background:${hex};border-radius:6px;flex-shrink:0;border:1px solid rgba(255,255,255,0.1);"></div>
      <div style="flex:1;">
        <div style="font-size:0.85rem;font-weight:700;color:var(--accent2);">${hex.toUpperCase()}</div>
        <div style="font-size:0.7rem;color:var(--muted);">rgb(${c.r},${c.g},${c.b}) ¬∑ hsl(${h},${s}%,${l}%) ¬∑ ${pct}%</div>
      </div>
      <div style="width:60px;height:8px;background:var(--border);border-radius:4px;overflow:hidden;"><div style="height:100%;background:${hex};width:${pct}%;"></div></div>
    </div>`;
  }).join('');
  swatchEl.innerHTML=colors.map(c=>{
    const hex='#'+[c.r,c.g,c.b].map(x=>x.toString(16).padStart(2,'0')).join('');
    return `<div onclick="navigator.clipboard.writeText('${hex}').then(()=>showNotif('${hex} disalin!'))" title="${hex}" style="width:40px;height:40px;background:${hex};border-radius:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.15);transition:transform 0.15s;" onmouseover="this.style.transform='scale(1.15)'" onmouseout="this.style.transform=''"></div>`;
  }).join('');
}

// ===== CHART GENERATOR =====
let cgChartInstance=null;
function renderChart(){
  const raw=document.getElementById('cg-data').value.trim();
  const type=document.getElementById('cg-type').value;
  const title=document.getElementById('cg-title').value;
  if(!raw) return;
  const rows=raw.split('\n').map(r=>r.split(',').map(s=>s.trim())).filter(r=>r.length>=2);
  if(!rows.length) return;
  const labels=rows.map(r=>r[0]);
  const values=rows.map(r=>parseFloat(r[1])||0);
  const palette=['#7c3aed','#06b6d4','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#f97316','#14b8a6','#84cc16'];
  const canvas=document.getElementById('cg-canvas');
  const W=canvas.parentElement.offsetWidth-32||500,H=360;
  canvas.width=W;canvas.height=H;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#0a0a0f';ctx.fillRect(0,0,W,H);
  // Title
  ctx.fillStyle='#e8e8f0';ctx.font='bold 16px Syne,sans-serif';ctx.textAlign='center';
  ctx.fillText(title,W/2,30);
  const pad={t:50,r:20,b:60,l:55};
  const cw=W-pad.l-pad.r,ch=H-pad.t-pad.b;
  if(type==='pie'||type==='donut'){
    const cx=W/2,cy=H/2+10,r=Math.min(cw,ch)/2-10;
    const total=values.reduce((a,b)=>a+b,0);
    let angle=-Math.PI/2;
    values.forEach((v,i)=>{
      const sweep=(v/total)*Math.PI*2;
      ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,angle,angle+sweep);ctx.closePath();
      ctx.fillStyle=palette[i%palette.length];ctx.fill();
      if(type==='donut'){ctx.beginPath();ctx.arc(cx,cy,r*0.5,0,Math.PI*2);ctx.fillStyle='#0a0a0f';ctx.fill();}
      const midA=angle+sweep/2;
      const tx=cx+Math.cos(midA)*(r*0.7),ty=cy+Math.sin(midA)*(r*0.7);
      ctx.fillStyle='#fff';ctx.font='bold 11px Space Mono,monospace';ctx.textAlign='center';
      ctx.fillText(((v/total)*100).toFixed(1)+'%',tx,ty+4);
      angle+=sweep;
    });
    const maxL=5;
    labels.slice(0,maxL).forEach((l,i)=>{
      ctx.fillStyle=palette[i%palette.length];ctx.fillRect(10,H-50+i*16,12,12);
      ctx.fillStyle='#9999bb';ctx.font='11px Space Mono,monospace';ctx.textAlign='left';
      ctx.fillText(l.substring(0,20),28,H-42+i*16);
    });
  } else {
    const max=Math.max(...values)*1.1||1;
    const yStep=Math.ceil(max/5);
    // Grid & Y axis
    for(let i=0;i<=5;i++){
      const y=pad.t+ch-(i/5)*ch;
      ctx.strokeStyle='#2a2a3d';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+cw,y);ctx.stroke();
      ctx.fillStyle='#6b6b8a';ctx.font='10px Space Mono,monospace';ctx.textAlign='right';
      ctx.fillText(Math.round(i*yStep),pad.l-5,y+4);
    }
    if(type==='bar'||type==='horizontal-bar'){
      const bw=Math.min(cw/labels.length*0.6,60);
      labels.forEach((l,i)=>{
        const x=pad.l+(i+0.5)*(cw/labels.length);
        const bh=(values[i]/max)*ch;
        const y=pad.t+ch-bh;
        const grad=ctx.createLinearGradient(0,y,0,y+bh);
        grad.addColorStop(0,palette[i%palette.length]);
        grad.addColorStop(1,palette[i%palette.length]+'44');
        ctx.fillStyle=grad;
        ctx.beginPath();ctx.roundRect?ctx.roundRect(x-bw/2,y,bw,bh,4):ctx.fillRect(x-bw/2,y,bw,bh);ctx.fill();
        ctx.fillStyle='#e8e8f0';ctx.font='bold 10px Space Mono,monospace';ctx.textAlign='center';
        ctx.fillText(values[i],x,y-5);
        ctx.fillStyle='#9999bb';ctx.font='10px Space Mono,monospace';
        ctx.fillText(l.substring(0,8),x,H-pad.b+15);
      });
    } else if(type==='line'){
      ctx.beginPath();
      labels.forEach((l,i)=>{
        const x=pad.l+(i/(labels.length-1||1))*cw;
        const y=pad.t+ch-(values[i]/max)*ch;
        i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
      });
      ctx.strokeStyle='#7c3aed';ctx.lineWidth=2.5;ctx.stroke();
      // Fill
      ctx.lineTo(pad.l+cw,pad.t+ch);ctx.lineTo(pad.l,pad.t+ch);ctx.closePath();
      ctx.fillStyle='rgba(124,58,237,0.15)';ctx.fill();
      // Dots & labels
      labels.forEach((l,i)=>{
        const x=pad.l+(i/(labels.length-1||1))*cw;
        const y=pad.t+ch-(values[i]/max)*ch;
        ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fillStyle='#7c3aed';ctx.fill();
        ctx.fillStyle='#e8e8f0';ctx.font='10px Space Mono,monospace';ctx.textAlign='center';ctx.fillText(values[i],x,y-8);
        ctx.fillStyle='#9999bb';ctx.fillText(l.substring(0,8),x,H-pad.b+15);
      });
    }
    ctx.strokeStyle='#2a2a3d';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,pad.t);ctx.lineTo(pad.l,pad.t+ch);ctx.lineTo(pad.l+cw,pad.t+ch);ctx.stroke();
  }
}
function cgDownload(){
  const c=document.getElementById('cg-canvas');
  const a=document.createElement('a');a.download='chart.png';a.href=c.toDataURL();a.click();
}

// ===== CIPHER =====
let currentCipher='caesar';
function setCipher(c){
  currentCipher=c;
  ['caesar','rot13','vigenere','atbash','morse2'].forEach(id=>{ const el=document.getElementById('ci-'+id); if(el) el.className='btn btn-secondary'; });
  const active=document.getElementById('ci-'+c);if(active) active.className='btn btn-primary';
  document.getElementById('ci-caesar-opts').style.display=c==='caesar'?'block':'none';
  document.getElementById('ci-vigenere-opts').style.display=c==='vigenere'?'block':'none';
  doCipher();
}
function caesarShift(text,n){ return text.replace(/[a-zA-Z]/g,c=>{ const base=c<='Z'?65:97; return String.fromCharCode((c.charCodeAt(0)-base+n+26)%26+base); }); }
function vigenereEncrypt(text,key,decrypt=false){
  key=key.toUpperCase().replace(/[^A-Z]/g,'');if(!key) return text;
  let ki=0;
  return text.replace(/[a-zA-Z]/g,c=>{ const base=c<='Z'?65:97; const kc=key.charCodeAt(ki%key.length)-65; ki++; const shift=decrypt?(26-kc):kc; return String.fromCharCode((c.charCodeAt(0)-base+shift)%26+base); });
}
function atbash(text){ return text.replace(/[a-zA-Z]/g,c=>{ const base=c<='Z'?65:97; return String.fromCharCode(25-(c.charCodeAt(0)-base)+base); }); }
function toBinary(text){ return text.split('').map(c=>c.charCodeAt(0).toString(2).padStart(8,'0')).join(' '); }
function fromBinary(text){ return text.split(' ').map(b=>String.fromCharCode(parseInt(b,2))).join(''); }
function doCipher(decrypt=false){
  const input=document.getElementById('ci-input').value;
  const shift=parseInt(document.getElementById('ci-shift').value)||3;
  const key=document.getElementById('ci-key').value||'KEY';
  let out='',info='';
  if(currentCipher==='caesar'){ out=caesarShift(input,decrypt?-shift:shift); info=`Geser: ${shift} posisi | ${decrypt?'Dekripsi':'Enkripsi'}`; }
  else if(currentCipher==='rot13'){ out=caesarShift(input,13); info='ROT13 (self-inverse)'; }
  else if(currentCipher==='vigenere'){ out=vigenereEncrypt(input,key,decrypt); info=`Kunci: ${key.toUpperCase()} | ${decrypt?'Dekripsi':'Enkripsi'}`; }
  else if(currentCipher==='atbash'){ out=atbash(input); info='Atbash: A‚ÜîZ, B‚ÜîY, dll'; }
  else if(currentCipher==='binary'){ out=decrypt?fromBinary(input):toBinary(input); info=decrypt?'Binary ‚Üí Teks':'Teks ‚Üí Binary'; }
  document.getElementById('ci-output').childNodes[0].textContent=out;
  document.getElementById('ci-info').textContent=info;
}
function doCipherDecrypt(){ doCipher(true); }

// ===== ASCII ART =====
const AA_FONTS={
  'Block':(t)=>aaBlock(t),
  'Shadow':(t)=>aaShadow(t),
  'Double':(t)=>aaDouble(t),
  'Stars':(t)=>t.split('').map(c=>`‚ú¶${c}‚ú¶`).join(''),
  'Wide':(t)=>t.split('').map(c=>c+' ').join(''),
  'Bubble':(t)=>t.split('').map(c=>{ const bubbles={A:'‚í∂',B:'‚í∑',C:'‚í∏',D:'‚íπ',E:'‚í∫',F:'‚íª',G:'‚íº',H:'‚íΩ',I:'‚íæ',J:'‚íø',K:'‚ìÄ',L:'‚ìÅ',M:'‚ìÇ',N:'‚ìÉ',O:'‚ìÑ',P:'‚ìÖ',Q:'‚ìÜ',R:'‚ìá',S:'‚ìà',T:'‚ìâ',U:'‚ìä',V:'‚ìã',W:'‚ìå',X:'‚ìç',Y:'‚ìé',Z:'‚ìè',' ':' '}; return bubbles[c.toUpperCase()]||c; }).join(''),
  'Box':(t)=>{ const top='‚ïî'+'‚ïê'.repeat(t.length+2)+'‚ïó'; const mid='‚ïë '+t+' ‚ïë'; const bot='‚ïö'+'‚ïê'.repeat(t.length+2)+'‚ïù'; return [top,mid,bot].join('\n'); },
  'Arrow':(t)=>t.split('').map(c=>`‚Üí${c}‚Üê`).join(''),
  'Fire':(t)=>{ const flames=['üî•','üí•','‚ö°']; return flames[0]+' '+t.split('').join('¬∑')+' '+flames[0]; },
  'Matrix':(t)=>{ const lines=[]; const chars='01'; lines.push(Array(t.length*2+2).fill(0).map(()=>chars[Math.floor(Math.random()*2)]).join('')); lines.push('[ '+t.toUpperCase()+' ]'); lines.push(Array(t.length*2+2).fill(0).map(()=>chars[Math.floor(Math.random()*2)]).join('')); return lines.join('\n'); },
};
function aaBlock(t){
  const letters={A:['  _  ',' / \\ ','/_/_\\'],B:['|---|','|---|','|___]'],C:[' ___','(   ','\\___'],D:['|\\  ','| \\ ','|__\\'],E:['|===','|== ','|___'],F:['|===','|== ','|   '],G:[' ___','( _ ','\\__G'],H:['|  |','|--|','|  |'],I:['===','|  ','==='],J:['  |','  |','__/'],K:['|\\ ','|/ ','|\\ '],L:['|  ','|  ','|__'],M:['|\\/|','|  |','|  |'],N:['|\\ |','| \\|','|  |'],O:[' _ ','( )','(_)'],P:['|--\\','|__/','|   '],Q:[' _ ','(_)','/_\\'],R:['|--\\','|_/ ','|  \\'],S:[' ___','(___','____)'],T:['===','| ','| '],U:['|  |','|  |','\\__/'],V:['\\  /','\\  /','\\/ '],W:['\\    /','\\  / ','\\\/  '],X:['\\/ ','/ \\','\\  '],Y:['\\/ ',' |  ',' |  '],Z:['=== ','/ /','=== '],' ':['  ','  ','  ']};
  const rows=[[],[],[]];
  t.toUpperCase().split('').forEach(c=>{ const l=letters[c]||['?','?','?']; rows[0].push(l[0]);rows[1].push(l[1]);rows[2].push(l[2]); });
  return rows.map(r=>r.join(' ')).join('\n');
}
function aaShadow(t){
  return t.toUpperCase().split('').map(c=>`${c}\n‚ñë`).join('');
}
function aaDouble(t){
  const map={A:'ùî∏',B:'ùîπ',C:'‚ÑÇ',D:'ùîª',E:'ùîº',F:'ùîΩ',G:'ùîæ',H:'‚Ñç',I:'ùïÄ',J:'ùïÅ',K:'ùïÇ',L:'ùïÉ',M:'ùïÑ',N:'‚Ñï',O:'ùïÜ',P:'‚Ñô',Q:'‚Ñö',R:'‚Ñù',S:'ùïä',T:'ùïã',U:'ùïå',V:'ùïç',W:'ùïé',X:'ùïè',Y:'ùïê',Z:'‚Ñ§',' ':' '};
  return t.toUpperCase().split('').map(c=>map[c]||c).join('');
}
function populateAaFonts(){
  const sel=document.getElementById('aa-font');
  if(sel) sel.innerHTML=Object.keys(AA_FONTS).map(k=>`<option value="${k}">${k}</option>`).join('');
}
function genAsciiArt(){
  const text=document.getElementById('aa-input').value||'TEXT';
  const font=document.getElementById('aa-font').value;
  if(!AA_FONTS[font]) return;
  const out=AA_FONTS[font](text);
  document.getElementById('aa-output').childNodes[0].textContent=out;
  // All previews
  const prev=document.getElementById('aa-all-preview');
  prev.innerHTML=Object.entries(AA_FONTS).map(([name,fn])=>{
    let result;try{result=fn(text);}catch(e){result='(error)';}
    return `<div style="border:1px solid var(--border);border-radius:8px;padding:12px;cursor:pointer;" onclick="document.getElementById('aa-font').value='${name}';genAsciiArt()">
      <div style="font-size:0.68rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">${name}</div>
      <pre style="font-size:0.72rem;color:var(--accent2);white-space:pre;overflow-x:auto;line-height:1.4;margin:0;">${result}</pre>
    </div>`;
  }).join('');
}
populateAaFonts();
genAsciiArt();

// CSS for fake data check labels
document.head.insertAdjacentHTML('beforeend',`<style>.fd-check{font-size:0.76rem;color:var(--muted);display:flex;align-items:center;gap:4px;cursor:pointer;}.fd-check input{width:13px;height:13px;accent-color:var(--accent);}</style>`);

// Auto-init mindmap example
mmExample();

// ===== POMODORO =====
let pomMode='work', pomRunning=false, pomInterval=null, pomRemain=25*60, pomSessions=0;
const pomDurations={work:()=>parseInt(document.getElementById('pom-work-min').value||25)*60, short:()=>parseInt(document.getElementById('pom-short-min').value||5)*60, long:()=>parseInt(document.getElementById('pom-long-min').value||15)*60};
const pomLabels={work:'Mode: Fokus üéØ',short:'Mode: Istirahat Pendek ‚òï',long:'Mode: Istirahat Panjang üò¥'};
function pomSetMode(m){
  pomMode=m; pomReset();
  document.querySelectorAll('[id^=pom-][id$=-btn]').forEach(b=>b.classList.remove('active-filter'));
  document.getElementById('pom-'+m+'-btn')?.classList.add('active-filter');
}
function pomToggle(){
  if(pomRunning){clearInterval(pomInterval);pomRunning=false;document.getElementById('pom-btn').textContent='‚ñ∂ Lanjut';}
  else{pomRunning=true;document.getElementById('pom-btn').textContent='‚è∏ Pause';pomInterval=setInterval(pomTick,1000);}
}
function pomTick(){
  pomRemain--;
  pomUpdateDisplay();
  if(pomRemain<=0){
    clearInterval(pomInterval);pomRunning=false;
    document.getElementById('pom-btn').textContent='‚ñ∂ Mulai';
    if(pomMode==='work'){pomSessions++;pomUpdateDots();}
    try{new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAA").play();}catch(e){}
    alert(pomMode==='work'?`‚úÖ Sesi fokus selesai! Istirahat dulu.`:`‚úÖ Istirahat selesai! Waktunya fokus lagi.`);
    pomMode=pomSessions%4===0&&pomSessions>0?'long':pomMode==='work'?'short':'work';
    pomReset();
  }
}
function pomReset(){
  clearInterval(pomInterval);pomRunning=false;
  pomRemain=pomDurations[pomMode]();
  pomUpdateDisplay();
  document.getElementById('pom-btn').textContent='‚ñ∂ Mulai';
  document.getElementById('pom-mode-label').textContent=pomLabels[pomMode];
}
function pomSkip(){clearInterval(pomInterval);pomRunning=false;pomRemain=0;pomTick();}
function pomUpdateDisplay(){
  const m=Math.floor(pomRemain/60),s=pomRemain%60;
  document.getElementById('pom-display').textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  document.title=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} ‚Äî Pomodoro`;
}
function pomUpdateDots(){
  const d=document.getElementById('pom-dots');
  d.innerHTML=Array(4).fill(0).map((_,i)=>`<div style="width:20px;height:20px;border-radius:50%;background:${i<pomSessions%4||pomSessions%4===0&&pomSessions>0&&i<4?'var(--accent)':'var(--border)'};transition:all 0.3s;"></div>`).join('');
  document.getElementById('pom-count').textContent=`${pomSessions} / 4 sesi`;
}
pomReset();pomUpdateDots();

// ===== TEXT TO SPEECH =====
let ttsUtter=null;
function ttsLoadVoices(){
  const voices=speechSynthesis.getVoices();
  const sel=document.getElementById('tts-voice');
  if(!sel)return;
  sel.innerHTML=voices.map((v,i)=>`<option value="${i}">${v.name} (${v.lang})</option>`).join('');
  // Prefer Indonesian
  const idIdx=voices.findIndex(v=>v.lang.startsWith('id'));
  if(idIdx>=0) sel.value=idIdx;
}
if('speechSynthesis' in window){speechSynthesis.onvoiceschanged=ttsLoadVoices;ttsLoadVoices();}
function ttsSpeak(){
  if(!window.speechSynthesis){document.getElementById('tts-status').textContent='‚ö† Browser tidak mendukung TTS';return;}
  speechSynthesis.cancel();
  const text=document.getElementById('tts-text').value;
  if(!text.trim())return;
  ttsUtter=new SpeechSynthesisUtterance(text);
  const voices=speechSynthesis.getVoices();
  const idx=parseInt(document.getElementById('tts-voice').value)||0;
  if(voices[idx]) ttsUtter.voice=voices[idx];
  ttsUtter.rate=parseFloat(document.getElementById('tts-rate').value)||1;
  ttsUtter.pitch=parseFloat(document.getElementById('tts-pitch').value)||1;
  ttsUtter.onstart=()=>document.getElementById('tts-status').textContent='üîä Sedang membaca...';
  ttsUtter.onend=()=>document.getElementById('tts-status').textContent='‚úÖ Selesai';
  ttsUtter.onerror=e=>document.getElementById('tts-status').textContent='‚ö† Error: '+e.error;
  speechSynthesis.speak(ttsUtter);
}
function ttsPause(){if(speechSynthesis.paused){speechSynthesis.resume();document.getElementById('tts-pause').textContent='‚è∏ Pause';}else{speechSynthesis.pause();document.getElementById('tts-pause').textContent='‚ñ∂ Lanjut';}}
function ttsStop(){speechSynthesis.cancel();document.getElementById('tts-status').textContent='‚èπ Dihentikan';document.getElementById('tts-pause').textContent='‚è∏ Pause';}
function ttsQuick(t){document.getElementById('tts-text').value=t;ttsSpeak();}

// ===== OCR =====
let ocrImgData=null;
function ocrDrop(e){e.preventDefault();document.getElementById('ocr-drop').style.borderColor='var(--border)';const f=e.dataTransfer.files[0];if(f&&f.type.startsWith('image/'))ocrLoadFile(f);}
function ocrProcess(inp){if(inp.files[0])ocrLoadFile(inp.files[0]);}
function ocrLoadFile(file){
  const reader=new FileReader();
  reader.onload=e=>{
    ocrImgData=e.target.result;
    document.getElementById('ocr-img').src=ocrImgData;
    document.getElementById('ocr-drop').style.display='none';
    document.getElementById('ocr-preview-wrap').style.display='block';
  };
  reader.readAsDataURL(file);
}
async function runOCR(){
  if(!ocrImgData)return;
  const lang=document.getElementById('ocr-lang').value;
  const btn=document.getElementById('ocr-run-btn');
  const prog=document.getElementById('ocr-progress');
  const bar=document.getElementById('ocr-bar');
  const progText=document.getElementById('ocr-prog-text');
  const out=document.getElementById('ocr-output');
  btn.disabled=true;prog.style.display='block';
  out.childNodes[0].textContent='Memproses...';
  try{
    const result=await Tesseract.recognize(ocrImgData,lang,{
      logger:m=>{
        if(m.status==='recognizing text'){
          const pct=Math.round(m.progress*100);
          bar.style.width=pct+'%';
          progText.textContent=`Mengenali teks... ${pct}%`;
        }
      }
    });
    out.childNodes[0].textContent=result.data.text||'Tidak ada teks terdeteksi';
    progText.textContent='‚úÖ Selesai!';
  }catch(e){
    out.childNodes[0].textContent='‚ö† Error: '+e.message+'\n\nPastikan koneksi internet aktif (butuh download model OCR pertama kali).';
  }finally{btn.disabled=false;}
}
function ocrReset(){ocrImgData=null;document.getElementById('ocr-drop').style.display='block';document.getElementById('ocr-preview-wrap').style.display='none';document.getElementById('ocr-file').value='';}

// ===== AGE CALCULATOR =====
function calcAge(){
  const dob=document.getElementById('age-dob').value;
  const to=document.getElementById('age-to').value;
  if(!dob||!to)return;
  const d1=new Date(dob),d2=new Date(to);
  if(d2<d1){document.getElementById('age-result').innerHTML='<div style="color:var(--danger);font-size:0.82rem;padding:20px;text-align:center;">‚ö† Tanggal "sampai" harus lebih dari tanggal lahir</div>';return;}
  let yy=d2.getFullYear()-d1.getFullYear(),mm=d2.getMonth()-d1.getMonth(),dd=d2.getDate()-d1.getDate();
  if(dd<0){mm--;dd+=new Date(d2.getFullYear(),d2.getMonth(),0).getDate();}
  if(mm<0){yy--;mm+=12;}
  const totalDays=Math.floor((d2-d1)/86400000);
  const totalWeeks=Math.floor(totalDays/7);
  const totalMonths=yy*12+mm;
  const totalHours=totalDays*24;
  document.getElementById('age-result').innerHTML=`
    <div style="text-align:center;margin-bottom:14px;">
      <div style="font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;color:var(--accent2);line-height:1;">${yy}</div>
      <div style="font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Tahun</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center;">
      <div><div style="font-weight:700;color:var(--accent3);">${mm}</div><div style="font-size:0.68rem;color:var(--muted);">Bulan</div></div>
      <div><div style="font-weight:700;color:var(--success);">${dd}</div><div style="font-size:0.68rem;color:var(--muted);">Hari</div></div>
      <div><div style="font-weight:700;color:var(--accent);">${totalDays.toLocaleString('id-ID')}</div><div style="font-size:0.68rem;color:var(--muted);">Total Hari</div></div>
    </div>
    <div style="margin-top:10px;font-size:0.72rem;color:var(--muted);text-align:center;line-height:1.8;">
      ${totalWeeks.toLocaleString('id-ID')} minggu ¬∑ ${totalMonths} bulan ¬∑ ${totalHours.toLocaleString('id-ID')} jam
    </div>`;
  // Milestones
  const milestones=[1,5,10,13,17,18,20,21,25,30,40,50,60,70,80,100];
  const upcoming=milestones.filter(a=>a>yy).slice(0,8);
  const passed=milestones.filter(a=>a<=yy).slice(-4);
  document.getElementById('age-milestones').style.display='block';
  document.getElementById('age-milestone-list').innerHTML=[...passed,...upcoming].map(a=>{
    const mDate=new Date(d1.getFullYear()+a,d1.getMonth(),d1.getDate());
    const daysLeft=Math.ceil((mDate-d2)/86400000);
    const isPast=a<=yy;
    return `<div style="background:var(--bg);border:1px solid ${isPast?'var(--border)':'var(--accent)'};border-radius:8px;padding:10px;text-align:center;">
      <div style="font-family:'Syne',sans-serif;font-weight:700;color:${isPast?'var(--muted)':'var(--accent2)'};">${a} th</div>
      <div style="font-size:0.68rem;color:var(--muted);">${isPast?'‚úì Sudah lewat':daysLeft+' hari lagi'}</div>
    </div>`;
  }).join('');
  // Birthday check
  const nextBday=new Date(d2.getFullYear(),d1.getMonth(),d1.getDate());
  if(nextBday<d2) nextBday.setFullYear(nextBday.getFullYear()+1);
  const daysUntil=Math.ceil((nextBday-d2)/86400000);
  const bdayEl=document.getElementById('age-bday');
  bdayEl.style.display='block';
  if(daysUntil===0) bdayEl.innerHTML='üéÇ <strong>Selamat Ulang Tahun!</strong> Hari ini adalah hari spesialmu! üéâ';
  else bdayEl.innerHTML=`üéÇ Ulang tahun berikutnya: <strong>${nextBday.toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}</strong> ‚Äî ${daysUntil} hari lagi`;
}
document.addEventListener('DOMContentLoaded',()=>{
  const today=new Date().toISOString().slice(0,10);
  document.getElementById('age-to').value=today;
});

// ===== NOISE GENERATOR =====
let noiseCtx=null, noiseNodes={}, noiseTimerInterval=null;
function getNoiseCtx(){if(!noiseCtx)noiseCtx=new(window.AudioContext||window.webkitAudioContext)();return noiseCtx;}
function makeWhiteNoise(ctx){
  const buf=ctx.createBuffer(1,ctx.sampleRate*2,ctx.sampleRate);
  const d=buf.getChannelData(0);for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
  const s=ctx.createBufferSource();s.buffer=buf;s.loop=true;return s;
}
function makePinkNoise(ctx){
  const buf=ctx.createBuffer(1,ctx.sampleRate*2,ctx.sampleRate);
  const d=buf.getChannelData(0);let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0;
  for(let i=0;i<d.length;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555179;b1=0.99332*b1+w*0.0750759;b2=0.96900*b2+w*0.1538520;b3=0.86650*b3+w*0.3104856;b4=0.55000*b4+w*0.5329522;b5=-0.7616*b5-w*0.0168980;d[i]=(b0+b1+b2+b3+b4+b5+w*0.5362)*0.11;}
  const s=ctx.createBufferSource();s.buffer=buf;s.loop=true;return s;
}
function makeBrownNoise(ctx){
  const buf=ctx.createBuffer(1,ctx.sampleRate*2,ctx.sampleRate);
  const d=buf.getChannelData(0);let last=0;
  for(let i=0;i<d.length;i++){const w=Math.random()*2-1;last=(last+0.02*w)/1.02;d[i]=last*3.5;}
  const s=ctx.createBufferSource();s.buffer=buf;s.loop=true;return s;
}
function toggleNoise(type){
  const ctx=getNoiseCtx();
  if(noiseNodes[type]){noiseNodes[type].gain.gain.value=0;setTimeout(()=>{try{noiseNodes[type].src.stop();}catch(e){}delete noiseNodes[type];},300);document.getElementById('noise-'+type+'-card').classList.remove('active');document.getElementById('noise-status').textContent='Noise dihentikan';return;}
  const makers={white:makeWhiteNoise,pink:makePinkNoise,brown:makeBrownNoise};
  const src=makers[type](ctx);
  const gain=ctx.createGain();gain.gain.value=parseFloat(document.getElementById('noise-vol').value)||0.3;
  src.connect(gain);gain.connect(ctx.destination);src.start();
  noiseNodes[type]={src,gain};
  document.getElementById('noise-'+type+'-card').classList.add('active');
  document.getElementById('noise-status').textContent='üîä '+{white:'White',pink:'Pink',brown:'Brown'}[type]+' Noise sedang diputar...';
}
function noiseSetVolume(v){document.getElementById('noise-vol-pct').textContent=Math.round(v*100)+'%';Object.values(noiseNodes).forEach(n=>n.gain.gain.value=parseFloat(v));}
function stopAllNoise(){Object.keys(noiseNodes).forEach(t=>{try{noiseNodes[t].src.stop();}catch(e){}document.getElementById('noise-'+t+'-card').classList.remove('active');});noiseNodes={};document.getElementById('noise-status').textContent='‚èπ Semua noise dihentikan';clearInterval(noiseTimerInterval);document.getElementById('noise-timer-display').style.display='none';}
function noiseTimer(min){
  clearInterval(noiseTimerInterval);let secs=min*60;
  document.getElementById('noise-timer-display').style.display='block';
  noiseTimerInterval=setInterval(()=>{secs--;const m=Math.floor(secs/60),s=secs%60;document.getElementById('noise-timer-display').textContent=`‚è± ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;if(secs<=0){stopAllNoise();clearInterval(noiseTimerInterval);}},1000);
}

// ===== GLASSMORPHISM BUILDER =====
const glBgs={gradient1:'linear-gradient(135deg,#7c3aed,#06b6d4)',gradient2:'linear-gradient(135deg,#f97316,#ec4899,#8b5cf6)',gradient3:'linear-gradient(135deg,#4ade80,#0ea5e9,#6366f1)',dots:'radial-gradient(circle,#2a2a4a 1px,transparent 1px) 0 0 / 24px 24px, #0a0a0f'};
function renderGlass(){
  const blur=document.getElementById('gl-blur').value;document.getElementById('gl-blur-v').textContent=blur+'px';
  const alpha=document.getElementById('gl-alpha').value;document.getElementById('gl-alpha-v').textContent=alpha;
  const borderO=document.getElementById('gl-border').value;document.getElementById('gl-border-v').textContent=borderO;
  const radius=document.getElementById('gl-radius').value;document.getElementById('gl-radius-v').textContent=radius+'px';
  const shadow=document.getElementById('gl-shadow').value;document.getElementById('gl-shadow-v').textContent=shadow;
  const color=document.getElementById('gl-color').value;
  const bg=glBgs[document.getElementById('gl-bg').value];
  const r=parseInt(color.slice(1,3),16),g=parseInt(color.slice(3,5),16),b=parseInt(color.slice(5,7),16);
  const css=`backdrop-filter: blur(${blur}px);
-webkit-backdrop-filter: blur(${blur}px);
background: rgba(${r},${g},${b},${alpha});
border: 1px solid rgba(${r},${g},${b},${borderO});
border-radius: ${radius}px;
box-shadow: 0 8px 32px rgba(0,0,0,${shadow});`;
  document.getElementById('gl-scene').style.background=bg;
  const card=document.getElementById('gl-card');
  card.style.cssText=`padding:28px 36px;text-align:center;backdrop-filter:blur(${blur}px);-webkit-backdrop-filter:blur(${blur}px);background:rgba(${r},${g},${b},${alpha});border:1px solid rgba(${r},${g},${b},${borderO});border-radius:${radius}px;box-shadow:0 8px 32px rgba(0,0,0,${shadow});color:white;`;
  document.getElementById('gl-code').childNodes[0].textContent='.glass {\n  '+css.split('\n').join('\n  ')+'\n}';
}
renderGlass();

// ===== DEVICE MOCKUP =====
const mkFrames={
  phone:{w:280,h:520,border:18,notch:true,label:'Smartphone (375√ó812)'},
  tablet:{w:420,h:560,border:22,notch:false,label:'Tablet (768√ó1024)'},
  laptop:{w:560,h:360,border:16,notch:false,isLaptop:true,label:'Laptop (1280√ó800)'},
};
function renderMockup(){
  const device=document.getElementById('mk-device').value;
  const frameColor=document.getElementById('mk-color').value;
  const f=mkFrames[device];
  const wrap=document.getElementById('mk-frame-container');
  const url=document.getElementById('mk-url').value||'https://example.com';
  let html='';
  if(f.isLaptop){
    html=`<div style="position:relative;display:inline-block;">
      <div style="background:${frameColor};border-radius:12px 12px 0 0;padding:${f.border}px ${f.border}px 0;box-shadow:0 0 0 2px #333;display:inline-block;">
        <div style="background:#111;width:8px;height:8px;border-radius:50%;margin:0 auto 8px;"></div>
        <iframe src="${url}" style="width:${f.w}px;height:${f.h}px;border:none;border-radius:4px;display:block;" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
      </div>
      <div style="background:${frameColor};height:14px;width:${f.w+f.border*2+40}px;border-radius:0 0 8px 8px;margin:0 auto;box-shadow:0 4px 16px rgba(0,0,0,0.4);"></div>
      <div style="background:#444;height:4px;width:${f.w+f.border*2+80}px;border-radius:0 0 4px 4px;margin:0 auto;"></div>
    </div>`;
  } else {
    html=`<div style="background:${frameColor};border-radius:${f.border*2}px;padding:${f.border}px;box-shadow:0 0 0 2px #222, 0 24px 48px rgba(0,0,0,0.5);display:inline-block;position:relative;">
      ${f.notch?`<div style="background:${frameColor};width:100px;height:24px;border-radius:0 0 16px 16px;position:absolute;top:${f.border}px;left:50%;transform:translateX(-50%);z-index:2;display:flex;align-items:center;justify-content:center;gap:6px;"><div style="width:10px;height:10px;border-radius:50%;background:#111;"></div><div style="width:40px;height:6px;border-radius:3px;background:#111;"></div></div>`:''}
      <iframe src="${url}" style="width:${f.w}px;height:${f.h}px;border:none;border-radius:${f.border}px;display:block;" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
      <div style="width:50px;height:5px;background:#333;border-radius:3px;margin:8px auto 0;"></div>
    </div>`;
  }
  wrap.innerHTML=html;
}
function mkQuick(url){document.getElementById('mk-url').value=url;renderMockup();}
renderMockup();

// ===== NUMBER SYSTEM =====
function nsConvert(from){
  const inputs={dec:document.getElementById('ns-dec'),bin:document.getElementById('ns-bin'),oct:document.getElementById('ns-oct'),hex:document.getElementById('ns-hex')};
  const val=inputs[from].value.trim();
  if(!val){['dec','bin','oct','hex'].filter(k=>k!==from).forEach(k=>inputs[k].value='');document.getElementById('ns-info').innerHTML='';return;}
  let decimal;
  try{
    if(from==='dec') decimal=parseInt(val,10);
    else if(from==='bin') decimal=parseInt(val,2);
    else if(from==='oct') decimal=parseInt(val,8);
    else decimal=parseInt(val,16);
    if(isNaN(decimal)) throw new Error('Input tidak valid');
    if(from!=='dec') inputs.dec.value=decimal;
    if(from!=='bin') inputs.bin.value=decimal.toString(2);
    if(from!=='oct') inputs.oct.value=decimal.toString(8);
    if(from!=='hex') inputs.hex.value=decimal.toString(16).toUpperCase();
    const bits=decimal.toString(2);
    document.getElementById('ns-info').innerHTML=`
      <span style="color:var(--accent2);">Nilai: ${decimal}</span> &nbsp;|&nbsp;
      <span style="color:var(--muted);">Bit: ${bits.length}</span> &nbsp;|&nbsp;
      <span style="color:var(--muted);">Byte: ${Math.ceil(bits.length/8)}</span> &nbsp;|&nbsp;
      <span style="color:var(--success);">ASCII: ${decimal>=32&&decimal<=126?String.fromCharCode(decimal):'‚Äî'}</span> &nbsp;|&nbsp;
      <span style="color:var(--accent3);">Signed: ${decimal>2147483647?decimal-4294967296:decimal}</span>`;
  }catch(e){document.getElementById('ns-info').innerHTML=`<span style="color:var(--danger)">‚ö† ${e.message}</span>`;}
}
function calcBitwise(){
  const a=parseInt(document.getElementById('bw-a').value)||0;
  const b=parseInt(document.getElementById('bw-b').value)||0;
  const ops=[['AND','&',a&b],['OR','|',a|b],['XOR','^',a^b],['NOT A','~',~a],['Lshift <<','<<',a<<1],['Rshift >>','>>',a>>1]];
  document.getElementById('bw-result').innerHTML=`<div style="display:flex;flex-wrap:wrap;gap:8px;">
    ${ops.map(([name,op,res])=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:8px 12px;font-size:0.8rem;">
      <span style="color:var(--muted);">${name}: </span><span style="color:var(--accent2);font-weight:700;">${res}</span>
      <div style="font-size:0.68rem;color:var(--muted);">${res.toString(2)}</div>
    </div>`).join('')}
  </div>`;
}

// ===== MINI GAMES =====
let gameLoop=null, gameState=null, currentGame='snake';
const GC=document.getElementById('game-canvas');
const GX=GC.getContext('2d');
const GW=GC.width, GH=GC.height;

function selectGame(g){
  currentGame=g;
  ['snake','flappy','2048','breakout'].forEach(id=>{
    const b=document.getElementById('game-'+id+'-btn');
    if(b) b.className=id===g?'btn btn-primary':'btn btn-secondary';
  });
  // Cleanup handler lama SEBELUM clear gameState
  if(gameState?._cleanup) gameState._cleanup();
  cancelAnimationFrame(gameLoop);clearInterval(gameLoop);gameState=null;
  // Reset cheat flags when switching game
  cheatFlags.snake={godmode:false,speed:false,slow:false};
  cheatFlags.flappy={noclip:false,autojump:false,nogravity:false,widegap:false};
  cheatFlags.breakout={ballgod:false,bigpaddle:false,multiball:false,slowball:false};
  // Update cheat panel if open
  if(document.getElementById('cheat-panel')?.style.display!=='none') updateCheatPanel();
  const info={
    snake:'üêç Snake\n\nMakan makanan untuk tumbuh!\nHindari dinding & ekor sendiri.\n\nKontrol: ‚Üê ‚Üí ‚Üë ‚Üì\natau WASD',
    flappy:'üê¶ Flappy Bird\n\nKlik / Tekan Space untuk terbang!\nHindari pipa-pipa.\n\nKontrol: Klik / Space',
    '2048':'üî¢ 2048\n\nGeser tile untuk menggabungkan!\nCapai angka 2048.\n\nKontrol: ‚Üê ‚Üí ‚Üë ‚Üì',
    breakout:'üß± Breakout\n\nPecahkan semua bata!\nJangan sampai bola jatuh.\n\nKontrol: ‚Üê ‚Üí atau mouse',
  };
  document.getElementById('game-info').style.whiteSpace='pre-line';
  document.getElementById('game-info').textContent=info[g]||'';
  document.getElementById('game-controls-hint').textContent={snake:'Arrow / WASD',flappy:'Space / Click',2048:'Arrow Keys',breakout:'‚Üê ‚Üí / Mouse'}[g]||'';
  const hs=JSON.parse(localStorage.getItem('tb-hs')||'{}');
  document.getElementById('game-highscore').textContent=hs[g]?`üèÜ High Score: ${hs[g]}`:'';
  drawGameIdle(g);
}
function drawGameIdle(g){
  GX.clearRect(0,0,GW,GH);
  GX.fillStyle='#0a0a0f';GX.fillRect(0,0,GW,GH);
  GX.fillStyle='#7c3aed';GX.font='bold 20px Syne,sans-serif';GX.textAlign='center';
  GX.fillText({snake:'üêç SNAKE',flappy:'üê¶ FLAPPY BIRD','2048':'üî¢ 2048',breakout:'üß± BREAKOUT'}[g]||g,GW/2,GH/2-20);
  GX.fillStyle='#6b6b8a';GX.font='14px Space Mono,monospace';
  GX.fillText('Tekan ‚ñ∂ Mulai',GW/2,GH/2+20);
}
function startGame(){
  // Cleanup handler lama SEBELUM start game baru
  if(gameState?._cleanup) gameState._cleanup();
  cancelAnimationFrame(gameLoop);clearInterval(gameLoop);gameState=null;
  if(currentGame==='snake') startSnake();
  else if(currentGame==='flappy') startFlappy();
  else if(currentGame==='2048') start2048();
  else if(currentGame==='breakout') startBreakout();
}
function pauseGame(){
  if(!gameState) return;
  gameState.paused=!gameState.paused;
  document.getElementById('game-pause-btn').textContent=gameState.paused?'‚ñ∂ Lanjut':'‚è∏ Pause';
}
function updateScore(s){
  document.getElementById('game-score').textContent='Skor: '+s;
  const hs=JSON.parse(localStorage.getItem('tb-hs')||'{}');
  if(!hs[currentGame]||s>hs[currentGame]){hs[currentGame]=s;localStorage.setItem('tb-hs',JSON.stringify(hs));document.getElementById('game-highscore').textContent='üèÜ High Score: '+s;}
}
function gameOver(score){
  cancelAnimationFrame(gameLoop);clearInterval(gameLoop);
  GX.fillStyle='rgba(0,0,0,0.7)';GX.fillRect(0,0,GW,GH);
  GX.fillStyle='#ef4444';GX.font='bold 28px Syne,sans-serif';GX.textAlign='center';GX.fillText('GAME OVER',GW/2,GH/2-20);
  GX.fillStyle='#e8e8f0';GX.font='18px Space Mono,monospace';GX.fillText('Skor: '+score,GW/2,GH/2+20);
  GX.fillStyle='#7c3aed';GX.font='14px Space Mono,monospace';GX.fillText('Tekan ‚ñ∂ Mulai lagi',GW/2,GH/2+50);
  updateScore(score);
  gameState=null;
}

/* SNAKE */
function startSnake(){
  const SZ=20,COLS=Math.floor(GW/SZ),ROWS=Math.floor(GH/SZ);
  gameState={snake:[{x:10,y:10}],dir:{x:1,y:0},nextDir:{x:1,y:0},food:null,score:0,paused:false};
  function placeFood(){
    let fx,fy,tries=0;
    do{fx=Math.floor(Math.random()*COLS);fy=Math.floor(Math.random()*ROWS);tries++;}
    while(gameState.snake.some(s=>s.x===fx&&s.y===fy)&&tries<200);
    gameState.food={x:fx,y:fy};
  }
  placeFood();updateScore(0);

  // ‚úÖ KEYBOARD HANDLER ‚Äî dipasang ke document, bukan canvas
  const snakeKeyHandler=e=>{
    if(!gameState||currentGame!=='snake') return;
    // Jangan intercept saat user sedang mengetik di input/textarea
    const tag=document.activeElement?.tagName;
    if(tag==='INPUT'||tag==='TEXTAREA') return;
    const key=e.key;
    // Cegah scroll halaman saat main
    if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(key)) e.preventDefault();
    const d=gameState.nextDir;
    if((key==='ArrowUp'   ||key==='w'||key==='W') && d.y===0) gameState.nextDir={x:0,y:-1};
    if((key==='ArrowDown' ||key==='s'||key==='S') && d.y===0) gameState.nextDir={x:0,y:1};
    if((key==='ArrowLeft' ||key==='a'||key==='A') && d.x===0) gameState.nextDir={x:-1,y:0};
    if((key==='ArrowRight'||key==='d'||key==='D') && d.x===0) gameState.nextDir={x:1,y:0};
    if(key===' '||key==='p'||key==='P') pauseGame();
  };
  document.addEventListener('keydown', snakeKeyHandler);

  // Touch controls untuk mobile
  let touchStartX=0,touchStartY=0;
  GC.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY;e.preventDefault();},{passive:false});
  GC.addEventListener('touchend',e=>{
    if(!gameState) return;
    const dx=e.changedTouches[0].clientX-touchStartX;
    const dy=e.changedTouches[0].clientY-touchStartY;
    const d=gameState.nextDir;
    if(Math.abs(dx)>Math.abs(dy)){
      if(dx>20&&d.x===0) gameState.nextDir={x:1,y:0};
      if(dx<-20&&d.x===0) gameState.nextDir={x:-1,y:0};
    } else {
      if(dy>20&&d.y===0) gameState.nextDir={x:0,y:1};
      if(dy<-20&&d.y===0) gameState.nextDir={x:0,y:-1};
    }
    e.preventDefault();
  },{passive:false});

  gameState._cleanup=()=>{ document.removeEventListener('keydown',snakeKeyHandler); };

  gameLoop=setInterval(()=>{
    if(!gameState||gameState.paused) return;
    // Apply direction
    gameState.dir={...gameState.nextDir};
    const head={x:gameState.snake[0].x+gameState.dir.x, y:gameState.snake[0].y+gameState.dir.y};
    // Wall & self collision ‚Äî godmode bypass
    if(cheatFlags.snake.godmode){
      if(head.x<0) head.x=COLS-1; else if(head.x>=COLS) head.x=0;
      if(head.y<0) head.y=ROWS-1; else if(head.y>=ROWS) head.y=0;
    } else if(head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS||gameState.snake.some(s=>s.x===head.x&&s.y===head.y)){
      gameOver(gameState.score); return;
    }
    gameState.snake.unshift(head);
    if(gameState.food && head.x===gameState.food.x&&head.y===gameState.food.y){
      gameState.score+=10; updateScore(gameState.score); placeFood();
    } else { gameState.snake.pop(); }

    // Draw
    GX.fillStyle='#0a0a0f'; GX.fillRect(0,0,GW,GH);
    // Grid dots
    GX.fillStyle='#1a1a2e';
    for(let x=0;x<COLS;x++) for(let y=0;y<ROWS;y++){GX.beginPath();GX.arc(x*SZ+SZ/2,y*SZ+SZ/2,1,0,Math.PI*2);GX.fill();}
    // Food ‚Äî apel merah berkilap
    if(gameState.food){
      GX.fillStyle='#ef4444';GX.beginPath();GX.arc(gameState.food.x*SZ+SZ/2,gameState.food.y*SZ+SZ/2,SZ/2-2,0,Math.PI*2);GX.fill();
      GX.fillStyle='rgba(255,255,255,0.4)';GX.beginPath();GX.arc(gameState.food.x*SZ+SZ/2-3,gameState.food.y*SZ+SZ/2-3,3,0,Math.PI*2);GX.fill();
    }
    // Snake body
    gameState.snake.forEach((s,i)=>{
      const g2=GX.createLinearGradient(s.x*SZ,s.y*SZ,(s.x+1)*SZ,(s.y+1)*SZ);
      g2.addColorStop(0,i===0?'#06b6d4':'#7c3aed');
      g2.addColorStop(1,i===0?'#0ea5e9':'#5b21b6');
      GX.fillStyle=g2;
      GX.beginPath();
      if(GX.roundRect) GX.roundRect(s.x*SZ+1,s.y*SZ+1,SZ-2,SZ-2,i===0?6:4);
      else GX.rect(s.x*SZ+1,s.y*SZ+1,SZ-2,SZ-2);
      GX.fill();
      // Mata di kepala
      if(i===0){
        GX.fillStyle='white';
        const ex=s.x*SZ+SZ/2+(gameState.dir.x*4), ey=s.y*SZ+SZ/2+(gameState.dir.y*4);
        const px=gameState.dir.y!==0?3:0, py=gameState.dir.x!==0?3:0;
        GX.beginPath();GX.arc(ex-py,ey-px,3,0,Math.PI*2);GX.fill();
        GX.beginPath();GX.arc(ex+py,ey+px,3,0,Math.PI*2);GX.fill();
        GX.fillStyle='#0a0a0f';
        GX.beginPath();GX.arc(ex-py,ey-px,1.5,0,Math.PI*2);GX.fill();
        GX.beginPath();GX.arc(ex+py,ey+px,1.5,0,Math.PI*2);GX.fill();
      }
    });
    // Score overlay
    GX.fillStyle='rgba(124,58,237,0.8)';GX.font='bold 13px Space Mono,monospace';GX.textAlign='left';
    GX.fillText('SKOR: '+gameState.score,8,18);
  },cheatFlags.snake.slow ? 300 : cheatFlags.snake.speed ? 55 : 140);

  // Tampilkan hint kontrol
  document.getElementById('game-controls-hint').textContent='‚Üê ‚Üí ‚Üë ‚Üì atau WASD | P = Pause | Swipe untuk mobile';
}

/* FLAPPY BIRD */
function startFlappy(){
  const BIRD_X=80,GRAVITY=0.35,JUMP=-7,PIPE_W=52,GAP=130,PIPE_SPEED=2.5;
  gameState={bird:{y:GH/2,vy:0},pipes:[],score:0,frame:0,paused:false,started:false};
  function addPipe(){const ty=50+Math.random()*(GH-GAP-100);gameState.pipes.push({x:GW,ty,by:ty+GAP});}
  addPipe();
  function flap(){if(gameState)gameState.bird.vy=JUMP;gameState.started=true;}
  GC.onclick=flap;
  const handler=e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return; if(e.code==='Space'){e.preventDefault();flap();}};
  document.addEventListener('keydown',handler);
  gameState._cleanup=()=>{GC.onclick=null;document.removeEventListener('keydown',handler);};
  updateScore(0);
  function frame(){
    if(!gameState){return;}
    gameLoop=requestAnimationFrame(frame);
    if(gameState.paused)return;
    // Gravity ‚Äî nogravity cheat bypass
    if(gameState.started && !cheatFlags.flappy.nogravity) gameState.bird.vy+=GRAVITY;
    if(cheatFlags.flappy.nogravity && gameState.bird.vy>0) gameState.bird.vy=0;
    gameState.bird.y+=gameState.bird.vy;
    // Clamp bird in screen when nogravity on
    if(cheatFlags.flappy.nogravity) gameState.bird.y=Math.max(20,Math.min(GH-40,gameState.bird.y));
    // Auto jump bot
    if(cheatFlags.flappy.autojump && gameState.started){
      const nextPipe=gameState.pipes.find(p=>p.x+PIPE_W>BIRD_X-20);
      if(nextPipe){const mid=(nextPipe.ty+nextPipe.by)/2;if(gameState.bird.y>mid+30) {gameState.bird.vy=JUMP;gameState.started=true;}}
    }
    gameState.frame++;
    if(gameState.frame%90===0) addPipe();
    gameState.pipes.forEach(p=>p.x-=PIPE_SPEED);
    gameState.pipes=gameState.pipes.filter(p=>p.x>-PIPE_W);
    // Score
    gameState.pipes.forEach(p=>{if(Math.abs(p.x+PIPE_W/2-BIRD_X)<PIPE_SPEED+1&&!p.scored){p.scored=true;gameState.score++;updateScore(gameState.score);}});
    // Collision ‚Äî noclip bypass
    const bx=BIRD_X-14,by=gameState.bird.y-14;
    if(!cheatFlags.flappy.noclip){
      if(gameState.bird.y>GH-20||gameState.bird.y<0){if(gameState.started){if(gameState._cleanup)gameState._cleanup();gameOver(gameState.score);return;}}
      for(const p of gameState.pipes){if(bx+28>p.x&&bx<p.x+PIPE_W&&(by<p.ty||by+28>p.by)){if(gameState.started){if(gameState._cleanup)gameState._cleanup();gameOver(gameState.score);return;}}}
    }
    // Draw
    GX.fillStyle='#0a0a2e';GX.fillRect(0,0,GW,GH);
    // Stars bg
    GX.fillStyle='rgba(255,255,255,0.4)';
    for(let i=0;i<30;i++){const sx=(i*73+gameState.frame*0.3)%GW,sy=(i*137)%GH;GX.beginPath();GX.arc(sx,sy,1,0,Math.PI*2);GX.fill();}
    // Pipes
    gameState.pipes.forEach(p=>{
      const g2=GX.createLinearGradient(p.x,0,p.x+PIPE_W,0);g2.addColorStop(0,'#16a34a');g2.addColorStop(1,'#4ade80');GX.fillStyle=g2;
      GX.fillRect(p.x,0,PIPE_W,p.ty);GX.fillRect(p.x,p.by,PIPE_W,GH-p.by);
      GX.fillStyle='#15803d';GX.fillRect(p.x-4,p.ty-18,PIPE_W+8,18);GX.fillRect(p.x-4,p.by,PIPE_W+8,18);
    });
    // Ground
    GX.fillStyle='#854d0e';GX.fillRect(0,GH-20,GW,20);GX.fillStyle='#a16207';GX.fillRect(0,GH-20,GW,6);
    // Bird
    GX.save();GX.translate(BIRD_X,gameState.bird.y);GX.rotate(Math.min(Math.PI/4,gameState.bird.vy*0.04));
    GX.fillStyle='#fbbf24';GX.beginPath();GX.ellipse(0,0,16,12,0,0,Math.PI*2);GX.fill();
    GX.fillStyle='#f59e0b';GX.beginPath();GX.ellipse(0,0,16,12,0,0,Math.PI);GX.fill();
    GX.fillStyle='white';GX.beginPath();GX.arc(5,-4,5,0,Math.PI*2);GX.fill();
    GX.fillStyle='#1e1b4b';GX.beginPath();GX.arc(7,-4,3,0,Math.PI*2);GX.fill();
    GX.fillStyle='#f97316';GX.beginPath();GX.moveTo(14,0);GX.lineTo(22,-4);GX.lineTo(22,4);GX.fill();
    GX.restore();
    if(!gameState.started){GX.fillStyle='rgba(0,0,0,0.4)';GX.fillRect(0,0,GW,GH);GX.fillStyle='white';GX.font='bold 18px Syne,sans-serif';GX.textAlign='center';GX.fillText('Klik / Space untuk mulai',GW/2,GH/2);}
  }
  gameLoop=requestAnimationFrame(frame);
}

/* 2048 */
function start2048(){
  let grid=Array(4).fill(null).map(()=>Array(4).fill(0));
  let score=0,moved=false;
  function add(){const empty=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!grid[r][c])empty.push([r,c]);if(!empty.length)return;const[r,c]=empty[Math.floor(Math.random()*empty.length)];grid[r][c]=Math.random()<0.9?2:4;}
  add();add();updateScore(0);
  const colors={'2':'#eee4da','4':'#ede0c8','8':'#f2b179','16':'#f59563','32':'#f67c5f','64':'#f65e3b','128':'#edcf72','256':'#edcc61','512':'#edc850','1024':'#edc53f','2048':'#edc22e'};
  function draw(){
    GX.fillStyle='#0a0a0f';GX.fillRect(0,0,GW,GH);
    const SZ=90,PAD=10,OX=(GW-4*(SZ+PAD)+PAD)/2,OY=(GH-4*(SZ+PAD)+PAD)/2;
    GX.fillStyle='#1a1a2e';GX.roundRect?GX.roundRect(OX-PAD,OY-PAD,4*(SZ+PAD)+PAD,4*(SZ+PAD)+PAD,12):GX.fillRect(OX-PAD,OY-PAD,4*(SZ+PAD)+PAD,4*(SZ+PAD)+PAD);GX.fill();
    for(let r=0;r<4;r++)for(let c=0;c<4;c++){
      const v=grid[r][c],x=OX+c*(SZ+PAD),y=OY+r*(SZ+PAD);
      GX.fillStyle=colors[v]||'#7c3aed';GX.beginPath();GX.roundRect?GX.roundRect(x,y,SZ,SZ,8):GX.fillRect(x,y,SZ,SZ);GX.fill();
      if(v){GX.fillStyle=v<=4?'#776e65':'#f9f6f2';GX.font=`bold ${v>99?v>999?22:26:32}px Syne,sans-serif`;GX.textAlign='center';GX.fillText(v,x+SZ/2,y+SZ/2+10);}
    }
  }
  function slide(row){const f=row.filter(v=>v);const merged=[];let skip=false;for(let i=0;i<f.length;i++){if(!skip&&i<f.length-1&&f[i]===f[i+1]){merged.push(f[i]*2);score+=f[i]*2;skip=true;}else if(skip){skip=false;}else merged.push(f[i]);}while(merged.length<4)merged.push(0);const changed=merged.some((v,i)=>v!==row[i]);return{row:merged,changed};}
  gameState={score,grid,paused:false};
  const handler=e=>{
    if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return;
    if(!gameState)return;
    const dirs={ArrowLeft:()=>{let ch=false;grid=grid.map(r=>{const{row,changed}=slide(r);if(changed)ch=true;return row;});return ch;},ArrowRight:()=>{let ch=false;grid=grid.map(r=>{const{row,changed}=slide([...r].reverse());if(changed)ch=true;return row.reverse();});return ch;},ArrowUp:()=>{let ch=false;for(let c=0;c<4;c++){const col=grid.map(r=>r[c]);const{row,changed}=slide(col);if(changed)ch=true;row.forEach((v,r)=>grid[r][c]=v);}return ch;},ArrowDown:()=>{let ch=false;for(let c=0;c<4;c++){const col=grid.map(r=>r[c]).reverse();const{row,changed}=slide(col);if(changed)ch=true;row.reverse().forEach((v,r)=>grid[r][c]=v);}return ch;}};
    const fn=dirs[e.key];if(fn){e.preventDefault();if(fn()){add();updateScore(score);draw();if(grid.flat().includes(2048)){alert('üéâ Selamat! Kamu mencapai 2048!');}}}}; 
  document.addEventListener('keydown',handler);
  gameState._cleanup=()=>document.removeEventListener('keydown',handler);
  draw();
}

/* BREAKOUT */
function startBreakout(){
  const BR={x:GW/2,y:GH-40,w:80,h:12,speed:6};
  const BALL={x:GW/2,y:GH-60,vx:3,vy:-4,r:8};
  const ROWS=5,COLS=8,BW=42,BH=16,PAD=6,OX=14,OY=50;
  const bricks=[];
  const brickColors=['#ef4444','#f97316','#eab308','#22c55e','#3b82f6'];
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)bricks.push({x:OX+c*(BW+PAD),y:OY+r*(BH+PAD),alive:true,color:brickColors[r]});
  let score=0,mousX=GW/2;
  GC.onmousemove=e=>{const rect=GC.getBoundingClientRect();mousX=e.clientX-rect.left;};
  const kh=e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return; if(e.key==='ArrowLeft')BR.x=Math.max(BR.w/2,BR.x-BR.speed*2);if(e.key==='ArrowRight')BR.x=Math.min(GW-BR.w/2,BR.x+BR.speed*2);};
  document.addEventListener('keydown',kh);
  gameState={br:BR,ball:BALL,bricks,score:0,paused:false,extraBalls:[],_cleanup:()=>{GC.onmousemove=null;document.removeEventListener('keydown',kh);}};
  updateScore(0);
  function frame(){
    if(!gameState){return;}
    gameLoop=requestAnimationFrame(frame);
    if(gameState.paused)return;
    // Sync paddle width if bigpaddle cheat toggled
    if(cheatFlags.breakout.bigpaddle) BR.w=200; else if(BR.w===200) BR.w=80;
    BR.x=Math.max(BR.w/2,Math.min(GW-BR.w/2,mousX));
    // Move all balls (main + extra)
    const allBalls=[BALL,...(gameState.extraBalls||[])];
    allBalls.forEach(ball=>{
      ball.x+=ball.vx; ball.y+=ball.vy;
      if(ball.x<ball.r||ball.x>GW-ball.r) ball.vx*=-1;
      if(ball.y<ball.r) ball.vy*=-1;
      // ballgod: bounce instead of die
      if(ball.y>GH){
        if(ball===BALL && !cheatFlags.breakout.ballgod){
          if(gameState._cleanup)gameState._cleanup(); gameOver(score); return;
        } else { ball.vy=-Math.abs(ball.vy); ball.y=GH-ball.r; } // bounce
      }
      if(ball.y+ball.r>GH-40&&ball.y<GH-28&&ball.x>BR.x-BR.w/2&&ball.x<BR.x+BR.w/2){ball.vy=-Math.abs(ball.vy);ball.vx+=(ball.x-BR.x)*0.05;}
      bricks.forEach(b=>{if(!b.alive)return;if(ball.x>b.x&&ball.x<b.x+BW&&ball.y>b.y&&ball.y<b.y+BH){b.alive=false;ball.vy*=-1;score+=10;updateScore(score);}});
    });
    if(bricks.every(b=>!b.alive)){if(gameState._cleanup)gameState._cleanup();GX.fillStyle='rgba(0,0,0,0.7)';GX.fillRect(0,0,GW,GH);GX.fillStyle='#10b981';GX.font='bold 28px Syne,sans-serif';GX.textAlign='center';GX.fillText('üéâ MENANG!',GW/2,GH/2);updateScore(score);return;}
    // Draw
    GX.fillStyle='#0a0a0f';GX.fillRect(0,0,GW,GH);
    bricks.forEach(b=>{if(!b.alive)return;GX.fillStyle=b.color;GX.beginPath();GX.roundRect?GX.roundRect(b.x,b.y,BW,BH,3):GX.fillRect(b.x,b.y,BW,BH);GX.fill();});
    const pg=GX.createLinearGradient(BR.x-BR.w/2,0,BR.x+BR.w/2,0);pg.addColorStop(0,'#7c3aed');pg.addColorStop(1,'#06b6d4');GX.fillStyle=pg;GX.beginPath();GX.roundRect?GX.roundRect(BR.x-BR.w/2,GH-40,BR.w,BR.h,6):GX.fillRect(BR.x-BR.w/2,GH-40,BR.w,BR.h);GX.fill();
    allBalls.forEach(ball=>{
      const bg=GX.createRadialGradient(ball.x,ball.y,0,ball.x,ball.y,ball.r);bg.addColorStop(0,'#e8e8f0');bg.addColorStop(1,'#7c3aed');GX.fillStyle=bg;GX.beginPath();GX.arc(ball.x,ball.y,ball.r,0,Math.PI*2);GX.fill();
    });
    // Cheat indicators
    if(cheatFlags.breakout.ballgod){GX.fillStyle='rgba(245,158,11,0.6)';GX.font='11px Space Mono,monospace';GX.textAlign='left';GX.fillText('‚ò†Ô∏è GOD',6,16);}
  }
  gameLoop=requestAnimationFrame(frame);
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üîî NOTIFIKASI & REMINDER                                    ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üé® THEME CUSTOMIZER                                         ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
const THEME_PRESETS = [
  {name:'Default',icon:'üåå',accent:'#7c3aed',accent2:'#06b6d4',accent3:'#f59e0b',bg:'#0a0a0f',surface:'#13131a',text:'#e8e8f0'},
  {name:'Crimson',icon:'üî¥',accent:'#dc2626',accent2:'#f97316',accent3:'#fbbf24',bg:'#0f0a0a',surface:'#1a1010',text:'#f0e8e8'},
  {name:'Emerald',icon:'üíö',accent:'#059669',accent2:'#0891b2',accent3:'#d97706',bg:'#0a0f0c',surface:'#101a13',text:'#e8f0ea'},
  {name:'Rose',icon:'üå∏',accent:'#e11d48',accent2:'#a21caf',accent3:'#f59e0b',bg:'#0f0a0e',surface:'#1a1018',text:'#f0e8ef'},
  {name:'Ocean',icon:'üåä',accent:'#0284c7',accent2:'#0891b2',accent3:'#10b981',bg:'#050e1a',surface:'#0a1628',text:'#e8f4f0'},
  {name:'Sunset',icon:'üåÖ',accent:'#ea580c',accent2:'#dc2626',accent3:'#f59e0b',bg:'#0f0a05',surface:'#1a1208',text:'#f0ece8'},
  {name:'Neon',icon:'‚ö°',accent:'#a3e635',accent2:'#22d3ee',accent3:'#f0abfc',bg:'#030303',surface:'#0a0a0a',text:'#f0f0f0'},
  {name:'Light',icon:'‚òÄÔ∏è',accent:'#7c3aed',accent2:'#0891b2',accent3:'#d97706',bg:'#f8f7ff',surface:'#ffffff',text:'#1a1a2e'},
];

function themeApply(){
  const r=document.documentElement.style;
  r.setProperty('--accent', document.getElementById('tc-accent')?.value||'#7c3aed');
  r.setProperty('--accent2', document.getElementById('tc-accent2')?.value||'#06b6d4');
  r.setProperty('--accent3', document.getElementById('tc-accent3')?.value||'#f59e0b');
  r.setProperty('--bg', document.getElementById('tc-bg')?.value||'#0a0a0f');
  r.setProperty('--surface', document.getElementById('tc-surface')?.value||'#13131a');
  r.setProperty('--text', document.getElementById('tc-text')?.value||'#e8e8f0');
  const font=document.getElementById('theme-font')?.value||"'Space Mono',monospace";
  r.setProperty('--font-mono',font);
  document.body.style.fontFamily=font;
  const rad=document.getElementById('theme-radius')?.value||8;
  const radEl=document.getElementById('theme-radius-val');
  if(radEl) radEl.textContent=rad;
  document.querySelectorAll('input,textarea,select,.btn,.output-box,.panel-card').forEach(el=>el.style.borderRadius=rad+'px');
}
function themeSave(){
  const t={
    accent:document.getElementById('tc-accent')?.value,
    accent2:document.getElementById('tc-accent2')?.value,
    accent3:document.getElementById('tc-accent3')?.value,
    bg:document.getElementById('tc-bg')?.value,
    surface:document.getElementById('tc-surface')?.value,
    text:document.getElementById('tc-text')?.value,
    font:document.getElementById('theme-font')?.value,
    radius:document.getElementById('theme-radius')?.value,
  };
  localStorage.setItem('tb-theme',JSON.stringify(t));
  const msg=document.getElementById('theme-saved-msg');
  if(msg){msg.textContent='‚úÖ Tema tersimpan!';setTimeout(()=>msg.textContent='',2500);}
  showNotif('üé® Tema tersimpan!');
}
function themeReset(){
  const d=THEME_PRESETS[0];
  ['accent','accent2','accent3','bg','surface','text'].forEach(k=>{
    const el=document.getElementById('tc-'+k);if(el)el.value=d[k];
  });
  themeApply();
  localStorage.removeItem('tb-theme');
}
function themeExportCSS(){
  const css=`:root{--accent:${document.getElementById('tc-accent')?.value};--accent2:${document.getElementById('tc-accent2')?.value};--accent3:${document.getElementById('tc-accent3')?.value};--bg:${document.getElementById('tc-bg')?.value};--surface:${document.getElementById('tc-surface')?.value};--text:${document.getElementById('tc-text')?.value};}`;
  navigator.clipboard.writeText(css);
  showNotif('üìã CSS tersalin!');
}
function themeApplyPreset(idx){
  const p=THEME_PRESETS[idx];if(!p)return;
  ['accent','accent2','accent3','bg','surface','text'].forEach(k=>{
    const el=document.getElementById('tc-'+k);if(el)el.value=p[k];
  });
  themeApply();
}
function themeInitPresets(){
  const wrap=document.getElementById('theme-presets');if(!wrap)return;
  wrap.innerHTML=THEME_PRESETS.map((p,i)=>`
    <button onclick="themeApplyPreset(${i})" style="background:linear-gradient(135deg,${p.accent},${p.accent2});border:none;border-radius:8px;padding:12px 6px;cursor:pointer;color:#fff;font-size:0.72rem;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,0.5);">
      <div style="font-size:1.1rem;">${p.icon}</div>
      <div>${p.name}</div>
    </button>`).join('');
}
function themeLoadSaved(){
  const saved=JSON.parse(localStorage.getItem('tb-theme')||'null');
  if(!saved)return;
  ['accent','accent2','accent3','bg','surface','text'].forEach(k=>{
    if(saved[k]&&document.getElementById('tc-'+k)) document.getElementById('tc-'+k).value=saved[k];
  });
  if(saved.font&&document.getElementById('theme-font')) document.getElementById('theme-font').value=saved.font;
  if(saved.radius&&document.getElementById('theme-radius')) document.getElementById('theme-radius').value=saved.radius;
  themeApply();
}

let reminders = JSON.parse(localStorage.getItem('tb-reminders')||'[]');
let remCheckInterval = null;

function remRequestPermission(){
  if(!('Notification' in window)){showNotif('‚ùå Browser tidak support notifikasi');return;}
  Notification.requestPermission().then(p=>{
    const el=document.getElementById('rem-notif-status');
    if(p==='granted'){if(el)el.textContent='‚úÖ Izin notifikasi diberikan!';}
    else{if(el)el.textContent='‚ùå Izin ditolak';}
  });
}

function remAdd(){
  const title=document.getElementById('rem-title')?.value.trim();
  const time=document.getElementById('rem-time')?.value;
  const msg=document.getElementById('rem-msg')?.value.trim();
  const sound=document.getElementById('rem-sound')?.value;
  if(!title){showNotif('‚ö†Ô∏è Masukkan judul reminder!');return;}
  if(!time){showNotif('‚ö†Ô∏è Pilih waktu reminder!');return;}
  const targetMs=new Date(time).getTime();
  if(targetMs<=Date.now()){showNotif('‚ö†Ô∏è Waktu harus di masa depan!');return;}
  const rem={id:Date.now(),title,msg,sound,time,targetMs,fired:false};
  reminders.push(rem);
  localStorage.setItem('tb-reminders',JSON.stringify(reminders));
  document.getElementById('rem-title').value='';
  document.getElementById('rem-msg').value='';
  remRender();
  showNotif('üîî Reminder ditambahkan!');
}

function remDelete(id){
  reminders=reminders.filter(r=>r.id!==id);
  localStorage.setItem('tb-reminders',JSON.stringify(reminders));
  remRender();
}

function remRender(){
  const list=document.getElementById('rem-list');
  const empty=document.getElementById('rem-empty');
  if(!list)return;
  const active=reminders.filter(r=>!r.fired);
  const fired=reminders.filter(r=>r.fired);
  const all=[...active,...fired];
  list.innerHTML=all.map(r=>`
    <div style="background:var(--bg);border:1px solid ${r.fired?'rgba(107,107,138,0.3)':'rgba(124,58,237,0.3)'};border-radius:8px;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;${r.fired?'opacity:0.5':''}">
      <div>
        <div style="font-weight:700;font-size:0.82rem;color:var(--text);">${r.fired?'‚úÖ':('üîî ')}${r.title}</div>
        <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;">${new Date(r.targetMs).toLocaleString('id-ID')} ‚Ä¢ üîä ${r.sound}</div>
        ${r.msg?`<div style="font-size:0.68rem;color:var(--muted);margin-top:2px;">${r.msg}</div>`:''}
      </div>
      <button onclick="remDelete(${r.id})" style="background:none;border:none;color:var(--danger);cursor:pointer;font-size:1rem;">üóë</button>
    </div>`).join('');
  if(empty)empty.style.display=all.length?'none':'block';
}

function remPlaySound(type){
  try{
    const ctx=new AudioContext();
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.connect(g);g.connect(ctx.destination);
    const freqs={beep:[880],chime:[523,659,784,1047],alarm:[440,880,440,880]}[type]||[440];
    let t=ctx.currentTime;
    freqs.forEach(f=>{o.frequency.setValueAtTime(f,t);t+=0.15;});
    g.gain.setValueAtTime(0.3,ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.8);
    o.start();o.stop(ctx.currentTime+0.8);
  }catch(e){}
}

function remCheck(){
  const now=Date.now();
  let changed=false;
  reminders.forEach(r=>{
    if(!r.fired&&r.targetMs<=now){
      r.fired=true;changed=true;
      // Browser notification
      if(Notification.permission==='granted'){
        new Notification('üîî '+r.title,{body:r.msg||'Toolbox Reminder',icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üîî</text></svg>'});
      }
      // In-app popup
      showNotif(`üîî ${r.title}`);
      remPlaySound(r.sound);
      remRender();
    }
  });
  if(changed)localStorage.setItem('tb-reminders',JSON.stringify(reminders));
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üìä DASHBOARD ANALYTICS                                      ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let toolUsage = JSON.parse(localStorage.getItem('tb-analytics')||'{}');
let sessionLog = JSON.parse(localStorage.getItem('tb-sessions')||'[]');
const sessionStart = Date.now();

function trackTool(tabName){
  toolUsage[tabName]=(toolUsage[tabName]||0)+1;
  localStorage.setItem('tb-analytics',JSON.stringify(toolUsage));
  // Track daily activity
  const today=new Date().toISOString().slice(0,10);
  const activity=JSON.parse(localStorage.getItem('tb-activity')||'{}');
  activity[today]=(activity[today]||0)+1;
  localStorage.setItem('tb-activity',JSON.stringify(activity));
}

function dashUpdate(){
  // Stats row
  const statsRow=document.getElementById('dash-stats-row');
  if(!statsRow)return;
  const totalUses=Object.values(toolUsage).reduce((a,b)=>a+b,0);
  const uniqueTools=Object.keys(toolUsage).length;
  const sessions=sessionLog.length+1;
  const today=new Date().toISOString().slice(0,10);
  const activity=JSON.parse(localStorage.getItem('tb-activity')||'{}');
  const todayCount=activity[today]||0;
  statsRow.innerHTML=[
    {icon:'üîß',label:'Total Klik Tool',val:totalUses},
    {icon:'üóÇÔ∏è',label:'Tool Dipakai',val:uniqueTools+' tool'},
    {icon:'üìÖ',label:'Sesi Total',val:sessions+' sesi'},
    {icon:'‚ö°',label:'Hari Ini',val:todayCount+' aksi'},
  ].map(s=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;text-align:center;">
    <div style="font-size:1.5rem;">${s.icon}</div>
    <div style="font-size:1.4rem;font-weight:800;color:var(--accent2);font-family:'Syne',sans-serif;">${s.val}</div>
    <div style="font-size:0.68rem;color:var(--muted);margin-top:4px;">${s.label}</div>
  </div>`).join('');

  // Top tools bar chart
  const topEl=document.getElementById('dash-top-tools');
  if(topEl){
    const sorted=Object.entries(toolUsage).sort((a,b)=>b[1]-a[1]).slice(0,8);
    const max=sorted[0]?.[1]||1;
    topEl.innerHTML=sorted.map(([name,count])=>`
      <div style="display:flex;align-items:center;gap:8px;font-size:0.75rem;">
        <div style="width:80px;color:var(--muted);text-overflow:ellipsis;overflow:hidden;white-space:nowrap;">${name}</div>
        <div style="flex:1;height:14px;background:var(--bg);border-radius:7px;overflow:hidden;">
          <div style="height:100%;width:${(count/max*100).toFixed(0)}%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:7px;transition:width 0.5s;"></div>
        </div>
        <div style="width:28px;text-align:right;color:var(--accent2);font-weight:700;">${count}</div>
      </div>`).join('');
    if(!sorted.length)topEl.innerHTML='<div style="color:var(--muted);font-size:0.78rem;">Belum ada data ‚Äî mulai pakai tools!</div>';
  }

  // 7-day activity chart on canvas
  const canvas=document.getElementById('dash-chart');
  if(canvas){
    const ctx2=canvas.getContext('2d');
    const W=canvas.offsetWidth||300;canvas.width=W;canvas.height=180;
    const days=[];for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);days.push(d.toISOString().slice(0,10));}
    const vals=days.map(d=>activity[d]||0);
    const maxV=Math.max(...vals,1);
    ctx2.clearRect(0,0,W,180);
    const barW=(W-40)/7;
    const grad=ctx2.createLinearGradient(0,0,0,160);
    grad.addColorStop(0,getComputedStyle(document.documentElement).getPropertyValue('--accent').trim()||'#7c3aed');
    grad.addColorStop(1,getComputedStyle(document.documentElement).getPropertyValue('--accent2').trim()+'88'||'#06b6d488');
    vals.forEach((v,i)=>{
      const bh=(v/maxV)*130;
      const x=20+i*barW+barW*0.1;
      const y=150-bh;
      ctx2.fillStyle=grad;
      ctx2.beginPath();if(ctx2.roundRect)ctx2.roundRect(x,y,barW*0.8,bh,4);else ctx2.fillRect(x,y,barW*0.8,bh);
      ctx2.fill();
      ctx2.fillStyle='#6b6b8a';ctx2.font='9px Space Mono,monospace';ctx2.textAlign='center';
      ctx2.fillText(days[i].slice(5),x+barW*0.4,165);
      if(v>0){ctx2.fillStyle='#e8e8f0';ctx2.fillText(v,x+barW*0.4,y-4);}
    });
  }

  // Sessions
  const sessEl=document.getElementById('dash-sessions');
  if(sessEl){
    const allSess=[...sessionLog,{start:sessionStart,tools:totalUses,current:true}].reverse().slice(0,10);
    sessEl.innerHTML=allSess.map(s=>`
      <div style="padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;justify-content:space-between;">
        <span>${s.current?'üü¢ Sesi Ini':new Date(s.start).toLocaleString('id-ID')}</span>
        <span style="color:var(--accent2);">${s.tools} aksi</span>
      </div>`).join('');
    if(!allSess.length)sessEl.innerHTML='<span>Belum ada sesi</span>';
  }
}

function dashReset(){
  if(!confirm('Reset semua data analytics? Tidak bisa dibatalkan!'))return;
  localStorage.removeItem('tb-analytics');localStorage.removeItem('tb-activity');localStorage.removeItem('tb-sessions');
  toolUsage={};sessionLog=[];
  dashUpdate();
  showNotif('üìä Analytics direset');
}

// Patch sw() to track tool usage + update dashboard
const _origSw = window.sw;
window.sw = function(name, btn){
  if(typeof _origSw==='function') _origSw(name, btn);
  else {
    document.querySelectorAll('.tool-panel').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    const el=document.getElementById('tab-'+name);if(el)el.classList.add('active');
    if(btn)btn.classList.add('active');
  }
  trackTool(name);
  if(name==='dashboard') setTimeout(dashUpdate, 50);

  if(name==='reminder'){remRender();}
  if(name==='share'){shareRender();}
  if(name==='settings'){settingsRenderData();}
  if(name==='plugins'){pluginRender();}
};

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üåç MULTI-LANGUAGE UI (i18n)                                 ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üåç I18N ‚Äî Sistem Translasi Lengkap (Tab, Header, Tombol, Label)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Mapping tab ID ‚Üí teks per bahasa
const I18N_TABS = {
  id: {
    text:'üìù Text',password:'üîê Password',base64:'üîÑ Base64',json:'üì¶ JSON',
    color:'üé® Warna',unit:'üìè Unit',hash:'üîë Hash',time:'‚è∞ Waktu',
    calc:'üßÆ Kalkulator',translate:'üåê Translate',qr:'üì∑ QR Code',
    random:'üé≤ Random',markdown:'üìÑ Markdown',regex:'üîç Regex',
    timer:'‚è±Ô∏è Timer',csv:'üìä CSV‚ÜíTabel',gradient:'üåà Gradient',
    minifier:'üóúÔ∏è Minifier',todo:'üìã To-Do',notepad:'üóíÔ∏è Notepad',
    currency:'üí± Kurs',weather:'üå§Ô∏è Cuaca',imgcomp:'üñºÔ∏è Kompres',
    fontprev:'üî§ Font',snippet:'üíª Snippet',aspect:'üìê Aspek',
    mindmap:'üß† Mindmap',morse:'üéµ Morse',worldclock:'üåç World Clock',
    fakedata:'üîÆ Fake Data',palette:'üé® Palette',chartgen:'üìä Chart',
    cipher:'üîê Enkripsi',ascii:'üñãÔ∏è ASCII Art',pomodoro:'üéØ Pomodoro',
    tts:'üé§ TTS',ocr:'üì∏ OCR',ageCalc:'üßÆ Umur',noise:'üåä Noise',
    glass:'ü™ü Glassmorphism',mockup:'üì± Mockup',numSys:'üî¢ Bilangan',
    games:'üéÆ Games',aihelp:'ü§ñ AI Support',about:'üë§ Tentang',
    calendar:'üìÖ Kalender',budget:'üí∞ Budget',habit:'üéØ Habit',
    flashcard:'üìñ Flashcard',videogif:'üé¨ Video‚ÜíGIF',meme:'üñºÔ∏è Meme',
    bpm:'üéµ BPM',urlqr:'üåê URL+QR',theme:'üé® Theme',
    reminder:'üîî Reminder',dashboard:'üìä Dashboard',i18n:'üåç Bahasa',
    share:'üîó Share',settings:'üì¶ Settings',plugins:'üß© Plugins',
    
    imgEditor:'‚úèÔ∏è Image Editor',resumeBuilder:'üìù Resume Builder',linkbio:'üîó Link Bio',svgEditor:'üìê SVG Editor',aiwriting:'‚úçÔ∏è AI Writing',aicodereview:'üêõ Code Review',aitranslatorpro:'üåê Translator Pro',aigoal:'üéØ Goal Planner',expense:'üìà Expense',apitester:'üîÑ API Tester',playlist:'üéµ Playlist',weeklyplan:'üóìÔ∏è Weekly Plan',
    audioviz:'üéµ Audio Viz',annotator:'üì∏ Annotator',vault:'üîê Vault',formula:'üßÆ Formula',summarizer:'üß† Summarizer',emailtpl:'üìß Email Tpl',focus:'‚è∞ Focus Mode',dataviz:'üìä Data Viz',

  },
  en: {
    text:'üìù Text',password:'üîê Password',base64:'üîÑ Base64',json:'üì¶ JSON',
    color:'üé® Color',unit:'üìè Unit',hash:'üîë Hash',time:'‚è∞ Time',
    calc:'üßÆ Calculator',translate:'üåê Translate',qr:'üì∑ QR Code',
    random:'üé≤ Random',markdown:'üìÑ Markdown',regex:'üîç Regex',
    timer:'‚è±Ô∏è Timer',csv:'üìä CSV‚ÜíTable',gradient:'üåà Gradient',
    minifier:'üóúÔ∏è Minifier',todo:'üìã To-Do',notepad:'üóíÔ∏è Notepad',
    currency:'üí± Currency',weather:'üå§Ô∏è Weather',imgcomp:'üñºÔ∏è Compress',
    fontprev:'üî§ Font',snippet:'üíª Snippet',aspect:'üìê Aspect',
    mindmap:'üß† Mindmap',morse:'üéµ Morse',worldclock:'üåç World Clock',
    fakedata:'üîÆ Fake Data',palette:'üé® Palette',chartgen:'üìä Chart',
    cipher:'üîê Cipher',ascii:'üñãÔ∏è ASCII Art',pomodoro:'üéØ Pomodoro',
    tts:'üé§ TTS',ocr:'üì∏ OCR',ageCalc:'üßÆ Age',noise:'üåä Noise',
    glass:'ü™ü Glassmorphism',mockup:'üì± Mockup',numSys:'üî¢ Numbers',
    games:'üéÆ Games',aihelp:'ü§ñ AI Support',about:'üë§ About',
    calendar:'üìÖ Calendar',budget:'üí∞ Budget',habit:'üéØ Habit',
    flashcard:'üìñ Flashcard',videogif:'üé¨ Video‚ÜíGIF',meme:'üñºÔ∏è Meme',
    bpm:'üéµ BPM',urlqr:'üåê URL+QR',theme:'üé® Theme',
    reminder:'üîî Reminder',dashboard:'üìä Dashboard',i18n:'üåç Language',
    share:'üîó Share',settings:'üì¶ Settings',plugins:'üß© Plugins',
    
    imgEditor:'‚úèÔ∏è Image Editor',resumeBuilder:'üìù Resume Builder',linkbio:'üîó Link Bio',svgEditor:'üìê SVG Editor',aiwriting:'‚úçÔ∏è AI Writing',aicodereview:'üêõ Code Review',aitranslatorpro:'üåê Translator Pro',aigoal:'üéØ Goal Planner',expense:'üìà Expense',apitester:'üîÑ API Tester',playlist:'üéµ Playlist',weeklyplan:'üóìÔ∏è Weekly Plan',
    audioviz:'üéµ Audio Viz',annotator:'üì∏ Annotator',vault:'üîê Vault',formula:'üßÆ Formula',summarizer:'üß† Summarizer',emailtpl:'üìß Email Tpl',focus:'‚è∞ Focus Mode',dataviz:'üìä Data Viz',

  },
  ja: {
    text:'üìù „ÉÜ„Ç≠„Çπ„Éà',password:'üîê „Éë„Çπ„ÉØ„Éº„Éâ',base64:'üîÑ Base64',json:'üì¶ JSON',
    color:'üé® „Ç´„É©„Éº',unit:'üìè Âçò‰Ωç',hash:'üîë „Éè„ÉÉ„Ç∑„É•',time:'‚è∞ ÊôÇÈñì',
    calc:'üßÆ Ë®àÁÆóÊ©ü',translate:'üåê ÁøªË®≥',qr:'üì∑ QR„Ç≥„Éº„Éâ',
    random:'üé≤ ‰π±Êï∞',markdown:'üìÑ Markdown',regex:'üîç Ê≠£Ë¶èË°®Áèæ',
    timer:'‚è±Ô∏è „Çø„Ç§„Éû„Éº',csv:'üìä CSVË°®',gradient:'üåà „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥',
    minifier:'üóúÔ∏è ÂúßÁ∏Æ',todo:'üìã To-Do',notepad:'üóíÔ∏è „É°„É¢Â∏≥',
    currency:'üí± ÁÇ∫Êõø',weather:'üå§Ô∏è Â§©Ê∞ó',imgcomp:'üñºÔ∏è ÂúßÁ∏Æ',
    fontprev:'üî§ „Éï„Ç©„É≥„Éà',snippet:'üíª „Çπ„Éã„Éö„ÉÉ„Éà',aspect:'üìê „Ç¢„Çπ„Éö„ÇØ„ÉàÊØî',
    mindmap:'üß† „Éû„Ç§„É≥„Éâ„Éû„ÉÉ„Éó',morse:'üéµ „É¢„Éº„É´„Çπ',worldclock:'üåç ‰∏ñÁïåÊôÇË®à',
    fakedata:'üîÆ „ÉÄ„Éü„Éº„Éá„Éº„Çø',palette:'üé® „Éë„É¨„ÉÉ„Éà',chartgen:'üìä „Ç∞„É©„Éï',
    cipher:'üîê ÊöóÂè∑',ascii:'üñãÔ∏è ASCII',pomodoro:'üéØ „Éù„É¢„Éâ„Éº„É≠',
    tts:'üé§ Èü≥Â£∞ÂêàÊàê',ocr:'üì∏ OCR',ageCalc:'üßÆ Âπ¥ÈΩ¢',noise:'üåä „Éé„Ç§„Ç∫',
    glass:'ü™ü „Ç¨„É©„Çπ',mockup:'üì± „É¢„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó',numSys:'üî¢ Êï∞ÂÄ§',
    games:'üéÆ „Ç≤„Éº„É†',aihelp:'ü§ñ AI „Çµ„Éù„Éº„Éà',about:'üë§ „Å´„Å§„ÅÑ„Å¶',
    calendar:'üìÖ „Ç´„É¨„É≥„ÉÄ„Éº',budget:'üí∞ ‰∫àÁÆó',habit:'üéØ ÁøíÊÖ£',
    flashcard:'üìñ „Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ',videogif:'üé¨ ÂãïÁîª‚ÜíGIF',meme:'üñºÔ∏è „Éü„Éº„É†',
    bpm:'üéµ BPM',urlqr:'üåê URL+QR',theme:'üé® „ÉÜ„Éº„Éû',
    reminder:'üîî „É™„Éû„Ç§„É≥„ÉÄ„Éº',dashboard:'üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',i18n:'üåç Ë®ÄË™û',
    share:'üîó „Ç∑„Çß„Ç¢',settings:'üì¶ Ë®≠ÂÆö',plugins:'üß© „Éó„É©„Ç∞„Ç§„É≥',
    
    imgEditor:'‚úèÔ∏è ÁîªÂÉèÁ∑®ÈõÜ',resumeBuilder:'üìù Â±•Ê≠¥Êõ∏',linkbio:'üîó „É™„É≥„ÇØ„Éê„Ç§„Ç™',svgEditor:'üìê SVGÁ∑®ÈõÜ',aiwriting:'‚úçÔ∏è AIÂü∑Á≠Ü',aicodereview:'üêõ „Ç≥„Éº„Éâ„É¨„Éì„É•„Éº',aitranslatorpro:'üåê ÁøªË®≥Pro',aigoal:'üéØ ÁõÆÊ®ôË®àÁîª',expense:'üìà ÊîØÂá∫ÁÆ°ÁêÜ',apitester:'üîÑ API„ÉÜ„Çπ„Éà',playlist:'üéµ „Éó„É¨„Ç§„É™„Çπ„Éà',weeklyplan:'üóìÔ∏è ÈÄ±ÈñìË®àÁîª',
    audioviz:'üéµ Èü≥Ê•ΩÂèØË¶ñÂåñ',annotator:'üì∏ Ê≥®Èáà',vault:'üîê ÈáëÂ∫´',formula:'üßÆ Êï∞Âºè',summarizer:'üß† Ë¶ÅÁ¥ÑAI',emailtpl:'üìß „É°„Éº„É´',focus:'‚è∞ ÈõÜ‰∏≠',dataviz:'üìä „Éá„Éº„ÇøÂèØË¶ñÂåñ',

  },
  ar: {
    text:'üìù ŸÜÿµ',password:'üîê ŸÉŸÑŸÖÿ© ÿ≥ÿ±',base64:'üîÑ Base64',json:'üì¶ JSON',
    color:'üé® ŸÑŸàŸÜ',unit:'üìè Ÿàÿ≠ÿØÿ©',hash:'üîë Ÿáÿßÿ¥',time:'‚è∞ ŸàŸÇÿ™',
    calc:'üßÆ ÿ≠ÿßÿ≥ÿ®ÿ©',translate:'üåê ÿ™ÿ±ÿ¨ŸÖÿ©',qr:'üì∑ QR',
    random:'üé≤ ÿπÿ¥Ÿàÿßÿ¶Ÿä',markdown:'üìÑ Markdown',regex:'üîç ÿ™ÿπÿ®Ÿäÿ±',
    timer:'‚è±Ô∏è ŸÖÿ§ŸÇÿ™',csv:'üìä CSV',gradient:'üåà ÿ™ÿØÿ±ÿ¨',
    minifier:'üóúÔ∏è ÿ∂ÿ∫ÿ∑',todo:'üìã ŸÖŸáÿßŸÖ',notepad:'üóíÔ∏è ÿØŸÅÿ™ÿ±',
    currency:'üí± ÿπŸÖŸÑÿ©',weather:'üå§Ô∏è ÿ∑ŸÇÿ≥',imgcomp:'üñºÔ∏è ÿµŸàÿ±ÿ©',
    fontprev:'üî§ ÿÆÿ∑',snippet:'üíª ŸÖŸÇÿ™ÿ∑ŸÅ',aspect:'üìê ŸÜÿ≥ÿ®ÿ©',
    mindmap:'üß† ÿÆÿ±Ÿäÿ∑ÿ©',morse:'üéµ ŸÖŸàÿ±ÿ≥',worldclock:'üåç ÿ≥ÿßÿπÿ©',
    fakedata:'üîÆ ÿ®ŸäÿßŸÜÿßÿ™',palette:'üé® ŸÑŸàÿ≠ÿ©',chartgen:'üìä ÿ±ÿ≥ŸÖ',
    cipher:'üîê ÿ™ÿ¥ŸÅŸäÿ±',ascii:'üñãÔ∏è ASCII',pomodoro:'üéØ ÿ®ŸàŸÖŸàÿØŸàÿ±Ÿà',
    tts:'üé§ TTS',ocr:'üì∏ OCR',ageCalc:'üßÆ ÿπŸÖÿ±',noise:'üåä ÿ∂ÿ¨Ÿäÿ¨',
    glass:'ü™ü ÿ≤ÿ¨ÿßÿ¨',mockup:'üì± ŸÜŸÖŸàÿ∞ÿ¨',numSys:'üî¢ ÿ£ÿπÿØÿßÿØ',
    games:'üéÆ ÿ£ŸÑÿπÿßÿ®',aihelp:'ü§ñ AI',about:'üë§ ÿ≠ŸàŸÑ',
    calendar:'üìÖ ÿ™ŸÇŸàŸäŸÖ',budget:'üí∞ ŸÖŸäÿ≤ÿßŸÜŸäÿ©',habit:'üéØ ÿπÿßÿØÿ©',
    flashcard:'üìñ ÿ®ÿ∑ÿßŸÇÿßÿ™',videogif:'üé¨ ŸÅŸäÿØŸäŸà‚ÜíGIF',meme:'üñºÔ∏è ŸÖŸäŸÖ',
    bpm:'üéµ BPM',urlqr:'üåê URL+QR',theme:'üé® ŸÖÿ∏Ÿáÿ±',
    reminder:'üîî ÿ™ÿ∞ŸÉŸäÿ±',dashboard:'üìä ŸÑŸàÿ≠ÿ©',i18n:'üåç ŸÑÿ∫ÿ©',
    share:'üîó ŸÖÿ¥ÿßÿ±ŸÉÿ©',settings:'üì¶ ÿ•ÿπÿØÿßÿØÿßÿ™',plugins:'üß© ÿ•ÿ∂ÿßŸÅÿßÿ™',
    
    imgEditor:'‚úèÔ∏è ŸÖÿ≠ÿ±ÿ± ÿµŸàÿ±',resumeBuilder:'üìù ÿ≥Ÿäÿ±ÿ© ÿ∞ÿßÿ™Ÿäÿ©',linkbio:'üîó ÿ®ŸäŸà ŸÑŸäŸÜŸÉ',svgEditor:'üìê ŸÖÿ≠ÿ±ÿ± SVG',aiwriting:'‚úçÔ∏è ŸÉÿ™ÿßÿ®ÿ© AI',aicodereview:'üêõ ŸÖÿ±ÿßÿ¨ÿπÿ© ŸÉŸàÿØ',aitranslatorpro:'üåê ÿ™ÿ±ÿ¨ŸÖÿ© Pro',aigoal:'üéØ ÿ™ÿÆÿ∑Ÿäÿ∑',expense:'üìà ŸÖÿµÿßÿ±ŸäŸÅ',apitester:'üîÑ ÿßÿÆÿ™ÿ®ÿßÿ± API',playlist:'üéµ ŸÇÿßÿ¶ŸÖÿ©',weeklyplan:'üóìÔ∏è ÿ¨ÿØŸàŸÑ ÿ£ÿ≥ÿ®ŸàÿπŸä',
    audioviz:'üéµ ÿµŸàÿ™',annotator:'üì∏ ÿ™ÿπŸÑŸäŸÇ',vault:'üîê ÿÆÿ≤ŸÜÿ©',formula:'üßÆ ŸÖÿπÿßÿØŸÑÿ©',summarizer:'üß† ŸÖŸÑÿÆÿµ',emailtpl:'üìß ÿ®ÿ±ŸäÿØ',focus:'‚è∞ ÿ™ÿ±ŸÉŸäÿ≤',dataviz:'üìä ÿ®ŸäÿßŸÜÿßÿ™',

  },
  ko: {
    text:'üìù ÌÖçÏä§Ìä∏',password:'üîê ÎπÑÎ∞ÄÎ≤àÌò∏',base64:'üîÑ Base64',json:'üì¶ JSON',
    color:'üé® ÏÉâÏÉÅ',unit:'üìè Îã®ÏúÑ',hash:'üîë Ìï¥Ïãú',time:'‚è∞ ÏãúÍ∞Ñ',
    calc:'üßÆ Í≥ÑÏÇ∞Í∏∞',translate:'üåê Î≤àÏó≠',qr:'üì∑ QRÏΩîÎìú',
    random:'üé≤ Î¨¥ÏûëÏúÑ',markdown:'üìÑ Markdown',regex:'üîç Ï†ïÍ∑úÏãù',
    timer:'‚è±Ô∏è ÌÉÄÏù¥Î®∏',csv:'üìä CSV‚ÜíÌëú',gradient:'üåà Í∑∏ÎùºÎç∞Ïù¥ÏÖò',
    minifier:'üóúÔ∏è ÏïïÏ∂ï',todo:'üìã Ìï†Ïùº',notepad:'üóíÔ∏è Î©îÎ™®Ïû•',
    currency:'üí± ÌôòÏú®',weather:'üå§Ô∏è ÎÇ†Ïî®',imgcomp:'üñºÔ∏è ÏïïÏ∂ï',
    fontprev:'üî§ Ìè∞Ìä∏',snippet:'üíª Ïä§ÎãàÌé´',aspect:'üìê ÎπÑÏú®',
    mindmap:'üß† ÎßàÏù∏ÎìúÎßµ',morse:'üéµ Î™®Ïä§',worldclock:'üåç ÏÑ∏Í≥ÑÏãúÍ≥Ñ',
    fakedata:'üîÆ Í∞ÄÏßúÎç∞Ïù¥ÌÑ∞',palette:'üé® ÌåîÎ†àÌä∏',chartgen:'üìä Ï∞®Ìä∏',
    cipher:'üîê ÏïîÌò∏',ascii:'üñãÔ∏è ASCII',pomodoro:'üéØ Ìè¨Î™®ÎèÑÎ°ú',
    tts:'üé§ TTS',ocr:'üì∏ OCR',ageCalc:'üßÆ ÎÇòÏù¥',noise:'üåä ÎÖ∏Ïù¥Ï¶à',
    glass:'ü™ü Ïú†Î¶¨',mockup:'üì± Î™©ÏóÖ',numSys:'üî¢ ÏßÑÎ≤ï',
    games:'üéÆ Í≤åÏûÑ',aihelp:'ü§ñ AI',about:'üë§ ÏÜåÍ∞ú',
    calendar:'üìÖ Ï∫òÎ¶∞Îçî',budget:'üí∞ ÏòàÏÇ∞',habit:'üéØ ÏäµÍ¥Ä',
    flashcard:'üìñ ÌîåÎûòÏãúÏπ¥Îìú',videogif:'üé¨ ÏòÅÏÉÅ‚ÜíGIF',meme:'üñºÔ∏è Î∞à',
    bpm:'üéµ BPM',urlqr:'üåê URL+QR',theme:'üé® ÌÖåÎßà',
    reminder:'üîî ÏïåÎ¶º',dashboard:'üìä ÎåÄÏãúÎ≥¥Îìú',i18n:'üåç Ïñ∏Ïñ¥',
    share:'üîó Í≥µÏú†',settings:'üì¶ ÏÑ§Ï†ï',plugins:'üß© ÌîåÎü¨Í∑∏Ïù∏',
    
    imgEditor:'‚úèÔ∏è Ïù¥ÎØ∏ÏßÄ Ìé∏Ïßë',resumeBuilder:'üìù Ïù¥Î†•ÏÑú',linkbio:'üîó ÎßÅÌÅ¨ Î∞îÏù¥Ïò§',svgEditor:'üìê SVG Ìé∏Ïßë',aiwriting:'‚úçÔ∏è AI Í∏ÄÏì∞Í∏∞',aicodereview:'üêõ ÏΩîÎìú Î¶¨Î∑∞',aitranslatorpro:'üåê Î≤àÏó≠ Pro',aigoal:'üéØ Î™©Ìëú Í≥ÑÌöç',expense:'üìà ÏßÄÏ∂ú Í¥ÄÎ¶¨',apitester:'üîÑ API ÌÖåÏä§ÌÑ∞',playlist:'üéµ ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏',weeklyplan:'üóìÔ∏è Ï£ºÍ∞Ñ Í≥ÑÌöç',
    audioviz:'üéµ Ïò§ÎîîÏò§ ÏãúÍ∞ÅÌôî',annotator:'üì∏ Ï£ºÏÑù',vault:'üîê Î≥ºÌä∏',formula:'üßÆ Í≥µÏãù',summarizer:'üß† ÏöîÏïΩAI',emailtpl:'üìß Ïù¥Î©îÏùº',focus:'‚è∞ ÏßëÏ§ëÎ™®Îìú',dataviz:'üìä Îç∞Ïù¥ÌÑ∞ ÏãúÍ∞ÅÌôî',

  },
};

// UI string translations (header, buttons, labels, placeholders, panel titles)
const I18N_UI = {
  id: {
    header_title:'‚ö° TOOLBOX',
    header_sub:'Kumpulan tools berguna ‚Äî gratis, cepat, privat',
    search_ph:'üîç Cari tool...',
    // Panel titles (by tab key)
    panel_text:'Text Analyzer & Converter',
    panel_password:'Password Generator',
    panel_calc:'Kalkulator',
    panel_todo:'To-Do List',
    panel_games:'üéÆ Mini Games',
    panel_theme:'üé® Theme Customizer',
    panel_reminder:'üîî Notifikasi & Reminder',
    panel_dashboard:'üìä Dashboard Analytics',
    panel_i18n:'üåç Multi-Language UI',
    panel_share:'üîó Share & Kolaborasi',
    panel_settings:'üì¶ Export/Import Settings',
    panel_plugins:'üß© Plugin System',
    // Common buttons
    btn_add:'Tambah', btn_save:'üíæ Simpan', btn_copy:'Salin', btn_reset:'Reset',
    btn_run:'Jalankan', btn_start:'‚ñ∂ Mulai', btn_stop:'‚èπ Berhenti',
    btn_cancel:'Batal', btn_delete:'Hapus', btn_export:'Export',
    btn_import:'Import', btn_refresh:'Refresh',
    // Labels
    label_result:'Hasil', label_input:'Input', label_output:'Output',
    label_settings:'Pengaturan', label_history:'Riwayat',
    // Footer
    footer:'‚ö° TOOLBOX by Adam yang Ganteng ‚Äî Semua proses di browser, data aman',
  },
  en: {
    header_title:'‚ö° TOOLBOX',
    header_sub:'Useful tools ‚Äî free, fast, private',
    search_ph:'üîç Search tools...',
    panel_text:'Text Analyzer & Converter',
    panel_password:'Password Generator',
    panel_calc:'Calculator',
    panel_todo:'To-Do List',
    panel_games:'üéÆ Mini Games',
    panel_theme:'üé® Theme Customizer',
    panel_reminder:'üîî Notifications & Reminders',
    panel_dashboard:'üìä Dashboard Analytics',
    panel_i18n:'üåç Multi-Language UI',
    panel_share:'üîó Share & Collaborate',
    panel_settings:'üì¶ Export/Import Settings',
    panel_plugins:'üß© Plugin System',
    btn_add:'Add', btn_save:'üíæ Save', btn_copy:'Copy', btn_reset:'Reset',
    btn_run:'Run', btn_start:'‚ñ∂ Start', btn_stop:'‚èπ Stop',
    btn_cancel:'Cancel', btn_delete:'Delete', btn_export:'Export',
    btn_import:'Import', btn_refresh:'Refresh',
    label_result:'Result', label_input:'Input', label_output:'Output',
    label_settings:'Settings', label_history:'History',
    footer:'‚ö° TOOLBOX by Adam ‚Äî All processing in browser, data is safe',
  },
  ja: {
    header_title:'‚ö° „ÉÑ„Éº„É´„Éú„ÉÉ„ÇØ„Çπ',
    header_sub:'‰æøÂà©„Å™„ÉÑ„Éº„É´ÈõÜ ‚Äî ÁÑ°Êñô„ÉªÈ´òÈÄü„Éª„Éó„É©„Ç§„Éô„Éº„Éà',
    search_ph:'üîç „ÉÑ„Éº„É´„ÇíÊ§úÁ¥¢...',
    panel_text:'„ÉÜ„Ç≠„Çπ„ÉàÂàÜÊûê„ÉªÂ§âÊèõ',
    panel_password:'„Éë„Çπ„ÉØ„Éº„ÉâÁîüÊàêÂô®',
    panel_calc:'Ë®àÁÆóÊ©ü',
    panel_todo:'To-Do„É™„Çπ„Éà',
    panel_games:'üéÆ „Éü„Éã„Ç≤„Éº„É†',
    panel_theme:'üé® „ÉÜ„Éº„Éû„Ç´„Çπ„Çø„Éû„Ç§„Ç∂„Éº',
    panel_reminder:'üîî ÈÄöÁü•„Éª„É™„Éû„Ç§„É≥„ÉÄ„Éº',
    panel_dashboard:'üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂàÜÊûê',
    panel_i18n:'üåç Â§öË®ÄË™ûUI',
    panel_share:'üîó „Ç∑„Çß„Ç¢„Éª„Ç≥„É©„Éú',
    panel_settings:'üì¶ Ë®≠ÂÆö„Ç®„ÇØ„Çπ„Éù„Éº„Éà/„Ç§„É≥„Éù„Éº„Éà',
    panel_plugins:'üß© „Éó„É©„Ç∞„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†',
    btn_add:'ËøΩÂä†', btn_save:'üíæ ‰øùÂ≠ò', btn_copy:'„Ç≥„Éî„Éº', btn_reset:'„É™„Çª„ÉÉ„Éà',
    btn_run:'ÂÆüË°å', btn_start:'‚ñ∂ ÈñãÂßã', btn_stop:'‚èπ ÂÅúÊ≠¢',
    btn_cancel:'„Ç≠„É£„É≥„Çª„É´', btn_delete:'ÂâäÈô§', btn_export:'„Ç®„ÇØ„Çπ„Éù„Éº„Éà',
    btn_import:'„Ç§„É≥„Éù„Éº„Éà', btn_refresh:'Êõ¥Êñ∞',
    label_result:'ÁµêÊûú', label_input:'ÂÖ•Âäõ', label_output:'Âá∫Âäõ',
    label_settings:'Ë®≠ÂÆö', label_history:'Â±•Ê≠¥',
    footer:'‚ö° TOOLBOX by Adam ‚Äî „Åô„Åπ„Å¶„ÅÆÂá¶ÁêÜ„ÅØ„Éñ„É©„Ç¶„Ç∂ÂÜÖ„ÅßË°å„Çè„Çå„Åæ„Åô',
  },
  ar: {
    header_title:'‚ö° ÿµŸÜÿØŸàŸÇ ÿßŸÑÿ£ÿØŸàÿßÿ™',
    header_sub:'ÿ£ÿØŸàÿßÿ™ ŸÖŸÅŸäÿØÿ© ‚Äî ŸÖÿ¨ÿßŸÜŸäÿ©ÿå ÿ≥ÿ±Ÿäÿπÿ©ÿå ÿÆÿßÿµÿ©',
    search_ph:'üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿØÿßÿ©...',
    panel_text:'ŸÖÿ≠ŸÑŸÑ ÿßŸÑŸÜÿµŸàÿµ',
    panel_password:'ŸÖŸàŸÑÿØ ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ≥ÿ±',
    panel_calc:'ÿßŸÑÿ¢ŸÑÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ©',
    panel_todo:'ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸáÿßŸÖ',
    panel_games:'üéÆ ÿ£ŸÑÿπÿßÿ® ŸÖÿµÿ∫ÿ±ÿ©',
    panel_theme:'üé® ÿ™ÿÆÿµŸäÿµ ÿßŸÑŸÖÿ∏Ÿáÿ±',
    panel_reminder:'üîî ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸàÿßŸÑÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™',
    panel_dashboard:'üìä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
    panel_i18n:'üåç Ÿàÿßÿ¨Ÿáÿ© ŸÖÿ™ÿπÿØÿØÿ© ÿßŸÑŸÑÿ∫ÿßÿ™',
    panel_share:'üîó ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ŸàÿßŸÑÿ™ÿπÿßŸàŸÜ',
    panel_settings:'üì¶ ÿ™ÿµÿØŸäÿ±/ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
    panel_plugins:'üß© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™',
    btn_add:'ÿ•ÿ∂ÿßŸÅÿ©', btn_save:'üíæ ÿ≠ŸÅÿ∏', btn_copy:'ŸÜÿ≥ÿÆ', btn_reset:'ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ',
    btn_run:'ÿ™ÿ¥ÿ∫ŸäŸÑ', btn_start:'‚ñ∂ ÿßÿ®ÿØÿ£', btn_stop:'‚èπ ÿ•ŸäŸÇÿßŸÅ',
    btn_cancel:'ÿ•ŸÑÿ∫ÿßÿ°', btn_delete:'ÿ≠ÿ∞ŸÅ', btn_export:'ÿ™ÿµÿØŸäÿ±',
    btn_import:'ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ', btn_refresh:'ÿ™ÿ≠ÿØŸäÿ´',
    label_result:'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©', label_input:'ÿßŸÑÿ•ÿØÿÆÿßŸÑ', label_output:'ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨',
    label_settings:'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', label_history:'ÿßŸÑÿ≥ÿ¨ŸÑ',
    footer:'‚ö° ÿµŸÜÿØŸàŸÇ ÿßŸÑÿ£ÿØŸàÿßÿ™ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© Adam ‚Äî ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ŸÅŸä ÿßŸÑŸÖÿ™ÿµŸÅÿ≠',
  },
  ko: {
    header_title:'‚ö° Ìà¥Î∞ïÏä§',
    header_sub:'Ïú†Ïö©Ìïú ÎèÑÍµ¨ Î™®Ïùå ‚Äî Î¨¥Î£å, Îπ†Î¶Ñ, Í∞úÏù∏ Ï†ïÎ≥¥ Î≥¥Ìò∏',
    search_ph:'üîç ÎèÑÍµ¨ Í≤ÄÏÉâ...',
    panel_text:'ÌÖçÏä§Ìä∏ Î∂ÑÏÑùÍ∏∞ Î∞è Î≥ÄÌôòÍ∏∞',
    panel_password:'ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÉùÏÑ±Í∏∞',
    panel_calc:'Í≥ÑÏÇ∞Í∏∞',
    panel_todo:'Ìï† Ïùº Î™©Î°ù',
    panel_games:'üéÆ ÎØ∏Îãà Í≤åÏûÑ',
    panel_theme:'üé® ÌÖåÎßà Ïª§Ïä§ÌÑ∞ÎßàÏù¥Ï†Ä',
    panel_reminder:'üîî ÏïåÎ¶º Î∞è Î¶¨ÎßàÏù∏Îçî',
    panel_dashboard:'üìä ÎåÄÏãúÎ≥¥Îìú Î∂ÑÏÑù',
    panel_i18n:'üåç Îã§Íµ≠Ïñ¥ UI',
    panel_share:'üîó Í≥µÏú† Î∞è ÌòëÏóÖ',
    panel_settings:'üì¶ ÏÑ§Ï†ï ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞',
    panel_plugins:'üß© ÌîåÎü¨Í∑∏Ïù∏ ÏãúÏä§ÌÖú',
    btn_add:'Ï∂îÍ∞Ä', btn_save:'üíæ Ï†ÄÏû•', btn_copy:'Î≥µÏÇ¨', btn_reset:'Ï¥àÍ∏∞Ìôî',
    btn_run:'Ïã§Ìñâ', btn_start:'‚ñ∂ ÏãúÏûë', btn_stop:'‚èπ Ï†ïÏßÄ',
    btn_cancel:'Ï∑®ÏÜå', btn_delete:'ÏÇ≠Ï†ú', btn_export:'ÎÇ¥Î≥¥ÎÇ¥Í∏∞',
    btn_import:'Í∞ÄÏ†∏Ïò§Í∏∞', btn_refresh:'ÏÉàÎ°úÍ≥†Ïπ®',
    label_result:'Í≤∞Í≥º', label_input:'ÏûÖÎ†•', label_output:'Ï∂úÎ†•',
    label_settings:'ÏÑ§Ï†ï', label_history:'Í∏∞Î°ù',
    footer:'‚ö° TOOLBOX by Adam ‚Äî Î™®Îì† Ï≤òÎ¶¨Îäî Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Ïù¥Î£®Ïñ¥ÏßëÎãàÎã§',
  },
};

let currentLang = localStorage.getItem('tb-lang')||'id';

function i18nApply(lang){
  currentLang = lang || currentLang;
  localStorage.setItem('tb-lang', currentLang);

  const tabs = I18N_TABS[currentLang] || I18N_TABS.id;
  const ui   = I18N_UI[currentLang]   || I18N_UI.id;
  const isRTL = currentLang === 'ar';

  // 1. RTL support
  document.body.dir = isRTL ? 'rtl' : 'ltr';
  document.documentElement.lang = currentLang;

  // 2. Translate ALL sidebar tab buttons
  document.querySelectorAll('.tab-btn').forEach(btn => {
    const m = btn.getAttribute('onclick')?.match(/sw\('([^']+)'/);
    if (m && tabs[m[1]]) btn.textContent = tabs[m[1]];
  });

  // 2.5 Translate back bar
  const backBtn = document.getElementById('tb-back-btn');
  if(backBtn){
    const backLabels = {id:'‚Üê Kembali', en:'‚Üê Back', ja:'‚Üê Êàª„Çã', ar:'‚Üê ÿ±ÿ¨Ÿàÿπ', ko:'‚Üê Îí§Î°ú'};
    backBtn.textContent = backLabels[currentLang] || '‚Üê Kembali';
  }
  const escHint = document.querySelector('#tb-back-bar div:last-child');
  if(escHint){
    const escLabels = {id:'ESC untuk kembali', en:'ESC to go back', ja:'ESC„ÅßÊàª„Çã', ar:'ESC ŸÑŸÑÿ±ÿ¨Ÿàÿπ', ko:'ESC Îí§Î°úÍ∞ÄÍ∏∞'};
    escHint.textContent = escLabels[currentLang] || 'ESC untuk kembali';
  }

  // 3. Header title & subtitle
  const h1 = document.querySelector('header h1');
  const hsub = document.querySelector('header p');
  if (h1) h1.textContent = ui.header_title;
  if (hsub) hsub.textContent = ui.header_sub;

  // 4. Search placeholder
  const srch = document.getElementById('tool-search');
  if (srch) srch.placeholder = ui.search_ph;

  // 5. Panel titles (key panels)
  const PANEL_MAP = {
    'tab-text': 'panel_text', 'tab-password': 'panel_password',
    'tab-calc': 'panel_calc', 'tab-todo': 'panel_todo',
    'tab-games': 'panel_games', 'tab-theme': 'panel_theme',
    'tab-reminder': 'panel_reminder', 'tab-dashboard': 'panel_dashboard',
    'tab-i18n': 'panel_i18n', 'tab-share': 'panel_share',
    'tab-settings': 'panel_settings', 'tab-plugins': 'panel_plugins',
  };
  Object.entries(PANEL_MAP).forEach(([tabId, uiKey]) => {
    const panel = document.getElementById(tabId);
    if (!panel) return;
    const titleEl = panel.querySelector('.panel-title');
    if (titleEl && ui[uiKey]) titleEl.textContent = ui[uiKey];
  });

  // 6. Common button text by data attribute (for buttons that have data-i18n-btn)
  document.querySelectorAll('[data-i18n-btn]').forEach(el => {
    const key = el.getAttribute('data-i18n-btn');
    if (ui[key]) el.textContent = ui[key];
  });

  // 7. Update preview in i18n panel
  const PREVIEW_KEYS = ['btn_save','btn_copy','btn_reset','btn_start','btn_stop','btn_add','btn_delete','label_result'];
  const prevEl = document.getElementById('i18n-kv');
  if (prevEl) {
    prevEl.innerHTML = PREVIEW_KEYS.map(k => {
      const base = k.replace('btn_','').replace('label_','');
      return `<div style="padding:4px 0;">${base} ‚Üí <span style="color:var(--accent2);font-weight:600;">${ui[k]||''}</span></div>`;
    }).join('');
  }

  // 8. Footer
  const footer = document.querySelector('footer p');
  if (footer) footer.textContent = ui.footer;

  // 9. Update active lang indicator in picker
  const activeEl = document.getElementById('i18n-active-lang');
  if (activeEl) activeEl.textContent = {id:'üáÆüá© Bahasa Indonesia',en:'üá∫üá∏ English',ja:'üáØüáµ Êó•Êú¨Ë™û',ar:'üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',ko:'üá∞üá∑ ÌïúÍµ≠Ïñ¥'}[currentLang] || currentLang;

  const langNames = {id:'Indonesia',en:'English',ja:'Êó•Êú¨Ë™û',ar:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',ko:'ÌïúÍµ≠Ïñ¥'};
  showNotif(`üåç ${langNames[currentLang]||currentLang}`);
  i18nRenderPicker();
}

function i18nRenderPicker(){
  const wrap = document.getElementById('i18n-picker');
  if (!wrap) return;
  const langs = [
    {code:'id', flag:'üáÆüá©', name:'Bahasa Indonesia', native:'Indonesian'},
    {code:'en', flag:'üá∫üá∏', name:'English',          native:'English'},
    {code:'ja', flag:'üáØüáµ', name:'Êó•Êú¨Ë™û',            native:'Japanese'},
    {code:'ar', flag:'üá∏üá¶', name:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',           native:'Arabic (RTL)'},
    {code:'ko', flag:'üá∞üá∑', name:'ÌïúÍµ≠Ïñ¥',            native:'Korean'},
  ];
  wrap.innerHTML = langs.map(l => `
    <div onclick="i18nApply('${l.code}')"
      style="padding:14px 18px;background:${currentLang===l.code?'rgba(124,58,237,0.15)':'var(--bg)'};
      border:2px solid ${currentLang===l.code?'var(--accent)':'var(--border)'};
      border-radius:12px;cursor:pointer;display:flex;align-items:center;gap:14px;
      transition:all 0.2s;user-select:none;">
      <span style="font-size:1.8rem;line-height:1;">${l.flag}</span>
      <div style="flex:1;">
        <div style="font-weight:${currentLang===l.code?'800':'500'};font-size:0.88rem;color:${currentLang===l.code?'var(--accent2)':'var(--text)'};">${l.name}</div>
        <div style="font-size:0.68rem;color:var(--muted);margin-top:1px;">${l.native}</div>
      </div>
      ${currentLang===l.code
        ? '<span style="background:var(--accent);color:#fff;font-size:0.65rem;font-weight:700;padding:2px 10px;border-radius:20px;">‚úì AKTIF</span>'
        : '<span style="color:var(--muted);font-size:0.75rem;">Pilih ‚Üí</span>'}
    </div>`).join('');
}


// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  ‚å®Ô∏è COMMAND PALETTE (Ctrl+K)                                 ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
const ALL_COMMANDS = [
  
  {name:'üîî Reminder',tab:'reminder',keywords:'notif pengingat alarm reminder'},
  {name:'üìä Dashboard Analytics',tab:'dashboard',keywords:'statistik grafik usage dashboard'},
  {name:'üåç Ganti Bahasa',tab:'i18n',keywords:'language bahasa indonesia english'},
  {name:'üîó Share Tool',tab:'share',keywords:'bagikan link share kolaborasi'},
  {name:'üé® Theme Customizer',tab:'theme',keywords:'tema warna color theme preset font radius'},
  {name:'üì¶ Export/Import Settings',tab:'settings',keywords:'backup restore export import'},
  {name:'üß© Plugin System',tab:'plugins',keywords:'plugin custom tambah tool'},
  {name:'ü§ñ AI Assistant',tab:'aihelp',keywords:'ai claude bantuan chatbot'},
  {name:'üêç Snake Game',tab:'games',keywords:'game snake ular'},
  {name:'üìù Text Analyzer',tab:'text',keywords:'teks analyze kata karakter'},
  {name:'üîë Password Generator',tab:'password',keywords:'password kata sandi generate'},
  {name:'üìä JSON Formatter',tab:'json',keywords:'json format validator'},
  {name:'üé® Color Converter',tab:'color',keywords:'warna hex rgb hsl color'},
  {name:'‚è± Stopwatch & Timer',tab:'timer',keywords:'stopwatch timer countdown'},
  {name:'üî¢ Kalkulator',tab:'calc',keywords:'kalkulator hitung calc'},
  {name:'üåê Translator',tab:'translate',keywords:'terjemah translate bahasa'},
  {name:'üì± QR Code',tab:'qr',keywords:'qr kode barcode'},
  {name:'‚≠ï Pomodoro',tab:'pomodoro',keywords:'pomodoro fokus produktivitas'},
  {name:'üí∞ Budget Tracker',tab:'budget',keywords:'budget pengeluaran keuangan'},
  {name:'üìÖ Calendar',tab:'calendar',keywords:'kalender jadwal event'},
  {name:'üìñ Flashcard',tab:'flashcard',keywords:'flashcard belajar hafalan'},
  {name:'üéµ BPM Counter',tab:'bpm',keywords:'bpm tempo musik'},
  {name:'üîê Hash Generator',tab:'hash',keywords:'hash md5 sha256'},
  {name:'üìù Markdown Preview',tab:'markdown',keywords:'markdown preview md'},
  {name:'üîç Regex Tester',tab:'regex',keywords:'regex regular expression'},
  {name:'üìã Notepad',tab:'notepad',keywords:'notepad catatan note'},
  {name:'‚úÖ To-Do List',tab:'todo',keywords:'todo daftar tugas task'},
  {name:'üå§ Cuaca',tab:'weather',keywords:'cuaca weather hujan'},
  {name:'üí± Kurs Mata Uang',tab:'currency',keywords:'kurs uang dollar rupiah'},
];

(function buildCommandPalette(){
  const css=document.createElement('style');
  css.textContent=`
    #cmd-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:100000;display:none;align-items:flex-start;justify-content:center;padding-top:10vh;backdrop-filter:blur(4px);}
    #cmd-overlay.open{display:flex;}
    #cmd-box{width:min(600px,92vw);background:#13131a;border:1px solid rgba(124,58,237,0.5);border-radius:14px;overflow:hidden;box-shadow:0 20px 80px rgba(0,0,0,0.8);}
    #cmd-input-wrap{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(124,58,237,0.2);}
    #cmd-input{flex:1;background:none;border:none;outline:none;color:#e8e8f0;font-size:1rem;font-family:'Space Mono',monospace;}
    #cmd-results{max-height:380px;overflow-y:auto;}
    .cmd-item{padding:10px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:background 0.1s;font-size:0.82rem;}
    .cmd-item:hover,.cmd-item.active{background:rgba(124,58,237,0.15);}
    .cmd-item .cmd-tab{font-size:0.65rem;color:var(--accent);background:rgba(124,58,237,0.15);border-radius:4px;padding:1px 6px;margin-left:auto;}
    #cmd-empty{padding:24px;text-align:center;color:#6b6b8a;font-size:0.82rem;}
  `;
  document.head.appendChild(css);
  const overlay=document.createElement('div');
  overlay.id='cmd-overlay';
  overlay.innerHTML=`<div id="cmd-box">
    <div id="cmd-input-wrap">
      <span style="color:var(--accent);font-size:1.1rem;">‚å®Ô∏è</span>
      <input id="cmd-input" placeholder="Ketik nama tool atau perintah..." autocomplete="off">
      <span style="font-size:0.65rem;color:#6b6b8a;white-space:nowrap;">ESC untuk tutup</span>
    </div>
    <div id="cmd-results"></div>
  </div>`;
  overlay.onclick=(e)=>{if(e.target===overlay)cmdClose();};
  document.body.appendChild(overlay);
})();

let cmdSelected=0;
function cmdOpen(){
  const o=document.getElementById('cmd-overlay');
  if(!o)return;
  o.classList.add('open');
  const inp=document.getElementById('cmd-input');
  if(inp){inp.value='';inp.focus();}
  cmdRender('');
}
function cmdClose(){
  document.getElementById('cmd-overlay')?.classList.remove('open');
}
function cmdRender(q){
  const results=document.getElementById('cmd-results');
  if(!results)return;
  const filtered=q?ALL_COMMANDS.filter(c=>
    (c.name+c.keywords).toLowerCase().includes(q.toLowerCase())
  ):ALL_COMMANDS;
  cmdSelected=0;
  if(!filtered.length){results.innerHTML='<div id="cmd-empty">Tidak ada hasil untuk "'+q+'"</div>';return;}
  results.innerHTML=filtered.map((c,i)=>`
    <div class="cmd-item${i===0?' active':''}" onclick="cmdGo('${c.tab}')" data-idx="${i}">
      <span>${c.name}</span>
      <span class="cmd-tab">${c.tab}</span>
    </div>`).join('');
}
function cmdGo(tab){
  cmdClose();
  const btn=document.querySelector(`[onclick*="sw('${tab}'"]`);
  if(btn){btn.click();}
}

document.addEventListener('keydown',e=>{
  if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();cmdOpen();return;}
  const o=document.getElementById('cmd-overlay');
  if(!o||!o.classList.contains('open'))return;
  const items=document.querySelectorAll('.cmd-item');
  if(e.key==='Escape'){cmdClose();}
  else if(e.key==='ArrowDown'){cmdSelected=Math.min(cmdSelected+1,items.length-1);items.forEach((el,i)=>el.classList.toggle('active',i===cmdSelected));items[cmdSelected]?.scrollIntoView({block:'nearest'});}
  else if(e.key==='ArrowUp'){cmdSelected=Math.max(cmdSelected-1,0);items.forEach((el,i)=>el.classList.toggle('active',i===cmdSelected));items[cmdSelected]?.scrollIntoView({block:'nearest'});}
  else if(e.key==='Enter'){const active=document.querySelector('.cmd-item.active');if(active){const tab=active.querySelector('.cmd-tab')?.textContent;if(tab)cmdGo(tab);}}
});
document.getElementById('cmd-input')?.addEventListener('input',function(){cmdRender(this.value);});

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üîó SHARE & KOLABORASI                                       ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let shareItems = JSON.parse(localStorage.getItem('tb-shares')||'[]');

function shareCreate(){
  const title=document.getElementById('share-title')?.value.trim();
  const content=document.getElementById('share-content')?.value.trim();
  const type=document.getElementById('share-type')?.value||'text';
  if(!title||!content){showNotif('‚ö†Ô∏è Isi judul dan konten!');return;}
  const id=Math.random().toString(36).slice(2,10).toUpperCase();
  const share={id,title,content,type,created:Date.now(),views:0};
  shareItems.unshift(share);
  localStorage.setItem('tb-shares',JSON.stringify(shareItems));
  // Generate shareable URL (data URI style for local)
  const payload=btoa(unescape(encodeURIComponent(JSON.stringify({t:title,c:content,ty:type}))));
  share.url=location.href.split('?')[0]+'?share='+id+'&d='+payload;
  localStorage.setItem('tb-shares',JSON.stringify(shareItems));
  shareRender();
  showNotif('üîó Link share dibuat!');
}

function shareRender(){
  const wrap=document.getElementById('share-list');
  if(!wrap)return;
  if(!shareItems.length){wrap.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px;font-size:0.78rem;">Belum ada share</div>';return;}
  wrap.innerHTML=shareItems.map(s=>`
    <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:8px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="font-weight:700;font-size:0.82rem;color:var(--text);">${s.title}</span>
        <span style="font-size:0.65rem;color:var(--muted);">${new Date(s.created).toLocaleDateString('id-ID')}</span>
      </div>
      <div style="font-size:0.72rem;color:var(--muted);margin-bottom:8px;max-height:48px;overflow:hidden;">${s.content.substring(0,120)}${s.content.length>120?'...':''}</div>
      <div style="display:flex;gap:6px;">
        <button class="btn" style="font-size:0.7rem;padding:4px 8px;" onclick="shareCopyLink('${s.id}')">üìã Copy Link</button>
        <button class="btn" style="font-size:0.7rem;padding:4px 8px;" onclick="shareQR('${s.id}')">üì± QR</button>
        <button class="btn" style="font-size:0.7rem;padding:4px 8px;color:var(--danger);border-color:var(--danger);" onclick="shareDelete('${s.id}')">üóë</button>
      </div>
    </div>`).join('');
}

function shareCopyLink(id){
  const s=shareItems.find(x=>x.id===id);
  if(!s){showNotif('Share tidak ditemukan');return;}
  navigator.clipboard.writeText(s.url||location.href);
  showNotif('üìã Link tersalin!');
}

function shareQR(id){
  const s=shareItems.find(x=>x.id===id);
  if(!s)return;
  const url=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(s.url||location.href)}`;
  const preview=document.getElementById('share-qr-preview');
  if(preview){preview.innerHTML=`<img src="${url}" style="width:160px;height:160px;border-radius:8px;border:2px solid var(--accent);" alt="QR">`;preview.style.display='block';}
}

function shareDelete(id){
  shareItems=shareItems.filter(s=>s.id!==id);
  localStorage.setItem('tb-shares',JSON.stringify(shareItems));
  shareRender();
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üì¶ EXPORT/IMPORT SETTINGS                                   ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
function settingsExport(){
  const allData={};
  const keys=['tb-reminders','tb-analytics','tb-activity','tb-sessions','tb-shares',
    'tb-todo','tb-notes','tb-snippets','tb-habits','tb-flashcards','tb-budget-transactions',
    'tb-calendar-events','tb-plugins','tb-hs','tb-wc-custom','tb-lang'];
  keys.forEach(k=>{const v=localStorage.getItem(k);if(v)allData[k]=JSON.parse(v);});
  allData['_meta']={exported:new Date().toISOString(),version:'2.0',tool:'ToolboxByAdam'};
  const blob=new Blob([JSON.stringify(allData,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download=`toolbox-backup-${new Date().toISOString().slice(0,10)}.json`;a.click();
  showNotif('üì¶ Backup di-download!');
}

function settingsFileImport(input){
  const file=input.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const data=JSON.parse(e.target.result);
      const keep=document.getElementById('settings-keep-existing')?.checked;
      const count={imported:0,skipped:0};
      Object.entries(data).forEach(([k,v])=>{
        if(k.startsWith('_'))return;
        if(keep&&localStorage.getItem(k)){count.skipped++;return;}
        localStorage.setItem(k,JSON.stringify(v));count.imported++;
      });
      const el=document.getElementById('settings-import-status');
      if(el)el.textContent=`‚úÖ ${count.imported} item di-import, ${count.skipped} dilewati. Reload untuk efek penuh.`;
      showNotif(`‚úÖ Import ${count.imported} item berhasil!`);
      settingsRenderData();
    }catch(err){
      const el=document.getElementById('settings-import-status');
      if(el)el.textContent='‚ùå File tidak valid: '+err.message;
    }
  };
  reader.readAsText(file);
}

function settingsDropImport(e){
  e.preventDefault();
  const file=e.dataTransfer.files[0];
  if(!file)return;
  const input=document.getElementById('settings-file-input');
  // Simulate file input
  const dt=new DataTransfer();dt.items.add(file);input.files=dt.files;
  settingsFileImport(input);
  document.getElementById('settings-drop-zone').style.borderColor='var(--border)';
}

function settingsClear(){
  if(!confirm('‚ö†Ô∏è Hapus SEMUA data Toolbox? Ini tidak bisa dibatalkan!'))return;
  const keep=['tb-lang'];
  Object.keys(localStorage).filter(k=>k.startsWith('tb-')&&!keep.includes(k)).forEach(k=>localStorage.removeItem(k));
  showNotif('üóë Semua data dihapus');
  settingsRenderData();
}

function settingsRenderData(){
  const wrap=document.getElementById('settings-data-list');
  if(!wrap)return;
  const entries=Object.keys(localStorage).filter(k=>k.startsWith('tb-')).map(k=>{
    const raw=localStorage.getItem(k);
    const size=(new Blob([raw])).size;
    const label={
      'tb-theme':'üé® Tema Custom','tb-reminders':'üîî Reminders','tb-analytics':'üìä Analytics',
      'tb-activity':'üìÖ Aktivitas Harian','tb-sessions':'üíæ Sesi','tb-shares':'üîó Shares',
      'tb-todo':'‚úÖ To-Do','tb-notes':'üìù Notes','tb-snippets':'üìã Snippets',
      'tb-habits':'üéØ Habits','tb-flashcards':'üìñ Flashcards','tb-budget-transactions':'üí∞ Budget',
      'tb-calendar-events':'üìÖ Calendar','tb-plugins':'üß© Plugins','tb-hs':'üèÜ High Scores',
      'tb-lang':'üåç Bahasa','tb-reminders':'üîî Reminders',
    }[k]||k;
    const sizeStr=size>1024?`${(size/1024).toFixed(1)} KB`:`${size} B`;
    return {k,label,size,sizeStr};
  }).sort((a,b)=>b.size-a.size);

  if(!entries.length){wrap.innerHTML='<div style="color:var(--muted);font-size:0.78rem;">Tidak ada data tersimpan</div>';return;}
  wrap.innerHTML=entries.map(e=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:var(--bg);border:1px solid var(--border);border-radius:8px;">
      <span style="font-size:0.78rem;color:var(--text);">${e.label}</span>
      <div style="display:flex;align-items:center;gap:8px;">
        <span style="font-size:0.65rem;color:var(--muted);">${e.sizeStr}</span>
        <button onclick="if(confirm('Hapus ${e.label}?')){localStorage.removeItem('${e.k}');settingsRenderData();}" style="background:none;border:none;cursor:pointer;color:var(--danger);font-size:0.8rem;">üóë</button>
      </div>
    </div>`).join('');
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üß© PLUGIN SYSTEM                                            ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let _rawPlugins = [];
try { _rawPlugins = JSON.parse(localStorage.getItem('tb-plugins')||'[]'); } catch(e) { _rawPlugins = []; }
// Migrate: remove plugins that call removed/renamed functions
const _removedFns = ['tBuildHomeCards','tbClockStart','tbWeatherLoad','tbBuildHome','initHyprland'];
let installedPlugins = _rawPlugins.filter(p => {
  if(!p.js) return true;
  const callsRemoved = _removedFns.some(fn => p.js.includes(fn));
  if(callsRemoved) {
    console.info(`Plugin "${p.name}" uses removed API ‚Äî skipped. Reinstall if needed.`);
    return false;
  }
  return true;
});
// Save cleaned list back
if(installedPlugins.length !== _rawPlugins.length){
  localStorage.setItem('tb-plugins', JSON.stringify(installedPlugins));
}

const PLUGIN_EXAMPLE = {
  id: 'uuid-gen',
  name: 'üîÆ UUID v4 Generator',
  desc: 'Generate UUID v4 secara instan',
  icon: 'üîÆ',
  html: '<div style="padding:8px;"><button class="btn btn-primary" onclick="pluginUUID()">Generate UUID</button><div id="plugin-uuid-out" style="margin-top:10px;font-family:monospace;font-size:0.85rem;color:var(--accent2);"></div></div>',
  js: 'function pluginUUID(){const u="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const r=Math.random()*16|0;return(c=="x"?r:r&0x3|0x8).toString(16)});document.getElementById("plugin-uuid-out").textContent=u;navigator.clipboard?.writeText(u);}'
};

function pluginInstall(){
  const raw=document.getElementById('plugin-json')?.value.trim();
  if(!raw){showNotif('‚ö†Ô∏è Paste JSON plugin dulu!');return;}
  let plugin;
  try{plugin=JSON.parse(raw);}catch(e){
    const msg=document.getElementById('plugin-install-msg');
    if(msg){msg.textContent='‚ùå JSON tidak valid: '+e.message;msg.style.color='var(--danger)';}
    return;
  }
  if(!plugin.id||!plugin.name){showNotif('‚ùå Plugin harus punya id dan name');return;}
  if(installedPlugins.find(p=>p.id===plugin.id)){showNotif('‚ö†Ô∏è Plugin sudah terinstall!');return;}
  plugin.installedAt=Date.now();
  installedPlugins.push(plugin);
  localStorage.setItem('tb-plugins',JSON.stringify(installedPlugins));
  // Create tab
  pluginActivate(plugin);
  pluginRender();
  document.getElementById('plugin-json').value='';
  const msg=document.getElementById('plugin-install-msg');
  if(msg){msg.textContent=`‚úÖ Plugin "${plugin.name}" berhasil diinstall!`;msg.style.color='var(--success)';setTimeout(()=>msg.textContent='',3000);}
  showNotif(`üß© ${plugin.name} terinstall!`);
}

function pluginActivate(plugin){
  // Add tab button
  const tabWrap=document.querySelector('.tab-list');
  if(tabWrap&&!document.getElementById('plugin-tab-btn-'+plugin.id)){
    const btn=document.createElement('button');
    btn.className='tab-btn';
    btn.id='plugin-tab-btn-'+plugin.id;
    btn.innerHTML=`${plugin.icon||'üß©'} ${plugin.name}`;
    btn.onclick=()=>sw('plugin-'+plugin.id,btn);
    tabWrap.appendChild(btn);
  }
  // Add tab panel
  const panelWrap=document.querySelector('.panels-wrap');
  if(panelWrap&&!document.getElementById('tab-plugin-'+plugin.id)){
    const panel=document.createElement('div');
    panel.className='tool-panel';
    panel.id='tab-plugin-'+plugin.id;
    panel.innerHTML=`<div class="panel-card">
      <div class="panel-title">${plugin.icon||'üß©'} ${plugin.name}</div>
      <div class="panel-desc">// ${plugin.desc||'Plugin custom'} ‚Äî ID: ${plugin.id}</div>
      <div id="plugin-body-${plugin.id}">${plugin.html||''}</div>
    </div>`;
    panelWrap.appendChild(panel);
  }
  // Execute plugin JS
  if(plugin.js){
    try{eval(plugin.js);}catch(e){
      console.warn(`Plugin "${plugin.name}" JS error:`, e.message);
      // Don't crash ‚Äî plugin HTML still shows
    }
  }
}

function pluginUninstall(id){
  if(!confirm('Uninstall plugin ini?'))return;
  installedPlugins=installedPlugins.filter(p=>p.id!==id);
  localStorage.setItem('tb-plugins',JSON.stringify(installedPlugins));
  // Remove tab + panel
  document.getElementById('plugin-tab-btn-'+id)?.remove();
  document.getElementById('tab-plugin-'+id)?.remove();
  // Switch back to first tab
  document.querySelector('.tab-btn')?.click();
  pluginRender();
  showNotif('üß© Plugin dihapus');
}

function pluginRender(){
  const wrap=document.getElementById('plugin-list');
  const empty=document.getElementById('plugin-empty');
  const count=document.getElementById('plugin-count');
  if(count)count.textContent=installedPlugins.length;
  if(!wrap)return;
  if(!installedPlugins.length){if(empty)empty.style.display='block';wrap.innerHTML='';return;}
  if(empty)empty.style.display='none';
  wrap.innerHTML=installedPlugins.map(p=>`
    <div style="background:var(--bg);border:1px solid rgba(124,58,237,0.3);border-radius:10px;padding:12px 14px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-weight:700;font-size:0.82rem;color:var(--text);">${p.icon||'üß©'} ${p.name}</div>
          <div style="font-size:0.68rem;color:var(--muted);margin-top:2px;">${p.desc||''} ‚Ä¢ ID: ${p.id}</div>
        </div>
        <div style="display:flex;gap:6px;">
          <button class="btn" style="font-size:0.7rem;padding:4px 8px;" onclick="cmdGo('plugin-${p.id}')">Buka</button>
          <button class="btn" style="font-size:0.7rem;padding:4px 8px;color:var(--danger);border-color:var(--danger);" onclick="pluginUninstall('${p.id}')">Hapus</button>
        </div>
      </div>
    </div>`).join('');
}

function pluginLoadExample(){
  document.getElementById('plugin-json').value=JSON.stringify(PLUGIN_EXAMPLE,null,2);
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üöÄ INIT ALL FEATURES                                        ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
(function initAllFeatures(){

  // Reminder checker every 30s
  remRender();
  remCheckInterval = setInterval(remCheck, 30000);
  remCheck(); // immediate check

  // i18n
  i18nApply(currentLang);
  // Start clock & weather widgets
  // Init widgets (deferred to ensure DOM is ready)
  setTimeout(()=>{
    try{ hyClockStart(); }catch(e){ console.info('Clock widget will init on interaction'); }
    try{ hyFetchWeather(hyWeatherCity); }catch(e){ console.info('Weather widget will load on interaction'); }
  }, 50);
  // Init tool helpers
  // SVG editor initializes on first open via sw() trigger
  try{ blRenderLinks(); blPreview(); }catch(e){}
  try{ etRender(); plRender(); wpRender(); rvRenderEntries(); }catch(e){}
  setTimeout(i18nRenderPicker, 200);

  // Analytics ‚Äî save session on exit
  window.addEventListener('beforeunload', ()=>{
    const sessions=JSON.parse(localStorage.getItem('tb-sessions')||'[]');
    sessions.push({start:sessionStart,end:Date.now(),tools:Object.values(toolUsage).reduce((a,b)=>a+b,0)});
    if(sessions.length>50)sessions.splice(0,sessions.length-50);
    localStorage.setItem('tb-sessions',JSON.stringify(sessions));
  });

  // Backward-compat shims ‚Äî old function names ‚Üí new ones
  // Prevents ReferenceError from old plugins in localStorage
  window.tBuildHomeCards  = ()=>{}; // removed, home is static
  window.tbClockStart     = ()=>{ try{hyClockStart();}catch(e){} };
  window.tbWeatherLoad    = (c)=>{ try{hyFetchWeather(c||hyWeatherCity);}catch(e){} };
  window.tbBuildHome      = ()=>{}; // removed
  window.initHyprland     = ()=>{}; // removed
  window.hyBuildHomeCards = ()=>{}; // static now

  // Plugins ‚Äî restore all installed
  installedPlugins.forEach(p=>pluginActivate(p));
  setTimeout(pluginRender, 200);

  // Share ‚Äî check for ?share= in URL
  const urlParams=new URLSearchParams(location.search);
  const shareData=urlParams.get('d');
  if(shareData){
    try{
      const decoded=JSON.parse(decodeURIComponent(escape(atob(shareData))));
      setTimeout(()=>{
        showNotif(`üì• Share diterima: "${decoded.t}"`);
        // Put content in AI chat or show modal
        const modal=document.createElement('div');
        modal.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:99999;display:flex;align-items:center;justify-content:center;';
        modal.innerHTML=`<div style="background:var(--surface);border:2px solid var(--accent);border-radius:16px;padding:24px;max-width:500px;width:90%;">
          <div style="font-weight:800;font-size:1rem;margin-bottom:8px;">üì• Share Diterima: ${decoded.t}</div>
          <div style="background:var(--bg);border-radius:8px;padding:12px;font-size:0.8rem;max-height:200px;overflow-y:auto;white-space:pre-wrap;color:var(--muted);">${decoded.c}</div>
          <div style="margin-top:12px;display:flex;gap:8px;">
            <button class="btn btn-primary" onclick="navigator.clipboard.writeText('${decoded.c.replace(/'/g,"\\'").replace(/\n/g,'\\n')}');showNotif('Tersalin!');">üìã Copy</button>
            <button class="btn btn-secondary" onclick="this.closest('[style]').remove()">Tutup</button>
          </div>
        </div>`;
        document.body.appendChild(modal);
      }, 500);
    }catch(e){}
  }

  // Show Ctrl+K hint after 3s
  setTimeout(()=>{
    if(!localStorage.getItem('tb-cmd-hint-shown')){
      showNotif('üí° Tekan Ctrl+K untuk Command Palette!');
      localStorage.setItem('tb-cmd-hint-shown','1');
    }
  }, 3000);

  // Keyboard shortcut display in footer
  const footer=document.querySelector('footer p');
  if(footer)footer.innerHTML+=' <span style="font-size:0.7rem;color:#6b6b8a;">[Ctrl+K = Command Palette]</span>';
})();

// ===== DEVELOPER CHEAT SYSTEM =====
let cheatUnlocked = false;
const CHEAT_PASS = 'adam ganteng dev';

// Cheat flags ‚Äî harus didefinisikan SEBELUM selectGame dipanggil
let cheatFlags = {
  snake: { godmode:false, speed:false, slow:false },
  flappy: { noclip:false, autojump:false, nogravity:false, widegap:false },
  '2048': {},
  breakout: { ballgod:false, bigpaddle:false, multiball:false, slowball:false }
};

selectGame('snake');

function openCheatMenu(){
  if(cheatUnlocked){
    toggleCheatPanel();
    return;
  }
  const modal = document.getElementById('cheat-modal');
  modal.style.display = 'flex';
  // Focus segera setelah render, tidak perlu setTimeout
  requestAnimationFrame(()=>requestAnimationFrame(()=>{
    const inp = document.getElementById('cheat-pass-input');
    if(inp){ inp.focus(); inp.value=''; }
  }));
}

function closeCheatModal(){
  document.getElementById('cheat-modal').style.display = 'none';
  document.getElementById('cheat-pass-input').value = '';
  document.getElementById('cheat-pass-error').textContent = '';
}

function submitCheatPass(){
  const val = document.getElementById('cheat-pass-input').value.trim();
  if(val === CHEAT_PASS){
    cheatUnlocked = true;
    closeCheatModal();
    // Visual feedback unlock
    const btn = document.getElementById('game-cheat-btn');
    btn.textContent = 'üõ†Ô∏è Dev ‚úì';
    btn.style.background = 'rgba(245,158,11,0.15)';
    showNotif('üõ†Ô∏è Developer Cheat Mode Aktif!');
    toggleCheatPanel();
  } else {
    const err = document.getElementById('cheat-pass-error');
    err.textContent = '‚ùå Password salah! Coba lagi.';
    document.getElementById('cheat-pass-input').value = '';
    document.getElementById('cheat-pass-input').classList.add('shake');
    setTimeout(()=>document.getElementById('cheat-pass-input').classList.remove('shake'), 400);
  }
}

function toggleCheatPanel(){
  const panel = document.getElementById('cheat-panel');
  const isVisible = panel.style.display !== 'none';
  panel.style.display = isVisible ? 'none' : 'block';
  if(!isVisible) updateCheatPanel();
}

function updateCheatPanel(){
  // Tampilkan hanya cheat untuk game yang dipilih
  ['snake','flappy','2048','breakout'].forEach(g => {
    const el = document.getElementById('cheat-'+g);
    if(el) el.style.display = g === currentGame ? 'flex' : 'none';
  });
  const labels = {snake:'üêç Snake', flappy:'üê¶ Flappy Bird', '2048':'üî¢ 2048', breakout:'üß± Breakout'};
  document.getElementById('cheat-game-label').textContent = labels[currentGame] || currentGame;
}

// Update cheat panel saat ganti game
const _origSelectGame = selectGame;
// Patch selectGame to also update cheat panel
const _selectGameOrig = window.selectGame;

function cheatLog(msg){
  const el = document.getElementById('cheat-status');
  if(el){ el.textContent = '‚ö° ' + msg; setTimeout(()=>{ if(el.textContent.includes(msg)) el.textContent=''; }, 3000); }
}

function cheat(game, type){
  if(!cheatUnlocked){ showNotif('üîí Unlock cheat dulu!'); return; }

  if(game === 'snake'){
    if(!gameState || currentGame !== 'snake'){ showNotif('Mulai game Snake dulu!'); return; }
    if(type === 'godmode'){
      cheatFlags.snake.godmode = !cheatFlags.snake.godmode;
      cheatLog('God Mode ' + (cheatFlags.snake.godmode ? 'ON ‚Äî tembus dinding & ekor!' : 'OFF'));
      showNotif('‚ò†Ô∏è God Mode: ' + (cheatFlags.snake.godmode ? 'ON' : 'OFF'));
    }
    else if(type === 'grow'){
      // Tambah panjang snake 10 segmen
      if(gameState.snake){
        const tail = gameState.snake[gameState.snake.length-1];
        for(let i=0;i<10;i++) gameState.snake.push({...tail});
        gameState.score += 100; updateScore(gameState.score);
        cheatLog('+10 panjang & +100 skor!');
      }
    }
    else if(type === 'speed'){
      cheatFlags.snake.speed = !cheatFlags.snake.speed;
      cheatFlags.snake.slow = false;
      clearInterval(gameLoop);
      const spd = cheatFlags.snake.speed ? 60 : 140;
      // Restart interval dengan speed baru
      const gs = gameState;
      gameLoop = setInterval(() => {
        if(!gameState || gameState !== gs) return;
        // game loop runs via existing reference ‚Äî just change interval
      }, spd);
      // Actually we need to restart the snake loop
      startSnake();
      cheatLog('Turbo Speed ' + (cheatFlags.snake.speed ? 'ON ‚ö°' : 'OFF'));
    }
    else if(type === 'slow'){
      cheatFlags.snake.slow = !cheatFlags.snake.slow;
      cheatFlags.snake.speed = false;
      startSnake();
      cheatLog('Slow Motion ' + (cheatFlags.snake.slow ? 'ON üê¢' : 'OFF'));
    }
    else if(type === 'score'){
      gameState.score += 500; updateScore(gameState.score);
      cheatLog('+500 skor!');
    }
  }

  else if(game === 'flappy'){
    if(!gameState || currentGame !== 'flappy'){ showNotif('Mulai game Flappy Bird dulu!'); return; }
    if(type === 'noclip'){
      cheatFlags.flappy.noclip = !cheatFlags.flappy.noclip;
      cheatLog('No Clip (tembus pipa) ' + (cheatFlags.flappy.noclip ? 'ON üëª' : 'OFF'));
      showNotif('üëª No Clip: ' + (cheatFlags.flappy.noclip ? 'ON' : 'OFF'));
    }
    else if(type === 'autojump'){
      cheatFlags.flappy.autojump = !cheatFlags.flappy.autojump;
      cheatLog('Auto Jump Bot ' + (cheatFlags.flappy.autojump ? 'ON ü§ñ' : 'OFF'));
      showNotif('ü§ñ Auto Jump: ' + (cheatFlags.flappy.autojump ? 'ON' : 'OFF'));
    }
    else if(type === 'nogravity'){
      cheatFlags.flappy.nogravity = !cheatFlags.flappy.nogravity;
      cheatLog('Anti Gravity ' + (cheatFlags.flappy.nogravity ? 'ON ü™Ç' : 'OFF'));
      showNotif('ü™Ç Anti Gravity: ' + (cheatFlags.flappy.nogravity ? 'ON' : 'OFF'));
    }
    else if(type === 'widegap'){
      cheatFlags.flappy.widegap = !cheatFlags.flappy.widegap;
      if(gameState.pipes) gameState.pipes.forEach(p => { if(cheatFlags.flappy.widegap){ p._origGap=p.by-p.ty; p.by=p.ty+250; } else { if(p._origGap) p.by=p.ty+p._origGap; } });
      cheatLog('Wide Gap ' + (cheatFlags.flappy.widegap ? 'ON üö™' : 'OFF'));
    }
    else if(type === 'score'){
      gameState.score += 100; updateScore(gameState.score);
      cheatLog('+100 skor!');
    }
  }

  else if(game === '2048'){
    if(!gameState || currentGame !== '2048'){ showNotif('Mulai game 2048 dulu!'); return; }
    if(type === 'win'){
      // Spawn 2048 tile di posisi random kosong
      const empties=[];
      for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(gameState.grid[r][c]===0) empties.push([r,c]);
      if(empties.length){ const [r,c]=empties[Math.floor(Math.random()*empties.length)]; gameState.grid[r][c]=2048; gameState.score+=2048; updateScore(gameState.score); }
      cheatLog('Tile 2048 di-spawn! üèÜ');
    }
    else if(type === 'clear'){
      for(let r=0;r<4;r++) for(let c=0;c<4;c++) gameState.grid[r][c]=(r===0&&c===0)?2:0;
      gameState.score=2; updateScore(2);
      cheatLog('Board di-clear! ‚ú®');
    }
    else if(type === 'maxscore'){
      gameState.score += 10000; updateScore(gameState.score);
      cheatLog('+10000 skor!');
    }
    else if(type === 'fill'){
      for(let r=0;r<4;r++) for(let c=0;c<4;c++) gameState.grid[r][c]=1024;
      gameState.score+=16*1024; updateScore(gameState.score);
      cheatLog('Semua tile 1024! üî¢');
    }
    // Force redraw 2048
    if(typeof draw2048==='function') draw2048();
  }

  else if(game === 'breakout'){
    if(!gameState || currentGame !== 'breakout'){ showNotif('Mulai game Breakout dulu!'); return; }
    if(type === 'ballgod'){
      cheatFlags.breakout.ballgod = !cheatFlags.breakout.ballgod;
      cheatLog('Bola tidak jatuh ' + (cheatFlags.breakout.ballgod ? 'ON ‚ò†Ô∏è' : 'OFF'));
      showNotif('‚ò†Ô∏è Ball God: ' + (cheatFlags.breakout.ballgod ? 'ON' : 'OFF'));
    }
    else if(type === 'bigpaddle'){
      cheatFlags.breakout.bigpaddle = !cheatFlags.breakout.bigpaddle;
      if(gameState.br) gameState.br.w = cheatFlags.breakout.bigpaddle ? 200 : 80;
      cheatLog('Paddle lebar ' + (cheatFlags.breakout.bigpaddle ? 'ON üìè' : 'OFF'));
    }
    else if(type === 'destroyall'){
      if(gameState.bricks){ gameState.bricks.forEach(b=>b.alive=false); cheatLog('Semua bata hancur! üí•'); }
    }
    else if(type === 'multiball'){
      cheatFlags.breakout.multiball = !cheatFlags.breakout.multiball;
      if(cheatFlags.breakout.multiball && gameState.ball){
        gameState.extraBalls=[
          {x:gameState.ball.x+30,y:gameState.ball.y,vx:-gameState.ball.vx,vy:gameState.ball.vy,r:8},
          {x:gameState.ball.x-30,y:gameState.ball.y,vx:gameState.ball.vx*1.2,vy:-gameState.ball.vy,r:8}
        ];
      } else { gameState.extraBalls=[]; }
      cheatLog('Multi Ball ' + (cheatFlags.breakout.multiball ? 'ON ‚öΩ‚öΩ‚öΩ' : 'OFF'));
    }
    else if(type === 'slowball'){
      cheatFlags.breakout.slowball = !cheatFlags.breakout.slowball;
      if(gameState.ball){
        const factor = cheatFlags.breakout.slowball ? 0.4 : 2.5;
        gameState.ball.vx *= factor; gameState.ball.vy *= factor;
        if(gameState.extraBalls) gameState.extraBalls.forEach(b=>{b.vx*=factor;b.vy*=factor;});
      }
      cheatLog('Slow Ball ' + (cheatFlags.breakout.slowball ? 'ON üê¢' : 'OFF'));
    }
  }
}

// ===== AI POWERED BY CLAUDE (REAL API) =====
let aiChatHistory = [];

function getToolboxContext() {
  const tabs = document.querySelectorAll('[id^="tab-"]');
  const tabNames = Array.from(tabs).map(t => t.id.replace('tab-', ''));
  const currentTabEl = document.querySelector('.tab-btn.active');
  const currentTab = currentTabEl ? currentTabEl.textContent.trim() : 'unknown';
  return `Kamu adalah AI Assistant pintar yang tertanam di dalam aplikasi web bernama "Toolbox by Adam" ‚Äî sebuah all-in-one toolbox dengan ${tabNames.length} tools lengkap.

TOOLBOX CONTEXT:
- Tab aktif sekarang: ${currentTab}
- Semua tab/tools: ${tabNames.join(', ')}
- Tools tersedia: Text Analyzer, Password Generator, Base64, JSON Formatter, Color Converter, Unit Converter, Hash Generator, Timestamp, Kalkulator (4 mode), Translate (MyMemory), QR Code, Random Generator, Markdown Preview, Regex Tester, Stopwatch & Timer, CSV‚ÜíTabel, Gradient Generator, Minifier, To-Do List, Notepad, Kurs Mata Uang, Cuaca, Image Compressor, Font Preview, Snippet Manager, Aspect Ratio, Mindmap, Morse Code (+ audio), World Clock (15+ kota), Fake Data Indonesia, Palette Extractor, Chart Generator, Enkripsi (Caesar/ROT13/Vigenere/Atbash), ASCII Art, Pomodoro Timer, Text to Speech, OCR (Tesseract.js), Kalkulator Umur, Noise Generator (Web Audio), Glassmorphism Builder, Device Mockup, Konversi Bilangan (Bitwise), Mini Games (Snake/Flappy/2048/Breakout), Auto Bug Scanner, Kalender & Event Planner, Budget Tracker, Habit Tracker, Flashcard Quiz Maker, Video‚ÜíGIF, Meme Generator, BPM Tap Counter, URL+QR Combo.
- Dibuat oleh: Adam (yang ganteng) üëë

KEMAMPUANMU:
1. Jawab pertanyaan apapun secara cerdas dan natural (bahasa Indonesia/Inggris)
2. Bantu user menggunakan tools yang ada
3. Saat user minta "buka tab X", respond dengan instruksi jelas cara navigasinya
4. Analisis masalah/bug dan beri solusi konkret
5. Bantu dengan coding, penulisan, perhitungan, analisis data, dll
6. Beri saran & rekomendasi yang berguna
7. Jika diminta "scan bug" atau "perbaiki toolbox" ‚Äî jalankan scan dengan calling function

ACTIONS yang bisa kamu trigger (tulis dalam format <ACTION:nama_action>):
- <ACTION:open_tab:nama_tab> ‚Äî buka tab tertentu (contoh: <ACTION:open_tab:translate>)
- <ACTION:run_scan> ‚Äî jalankan bug scanner
- <ACTION:generate_password> ‚Äî generate password random
- <ACTION:clear_todos> ‚Äî bersihkan semua todo
- <ACTION:show_tools_list> ‚Äî tampilkan semua tools

Selalu jawab dengan ramah, natural, dan helpful. Kalau bisa, selalu sertakan ACTION yang relevan.`;
}

async function sendAI() {
  const inp = document.getElementById('ai-input');
  const msg = inp.value.trim();
  if (!msg) return;
  inp.value = '';
  inp.style.height = '44px';

  const container = document.getElementById('ai-messages');
  const sendBtn = document.getElementById('ai-send-btn');

  // User message
  container.insertAdjacentHTML('beforeend', `
    <div class="ai-msg ai-user">
      <div class="ai-avatar">üë§</div>
      <div class="ai-bubble">${msg.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')}</div>
    </div>`);

  // Typing indicator
  container.insertAdjacentHTML('beforeend', `
    <div class="ai-msg ai-bot" id="ai-typing-ind">
      <div class="ai-avatar">ü§ñ</div>
      <div class="ai-bubble ai-typing"><span></span><span></span><span></span></div>
    </div>`);
  container.scrollTop = container.scrollHeight;
  if (sendBtn) { sendBtn.disabled = true; sendBtn.textContent = '‚è≥'; }

  // Add to history
  aiChatHistory.push({ role: 'user', content: msg });
  // Keep history to last 10 messages
  if (aiChatHistory.length > 20) aiChatHistory = aiChatHistory.slice(-20);

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: getToolboxContext(),
        messages: aiChatHistory
      })
    });

    const data = await response.json();
    document.getElementById('ai-typing-ind')?.remove();

    let reply = data.content?.[0]?.text || 'Maaf, tidak ada respons dari AI.';

    // Process ACTIONs in reply
    const actionMatches = [...reply.matchAll(/<ACTION:([^>]+)>/g)];
    actionMatches.forEach(m => {
      const action = m[1];
      reply = reply.replace(m[0], ''); // remove tag from display
      setTimeout(() => executeAiAction(action), 500);
    });

    // Format reply
    const formatted = reply.trim()
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/`([^`]+)`/g, '<code style="background:var(--surface2);padding:1px 5px;border-radius:3px;font-size:0.85em;">$1</code>')
      .replace(/\n/g, '<br>');

    container.insertAdjacentHTML('beforeend', `
      <div class="ai-msg ai-bot">
        <div class="ai-avatar">ü§ñ</div>
        <div class="ai-bubble">${formatted}</div>
      </div>`);

    // Add assistant reply to history
    aiChatHistory.push({ role: 'assistant', content: reply.trim() });

  } catch (err) {
    document.getElementById('ai-typing-ind')?.remove();
    // Fallback to local KB
    const fallback = aiLocalFallback(msg);
    container.insertAdjacentHTML('beforeend', `
      <div class="ai-msg ai-bot">
        <div class="ai-avatar">ü§ñ</div>
        <div class="ai-bubble" style="border-color:var(--accent3);">
          ${fallback.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')}
          <div style="font-size:0.68rem;color:var(--muted);margin-top:6px;">‚ö° Mode offline (Claude API tidak terjangkau)</div>
        </div>
      </div>`);
  }

  if (sendBtn) { sendBtn.disabled = false; sendBtn.textContent = '‚û§'; }
  container.scrollTop = container.scrollHeight;
}

function executeAiAction(action) {
  const [cmd, ...args] = action.split(':');
  if (cmd === 'open_tab') {
    const tabName = args[0];
    const btn = document.querySelector(`[onclick*="sw('${tabName}'"]`);
    if (btn) { btn.click(); showNotif(`üìÇ Membuka tab: ${tabName}`); }
  } else if (cmd === 'run_scan') {
    runManualScan();
  } else if (cmd === 'generate_password') {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%';
    const pw = Array(16).fill(0).map(() => chars[Math.floor(Math.random()*chars.length)]).join('');
    const el = document.getElementById('pw-output');
    if (el) { el.childNodes[0].textContent = pw; showNotif('Password dibuat: ' + pw); }
  } else if (cmd === 'show_tools_list') {
    const tabs = document.querySelectorAll('.tab-btn');
    showNotif(`${tabs.length} tools tersedia di toolbar atas!`);
  }
}

function aiLocalFallback(q) {
  const lq = q.toLowerCase();
  if (lq.includes('tools') || lq.includes('fitur') || lq.includes('apa saja')) return 'Toolbox ini punya **53+ tools** lengkap! Scroll tab di atas untuk melihat semua. Mulai dari Text Analyzer, Password Generator, Translator, Games, hingga AI Assistant ini.';
  if (lq.includes('translate') || lq.includes('terjemah')) return 'Klik tab **üåê Translate** ‚Üí pilih bahasa asal & tujuan ‚Üí ketik teks ‚Üí klik Terjemahkan.';
  if (lq.includes('password')) return 'Klik tab **üîê Password** ‚Üí atur panjang & karakter ‚Üí klik Generate ‚Üí Copy.';
  if (lq.includes('game') || lq.includes('snake')) return 'Klik tab **üéÆ Games** ‚Üí pilih Snake/Flappy/2048/Breakout ‚Üí klik ‚ñ∂ Mulai. Snake pakai arrow keys atau WASD.';
  if (lq.includes('bug') || lq.includes('scan') || lq.includes('perbaiki')) { setTimeout(runManualScan, 300); return 'üîç Menjalankan **Auto Bug Scanner**...'; }
  if (lq.includes('halo') || lq.includes('hi') || lq.includes('hello')) return 'Halo! üëã Saya Claude AI. Maaf koneksi API sedang tidak aktif, tapi saya masih bisa bantu dalam mode offline. Tanya tentang cara pakai tools!';
  return 'Maaf, koneksi ke Claude API tidak aktif saat ini. Coba pertanyaan tentang cara pakai tools yang ada di Toolbox, atau klik **Scan Bug** untuk cek kesehatan toolbox!';
}

function aiQuick(q) {
  const inp = document.getElementById('ai-input');
  if (inp) { inp.value = q; sendAI(); }
}

// Update about badge count
document.querySelectorAll('.panel-title').forEach(()=>{});


// ===== CALENDAR =====
let calYear=new Date().getFullYear(), calMonth=new Date().getMonth();
let calSelectedDate=null;
let calEvents=JSON.parse(localStorage.getItem('tb-cal-events')||'{}');
function calNav(d){calMonth+=d;if(calMonth>11){calMonth=0;calYear++;}if(calMonth<0){calMonth=11;calYear--;}calRender();}
function calRender(){
  const months=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
  document.getElementById('cal-title').textContent=`${months[calMonth]} ${calYear}`;
  const first=new Date(calYear,calMonth,1).getDay();
  const days=new Date(calYear,calMonth+1,0).getDate();
  const today=new Date();
  let html='';
  for(let i=0;i<first;i++) html+=`<div style="padding:6px;"></div>`;
  for(let d=1;d<=days;d++){
    const key=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const evs=calEvents[key]||[];
    const isToday=today.getFullYear()===calYear&&today.getMonth()===calMonth&&today.getDate()===d;
    const isSel=calSelectedDate===key;
    const dots=evs.slice(0,3).map(e=>`<div style="width:5px;height:5px;border-radius:50%;background:${e.color||'var(--accent)'};flex-shrink:0;"></div>`).join('');
    html+=`<div onclick="calSelectDay('${key}')" style="padding:6px 4px;text-align:center;border-radius:8px;cursor:pointer;border:1px solid ${isSel?'var(--accent)':'transparent'};background:${isToday?'rgba(124,58,237,0.2)':isSel?'rgba(124,58,237,0.1)':'transparent'};transition:all 0.15s;" onmouseover="this.style.background='rgba(124,58,237,0.08)'" onmouseout="this.style.background='${isToday?'rgba(124,58,237,0.2)':isSel?'rgba(124,58,237,0.1)':'transparent'}'">
      <div style="font-size:0.82rem;font-weight:${isToday?'800':'400'};color:${isToday?'var(--accent2)':'var(--text)'};">${d}</div>
      <div style="display:flex;justify-content:center;gap:2px;margin-top:2px;min-height:5px;">${dots}</div>
    </div>`;
  }
  document.getElementById('cal-grid').innerHTML=html;
  if(calSelectedDate) calShowDayEvents(calSelectedDate);
}
function calSelectDay(key){
  calSelectedDate=key;
  const [y,m,d]=key.split('-');
  document.getElementById('cal-selected-date').textContent=`${d} ${['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'][parseInt(m)-1]} ${y}`;
  calRender();calShowDayEvents(key);
}
function calShowDayEvents(key){
  const evs=calEvents[key]||[];
  const el=document.getElementById('cal-day-events');
  el.innerHTML=evs.length?evs.map((e,i)=>`<div style="background:var(--bg);border-left:3px solid ${e.color||'var(--accent)'};border-radius:0 6px 6px 0;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;">
    <div><div style="font-size:0.82rem;font-weight:600;">${e.title}</div><div style="font-size:0.68rem;color:var(--muted);">${e.time||''} ¬∑ ${e.cat||''}</div></div>
    <button onclick="calDeleteEvent('${key}',${i})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">‚úï</button>
  </div>`).join(''):'<div style="color:var(--muted);font-size:0.78rem;padding:10px 0;">Tidak ada event hari ini</div>';
}
function calAddEvent(){
  if(!calSelectedDate){showNotif('Pilih tanggal dulu!');return;}
  const title=document.getElementById('cal-event-title').value.trim();
  if(!title){showNotif('Isi judul event!');return;}
  if(!calEvents[calSelectedDate]) calEvents[calSelectedDate]=[];
  calEvents[calSelectedDate].push({title,time:document.getElementById('cal-event-time').value,color:document.getElementById('cal-event-color').value,cat:document.getElementById('cal-event-cat').value});
  localStorage.setItem('tb-cal-events',JSON.stringify(calEvents));
  document.getElementById('cal-event-title').value='';
  calRender();showNotif('Event ditambahkan!');
}
function calDeleteEvent(key,i){calEvents[key].splice(i,1);if(!calEvents[key].length)delete calEvents[key];localStorage.setItem('tb-cal-events',JSON.stringify(calEvents));calRender();}
calRender();

// ===== BUDGET TRACKER =====
let bgtData=JSON.parse(localStorage.getItem('tb-budget')||'[]');
let bgtFilterType='all', bgtCurrentType='income';
function setBgtType(t){
  bgtCurrentType=t;
  document.getElementById('bgt-type-in').style.cssText=t==='income'?'flex:1;background:rgba(16,185,129,0.2);border:1px solid var(--success);color:var(--success);':'flex:1;background:var(--surface2);border:1px solid var(--border);color:var(--muted);';
  document.getElementById('bgt-type-out').style.cssText=t==='expense'?'flex:1;background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger);':'flex:1;background:var(--surface2);border:1px solid var(--border);color:var(--muted);';
}
function bgtAdd(){
  const desc=document.getElementById('bgt-desc').value.trim();
  const amount=parseFloat(document.getElementById('bgt-amount').value);
  if(!desc||!amount||amount<=0){showNotif('Isi keterangan dan jumlah!');return;}
  bgtData.unshift({id:Date.now(),type:bgtCurrentType,desc,amount,cat:document.getElementById('bgt-cat').value,date:document.getElementById('bgt-date').value||new Date().toISOString().slice(0,10)});
  localStorage.setItem('tb-budget',JSON.stringify(bgtData));
  document.getElementById('bgt-desc').value='';document.getElementById('bgt-amount').value='';
  bgtRender();showNotif('Transaksi disimpan!');
}
function bgtRender(){
  const inc=bgtData.filter(d=>d.type==='income').reduce((s,d)=>s+d.amount,0);
  const exp=bgtData.filter(d=>d.type==='expense').reduce((s,d)=>s+d.amount,0);
  const bal=inc-exp;
  const fmt=n=>'Rp '+Math.abs(n).toLocaleString('id-ID');
  document.getElementById('bgt-income').textContent=fmt(inc);
  document.getElementById('bgt-expense').textContent=fmt(exp);
  document.getElementById('bgt-balance').textContent=(bal<0?'-':'')+fmt(bal);
  document.getElementById('bgt-balance').style.color=bal>=0?'var(--success)':'var(--danger)';
  const filtered=bgtFilterType==='all'?bgtData:bgtData.filter(d=>d.type===bgtFilterType);
  const catIcons={gaji:'üíº',makanan:'üçî',transport:'üöó',belanja:'üõçÔ∏è',tagihan:'üìÑ',hiburan:'üéÆ',lainnya:'üìå'};
  document.getElementById('bgt-list').innerHTML=filtered.slice(0,50).map(d=>`<div style="display:flex;align-items:center;gap:10px;background:var(--bg);border:1px solid var(--border);border-left:3px solid ${d.type==='income'?'var(--success)':'var(--danger)'};border-radius:0 8px 8px 0;padding:8px 12px;">
    <div style="font-size:1.2rem;">${catIcons[d.cat]||'üìå'}</div>
    <div style="flex:1;"><div style="font-size:0.82rem;">${d.desc}</div><div style="font-size:0.68rem;color:var(--muted);">${d.date}</div></div>
    <div style="font-weight:700;color:${d.type==='income'?'var(--success)':'var(--danger)'};">${d.type==='income'?'+':'-'}${fmt(d.amount)}</div>
    <button onclick="bgtDelete(${d.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">‚úï</button>
  </div>`).join('')||'<div style="color:var(--muted);text-align:center;padding:20px;font-size:0.82rem;">Belum ada transaksi</div>';
  bgtDrawChart();
}
function bgtDrawChart(){
  const canvas=document.getElementById('bgt-chart');if(!canvas)return;
  const ctx=canvas.getContext('2d');const W=canvas.offsetWidth||500,H=120;canvas.width=W;canvas.height=H;
  ctx.fillStyle='var(--bg)';ctx.fillRect(0,0,W,H);
  const last7=[];const today=new Date();
  for(let i=6;i>=0;i--){const d=new Date(today);d.setDate(d.getDate()-i);last7.push(d.toISOString().slice(0,10));}
  const incDay=last7.map(d=>bgtData.filter(t=>t.date===d&&t.type==='income').reduce((s,t)=>s+t.amount,0));
  const expDay=last7.map(d=>bgtData.filter(t=>t.date===d&&t.type==='expense').reduce((s,t)=>s+t.amount,0));
  const max=Math.max(...incDay,...expDay,1);
  const bw=Math.floor((W-40)/7*0.35),gap=Math.floor((W-40)/7);
  last7.forEach((d,i)=>{
    const x=20+i*gap,yBase=H-25;
    const ih=Math.round((incDay[i]/max)*(H-40));
    const eh=Math.round((expDay[i]/max)*(H-40));
    if(ih>0){ctx.fillStyle='rgba(16,185,129,0.7)';ctx.fillRect(x,yBase-ih,bw,ih);}
    if(eh>0){ctx.fillStyle='rgba(239,68,68,0.7)';ctx.fillRect(x+bw+2,yBase-eh,bw,eh);}
    ctx.fillStyle='#6b6b8a';ctx.font='9px Space Mono,monospace';ctx.textAlign='center';
    ctx.fillText(d.slice(5),x+bw/2,H-8);
  });
}
function bgtFilter(t){bgtFilterType=t;bgtRender();}
function bgtDelete(id){bgtData=bgtData.filter(d=>d.id!==id);localStorage.setItem('tb-budget',JSON.stringify(bgtData));bgtRender();}
function bgtClear(){bgtData=[];localStorage.setItem('tb-budget','[]');bgtRender();}
function bgtExport(){
  const csv=['Tanggal,Tipe,Keterangan,Kategori,Jumlah',...bgtData.map(d=>`${d.date},${d.type},"${d.desc}",${d.cat},${d.amount}`)].join('\n');
  const a=document.createElement('a');a.download='budget.csv';a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.click();
}
setBgtType('income');
document.getElementById('bgt-date').value=new Date().toISOString().slice(0,10);
bgtRender();

// ===== HABIT TRACKER =====
let habits=JSON.parse(localStorage.getItem('tb-habits')||'[]');
function habitAdd(){
  const name=document.getElementById('habit-name').value.trim();
  if(!name){showNotif('Isi nama kebiasaan!');return;}
  habits.push({id:Date.now(),name,color:document.getElementById('habit-color').value,icon:document.getElementById('habit-icon').value,checks:{}});
  localStorage.setItem('tb-habits',JSON.stringify(habits));
  document.getElementById('habit-name').value='';
  habitRender();showNotif('Kebiasaan ditambahkan!');
}
function habitToggle(id,date){
  const h=habits.find(h=>h.id===id);if(!h)return;
  h.checks[date]=!h.checks[date];
  localStorage.setItem('tb-habits',JSON.stringify(habits));habitRender();
}
function habitDelete(id){habits=habits.filter(h=>h.id!==id);localStorage.setItem('tb-habits',JSON.stringify(habits));habitRender();}
function habitRender(){
  const list=document.getElementById('habit-list');
  const empty=document.getElementById('habit-empty');
  if(!habits.length){list.innerHTML='';empty.style.display='block';return;}
  empty.style.display='none';
  const today=new Date();
  const days=[];for(let i=29;i>=0;i--){const d=new Date(today);d.setDate(d.getDate()-i);days.push(d.toISOString().slice(0,10));}
  list.innerHTML=habits.map(h=>{
    const streak=()=>{let s=0,d=new Date(today);while(h.checks[d.toISOString().slice(0,10)]){s++;d.setDate(d.getDate()-1);}return s;};
    const pct=Math.round((days.filter(d=>h.checks[d]).length/30)*100);
    const st=streak();
    const boxes=days.map(d=>{
      const isToday=d===today.toISOString().slice(0,10);
      return `<div onclick="habitToggle(${h.id},'${d}')" title="${d}" style="width:14px;height:14px;border-radius:2px;cursor:pointer;background:${h.checks[d]?h.color:'var(--border)'};border:${isToday?'2px solid var(--accent)':'1px solid transparent'};transition:all 0.15s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'"></div>`;
    }).join('');
    return `<div style="background:var(--bg);border:1px solid var(--border);border-left:3px solid ${h.color};border-radius:0 10px 10px 0;padding:12px 16px;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
        <span style="font-size:1.4rem;">${h.icon}</span>
        <div style="flex:1;"><div style="font-weight:700;font-size:0.9rem;">${h.name}</div>
          <div style="font-size:0.7rem;color:var(--muted);">${pct}% bulan ini ¬∑ üî• ${st} hari streak</div>
        </div>
        <button onclick="habitDelete(${h.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;">üóë</button>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:2px;">${boxes}</div>
      <div style="margin-top:8px;background:var(--border);border-radius:3px;height:4px;overflow:hidden;"><div style="height:100%;background:${h.color};width:${pct}%;border-radius:3px;transition:width 0.3s;"></div></div>
    </div>`;
  }).join('');
}
habitRender();

// ===== FLASHCARD =====
let fcCards=JSON.parse(localStorage.getItem('tb-flashcards')||'[]');
let fcStudyCards=[],fcStudyIdx=0,fcStudyFlipped=false;
let fcQuizCards=[],fcQuizIdx=0,fcQuizScore=0,fcQuizTotal=0;
function setFcMode(m){
  ['create','study','quiz'].forEach(id=>{document.getElementById('fc-'+id).style.display='none';document.getElementById('fc-mode-'+id).className='btn btn-secondary';});
  document.getElementById('fc-'+m).style.display='block';document.getElementById('fc-mode-'+m).className='btn btn-primary';
  if(m==='study'||m==='quiz'){fcPopulateDecks();fcStudyInit();}
}
function fcGetDecks(){return [...new Set(fcCards.map(c=>c.deck||'Default'))];}
function fcPopulateDecks(){
  const decks=fcGetDecks();
  ['fc-study-deck','fc-quiz-deck'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=decks.map(d=>`<option>${d}</option>`).join('');});
}
function fcAddCard(){
  const q=document.getElementById('fc-q').value.trim(),a=document.getElementById('fc-a').value.trim(),deck=document.getElementById('fc-deck').value.trim()||'Default';
  if(!q||!a){showNotif('Isi pertanyaan dan jawaban!');return;}
  fcCards.push({id:Date.now(),q,a,deck});localStorage.setItem('tb-flashcards',JSON.stringify(fcCards));
  document.getElementById('fc-q').value='';document.getElementById('fc-a').value='';
  fcRenderCardList();showNotif('Kartu ditambahkan!');
}
function fcRenderCardList(){
  document.getElementById('fc-card-list').innerHTML=fcCards.slice(-10).reverse().map(c=>`<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:10px;">
    <div style="flex:1;"><div style="font-size:0.8rem;font-weight:600;">${c.q.substring(0,60)}</div><div style="font-size:0.7rem;color:var(--muted);">${c.a.substring(0,60)} ¬∑ [${c.deck}]</div></div>
    <button onclick="fcDeleteCard(${c.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;">‚úï</button>
  </div>`).join('')||'<div style="color:var(--muted);font-size:0.78rem;text-align:center;padding:20px;">Belum ada kartu. Tambahkan di atas!</div>';
}
function fcDeleteCard(id){fcCards=fcCards.filter(c=>c.id!==id);localStorage.setItem('tb-flashcards',JSON.stringify(fcCards));fcRenderCardList();}
function fcStudyInit(){
  const deck=document.getElementById('fc-study-deck')?.value;
  let cards=deck?fcCards.filter(c=>c.deck===deck):fcCards;
  fcStudyCards=cards.sort(()=>Math.random()-0.5);fcStudyIdx=0;fcStudyFlipped=false;fcStudyRender();
}
function fcStudyRender(){
  if(!fcStudyCards.length){document.getElementById('fc-flip-content').textContent='Belum ada kartu. Buat dulu di tab "Buat Kartu"!';document.getElementById('fc-study-progress').textContent='';return;}
  const c=fcStudyCards[fcStudyIdx];
  document.getElementById('fc-flip-content').textContent=fcStudyFlipped?c.a:c.q;
  document.getElementById('fc-flip-card').style.background=fcStudyFlipped?'rgba(6,182,212,0.1)':'var(--bg)';
  document.getElementById('fc-flip-card').style.borderColor=fcStudyFlipped?'var(--accent2)':'var(--border)';
  document.getElementById('fc-study-progress').textContent=`${fcStudyIdx+1} / ${fcStudyCards.length}`;
}
function fcFlip(){fcStudyFlipped=!fcStudyFlipped;fcStudyRender();}
function fcStudyNav(d){fcStudyIdx=(fcStudyIdx+d+fcStudyCards.length)%fcStudyCards.length;fcStudyFlipped=false;fcStudyRender();}
function fcQuizStart(){
  const deck=document.getElementById('fc-quiz-deck')?.value;
  let cards=deck?fcCards.filter(c=>c.deck===deck):fcCards;
  fcQuizCards=cards.sort(()=>Math.random()-0.5);fcQuizIdx=0;fcQuizScore=0;fcQuizTotal=fcQuizCards.length;
  document.getElementById('fc-quiz-setup').style.display='none';document.getElementById('fc-quiz-play').style.display='block';
  fcQuizRender();
}
function fcQuizRender(){
  if(fcQuizIdx>=fcQuizCards.length){
    document.getElementById('fc-quiz-q').innerHTML=`<div style="color:var(--success);font-size:1.2rem;font-weight:700;">üéâ Selesai! Skor: ${fcQuizScore}/${fcQuizTotal}</div>`;
    document.getElementById('fc-quiz-feedback').textContent='';
    document.getElementById('fc-quiz-score').textContent='';
    document.getElementById('fc-quiz-ans').style.display='none';
    return;
  }
  document.getElementById('fc-quiz-q').textContent=fcQuizCards[fcQuizIdx].q;
  document.getElementById('fc-quiz-ans').value='';document.getElementById('fc-quiz-feedback').textContent='';
  document.getElementById('fc-quiz-score').textContent=`Skor: ${fcQuizScore}/${fcQuizTotal} | Soal ${fcQuizIdx+1}/${fcQuizCards.length}`;
}
function fcQuizCheck(){
  const ans=document.getElementById('fc-quiz-ans').value.trim().toLowerCase();
  const correct=fcQuizCards[fcQuizIdx].a.trim().toLowerCase();
  const ok=ans===correct||correct.includes(ans)&&ans.length>3;
  document.getElementById('fc-quiz-feedback').innerHTML=ok?`<span style="color:var(--success);">‚úÖ Benar!</span>`:`<span style="color:var(--danger);">‚ùå Salah. Jawaban: <strong>${fcQuizCards[fcQuizIdx].a}</strong></span>`;
  if(ok) fcQuizScore++;
  setTimeout(()=>{fcQuizIdx++;fcQuizRender();},1200);
}
function fcQuizSkip(){fcQuizIdx++;fcQuizRender();}
fcRenderCardList();

// ===== VIDEO TO GIF =====
let vgVideoFile=null,vgGifBlob=null;
function vgDrop(e){e.preventDefault();const f=e.dataTransfer.files[0];if(f&&f.type.startsWith('video/'))vgLoadFile(f);}
function vgLoad(inp){if(inp.files[0])vgLoadFile(inp.files[0]);}
function vgLoadFile(file){
  vgVideoFile=file;
  const url=URL.createObjectURL(file);
  const vid=document.getElementById('vg-video');vid.src=url;
  document.getElementById('vg-drop').style.display='none';document.getElementById('vg-controls').style.display='block';
  vid.onloadedmetadata=()=>{
    const dur=Math.min(vid.duration,30);
    ['vg-start','vg-end'].forEach(id=>document.getElementById(id).max=dur);
    document.getElementById('vg-end').value=Math.min(5,dur);
    document.getElementById('vg-end-v').textContent=Math.min(5,dur).toFixed(1);
  };
}
async function vgConvert(){
  const vid=document.getElementById('vg-video');
  const start=parseFloat(document.getElementById('vg-start').value)||0;
  const end=parseFloat(document.getElementById('vg-end').value)||5;
  const fps=parseInt(document.getElementById('vg-fps').value)||10;
  const width=parseInt(document.getElementById('vg-w').value)||320;
  const dur=end-start;if(dur<=0){showNotif('End harus lebih besar dari start!');return;}
  const btn=document.getElementById('vg-btn');btn.disabled=true;
  document.getElementById('vg-progress').style.display='block';
  document.getElementById('vg-result').style.display='none';
  const totalFrames=Math.ceil(dur*fps);
  const c=document.createElement('canvas');
  const aspect=vid.videoHeight/vid.videoWidth;
  c.width=width;c.height=Math.round(width*aspect);
  const ctx=c.getContext('2d');
  // Use GIF.js-style simple approach: capture frames as data URLs then use canvas animation
  const frames=[];
  for(let i=0;i<totalFrames;i++){
    const t=start+(i/fps);
    await new Promise(r=>{vid.currentTime=t;vid.onseeked=r;});
    ctx.drawImage(vid,0,0,c.width,c.height);
    frames.push(c.toDataURL('image/jpeg',0.7));
    const pct=Math.round((i/totalFrames)*80);
    document.getElementById('vg-prog-bar').style.width=pct+'%';
    document.getElementById('vg-prog-text').textContent=`Capturing frame ${i+1}/${totalFrames}...`;
    await new Promise(r=>setTimeout(r,20));
  }
  // Build animated WebP-like via canvas cycling + create GIF data
  // Simple approach: create animated GIF via native APIs not available,
  // so we create an animated canvas preview + offer frame-by-frame download
  document.getElementById('vg-prog-bar').style.width='100%';
  document.getElementById('vg-prog-text').textContent=`‚úÖ ${totalFrames} frames siap! Menampilkan preview animasi...`;
  // Display as animated canvas preview
  const result=document.getElementById('vg-result');
  const gifCanvas=document.getElementById('vg-gif');
  if(gifCanvas.tagName==='IMG'){
    // Replace img with canvas for animation
    const ac=document.createElement('canvas');
    ac.id='vg-gif';ac.style.cssText=gifCanvas.style.cssText;
    gifCanvas.replaceWith(ac);
  }
  const ac=document.getElementById('vg-gif');
  ac.width=c.width;ac.height=c.height;
  const acx=ac.getContext('2d');
  let fi=0;
  const animInterval=setInterval(()=>{const img=new Image();img.onload=()=>acx.drawImage(img,0,0);img.src=frames[fi];fi=(fi+1)%frames.length;},1000/fps);
  ac._animInterval=animInterval;
  // Store frames for download
  vgGifBlob={frames,fps,w:c.width,h:c.height};
  result.style.display='block';
  btn.disabled=false;
  showNotif('Konversi selesai! Preview animasi aktif.');
}
function vgDownload(){
  if(!vgGifBlob){showNotif('Convert video dulu!');return;}
  // Create a WebM video blob from frames using MediaRecorder (if available)
  // Fallback: download first frame as PNG
  const c=document.createElement('canvas');c.width=vgGifBlob.w;c.height=vgGifBlob.h;
  const ctx=c.getContext('2d');
  const img=new Image();img.onload=()=>{ctx.drawImage(img,0,0);c.toBlob(blob=>{const a=document.createElement('a');a.download='video-preview.png';a.href=URL.createObjectURL(blob);a.click();showNotif('Preview frame didownload (format PNG)');},'image/png');};
  img.src=vgGifBlob.frames[0];
}
function vgReset(){vgVideoFile=null;vgGifBlob=null;const ac=document.getElementById('vg-gif');if(ac&&ac._animInterval)clearInterval(ac._animInterval);document.getElementById('vg-drop').style.display='block';document.getElementById('vg-controls').style.display='none';document.getElementById('vg-file').value='';}

// ===== MEME GENERATOR =====
const MEME_TEMPLATES=[
  {name:'Drake',emoji:'üï∫',bg:'#1a1a2e',w:500,h:500},
  {name:'Distracted BF',emoji:'üëÄ',bg:'#2d1b00',w:600,h:400},
  {name:'This is Fine',emoji:'üî•',bg:'#1a1000',w:500,h:400},
  {name:'Expanding Brain',emoji:'üß†',bg:'#0a0a0f',w:500,h:600},
  {name:'Change My Mind',emoji:'üí¨',bg:'#0a1a2e',w:600,h:400},
  {name:'Blank White',emoji:'‚¨ú',bg:'#ffffff',w:500,h:300},
];
let memeImg=null;
function memeInitTemplates(){
  document.getElementById('meme-templates').innerHTML=MEME_TEMPLATES.map((t,i)=>`<div onclick="memeSelectTemplate(${i})" style="background:${t.bg};border:1px solid var(--border);border-radius:6px;padding:8px 4px;text-align:center;cursor:pointer;font-size:1.6rem;" title="${t.name}">${t.emoji}</div>`).join('');
}
function memeSelectTemplate(i){
  const t=MEME_TEMPLATES[i];
  const c=document.getElementById('meme-canvas');c.width=t.w;c.height=t.h;
  const ctx=c.getContext('2d');ctx.fillStyle=t.bg;ctx.fillRect(0,0,t.w,t.h);
  // Draw template background pattern
  ctx.fillStyle=t.bg==='#ffffff'?'rgba(0,0,0,0.05)':'rgba(255,255,255,0.03)';
  for(let x=0;x<t.w;x+=40)for(let y=0;y<t.h;y+=40){ctx.fillRect(x,y,20,20);}
  // Template label
  ctx.fillStyle=t.bg==='#ffffff'?'#999':'rgba(255,255,255,0.2)';
  ctx.font='bold 48px serif';ctx.textAlign='center';ctx.fillText(t.emoji,t.w/2,t.h/2+16);
  ctx.font='14px Space Mono,monospace';ctx.fillStyle=t.bg==='#ffffff'?'#aaa':'rgba(255,255,255,0.3)';
  ctx.fillText(t.name,t.w/2,t.h/2+44);
  memeImg=c.toDataURL();drawMeme();
}
function memeLoadFile(inp){
  if(!inp.files[0]) return;
  const reader=new FileReader();
  reader.onload=e=>{memeImg=e.target.result;drawMeme();};
  reader.readAsDataURL(inp.files[0]);
}
function drawMeme(){
  const c=document.getElementById('meme-canvas');
  const ctx=c.getContext('2d');
  const top=document.getElementById('meme-top').value;
  const bot=document.getElementById('meme-bottom').value;
  const fs=parseInt(document.getElementById('meme-fs').value)||40;
  const color=document.getElementById('meme-color').value;
  const stroke=document.getElementById('meme-stroke').value;
  if(memeImg){
    const img=new Image();
    img.onload=()=>{
      c.width=img.width;c.height=img.height;
      ctx.drawImage(img,0,0);
      drawMemeText(ctx,c.width,c.height,top,bot,fs,color,stroke);
    };img.src=memeImg;
  } else {
    if(!c.width) {c.width=500;c.height=300;}
    ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='rgba(255,255,255,0.2)';ctx.font='bold 48px serif';ctx.textAlign='center';
    ctx.fillText('üì∑',c.width/2,c.height/2+16);
    ctx.fillStyle='rgba(255,255,255,0.3)';ctx.font='14px Space Mono,monospace';ctx.fillText('Upload gambar atau pilih template',c.width/2,c.height/2+48);
    drawMemeText(ctx,c.width,c.height,top,bot,fs,color,stroke);
  }
}
function drawMemeText(ctx,W,H,top,bot,fs,color,stroke){
  ctx.font=`bold ${fs}px Impact,Arial Black,sans-serif`;
  ctx.textAlign='center';
  function drawText(text,y){
    ctx.strokeStyle=stroke;ctx.lineWidth=fs/8;ctx.strokeText(text,W/2,y);
    ctx.fillStyle=color;ctx.fillText(text,W/2,y);
  }
  if(top) drawText(top.toUpperCase(),fs+8);
  if(bot) drawText(bot.toUpperCase(),H-12);
}
function memeDownload(){
  const c=document.getElementById('meme-canvas');
  const a=document.createElement('a');a.download='meme.png';a.href=c.toDataURL('image/png');a.click();
}
memeInitTemplates();drawMeme();

// ===== BPM TAP COUNTER =====
let bpmTaps=[],bpmResetTimer=null;
const bpmGenres=[[0,'‚Äî'],[40,'Grave (sangat lambat)'],[60,'Largo'],[66,'Larghetto'],[76,'Andante'],[108,'Moderato'],[120,'Allegro'],[156,'Vivace'],[176,'Presto'],[200,'Prestissimo (sangat cepat)']];
function bpmTap(){
  const now=Date.now();
  bpmTaps.push(now);
  // Hapus tap yang > 3 detik lalu
  bpmTaps=bpmTaps.filter(t=>now-t<3000);
  clearTimeout(bpmResetTimer);
  bpmResetTimer=setTimeout(bpmReset,4000);
  if(bpmTaps.length>=2){
    const intervals=[];for(let i=1;i<bpmTaps.length;i++)intervals.push(bpmTaps[i]-bpmTaps[i-1]);
    const avg=intervals.reduce((a,b)=>a+b,0)/intervals.length;
    const bpm=Math.round(60000/avg);
    document.getElementById('bpm-display').textContent=bpm;
    document.getElementById('bpm-display').style.color=bpm<60?'var(--accent2)':bpm<120?'var(--success)':bpm<160?'var(--accent3)':'var(--danger)';
    const allBpms=bpmTaps.length>=2?bpmTaps.slice(1).map((_,i)=>Math.round(60000/(bpmTaps[i+1]-bpmTaps[i]))):[];
    document.getElementById('bpm-min').textContent=allBpms.length?Math.min(...allBpms):'--';
    document.getElementById('bpm-max').textContent=allBpms.length?Math.max(...allBpms):'--';
    const genre=bpmGenres.filter(([b])=>b<=bpm).pop();
    document.getElementById('bpm-genre').textContent=genre?`‚ô© ${genre[1]}`:'';
    bpmDrawViz(allBpms);
  }
  document.getElementById('bpm-taps').textContent=bpmTaps.length;
  document.getElementById('bpm-label').textContent=bpmTaps.length<2?`${bpmTaps.length} tap...`:`${bpmTaps.length} taps`;
  // Flash effect
  const btn=document.getElementById('bpm-btn');
  btn.style.boxShadow='0 0 40px rgba(6,182,212,0.8)';
  setTimeout(()=>btn.style.boxShadow='0 8px 32px rgba(124,58,237,0.4)',150);
}
function bpmDrawViz(bpms){
  const c=document.getElementById('bpm-viz');if(!c)return;
  const ctx=c.getContext('2d');ctx.clearRect(0,0,c.width,c.height);
  if(bpms.length<2)return;
  ctx.fillStyle='rgba(124,58,237,0.1)';ctx.fillRect(0,0,c.width,c.height);
  const max=Math.max(...bpms)*1.1,min=Math.min(...bpms)*0.9;
  ctx.beginPath();
  bpms.forEach((b,i)=>{const x=i/(bpms.length-1)*c.width,y=c.height-(b-min)/(max-min||1)*(c.height-10)-5;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.strokeStyle='var(--accent2)';ctx.lineWidth=2;ctx.stroke();
}
function bpmReset(){bpmTaps=[];document.getElementById('bpm-display').textContent='--';document.getElementById('bpm-taps').textContent='0';document.getElementById('bpm-min').textContent='--';document.getElementById('bpm-max').textContent='--';document.getElementById('bpm-label').textContent='Tap untuk mulai';document.getElementById('bpm-genre').textContent='';}
function bpmSetManual(bpm){document.getElementById('bpm-display').textContent=bpm;const genre=bpmGenres.filter(([b])=>b<=bpm).pop();document.getElementById('bpm-genre').textContent=genre?`‚ô© ${genre[1]}`:'';document.getElementById('bpm-label').textContent='Manual';}
document.addEventListener('keydown',e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return; if(e.code==='Space'&&document.getElementById('tab-bpm')?.classList.contains('active')){e.preventDefault();bpmTap();}});

// ===== URL SHORTENER + QR COMBO =====
let uqHistory=JSON.parse(localStorage.getItem('tb-uq-history')||'[]');
let uqShortUrl='';
function uqAnalyze(){
  const url=document.getElementById('uq-input').value.trim();
  if(!url) return;
}
async function uqProcess(){
  const url=document.getElementById('uq-input').value.trim();
  if(!url){showNotif('Masukkan URL!');return;}
  document.getElementById('uq-result').style.display='block';
  // Analyze URL
  try{
    const u=new URL(url.startsWith('http')?url:'https://'+url);
    const params=[...u.searchParams.entries()];
    document.getElementById('uq-analysis').innerHTML=`
      <div>üåê <strong>Domain:</strong> ${u.hostname}</div>
      <div>üìÅ <strong>Path:</strong> ${u.pathname||'/'}</div>
      <div>üîí <strong>Protokol:</strong> ${u.protocol.replace(':','')}</div>
      ${params.length?`<div>‚öôÔ∏è <strong>Parameter:</strong> ${params.map(([k,v])=>`${k}=${v}`).join(', ')}</div>`:''}
      <div>üìè <strong>Panjang URL:</strong> ${url.length} karakter</div>
    `;
  } catch(e){
    document.getElementById('uq-analysis').innerHTML=`<div style="color:var(--danger)">‚ö† URL tidak valid: ${e.message}</div>`;
  }
  // Generate short URL via TinyURL API
  const shortEl=document.getElementById('uq-short');
  shortEl.textContent='Mempersingkat URL...';
  try{
    const resp=await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}`);
    if(resp.ok){
      uqShortUrl=await resp.text();
      shortEl.innerHTML=`<a href="${uqShortUrl}" target="_blank" style="color:var(--accent2);">${uqShortUrl}</a>`;
      // Save to history
      uqHistory.unshift({original:url,short:uqShortUrl,date:new Date().toISOString().slice(0,10)});
      uqHistory=uqHistory.slice(0,20);
      localStorage.setItem('tb-uq-history',JSON.stringify(uqHistory));
      uqRenderHistory();
    } else throw new Error('API error');
  } catch(e){
    uqShortUrl=url;
    shortEl.textContent='‚ö† Tidak bisa memperpendek (offline/CORS) ‚Äî menggunakan URL asli';
  }
  // Generate QR
  const qrCanvas=document.getElementById('uq-qr');
  qrCanvas.width=180;qrCanvas.height=180;
  try{
    if(window.QRCode){
      const ctx=qrCanvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,180,180);
      new QRCode(qrCanvas,{text:uqShortUrl||url,width:180,height:180});
    } else {
      const ctx=qrCanvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,180,180);
      ctx.fillStyle='#333';ctx.font='12px monospace';ctx.textAlign='center';ctx.fillText('QR Canvas',90,90);
    }
  } catch(e){}
  showNotif('URL diproses!');
}
function uqCopyShort(){navigator.clipboard.writeText(uqShortUrl).then(()=>showNotif('URL pendek disalin!'));}
function uqDownloadQR(){const c=document.getElementById('uq-qr');const a=document.createElement('a');a.download='qr.png';a.href=c.toDataURL();a.click();}
function uqRenderHistory(){
  document.getElementById('uq-history').innerHTML=uqHistory.map(h=>`<div style="font-size:0.72rem;padding:4px 0;border-bottom:1px solid var(--border);">
    <div style="color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${h.original.substring(0,40)}${h.original.length>40?'...':''}</div>
    <div style="color:var(--accent2);cursor:pointer;" onclick="navigator.clipboard.writeText('${h.short}').then(()=>showNotif('Disalin!'))">${h.short} ¬∑ ${h.date}</div>
  </div>`).join('')||'<div style="color:var(--muted);">Belum ada riwayat</div>';
}
uqRenderHistory();

// ===== AI AUTO BUG SCANNER =====
let aiScannerInterval=null, scanCount=0, lastScanTime=null;

// Daftar pengecekan yang bisa dilakukan
// ===== COMPREHENSIVE BUG CHECKS ‚Äî semua 53 fitur =====
function chkEl(ids){const m=ids.filter(id=>!document.getElementById(id));return m.length?{ok:false,msg:`Elemen hilang: ${m.join(', ')}`}:{ok:true,msg:`${ids.length} elemen OK`};}
function chkFn(names){const m=names.filter(n=>typeof window[n]!=='function');return m.length?{ok:false,msg:`Fungsi tidak ada: ${m.join(', ')}`}:{ok:true,msg:`${names.length} fungsi OK`};}


// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üé® SVG EDITOR                                               ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
(function() {
  let svgTool = 'rect';
  let svgShapes = [];
  let svgSelected = null;
  let svgDragging = false;
  let svgDrawing = false;
  let svgStart = {x:0,y:0};
  let svgColor = '#7c3aed';
  let svgStroke = '#06b6d4';
  let svgStrokeW = 2;
  let svgFontSize = 18;
  let svgPath = [];
  let svgInitDone = false;

  function svgGetCanvas() { return document.getElementById('svg-canvas'); }

  function svgInit() {
    if(svgInitDone) return;
    const canvas = svgGetCanvas(); if(!canvas) return;
    svgInitDone = true;
    canvas.addEventListener('mousedown', svgOnDown);
    canvas.addEventListener('mousemove', svgOnMove);
    canvas.addEventListener('mouseup', svgOnUp);
    canvas.addEventListener('touchstart', e=>{ e.preventDefault(); const t=e.touches[0],r=canvas.getBoundingClientRect(); svgOnDown({clientX:t.clientX,clientY:t.clientY,target:canvas,r}); },{passive:false});
    canvas.addEventListener('touchmove', e=>{ e.preventDefault(); const t=e.touches[0]; svgOnMove({clientX:t.clientX,clientY:t.clientY}); },{passive:false});
    canvas.addEventListener('touchend', e=>{ e.preventDefault(); svgOnUp(e); },{passive:false});
    svgRender();
  }
  window.svgInit = svgInit;

  function svgPt(e) {
    const r = svgGetCanvas().getBoundingClientRect();
    const scaleX = parseFloat(svgGetCanvas().getAttribute('width')) / r.width;
    const scaleY = parseFloat(svgGetCanvas().getAttribute('height')) / r.height;
    return { x: (e.clientX - r.left) * scaleX, y: (e.clientY - r.top) * scaleY };
  }

  function svgOnDown(e) {
    const {x,y} = svgPt(e);
    svgStart = {x,y};
    if(svgTool === 'select') {
      // Hit test
      svgSelected = null;
      for(let i=svgShapes.length-1;i>=0;i--) {
        const s=svgShapes[i];
        if(s.type==='rect'&&x>=s.x&&x<=s.x+s.w&&y>=s.y&&y<=s.y+s.h){svgSelected=i;break;}
        if(s.type==='circle'&&Math.hypot(x-s.cx,y-s.cy)<=s.r){svgSelected=i;break;}
        if(s.type==='line'&&Math.abs(x-(s.x1+s.x2)/2)<20&&Math.abs(y-(s.y1+s.y2)/2)<20){svgSelected=i;break;}
        if(s.type==='text'&&x>=s.x&&x<=s.x+s.w&&y>=s.y-s.fs&&y<=s.y){svgSelected=i;break;}
      }
      svgDragging = svgSelected !== null;
      svgRender();
      return;
    }
    if(svgTool==='text') {
      const txt = prompt('Teks:','Hello'); if(!txt) return;
      svgShapes.push({type:'text',x,y,text:txt,fill:svgColor,fs:svgFontSize,w:txt.length*svgFontSize*0.6});
      svgRender(); return;
    }
    if(svgTool==='path') {
      svgPath = [{x,y}];
      svgDrawing = true;
      return;
    }
    svgDrawing = true;
  }

  function svgOnMove(e) {
    if(!svgDrawing && !svgDragging) return;
    const {x,y} = svgPt(e);
    if(svgDragging && svgSelected!==null) {
      const dx=x-svgStart.x, dy=y-svgStart.y;
      const s=svgShapes[svgSelected];
      if(s.type==='rect'){s.x+=dx;s.y+=dy;}
      else if(s.type==='circle'){s.cx+=dx;s.cy+=dy;}
      else if(s.type==='line'){s.x1+=dx;s.y1+=dy;s.x2+=dx;s.y2+=dy;}
      else if(s.type==='text'){s.x+=dx;s.y+=dy;}
      else if(s.type==='path'){s.pts=s.pts.map(p=>({x:p.x+dx,y:p.y+dy}));}
      svgStart={x,y};
    }
    if(svgTool==='path'&&svgDrawing) {
      svgPath.push({x,y});
    }
    svgRender(x,y);
  }

  function svgOnUp(e) {
    if(svgTool==='path'&&svgDrawing&&svgPath.length>1) {
      svgShapes.push({type:'path',pts:[...svgPath],fill:'none',stroke:svgStroke,sw:svgStrokeW});
      svgPath=[];
    } else if(svgDrawing) {
      const {x,y}=svgTool==='path'?svgStart:svgPt(e||{clientX:svgStart.x,clientY:svgStart.y});
      const px=svgPt(e||{clientX:0,clientY:0});
      const ex=px.x, ey=px.y;
      const x1=Math.min(svgStart.x,ex),y1=Math.min(svgStart.y,ey);
      const w=Math.abs(ex-svgStart.x),h=Math.abs(ey-svgStart.y);
      if(svgTool==='rect'&&(w>4||h>4)) svgShapes.push({type:'rect',x:x1,y:y1,w,h,fill:svgColor,stroke:svgStroke,sw:svgStrokeW,rx:4});
      else if(svgTool==='circle'&&(w>4||h>4)) svgShapes.push({type:'circle',cx:svgStart.x+(ex-svgStart.x)/2,cy:svgStart.y+(ey-svgStart.y)/2,r:Math.max(w,h)/2,fill:svgColor,stroke:svgStroke,sw:svgStrokeW});
      else if(svgTool==='line') svgShapes.push({type:'line',x1:svgStart.x,y1:svgStart.y,x2:ex,y2:ey,stroke:svgStroke,sw:svgStrokeW});
    }
    svgDrawing=false; svgDragging=false;
    svgRender();
  }

  function svgOnUpWrapper(e) {
    if(!svgDrawing && !svgDragging) return;
    const {x,y}=svgPt(e);
    svgOnUp({clientX:e.clientX,clientY:e.clientY});
    // Recalc for final position
    if(svgTool==='rect'||svgTool==='circle'||svgTool==='line') {
      const x1=Math.min(svgStart.x,x),y1=Math.min(svgStart.y,y);
      const w=Math.abs(x-svgStart.x),h=Math.abs(y-svgStart.y);
      if(svgShapes.length&&svgTool==='rect') { const s=svgShapes[svgShapes.length-1]; s.x=x1;s.y=y1;s.w=w;s.h=h; }
      if(svgShapes.length&&svgTool==='circle') { const s=svgShapes[svgShapes.length-1]; s.cx=svgStart.x+(x-svgStart.x)/2;s.cy=svgStart.y+(y-svgStart.y)/2;s.r=Math.max(w,h)/2; }
      if(svgShapes.length&&svgTool==='line') { const s=svgShapes[svgShapes.length-1]; s.x2=x;s.y2=y; }
    }
    svgRender();
  }

  function svgRender(curX,curY) {
    const canvas = svgGetCanvas(); if(!canvas) return;
    const W = parseFloat(canvas.getAttribute('width')), H = parseFloat(canvas.getAttribute('height'));
    let html = '';
    for(let i=0;i<svgShapes.length;i++) {
      const s=svgShapes[i], sel=i===svgSelected;
      const selStyle = sel?`stroke-dasharray="4" opacity="0.8"`:'';
      if(s.type==='rect') html+=`<rect x="${s.x}" y="${s.y}" width="${Math.max(1,s.w)}" height="${Math.max(1,s.h)}" rx="${s.rx||0}" fill="${s.fill}" stroke="${sel?'#fff':s.stroke}" stroke-width="${sel?3:s.sw}" ${selStyle}/>`;
      else if(s.type==='circle') html+=`<circle cx="${s.cx}" cy="${s.cy}" r="${Math.max(1,s.r)}" fill="${s.fill}" stroke="${sel?'#fff':s.stroke}" stroke-width="${sel?3:s.sw}" ${selStyle}/>`;
      else if(s.type==='line') html+=`<line x1="${s.x1}" y1="${s.y1}" x2="${s.x2}" y2="${s.y2}" stroke="${sel?'#fff':s.stroke}" stroke-width="${sel?3:s.sw}" ${selStyle}/>`;
      else if(s.type==='text') html+=`<text x="${s.x}" y="${s.y}" fill="${s.fill}" font-size="${s.fs}" font-family="Space Mono,monospace" ${sel?'text-decoration="underline"':''}>${s.text}</text>`;
      else if(s.type==='path') { const d='M'+s.pts.map(p=>`${p.x},${p.y}`).join('L'); html+=`<path d="${d}" fill="${s.fill||'none'}" stroke="${sel?'#fff':s.stroke}" stroke-width="${sel?3:s.sw}" stroke-linecap="round" stroke-linejoin="round" ${selStyle}/>`; }
    }
    // Preview shape while drawing
    if(svgDrawing && curX!==undefined && svgTool!=='path'&&svgTool!=='text'&&svgTool!=='select') {
      const x1=Math.min(svgStart.x,curX),y1=Math.min(svgStart.y,curY);
      const w=Math.abs(curX-svgStart.x),h=Math.abs(curY-svgStart.y);
      if(svgTool==='rect') html+=`<rect x="${x1}" y="${y1}" width="${w}" height="${h}" fill="${svgColor}44" stroke="${svgStroke}" stroke-width="${svgStrokeW}" stroke-dasharray="4"/>`;
      else if(svgTool==='circle') html+=`<circle cx="${svgStart.x+(curX-svgStart.x)/2}" cy="${svgStart.y+(curY-svgStart.y)/2}" r="${Math.max(w,h)/2}" fill="${svgColor}44" stroke="${svgStroke}" stroke-width="${svgStrokeW}" stroke-dasharray="4"/>`;
      else if(svgTool==='line') html+=`<line x1="${svgStart.x}" y1="${svgStart.y}" x2="${curX}" y2="${curY}" stroke="${svgStroke}" stroke-width="${svgStrokeW}" stroke-dasharray="4"/>`;
    }
    if(svgTool==='path'&&svgPath.length>1) {
      const d='M'+svgPath.map(p=>`${p.x},${p.y}`).join('L');
      html+=`<path d="${d}" fill="none" stroke="${svgStroke}" stroke-width="${svgStrokeW}" stroke-linecap="round" stroke-linejoin="round"/>`;
    }
    canvas.innerHTML = html;
  }

  // Expose global functions
  window.svgSetTool = function(t) {
    svgTool=t; svgSelected=null;
    document.querySelectorAll('[id^="svg-tool-"]').forEach(b=>b.className='btn btn-secondary');
    const active=document.getElementById('svg-tool-'+t); if(active) active.className='btn btn-primary';
    svgGetCanvas().style.cursor = t==='select'?'default':t==='text'?'text':'crosshair';
    svgRender();
  };

  window.svgSetColor = function(type,val) {
    if(type==='fill') svgColor=val;
    else svgStroke=val;
    if(svgSelected!==null&&svgShapes[svgSelected]) {
      if(type==='fill') svgShapes[svgSelected].fill=val;
      else svgShapes[svgSelected].stroke=val;
      svgRender();
    }
  };

  window.svgDeleteSelected = function() {
    if(svgSelected===null) return;
    svgShapes.splice(svgSelected,1);
    svgSelected=null; svgRender();
  };

  window.svgClearAll = function() {
    if(confirm('Hapus semua shapes?')) { svgShapes=[]; svgSelected=null; svgRender(); }
  };

  window.svgUndo = function() {
    svgShapes.pop(); svgSelected=null; svgRender();
  };

  window.svgResize = function() {
    const w=document.getElementById('svg-canvas-w')?.value||600;
    const h=document.getElementById('svg-canvas-h')?.value||400;
    const c=svgGetCanvas(); if(c){c.setAttribute('width',w);c.setAttribute('height',h);}
    svgRender();
  };

  window.svgExportSVG = function() {
    const c=svgGetCanvas(); if(!c) return;
    const W=c.getAttribute('width'), H=c.getAttribute('height');
    const svgContent=`<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" style="background:#1c1c28">${c.innerHTML}</svg>`;
    const a=document.createElement('a'); a.href='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svgContent);
    a.download='drawing.svg'; a.click(); showNotif('üíæ SVG tersimpan!');
  };

  window.svgExportPNG = function() {
    const c=svgGetCanvas(); if(!c) return;
    const W=parseFloat(c.getAttribute('width')), H=parseFloat(c.getAttribute('height'));
    const svgContent=`<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" style="background:#1c1c28">${c.innerHTML}</svg>`;
    const img=new Image(); img.src='data:image/svg+xml;base64,'+btoa(svgContent);
    img.onload=()=>{ const cv=document.createElement('canvas');cv.width=W;cv.height=H;cv.getContext('2d').drawImage(img,0,0);const a=document.createElement('a');a.href=cv.toDataURL('image/png');a.download='drawing.png';a.click();showNotif('üñºÔ∏è PNG tersimpan!'); };
  };

  // Initialize when tab opens
  document.addEventListener('DOMContentLoaded', ()=>{ setTimeout(svgInit, 500); });
})();

const BUG_CHECKS=[
// ‚îÄ‚îÄ SISTEM & INFRASTRUKTUR ‚îÄ‚îÄ
{id:'tabs-all',name:'Semua Tab Panel (81)',check:()=>{
  const all=['text','password','base64','json','color','unit','hash','time','calc','translate','qr','random','markdown','regex','timer','csv','gradient','minifier','todo','notepad','currency','weather','imgcomp','fontprev','snippet','aspect','mindmap','morse','worldclock','fakedata','palette','chartgen','cipher','ascii','pomodoro','tts','ocr','ageCalc','noise','glass','mockup','numSys','games','aihelp','about','calendar','budget','habit','flashcard','videogif','meme','bpm','urlqr','theme','reminder','dashboard','i18n','share','settings','plugins','audioviz','annotator','vault','formula','summarizer','emailtpl','focus','dataviz','imgEditor','resume','biolink','svgEditor','aiwriting','aicode','aitranslator','aigoal','expenseTracker','apiTester','playlist','weeklyPlanner'];
  const missing=all.filter(id=>!document.getElementById('tab-'+id));
  return missing.length?{ok:false,msg:`Tab hilang (${missing.length}): ${missing.join(', ')}`}:{ok:true,msg:`Semua ${all.length} tab ada ‚úì`};
},fix:null},
{id:'dup-ids',name:'Cek Duplikasi ID Elemen',check:()=>{
  const all=document.querySelectorAll('[id]');
  const seen={},dups=[];
  all.forEach(el=>{if(seen[el.id])dups.push(el.id);seen[el.id]=true;});
  const uniq=[...new Set(dups)];
  return uniq.length?{ok:false,msg:`ID duplikat (${uniq.length}): ${uniq.slice(0,8).join(', ')}`}:{ok:true,msg:'Tidak ada ID duplikat ‚úì'};
},fix:null},
{id:'tab-buttons',name:'Tab Navigation Buttons',check:()=>{
  const btns=document.querySelectorAll('.tab-btn');
  if(btns.length<50) return {ok:false,msg:`Hanya ${btns.length} tab button, kemungkinan ada yg hilang`};
  return {ok:true,msg:`${btns.length} tab button ditemukan ‚úì`};
},fix:null},
{id:'localStorage',name:'LocalStorage System',check:()=>{
  try{localStorage.setItem('tb-bugcheck','1');localStorage.removeItem('tb-bugcheck');return {ok:true,msg:'LocalStorage berfungsi normal ‚úì'};}
  catch(e){return {ok:false,msg:'LocalStorage error: '+e.message};}
},fix:null},
{id:'indexeddb',name:'Browser Storage Quota',check:()=>{
  if(!navigator.storage) return {ok:true,msg:'Storage API tidak tersedia (normal di beberapa browser)'};
  return {ok:true,msg:'Storage API tersedia ‚úì'};
},fix:null},
{id:'canvas2d',name:'Canvas 2D API',check:()=>{
  try{const c=document.createElement('canvas');const ctx=c.getContext('2d');
    if(!ctx) return {ok:false,msg:'Canvas 2D context gagal'};
    return {ok:true,msg:'Canvas 2D OK'+(ctx.roundRect?' (roundRect tersedia)':' (roundRect: fallback)')};
  }catch(e){return {ok:false,msg:'Canvas error: '+e.message};}
},fix:null},
{id:'webaudio',name:'Web Audio API (Noise/Morse)',check:()=>{
  if(!window.AudioContext&&!window.webkitAudioContext) return {ok:false,msg:'Web Audio API tidak didukung ‚Äî Noise Generator & Morse audio tidak berfungsi'};
  return {ok:true,msg:'Web Audio API tersedia ‚úì'};
},fix:null},
{id:'speechsynth',name:'Speech Synthesis API (TTS)',check:()=>{
  if(!window.speechSynthesis) return {ok:false,msg:'Speech Synthesis tidak didukung ‚Äî TTS tidak berfungsi'};
  const voices=window.speechSynthesis.getVoices();
  return {ok:true,msg:`Speech Synthesis OK ‚Äî ${voices.length} suara tersedia ‚úì`};
},fix:null},
{id:'clipboard',name:'Clipboard API',check:()=>{
  if(!navigator.clipboard) return {ok:false,msg:'Clipboard API tidak tersedia ‚Äî tombol Copy mungkin tidak berfungsi'};
  return {ok:true,msg:'Clipboard API tersedia ‚úì'};
},fix:null},
{id:'fileapi',name:'File Reader API (Upload)',check:()=>{
  if(!window.FileReader) return {ok:false,msg:'FileReader tidak tersedia ‚Äî upload gambar/file tidak berfungsi'};
  return {ok:true,msg:'FileReader API tersedia ‚úì'};
},fix:null},
{id:'fetchapi',name:'Fetch API (untuk API calls)',check:()=>{
  if(!window.fetch) return {ok:false,msg:'Fetch API tidak tersedia ‚Äî translate/cuaca/kurs tidak berfungsi'};
  return {ok:true,msg:'Fetch API tersedia ‚úì'};
},fix:null},
{id:'external-libs',name:'Library Eksternal (Tesseract)',check:()=>{
  // Tesseract lazy-load saat OCR dipakai ‚Äî tidak perlu dicek saat init
  // Markdown pakai renderer custom sendiri, tidak butuh library
  return {ok:true,msg:'Library eksternal OK ‚úì (Tesseract lazy-load saat OCR digunakan)'};
},fix:null},

// ‚îÄ‚îÄ TEXT TOOLS ‚îÄ‚îÄ
{id:'text-analyzer',name:'Text Analyzer',check:()=>chkEl(['text-input','text-out']),fix:null},
{id:'password-gen',name:'Password Generator',check:()=>{
  const r=chkEl(['plen','pass-out']);
  if(!r.ok) return r;
  if(typeof genPass!=='function') return {ok:false,msg:'Fungsi genPass tidak ada!'};
  return {ok:true,msg:'Password Generator OK ‚úì'};
},fix:null},
{id:'base64',name:'Base64 Encoder/Decoder',check:()=>chkEl(['b64-in','b64-out']),fix:null},
{id:'json-fmt',name:'JSON Formatter',check:()=>chkEl(['json-in','json-out']),fix:null},
{id:'hash-gen',name:'Hash Generator',check:()=>chkEl(['hash-in','hash-out']),fix:null},
{id:'regex-test',name:'Regex Tester',check:()=>chkEl(['rx-pat','rx-in','rx-flags']),fix:null},
{id:'markdown',name:'Markdown Preview',check:()=>{
  if(typeof renderMd!=='function') return {ok:false,msg:'Fungsi renderMd tidak ada!'};
  return chkEl(['md-in','md-prev']);
},fix:null},
{id:'minifier',name:'Code Minifier',check:()=>chkEl(['mini-in','mini-out']),fix:null},
{id:'cipher',name:'Enkripsi Teks',check:()=>chkEl(['ci-caesar','ci-rot13','ci-vigenere']),fix:null},
{id:'ascii-art',name:'ASCII Art Generator',check:()=>chkEl(['aa-input','aa-output']),fix:null},

// ‚îÄ‚îÄ CONVERTERS & TOOLS ‚îÄ‚îÄ
{id:'color-conv',name:'Color Converter',check:()=>chkEl(['cpicker','chex','cvhex']),fix:null},
{id:'unit-conv',name:'Unit Converter',check:()=>chkEl(['ucat','ufrom','uto','uout']),fix:null},
{id:'timestamp',name:'Timestamp Converter',check:()=>chkEl(['tsin','ts-out']),fix:null},
{id:'calc',name:'Kalkulator (4 Mode)',check:()=>{
  const r=chkEl(['calc-std','calc-sci']);
  if(!r.ok) return r;
  if(typeof cNum!=='function'||typeof cOp!=='function') return {ok:false,msg:'Fungsi kalkulator hilang!'};
  return {ok:true,msg:'Kalkulator OK ‚úì'};
},fix:null},
{id:'num-sys',name:'Konversi Bilangan (Bitwise)',check:()=>chkEl(['ns-dec','ns-bin','ns-oct','ns-hex']),fix:null},
{id:'aspect',name:'Aspect Ratio Calculator',check:()=>chkEl(['ar-w','ar-h']),fix:null},

// ‚îÄ‚îÄ GENERATORS ‚îÄ‚îÄ
{id:'qr-code',name:'QR Code Generator',check:()=>chkEl(['qr-in','qr-canvas']),fix:null},
{id:'gradient',name:'Gradient Generator',check:()=>chkEl(['gr-c1','gr-c2','gr-type']),fix:null},
{id:'random-gen',name:'Random Generator',check:()=>chkEl(['r-uuid','r-min']),fix:null},
{id:'fake-data',name:'Fake Data Generator (Indonesia)',check:()=>chkEl(['fd-count','fd-nama']),fix:null},
{id:'palette',name:'Color Palette Extractor',check:()=>{
  const r=chkEl(['pal-drop','pal-file','pal-result']);
  if(!r.ok) return r;
  if(!window.FileReader) return {ok:false,msg:'FileReader hilang ‚Äî tidak bisa upload gambar'};
  return {ok:true,msg:'Palette Extractor OK ‚úì'};
},fix:null},
{id:'chart-gen',name:'Chart Generator',check:()=>chkEl(['cg-data','cg-canvas']),fix:null},

// ‚îÄ‚îÄ MEDIA & VISUAL ‚îÄ‚îÄ
{id:'img-compressor',name:'Image Compressor',check:()=>{
  if(!window.FileReader) return {ok:false,msg:'FileReader tidak tersedia'};
  return chkEl(['ic-canvas','ic-quality']);
},fix:null},
{id:'font-prev',name:'Font Previewer',check:()=>chkEl(['fp-text','fp-size','fp-grid']),fix:null},
{id:'glass',name:'Glassmorphism Builder',check:()=>chkEl(['gl-blur','gl-alpha','gl-border-v']),fix:null},
{id:'mockup',name:'Device Mockup',check:()=>chkEl(['mk-url','mk-device','mk-preview-wrap']),fix:null},
{id:'mindmap',name:'Mindmap Generator',check:()=>chkEl(['mm-input','mm-canvas']),fix:null},

// ‚îÄ‚îÄ PRODUKTIVITAS ‚îÄ‚îÄ
{id:'todo',name:'To-Do List',check:()=>{
  const r=chkEl(['todo-list','todo-input']);
  if(!r.ok) return r;
  const stored=localStorage.getItem('tb-todos');
  if(stored){try{JSON.parse(stored);}catch(e){return {ok:false,msg:'Data todo korup: '+e.message};}}
  return {ok:true,msg:'To-Do List OK ‚Äî '+(JSON.parse(stored||'[]').length)+' item tersimpan ‚úì'};
},fix:()=>{try{renderTodos();}catch(e){}}},
{id:'notepad',name:'Notepad',check:()=>chkEl(['np-title']),fix:null},
{id:'snippet',name:'Snippet Manager',check:()=>chkEl(['snip-list','snip-search']),fix:null},
{id:'timer-sw',name:'Timer & Stopwatch',check:()=>chkEl(['sw-d','sw-btn']),fix:null},
{id:'pomodoro',name:'Pomodoro Timer',check:()=>{
  const r=chkEl(['pom-display','pom-btn']);
  if(!r.ok) return r;
  if(typeof pomRunning!=='undefined'&&pomRunning&&!pomInterval) return {ok:false,msg:'Pomodoro berjalan tapi interval hilang!'};
  return {ok:true,msg:'Pomodoro OK ‚úì'};
},fix:()=>{if(typeof pomRunning!=='undefined'&&pomRunning&&!pomInterval){pomRunning=false;const b=document.getElementById('pom-btn');if(b)b.textContent='‚ñ∂ Mulai';}}},
{id:'calendar',name:'Kalender & Event Planner',check:()=>{
  const r=chkEl(['cal-grid','cal-title','cal-day-events']);
  if(!r.ok) return r;
  const stored=localStorage.getItem('tb-cal-events');
  if(stored){try{JSON.parse(stored);}catch(e){return {ok:false,msg:'Data kalender korup: '+e.message};}}
  return {ok:true,msg:'Kalender OK ‚úì'};
},fix:()=>{try{calRender();}catch(e){}}},
{id:'budget',name:'Budget Tracker',check:()=>{
  const r=chkEl(['bgt-income','bgt-expense','bgt-balance','bgt-list']);
  if(!r.ok) return r;
  const stored=localStorage.getItem('tb-budget');
  if(stored){try{const d=JSON.parse(stored);return {ok:true,msg:`Budget OK, ${d.length} transaksi ‚úì`};}catch(e){return {ok:false,msg:'Data budget korup: '+e.message};}}
  return {ok:true,msg:'Budget Tracker OK ‚úì'};
},fix:()=>{try{bgtRender();}catch(e){}}},
{id:'habit',name:'Habit Tracker',check:()=>{
  const r=chkEl(['habit-list']);
  if(!r.ok) return r;
  const stored=localStorage.getItem('tb-habits');
  if(stored){try{const d=JSON.parse(stored);return {ok:true,msg:`Habit OK, ${d.length} kebiasaan ‚úì`};}catch(e){return {ok:false,msg:'Data habit korup: '+e.message};}}
  return {ok:true,msg:'Habit Tracker OK ‚úì'};
},fix:()=>{try{habitRender();}catch(e){}}},
{id:'flashcard',name:'Flashcard & Quiz Maker',check:()=>{
  const r=chkEl(['fc-create','fc-study','fc-quiz']);
  if(!r.ok) return r;
  const stored=localStorage.getItem('tb-flashcards');
  if(stored){try{const d=JSON.parse(stored);return {ok:true,msg:`Flashcard OK, ${d.length} kartu ‚úì`};}catch(e){return {ok:false,msg:'Data flashcard korup: '+e.message};}}
  return {ok:true,msg:'Flashcard OK ‚úì'};
},fix:()=>{try{fcRenderCardList();}catch(e){}}},

// ‚îÄ‚îÄ AUDIO & KREATIF ‚îÄ‚îÄ
{id:'tts',name:'Text to Speech',check:()=>{
  if(!window.speechSynthesis) return {ok:false,msg:'Speech Synthesis tidak tersedia di browser ini'};
  return chkEl(['tts-text','tts-voice']);
},fix:null},
{id:'noise-gen',name:'Noise Generator',check:()=>{
  if(!window.AudioContext&&!window.webkitAudioContext) return {ok:false,msg:'Web Audio API tidak tersedia'};
  return chkEl(['noise-vol']);
},fix:null},
{id:'morse',name:'Morse Code Converter',check:()=>chkEl(['morse-text','morse-code']),fix:null},
{id:'bpm',name:'BPM Tap Counter',check:()=>{
  const r=chkEl(['bpm-display','bpm-btn','bpm-taps']);
  if(!r.ok) return r;
  if(typeof bpmTap!=='function') return {ok:false,msg:'Fungsi bpmTap tidak ada!'};
  return {ok:true,msg:'BPM Counter OK ‚úì'};
},fix:null},

// ‚îÄ‚îÄ GAMES ‚îÄ‚îÄ
{id:'game-canvas',name:'Game Canvas',check:()=>{
  const c=document.getElementById('game-canvas');
  if(!c) return {ok:false,msg:'Canvas game tidak ada!'};
  if(c.width<100) return {ok:false,msg:`Canvas terlalu kecil: ${c.width}px`};
  return {ok:true,msg:`Game canvas OK (${c.width}√ó${c.height}) ‚úì`};
},fix:()=>{const c=document.getElementById('game-canvas');if(c&&c.width<100){c.width=400;c.height=450;}}},
{id:'snake-fn',name:'Snake Game Functions',check:()=>chkFn(['startSnake','startFlappy','start2048','startBreakout']),fix:null},
{id:'game-scores',name:'Game High Scores Storage',check:()=>{
  try{
    const s=JSON.parse(localStorage.getItem('tb-hs')||'{}');
    return {ok:true,msg:`High scores OK ‚Äî Snake:${s.snake||0}, Flappy:${s.flappy||0}, 2048:${s['2048']||0}, Breakout:${s.breakout||0} ‚úì`};
  }catch(e){return {ok:false,msg:'Data high score korup: '+e.message};}
},fix:()=>{localStorage.removeItem('tb-hs');}},

// ‚îÄ‚îÄ API & NETWORK ‚îÄ‚îÄ
{id:'translate-els',name:'Translate Tool Elements',check:()=>chkEl(['tr-in','tr-from','tr-to','tr-out']),fix:null},
{id:'currency-els',name:'Kurs Mata Uang Elements',check:()=>chkEl(['cur-amount','cur-from','cur-to','cur-result']),fix:null},
{id:'weather-els',name:'Cuaca Tool Elements',check:()=>chkEl(['wx-city','wx-result']),fix:null},
{id:'worldclock',name:'World Clock',check:()=>{
  const r=chkEl(['wc-grid']);
  if(!r.ok) return r;
  if(typeof Intl?.DateTimeFormat!=='function') return {ok:false,msg:'Intl.DateTimeFormat tidak tersedia'};
  return {ok:true,msg:'World Clock OK ‚úì'};
},fix:null},

// ‚îÄ‚îÄ FITUR BARU ‚îÄ‚îÄ
{id:'ocr-fn',name:'OCR (Tesseract.js)',check:()=>{
  const r=chkEl(['ocr-file','ocr-output']);
  if(!r.ok) return r;
  return {ok:true,msg:'OCR elements OK ‚úì (Tesseract lazy-load saat digunakan)'};
},fix:null},
{id:'age-calc',name:'Kalkulator Umur',check:()=>chkEl(['age-dob','age-to','age-result']),fix:null},
{id:'videogif',name:'Video ‚Üí GIF Converter',check:()=>{
  if(!window.FileReader) return {ok:false,msg:'FileReader tidak tersedia'};
  return chkEl(['vg-drop','vg-file']);
},fix:null},
{id:'meme-gen',name:'Meme Generator',check:()=>{
  const r=chkEl(['meme-canvas','meme-top','meme-bottom']);
  if(!r.ok) return r;
  if(typeof drawMeme!=='function') return {ok:false,msg:'Fungsi drawMeme tidak ada!'};
  return {ok:true,msg:'Meme Generator OK ‚úì'};
},fix:null},
{id:'urlqr-combo',name:'URL Shortener + QR Combo',check:()=>{
  const r=chkEl(['uq-input','uq-qr']);
  if(!r.ok) return r;
  const hist=localStorage.getItem('tb-uq-history');
  if(hist){try{JSON.parse(hist);}catch(e){return {ok:false,msg:'Data URL history korup: '+e.message};}}
  return {ok:true,msg:'URL+QR OK ‚úì'};
},fix:()=>{localStorage.removeItem('tb-uq-history');}},
{id:'csv-table',name:'CSV to Table',check:()=>chkEl(['csv-in','csv-wrap']),fix:null},
{id:'ai-chat',name:'AI Chat System (Claude)',check:()=>{
  const r=chkEl(['ai-messages','ai-input']);
  if(!r.ok) return r;
  if(typeof sendAI!=='function') return {ok:false,msg:'Fungsi sendAI tidak ada!'};
  return {ok:true,msg:`AI Chat OK ‚Äî ${(typeof aiChatHistory!=='undefined'?aiChatHistory.length:0)} pesan dalam history ‚úì`};
},fix:null},
{id:'ai-scanner-itself',name:'Auto Bug Scanner Sendiri',check:()=>{
  if(typeof runManualScan!=='function') return {ok:false,msg:'Fungsi runManualScan tidak ada!'};
  if(typeof addScanLog!=='function') return {ok:false,msg:'Fungsi addScanLog tidak ada!'};
  return {ok:true,msg:`Bug Scanner OK ‚Äî ${(typeof scanCount!=='undefined'?scanCount:0)} kali scan dijalankan ‚úì`};
},fix:null},

// ‚îÄ‚îÄ FITUR BARU: 8 UPDATE TERBESAR ‚îÄ‚îÄ

{id:'new-tools-basic',name:'12 New Tools Panels',check:()=>{
  const newTools=['imgEditor','resume','biolink','svgEditor','aiwriting','aicode','aitranslator','aigoal','expenseTracker','apiTester','playlist','weeklyPlanner'];
  const missing=newTools.filter(id=>!document.getElementById('tab-'+id));
  if(missing.length) return{ok:false,msg:'Panel hilang: '+missing.join(', ')};
  const fns=['ieLoad','awGenerate','acrReview','atpTranslate','agPlan','etAdd','atSend','plAdd','wpRender'];
  const missingFns=fns.filter(f=>typeof window[f]!=='function');
  if(missingFns.length) return{ok:false,msg:'Fungsi hilang: '+missingFns.join(', ')};
  return{ok:true,msg:'12 tools baru OK ‚úì'};
}},
{id:'widgets',name:'Clock & Weather Widgets',check:()=>{
  if(!document.getElementById('hy-topbar')) return{ok:false,msg:'TopBar hilang!'};
  if(!document.getElementById('hy-clock-widget')) return{ok:false,msg:'Clock widget hilang!'};
  if(!document.getElementById('hy-weather-widget')) return{ok:false,msg:'Weather widget hilang!'};
  if(!document.getElementById('hy-home')) return{ok:false,msg:'Home screen hilang!'};
  if(typeof hyOpenTool!=='function') return{ok:false,msg:'hyOpenTool() tidak ada!'};
  if(typeof hyFetchWeather!=='function') return{ok:false,msg:'hyFetchWeather() tidak ada!'};
  return{ok:true,msg:'Widgets & home screen OK ‚úì'};
}},{id:'theme-customizer',name:'Theme Customizer',check:()=>{
  // Theme customizer removed
  const saved=localStorage.getItem('tb-theme');
  if(saved){try{JSON.parse(saved);}catch(e){return {ok:false,msg:'Data tema tersimpan korup: '+e.message};}}
  return {ok:true,msg:`Theme Customizer OK ‚Äî ${saved?'tema custom aktif':'default'} ‚úì`};
},fix:()=>{
  // Coba reload tema tersimpan, jika gagal reset ke default
  try{themeLoadSaved();}catch(e){
    try{themeReset();}catch(e2){}
  }
}},

{id:'reminder-system',name:'Notifikasi & Reminder',check:()=>{
  const r=chkEl(['rem-title','rem-time','rem-list','rem-empty','rem-sound']);
  if(!r.ok) return r;
  if(typeof remAdd!=='function') return {ok:false,msg:'Fungsi remAdd tidak ada!'};
  if(typeof remCheck!=='function') return {ok:false,msg:'Fungsi remCheck tidak ada!'};
  const stored=localStorage.getItem('tb-reminders');
  if(stored){
    try{
      const d=JSON.parse(stored);
      const expired=d.filter(r=>!r.fired&&r.targetMs&&r.targetMs<Date.now()).length;
      if(expired>0) return {ok:false,msg:`${expired} reminder sudah lewat waktunya tapi belum di-fire!`};
      return {ok:true,msg:`Reminder OK ‚Äî ${d.length} total, ${d.filter(x=>!x.fired).length} aktif ‚úì`};
    }catch(e){return {ok:false,msg:'Data reminder korup: '+e.message};}
  }
  return {ok:true,msg:'Reminder system OK ‚úì'};
},fix:()=>{
  // Auto-fire reminder yang terlewat & re-render
  try{remCheck();remRender();}catch(e){}
  // Jika data korup, reset
  try{const d=JSON.parse(localStorage.getItem('tb-reminders')||'[]');}
  catch(e){localStorage.removeItem('tb-reminders');if(typeof reminders!=='undefined')reminders=[];try{remRender();}catch(e2){}}
}},

{id:'dashboard-analytics',name:'Dashboard Analytics',check:()=>{
  const r=chkEl(['dash-stats-row','dash-top-tools','dash-chart','dash-sessions']);
  if(!r.ok) return r;
  if(typeof dashUpdate!=='function') return {ok:false,msg:'Fungsi dashUpdate tidak ada!'};
  if(typeof trackTool!=='function') return {ok:false,msg:'Fungsi trackTool tidak ada!'};
  const stored=localStorage.getItem('tb-analytics');
  if(stored){try{JSON.parse(stored);}catch(e){return {ok:false,msg:'Data analytics korup: '+e.message};}}
  const activity=localStorage.getItem('tb-activity');
  if(activity){try{JSON.parse(activity);}catch(e){return {ok:false,msg:'Data aktivitas harian korup: '+e.message};}}
  const toolCount=stored?Object.keys(JSON.parse(stored)).length:0;
  return {ok:true,msg:`Analytics OK ‚Äî ${toolCount} tool tercatat ‚úì`};
},fix:()=>{
  // Reset korup data, keep valid
  ['tb-analytics','tb-activity','tb-sessions'].forEach(k=>{
    const v=localStorage.getItem(k);
    if(v){try{JSON.parse(v);}catch(e){localStorage.removeItem(k);}}
  });
  if(typeof toolUsage==='undefined')toolUsage={};
  try{dashUpdate();}catch(e){}
}},

{id:'i18n-system',name:'Multi-Language UI (i18n)',check:()=>{
  if(typeof i18nApply!=='function') return {ok:false,msg:'Fungsi i18nApply tidak ada!'};
  if(typeof I18N_TABS==='undefined') return {ok:false,msg:'Data I18N_TABS tidak ada!'};
  if(typeof I18N_UI==='undefined') return {ok:false,msg:'Data I18N_UI tidak ada!'};
  const r=chkEl(['i18n-picker','i18n-kv']);
  if(!r.ok) return r;
  const savedLang=localStorage.getItem('tb-lang')||'id';
  const validLangs=['id','en','ja','ar','ko'];
  if(!validLangs.includes(savedLang)) return {ok:false,msg:`Bahasa tersimpan tidak valid: "${savedLang}"`};
  const tabCount=Object.keys(I18N_TABS.id||{}).length;
  return {ok:true,msg:`i18n OK ‚Äî ${validLangs.length} bahasa, ${tabCount} tab diterjemahkan, aktif: ${savedLang} ‚úì`};
},fix:()=>{
  // Reset bahasa ke Indonesia jika tidak valid
  const saved=localStorage.getItem('tb-lang');
  if(!['id','en','ja','ar','ko'].includes(saved)){
    localStorage.setItem('tb-lang','id');
    if(typeof currentLang!=='undefined')currentLang='id';
  }
  // Re-apply
  try{i18nApply(localStorage.getItem('tb-lang')||'id');}catch(e){}
}},

{id:'share-system',name:'Share & Kolaborasi',check:()=>{
  const r=chkEl(['share-title','share-content','share-type','share-list','share-qr-preview']);
  if(!r.ok) return r;
  if(typeof shareCreate!=='function') return {ok:false,msg:'Fungsi shareCreate tidak ada!'};
  const stored=localStorage.getItem('tb-shares');
  if(stored){
    try{
      const d=JSON.parse(stored);
      // Check each share has required fields
      const broken=d.filter(s=>!s.id||!s.title||!s.content);
      if(broken.length) return {ok:false,msg:`${broken.length} share item korup (tidak punya id/title/content)`};
      return {ok:true,msg:`Share OK ‚Äî ${d.length} share tersimpan ‚úì`};
    }catch(e){return {ok:false,msg:'Data share korup: '+e.message};}
  }
  return {ok:true,msg:'Share system OK ‚úì'};
},fix:()=>{
  // Clean up broken share items
  try{
    const d=JSON.parse(localStorage.getItem('tb-shares')||'[]');
    const clean=d.filter(s=>s.id&&s.title&&s.content);
    localStorage.setItem('tb-shares',JSON.stringify(clean));
    if(typeof shareItems!=='undefined')shareItems=clean;
    shareRender();
  }catch(e){localStorage.removeItem('tb-shares');if(typeof shareItems!=='undefined')shareItems=[];try{shareRender();}catch(e2){}}
}},

{id:'settings-export-import',name:'Export/Import Settings',check:()=>{
  const r=chkEl(['settings-data-list','settings-drop-zone','settings-file-input']);
  if(!r.ok) return r;
  if(typeof settingsExport!=='function') return {ok:false,msg:'Fungsi settingsExport tidak ada!'};
  if(typeof settingsRenderData!=='function') return {ok:false,msg:'Fungsi settingsRenderData tidak ada!'};
  // Check all localStorage tb- keys are valid JSON
  // Some keys are intentionally plain strings (tb-lang, tb-bg, etc)
  const NON_JSON_KEYS = ['tb-lang','tb-bg','tb-font'];
  const corrupt=[];
  Object.keys(localStorage).filter(k=>k.startsWith('tb-')&&!NON_JSON_KEYS.includes(k)).forEach(k=>{
    try{JSON.parse(localStorage.getItem(k));}catch(e){corrupt.push(k);}
  });
  if(corrupt.length) return {ok:false,msg:`Data korup (bukan JSON valid): ${corrupt.join(', ')}`};
  const tbKeys=Object.keys(localStorage).filter(k=>k.startsWith('tb-')).length;
  return {ok:true,msg:`Settings OK ‚Äî ${tbKeys} key tb- tersimpan ‚úì`};
},fix:()=>{
  // Remove all corrupt tb- keys
  Object.keys(localStorage).filter(k=>k.startsWith('tb-')).forEach(k=>{
    try{JSON.parse(localStorage.getItem(k));}catch(e){localStorage.removeItem(k);}
  });
  try{settingsRenderData();}catch(e){}
}},

{id:'plugin-system',name:'Plugin System',check:()=>{
  const r=chkEl(['plugin-json','plugin-list','plugin-count','plugin-empty']);
  if(!r.ok) return r;
  if(typeof pluginInstall!=='function') return {ok:false,msg:'Fungsi pluginInstall tidak ada!'};
  if(typeof pluginActivate!=='function') return {ok:false,msg:'Fungsi pluginActivate tidak ada!'};
  const stored=localStorage.getItem('tb-plugins');
  if(stored){
    try{
      const d=JSON.parse(stored);
      const broken=d.filter(p=>!p.id||!p.name);
      if(broken.length) return {ok:false,msg:`${broken.length} plugin tidak punya id/name`};
      // Check installed plugins have their tab panels
      const missingPanels=d.filter(p=>!document.getElementById('tab-plugin-'+p.id));
      if(missingPanels.length) return {ok:false,msg:`${missingPanels.length} plugin tab panel hilang: ${missingPanels.map(p=>p.name).join(', ')}`};
      return {ok:true,msg:`Plugin OK ‚Äî ${d.length} plugin terinstall, semua tab aktif ‚úì`};
    }catch(e){return {ok:false,msg:'Data plugin korup: '+e.message};}
  }
  return {ok:true,msg:'Plugin system OK (0 plugin) ‚úì'};
},fix:()=>{
  // Re-activate missing plugin panels
  try{
    const d=JSON.parse(localStorage.getItem('tb-plugins')||'[]');
    const valid=d.filter(p=>p.id&&p.name);
    if(valid.length!==d.length){
      localStorage.setItem('tb-plugins',JSON.stringify(valid));
      if(typeof installedPlugins!=='undefined')installedPlugins=valid;
    }
    // Re-activate each plugin
    valid.forEach(p=>{
      if(!document.getElementById('tab-plugin-'+p.id)){
        try{pluginActivate(p);}catch(e){}
      }
    });
    pluginRender();
  }catch(e){localStorage.removeItem('tb-plugins');if(typeof installedPlugins!=='undefined')installedPlugins=[];try{pluginRender();}catch(e2){}}
}},

{id:'command-palette',name:'Command Palette (Ctrl+K)',check:()=>{
  if(typeof cmdOpen!=='function') return {ok:false,msg:'Fungsi cmdOpen tidak ada!'};
  if(typeof cmdClose!=='function') return {ok:false,msg:'Fungsi cmdClose tidak ada!'};
  if(typeof ALL_COMMANDS==='undefined'||!ALL_COMMANDS.length) return {ok:false,msg:'Data ALL_COMMANDS kosong!'};
  const overlay=document.getElementById('cmd-overlay');
  if(!overlay) return {ok:false,msg:'Elemen cmd-overlay tidak ada!'};
  const input=document.getElementById('cmd-input');
  if(!input) return {ok:false,msg:'Elemen cmd-input tidak ada!'};
  return {ok:true,msg:`Command Palette OK ‚Äî ${ALL_COMMANDS.length} commands, Ctrl+K ready ‚úì`};
},fix:()=>{
  // Re-inject command palette if missing
  if(!document.getElementById('cmd-overlay')){
    try{
      const overlay=document.createElement('div');
      overlay.id='cmd-overlay';
      overlay.innerHTML=`<div id="cmd-box"><div id="cmd-input-wrap"><span style="color:var(--accent);font-size:1.1rem;">‚å®Ô∏è</span><input id="cmd-input" placeholder="Ketik nama tool..." autocomplete="off"><span style="font-size:0.65rem;color:#6b6b8a;">ESC tutup</span></div><div id="cmd-results"></div></div>`;
      overlay.onclick=(e)=>{if(e.target===overlay)cmdClose();};
      document.body.appendChild(overlay);
      document.getElementById('cmd-input')?.addEventListener('input',function(){cmdRender(this.value);});
    }catch(e){}
  }
}},

{id:'aitools',name:'AITools (Floating Button)',check:()=>{
  const btn=document.getElementById('aitools-btn');
  const popup=document.getElementById('aitools-popup');
  if(!btn) return {ok:false,msg:'Elemen aitools-btn tidak ada ‚Äî tombol AITools hilang!'};
  if(!popup) return {ok:false,msg:'Elemen aitools-popup tidak ada!'};
  if(typeof toggleAITools!=='function') return {ok:false,msg:'Fungsi toggleAITools tidak ada!'};
  if(typeof aitSend!=='function') return {ok:false,msg:'Fungsi aitSend tidak ada!'};
  if(typeof aitRunScan!=='function') return {ok:false,msg:'Fungsi aitRunScan tidak ada!'};
  return {ok:true,msg:'AITools OK ‚Äî tombol & popup aktif, semua fungsi tersedia ‚úì'};
},fix:()=>{
  // Re-inject AITools button if missing
  if(!document.getElementById('aitools-btn')){
    const btn=document.createElement('button');
    btn.id='aitools-btn';btn.innerHTML='ü§ñ';btn.onclick=()=>toggleAITools();
    btn.style.cssText='position:fixed;bottom:24px;right:24px;z-index:99998;width:52px;height:52px;border-radius:50%;background:conic-gradient(from 0deg,#7c3aed,#06b6d4,#10b981,#f59e0b,#7c3aed);cursor:pointer;border:none;font-size:20px;box-shadow:0 0 22px rgba(124,58,237,0.55);';
    document.body.appendChild(btn);
  }
}},
];

function addScanLog(msg, type='info'){
  const log=document.getElementById('ai-scan-log');
  if(!log) return;
  const colors={ok:'#10b981',bug:'#ef4444',info:'#06b6d4',fix:'#f59e0b'};
  const icons={ok:'‚úÖ',bug:'üêõ',info:'‚ÑπÔ∏è',fix:'üîß'};
  const time=new Date().toLocaleTimeString('id-ID');
  const entry=document.createElement('div');
  entry.style.cssText=`color:${colors[type]||colors.info};padding:2px 0;border-bottom:1px solid rgba(255,255,255,0.05);flex-shrink:0;`;
  entry.textContent=`[${time}] ${icons[type]||''} ${msg}`;
  log.appendChild(entry); // append di bawah, scroll ke bawah
  log.scrollTop=log.scrollHeight;
  // Batasi 200 baris ‚Äî cukup untuk 67 check √ó 3 baris
  while(log.children.length>200) log.removeChild(log.firstChild);
}

async function runManualScan(){
  const statusEl=document.getElementById('ai-scanner-status');
  const btn=document.querySelector('[onclick="runManualScan()"]');
  if(btn){btn.disabled=true;btn.textContent='üîÑ Scanning...';}
  scanCount++;
  lastScanTime=new Date();

  // Reset bug report panel
  let bugReport=document.getElementById('ai-bug-report');
  if(!bugReport){
    const scannerDiv=document.getElementById('ai-scan-log').parentElement;
    bugReport=document.createElement('div');
    bugReport.id='ai-bug-report';
    bugReport.style.cssText='margin-top:8px;display:flex;flex-direction:column;gap:4px;';
    scannerDiv.appendChild(bugReport);
  }
  bugReport.innerHTML='';

  // Clear old log & show start
  const log=document.getElementById('ai-scan-log');
  if(log) log.innerHTML='';

  addScanLog(`üöÄ Scan #${scanCount} dimulai ‚Äî ${BUG_CHECKS.length} pengecekan...`,'info');
  if(statusEl) statusEl.textContent=`‚è≥ Scanning ${BUG_CHECKS.length} fitur... (${lastScanTime.toLocaleTimeString('id-ID')})`;

  let bugsFound=0, fixesApplied=0;
  const bugList=[];
  await new Promise(r=>setTimeout(r,100));

  for(const check of BUG_CHECKS){
    await new Promise(r=>setTimeout(r,30));
    let result;
    try{ result=check.check(); }
    catch(e){ result={ok:false,msg:'Error saat cek: '+e.message}; }

    if(result.ok){
      addScanLog(`${check.name}: ${result.msg}`,'ok');
    } else {
      bugsFound++;
      bugList.push({name:check.name, msg:result.msg, hasFix:!!check.fix});
      addScanLog(`BUG ‚Äî ${check.name}: ${result.msg}`,'bug');

      if(check.fix){
        try{
          check.fix();
          fixesApplied++;
          addScanLog(`üîß AUTO-FIX diterapkan: ${check.name}`,'fix');
          bugList[bugList.length-1].fixed=true;
        } catch(e){
          addScanLog(`Fix gagal: ${e.message}`,'bug');
        }
      }
    }
  }

  // ‚îÄ‚îÄ TAMPILKAN BUG REPORT PERMANEN DI ATAS ‚îÄ‚îÄ
  if(bugList.length>0){
    bugReport.innerHTML=`<div style="font-size:0.72rem;font-weight:700;color:var(--danger);margin-bottom:4px;">üêõ ${bugList.length} BUG DITEMUKAN:</div>`+
      bugList.map(b=>`<div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:6px;padding:6px 10px;font-size:0.72rem;">
        <span style="color:${b.fixed?'var(--accent3)':'var(--danger)'};">${b.fixed?'üîß FIXED':'üêõ BUG'}</span>
        <strong style="color:var(--text);margin-left:6px;">${b.name}</strong>
        <div style="color:var(--muted);margin-top:2px;font-family:'Space Mono',monospace;font-size:0.68rem;">${b.msg}</div>
      </div>`).join('');
  } else {
    bugReport.innerHTML=`<div style="color:var(--success);font-size:0.72rem;font-weight:700;">‚úÖ Tidak ada bug ditemukan!</div>`;
  }

  const summary = bugsFound===0
    ? `‚úÖ Scan #${scanCount} selesai ‚Äî Semua ${BUG_CHECKS.length} cek lulus!`
    : `‚ö†Ô∏è Scan #${scanCount} selesai ‚Äî ${bugsFound} bug, ${fixesApplied} auto-fix.`;
  addScanLog(summary, bugsFound===0?'ok':'bug');
  if(statusEl) statusEl.textContent=`${bugsFound===0?'‚úÖ Bersih':'‚ö†Ô∏è '+bugsFound+' bug'} | ${lastScanTime.toLocaleTimeString('id-ID')} | Scan ke-${scanCount}`;

  // Kirim laporan ke chat AI
  if(bugsFound>0){
    const container=document.getElementById('ai-messages');
    if(container){
      const bugLines=bugList.map(b=>`‚Ä¢ ${b.fixed?'[FIXED] ':''}${b.name}: ${b.msg}`).join('<br>');
      container.insertAdjacentHTML('beforeend',`<div class="ai-msg ai-bot">
        <div class="ai-avatar">üîç</div>
        <div class="ai-bubble" style="border-color:var(--danger);">
          <strong>Laporan Bug Scan #${scanCount}</strong><br>
          üêõ <strong>${bugsFound} bug ditemukan</strong>, üîß ${fixesApplied} auto-fix diterapkan.<br><br>
          ${bugLines}
        </div>
      </div>`);
      container.scrollTop=container.scrollHeight;
    }
  }

  if(btn){btn.disabled=false;btn.textContent='üîç Scan Sekarang';}
}

function startAiScanner(){
  const intervalSec=parseInt(document.getElementById('ai-scan-interval').value)||0;
  if(intervalSec===0){ runManualScan(); return; }
  stopAiScanner();
  const statusEl=document.getElementById('ai-scanner-status');
  const btn=document.getElementById('ai-scanner-btn');
  if(btn){btn.textContent='‚úÖ Aktif';btn.className='btn btn-cyan';}
  addScanLog(`Auto scanner diaktifkan ‚Äî interval ${intervalSec} detik`,'info');
  // Scan pertama langsung
  runManualScan();
  // Hitung mundur & scan berikutnya
  let nextIn=intervalSec;
  aiScannerInterval=setInterval(()=>{
    nextIn--;
    if(statusEl&&lastScanTime) statusEl.textContent=`‚úÖ Auto scanner aktif | Scan berikutnya: ${nextIn}s | Terakhir: ${lastScanTime.toLocaleTimeString('id-ID')}`;
    if(nextIn<=0){ nextIn=intervalSec; runManualScan(); }
  },1000);
}

function stopAiScanner(){
  clearInterval(aiScannerInterval);
  aiScannerInterval=null;
  const btn=document.getElementById('ai-scanner-btn');
  if(btn){btn.textContent='‚ñ∂ Aktifkan';btn.className='btn btn-primary';}
  const statusEl=document.getElementById('ai-scanner-status');
  if(statusEl) statusEl.textContent=scanCount>0?`‚èπ Scanner dihentikan | Total scan: ${scanCount}`:'Scanner belum aktif';
  addScanLog('Auto scanner dihentikan','info');
}


// ============================================================
// ü§ñ AITOOLS ‚Äî Smart Floating Assistant + Popup Panel
// ============================================================

// ‚îÄ‚îÄ AITools State ‚Äî declared BEFORE IIFE to avoid temporal dead zone ‚îÄ‚îÄ
let aitIsOpen = false;
let aitChatHistory = [{role:'assistant',content:'Halo! Saya AITools ü§ñ ‚Äî asisten Toolbox kamu. Tanya apa saja!'}];
let aitAutoScanActive = false;
let aitAutoInterval = null;
let aitCurrentTab = 'chat';

(function injectAITools(){
  // ‚îÄ‚îÄ CSS for AITools ‚îÄ‚îÄ
  const style = document.createElement('style');
  style.textContent = `
    @keyframes guardianSpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    @keyframes guardianPulse{from{box-shadow:0 0 20px rgba(124,58,237,0.5)}to{box-shadow:0 0 36px rgba(6,182,212,0.7),0 0 60px rgba(124,58,237,0.3)}}
    #aitools-btn{position:fixed;bottom:24px;right:24px;z-index:99998;width:52px;height:52px;border-radius:50%;background:conic-gradient(from 0deg,#7c3aed,#06b6d4,#10b981,#f59e0b,#7c3aed);cursor:pointer;box-shadow:0 0 22px rgba(124,58,237,0.55);display:flex;align-items:center;justify-content:center;font-size:20px;user-select:none;transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.2s;animation:guardianSpin 3s linear infinite,guardianPulse 2s ease-in-out infinite alternate;border:none;outline:none;}
    #aitools-btn:hover{transform:scale(1.15)!important;}
    #aitools-btn.open{animation:guardianSpin 1s linear infinite;box-shadow:0 0 36px rgba(124,58,237,0.8);}
    #aitools-popup{position:fixed;bottom:88px;right:24px;z-index:99999;width:340px;max-height:520px;background:#13131a;border:1px solid rgba(124,58,237,0.45);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.7);display:flex;flex-direction:column;overflow:hidden;transform:scale(0.85) translateY(20px);opacity:0;pointer-events:none;transform-origin:bottom right;transition:transform 0.32s cubic-bezier(0.34,1.46,0.64,1),opacity 0.28s ease;}
    #aitools-popup.open{transform:scale(1) translateY(0);opacity:1;pointer-events:all;}
    #aitools-header{padding:11px 14px;background:linear-gradient(135deg,rgba(124,58,237,0.3),rgba(6,182,212,0.15));border-bottom:1px solid rgba(124,58,237,0.2);display:flex;align-items:center;gap:8px;flex-shrink:0;}
    #aitools-tabs{display:flex;gap:0;border-bottom:1px solid rgba(124,58,237,0.15);flex-shrink:0;}
    .ait-tab{padding:7px 12px;font-size:0.62rem;font-family:'Space Mono',monospace;cursor:pointer;color:var(--muted);background:none;border:none;border-bottom:2px solid transparent;transition:all 0.2s;text-transform:uppercase;letter-spacing:0.5px;}
    .ait-tab.active{color:var(--accent2);border-bottom-color:var(--accent);}
    .ait-pane{display:none;flex:1;flex-direction:column;overflow:hidden;}
    .ait-pane.active{display:flex;}
    #ait-chat-msgs{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:6px;min-height:180px;max-height:280px;}
    #ait-chat-msgs::-webkit-scrollbar{width:3px;}
    #ait-chat-msgs::-webkit-scrollbar-thumb{background:rgba(124,58,237,0.4);border-radius:3px;}
    .ait-msg-user{align-self:flex-end;background:rgba(124,58,237,0.22);border:1px solid rgba(124,58,237,0.3);border-radius:12px 12px 3px 12px;padding:7px 11px;font-size:0.73rem;max-width:88%;color:var(--text);word-break:break-word;}
    .ait-msg-ai{align-self:flex-start;background:rgba(6,182,212,0.08);border:1px solid rgba(6,182,212,0.2);border-radius:3px 12px 12px 12px;padding:7px 11px;font-size:0.73rem;max-width:92%;color:var(--text);line-height:1.55;word-break:break-word;}
    .ait-msg-ai b{color:var(--accent2);}
    .ait-msg-system{align-self:center;font-size:0.62rem;color:var(--muted);padding:2px 0;}
    #ait-input-row{padding:8px 10px;border-top:1px solid rgba(124,58,237,0.15);display:flex;gap:6px;flex-shrink:0;}
    #ait-input{flex:1;background:rgba(255,255,255,0.04);border:1px solid rgba(124,58,237,0.25);border-radius:8px;padding:7px 10px;color:var(--text);font-size:0.72rem;font-family:'Space Mono',monospace;outline:none;resize:none;height:34px;line-height:1.2;}
    #ait-input:focus{border-color:rgba(124,58,237,0.55);}
    #ait-send{background:linear-gradient(135deg,#7c3aed,#06b6d4);border:none;border-radius:8px;width:34px;height:34px;cursor:pointer;color:#fff;font-size:0.95rem;display:flex;align-items:center;justify-content:center;transition:transform 0.15s;flex-shrink:0;}
    #ait-send:hover{transform:scale(1.08);}
    #ait-send:disabled{opacity:0.4;transform:none;}
    #ait-scan-log{flex:1;overflow-y:auto;padding:10px;font-size:0.68rem;font-family:'Space Mono',monospace;display:flex;flex-direction:column;gap:2px;min-height:180px;max-height:280px;}
    #ait-scan-log::-webkit-scrollbar{width:3px;}
    #ait-scan-log::-webkit-scrollbar-thumb{background:rgba(16,185,129,0.4);border-radius:3px;}
    .ait-quick{background:rgba(124,58,237,0.1);border:1px solid rgba(124,58,237,0.2);border-radius:6px;padding:3px 8px;font-size:0.6rem;cursor:pointer;color:var(--accent2);transition:all 0.15s;font-family:'Space Mono',monospace;white-space:nowrap;}
    .ait-quick:hover{background:rgba(124,58,237,0.22);}
  `;
  document.head.appendChild(style);

  // ‚îÄ‚îÄ Build DOM ‚îÄ‚îÄ
  const btn = document.createElement('button');
  btn.id = 'aitools-btn';
  btn.innerHTML = 'ü§ñ';
  btn.title = 'AITools ‚Äî Klik untuk buka';
  btn.onclick = toggleAITools;

  const popup = document.createElement('div');
  popup.id = 'aitools-popup';
  // Cegah semua key event dari popup merembet ke game handler
  popup.addEventListener('keydown', e=>e.stopPropagation());
  popup.addEventListener('keyup', e=>e.stopPropagation());
  popup.innerHTML = `
    <div id="aitools-header">
      <div style="width:28px;height:28px;border-radius:50%;background:conic-gradient(from 0deg,#7c3aed,#06b6d4,#10b981,#7c3aed);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;">ü§ñ</div>
      <div style="flex:1;">
        <div style="font-size:0.78rem;font-weight:700;color:var(--text);">AITools</div>
        <div style="font-size:0.6rem;color:var(--accent2);" id="ait-status-bar">Online ‚Ä¢ Siap membantu</div>
      </div>
      <button onclick="toggleAITools()" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:1rem;padding:0 4px;">‚úï</button>
    </div>
    <div id="aitools-tabs">
      <button class="ait-tab active" onclick="aitSwitchTab('chat')">üí¨ Chat</button>
      <button class="ait-tab" onclick="aitSwitchTab('scan')">üîç Scan</button>
      <button class="ait-tab" onclick="aitSwitchTab('quick')">‚ö° Quick</button>
    </div>

    <!-- CHAT PANE -->
    <div class="ait-pane active" id="ait-pane-chat">
      <div id="ait-chat-msgs">
        <div class="ait-msg-ai">
          <b>Halo! Saya AITools ü§ñ</b><br>
          Asisten cerdas Toolbox kamu. Tanya apa saja ‚Äî cara pakai tools, debug kode, analisis teks, matematika, fakta umum, atau minta rekomendasi!<br><br>
          Contoh: <i>"Tolong jelaskan cara pakai regex"</i> atau <i>"Buatkan rumus menghitung BMI"</i>
        </div>
      </div>
      <div style="padding:4px 10px;display:flex;gap:4px;flex-wrap:wrap;flex-shrink:0;border-top:1px solid rgba(124,58,237,0.08);">
        <button class="ait-quick" onclick="aitQuick('Jelaskan cara pakai tools di Toolbox ini')">üìñ Cara pakai</button>
        <button class="ait-quick" onclick="aitQuick('Tolong buatkan regex untuk validasi email')">üîç Regex email</button>
        <button class="ait-quick" onclick="aitQuick('Apa perbedaan SHA256 dan MD5?')">üîë Hash info</button>
        <button class="ait-quick" onclick="aitQuick('Rekomendasikan tools terbaik untuk developer')">üí° Rekomendasi</button>
      </div>
      <div id="ait-input-row">
        <input id="ait-input" placeholder="Tanya AITools..." onkeydown="event.stopPropagation();if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();aitSend();}">
        <button id="ait-send" onclick="aitSend()">‚û§</button>
      </div>
    </div>

    <!-- SCAN PANE -->
    <div class="ait-pane" id="ait-pane-scan">
      <div style="padding:8px 10px;display:flex;gap:6px;flex-shrink:0;flex-wrap:wrap;border-bottom:1px solid rgba(124,58,237,0.1);">
        <button class="btn btn-primary" onclick="aitRunScan()" id="ait-scan-btn" style="font-size:0.68rem;padding:5px 10px;">üîç Scan Sekarang</button>
        <button class="btn btn-secondary" onclick="aitAutoToggle()" id="ait-auto-btn" style="font-size:0.68rem;padding:5px 10px;">‚ñ∂ Auto Scan</button>
        <span id="ait-scan-status" style="font-size:0.62rem;color:var(--muted);align-self:center;"></span>
      </div>
      <div id="ait-scan-log"></div>
      <div style="padding:6px 10px;border-top:1px solid rgba(124,58,237,0.1);display:flex;gap:4px;flex-shrink:0;flex-wrap:wrap;">
        <button class="ait-quick" onclick="aitRunFix()">üîß Auto Fix Semua</button>
        <button class="ait-quick" onclick="aitClearLog()">üóë Clear</button>
      </div>
    </div>

    <!-- QUICK ACTIONS PANE -->
    <div class="ait-pane" id="ait-pane-quick" style="padding:10px;flex-direction:column;gap:8px;overflow-y:auto;">
      <div style="font-size:0.62rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:2px;">‚ö° Aksi Cepat</div>
      <div id="ait-quick-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:6px;"></div>
      <div style="font-size:0.62rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:6px;margin-bottom:2px;">üìä Status Toolbox</div>
      <div id="ait-stats" style="font-size:0.68rem;color:var(--text);line-height:1.8;"></div>
    </div>
  `;

  document.body.appendChild(btn);
  document.body.appendChild(popup);

  // Build quick actions grid
  const QUICK_ACTIONS = [
    {icon:'üóë', label:'Clear LocalStorage', fn:'aitClearStorage'},
    {icon:'üìä', label:'Lihat Analytics', fn:"sw('dashboard',document.querySelector('[onclick*=dashboard]'))"},
    {icon:'üìã', label:'Buka To-Do', fn:"sw('todo',document.querySelector('[onclick*=todo]'))"},
    {icon:'üîç', label:'Buka Regex', fn:"sw('regex',document.querySelector('[onclick*=regex]'))"},
    {icon:'üîê', label:'Buka Vault', fn:"sw('vault',document.querySelector('[onclick*=vault]'))"},
    {icon:'üì∏', label:'Annotator', fn:"sw('annotator',document.querySelector('[onclick*=annotator]'))"},
    {icon:'üß†', label:'AI Summarizer', fn:"sw('summarizer',document.querySelector('[onclick*=summarizer]'))"},
    {icon:'‚è∞', label:'Focus Mode', fn:"sw('focus',document.querySelector('[onclick*=focus]'))"},
  ];
  const grid = document.getElementById('ait-quick-grid');
  if(grid) grid.innerHTML = QUICK_ACTIONS.map(a=>`
    <button onclick="${a.fn}" style="background:rgba(124,58,237,0.08);border:1px solid rgba(124,58,237,0.2);border-radius:8px;padding:8px 6px;cursor:pointer;text-align:center;transition:all 0.2s;font-family:'Space Mono',monospace;">
      <div style="font-size:1.1rem;">${a.icon}</div>
      <div style="font-size:0.6rem;color:var(--text);margin-top:3px;line-height:1.2;">${a.label}</div>
    </button>`).join('');

  // aitUpdateStats() called lazily when popup opens ‚Äî not here
})();

// ‚îÄ‚îÄ AITools State ‚Äî (already declared above IIFE) ‚îÄ‚îÄ

function toggleAITools(){
  const popup = document.getElementById('aitools-popup');
  const btn   = document.getElementById('aitools-btn');
  if(!popup||!btn) return;
  aitIsOpen = !aitIsOpen;
  popup.classList.toggle('open', aitIsOpen);
  btn.classList.toggle('open', aitIsOpen);
  if(aitIsOpen){
    aitUpdateStats();
    // Auto-focus input saat popup dibuka supaya bisa langsung ngetik
    requestAnimationFrame(()=>{
      const inp = document.getElementById('ait-input');
      if(inp) inp.focus();
    });
  }
}

function aitSwitchTab(tab){
  aitCurrentTab = tab;
  document.querySelectorAll('.ait-tab').forEach((t,i)=>{
    const tabs=['chat','scan','quick'];
    t.classList.toggle('active', tabs[i]===tab);
  });
  document.querySelectorAll('.ait-pane').forEach(p=>p.classList.remove('active'));
  const pane = document.getElementById('ait-pane-'+tab);
  if(pane) pane.classList.add('active');
  if(tab==='quick') aitUpdateStats();
}

// ‚îÄ‚îÄ AITools Chat (Claude API) ‚îÄ‚îÄ
async function aitSend(){
  const input = document.getElementById('ait-input');
  const sendBtn = document.getElementById('ait-send');
  const text = input?.value?.trim();
  if(!text) return;

  input.value = '';
  sendBtn.disabled = true;
  document.getElementById('ait-status-bar').textContent = 'Sedang berpikir...';

  // Add user message
  aitAddMsg(text, 'user');
  aitChatHistory.push({role:'user', content:text});

  // Typing indicator
  const typingEl = document.createElement('div');
  typingEl.className = 'ait-msg-ai';
  typingEl.innerHTML = '<span style="color:var(--muted);font-size:0.7rem;animation:aitBlink 0.8s infinite;">‚ñã AITools sedang membalas...</span>';
  typingEl.id = 'ait-typing';
  document.getElementById('ait-chat-msgs')?.appendChild(typingEl);

  const ctx = `Kamu adalah AITools, asisten AI cerdas yang tertanam di dalam aplikasi web bernama TOOLBOX ‚Äî sebuah kumpulan tools berguna untuk developer dan desainer, dibuat oleh Adam yang Ganteng.

Toolbox memiliki 60+ tools termasuk: Text Analyzer, Password Generator, Base64, JSON Formatter, Color Converter, Unit Converter, Hash Generator, Timestamp, Calculator, Translator, QR Code, Markdown Preview, Regex Tester, Timer, CSV Table, Gradient Generator, Minifier, To-Do, Notepad, Currency Converter, Weather, Image Compressor, Font Previewer, Snippet Manager, Aspect Ratio, Mindmap, Morse Code, World Clock, Fake Data Generator, Color Palette, Chart Generator, Cipher, ASCII Art, Pomodoro, TTS, OCR, Age Calculator, Noise Generator, Glassmorphism Builder, Device Mockup, Number System, Games (Snake/Flappy/2048/Breakout), AI Chat, Calendar, Budget Tracker, Habit Tracker, Flashcard, Video-to-GIF, Meme Generator, BPM Counter, URL+QR, Audio Visualizer, Screenshot Annotator, Password Vault, Formula Builder, AI Summarizer, Email Template Builder, Focus Mode, Data Viz Studio.

Kamu sangat pintar, ramah, dan komunikatif. Jawab dalam bahasa Indonesia kecuali diminta lain. Format jawaban dengan **bold** untuk hal penting, dan gunakan bullet points bila perlu. Jaga jawaban tetap relevan dan berguna.`;

  try {
    const messages = aitChatHistory.length > 1
      ? aitChatHistory.slice(-12).map(m=>({role:m.role,content:m.content}))
      : [{role:'user',content:text}];

    const res = await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:1000,
        system: ctx,
        messages: messages
      })
    });
    const data = await res.json();
    const reply = data?.content?.[0]?.text || 'Maaf, tidak ada respon dari API.';

    typingEl?.remove();
    aitAddMsg(reply, 'ai');
    aitChatHistory.push({role:'assistant', content:reply});

    // Keep history manageable
    if(aitChatHistory.length > 30) aitChatHistory = aitChatHistory.slice(-20);
    document.getElementById('ait-status-bar').textContent = 'Online ‚Ä¢ Siap membantu';
  } catch(e) {
    typingEl?.remove();
    aitAddMsg('‚ö†Ô∏è Gagal terhubung ke API. Pastikan koneksi internet aktif.', 'ai');
    document.getElementById('ait-status-bar').textContent = 'Offline ‚Ä¢ Error koneksi';
  }
  sendBtn.disabled = false;
}

function aitAddMsg(text, role){
  const msgs = document.getElementById('ait-chat-msgs');
  if(!msgs) return;
  const div = document.createElement('div');
  div.className = role==='user' ? 'ait-msg-user' : (role==='ai' ? 'ait-msg-ai' : 'ait-msg-system');
  // Simple markdown: **bold**, *italic*, bullet points
  let html = text
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\*\*(.+?)\*\*/g,'<b>$1</b>')
    .replace(/\*(.+?)\*/g,'<i>$1</i>')
    .replace(/^‚Ä¢ (.+)$/gm,'<span style="display:block;padding-left:8px;">‚Ä¢ $1</span>')
    .replace(/^- (.+)$/gm,'<span style="display:block;padding-left:8px;">‚Ä¢ $1</span>')
    .replace(/\n/g,'<br>');
  div.innerHTML = html;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function aitQuick(prompt){
  const input = document.getElementById('ait-input');
  if(input){ input.value=prompt; aitSend(); }
}

// ‚îÄ‚îÄ AITools Scan (reuse BUG_CHECKS) ‚îÄ‚îÄ
function aitScanLog(msg, type='info'){
  const log = document.getElementById('ait-scan-log');
  if(!log) return;
  const colors={ok:'#10b981',bug:'#ef4444',info:'#06b6d4',fix:'#f59e0b',warn:'#f97316'};
  const icons={ok:'‚úÖ',bug:'üêõ',info:'‚ÑπÔ∏è',fix:'üîß',warn:'‚ö†Ô∏è'};
  const div = document.createElement('div');
  div.style.cssText = `color:${colors[type]||colors.info};padding:1px 0;line-height:1.4;`;
  div.textContent = `${icons[type]||''} ${msg}`;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
  while(log.children.length > 120) log.removeChild(log.firstChild);
}

async function aitRunScan(){
  const btn = document.getElementById('ait-scan-btn');
  const status = document.getElementById('ait-scan-status');
  if(btn){btn.disabled=true;btn.textContent='‚è≥ Scanning...';}
  if(status) status.textContent=`${BUG_CHECKS.length} cek...`;
  aitScanLog(`üöÄ Scan dimulai ‚Äî ${BUG_CHECKS.length} pengecekan`, 'info');

  let bugs=0;
  for(const ck of BUG_CHECKS){
    await new Promise(r=>setTimeout(r,8));
    try{
      const result = ck.check();
      if(result.ok){
        aitScanLog(`${ck.name}: ${result.msg}`, 'ok');
      } else {
        bugs++;
        aitScanLog(`${ck.name}: ${result.msg}`, 'bug');
      }
    }catch(e){ aitScanLog(`${ck.name}: Error ‚Äî ${e.message}`, 'bug'); bugs++; }
  }

  if(status) status.textContent = bugs ? `‚ö†Ô∏è ${bugs} bug` : '‚úÖ Semua OK';
  aitScanLog(bugs ? `‚ö†Ô∏è Selesai ‚Äî ${bugs} bug ditemukan` : `‚úÖ Selesai ‚Äî Semua ${BUG_CHECKS.length} check lulus!`, bugs?'bug':'ok');
  if(btn){btn.disabled=false;btn.textContent='üîç Scan Sekarang';}
}

async function aitRunFix(){
  aitScanLog('üîß Menjalankan auto-fix...', 'fix');
  let fixed=0;
  for(const ck of BUG_CHECKS){
    if(!ck.fix) continue;
    try{
      const r=ck.check();
      if(!r.ok){ ck.fix(); fixed++; aitScanLog(`Fixed: ${ck.name}`, 'fix'); }
    }catch(e){}
  }
  aitScanLog(`üîß Fix selesai ‚Äî ${fixed} item diperbaiki`, 'fix');
}

function aitAutoToggle(){
  const btn = document.getElementById('ait-auto-btn');
  aitAutoScanActive = !aitAutoScanActive;
  if(aitAutoScanActive){
    btn.textContent='‚è∏ Stop Auto';
    btn.style.borderColor='var(--accent)';
    aitScanLog('‚ñ∂ Auto scan aktif (setiap 5 menit)', 'info');
    aitRunScan();
    aitAutoInterval = setInterval(aitRunScan, 300000);
  } else {
    btn.textContent='‚ñ∂ Auto Scan';
    btn.style.borderColor='';
    clearInterval(aitAutoInterval);
    aitScanLog('‚èπ Auto scan dihentikan', 'info');
  }
}

function aitClearLog(){
  const log = document.getElementById('ait-scan-log');
  if(log) log.innerHTML='';
}

function aitClearStorage(){
  if(confirm('Hapus semua data Toolbox dari localStorage?')){
    Object.keys(localStorage).filter(k=>k.startsWith('tb-')).forEach(k=>localStorage.removeItem(k));
    aitScanLog('üóë localStorage tb-* dihapus', 'fix');
    showNotif('üóë Data dihapus!');
  }
}

function aitUpdateStats(){
  const stats = document.getElementById('ait-stats');
  if(!stats) return;
  const tbKeys = Object.keys(localStorage).filter(k=>k.startsWith('tb-'));
  const totalSize = tbKeys.reduce((s,k)=>s+(localStorage.getItem(k)||'').length,0);
  const panels = document.querySelectorAll('.tool-panel').length;
  stats.innerHTML = `
    <div>üîß <b style="color:var(--accent2);">${panels}</b> tools tersedia</div>
    <div>üíæ <b style="color:var(--accent2);">${tbKeys.length}</b> data tersimpan (${(totalSize/1024).toFixed(1)}KB)</div>
    <div>üîç <b style="color:var(--accent2);">${typeof BUG_CHECKS!=='undefined'?BUG_CHECKS.length:0}</b> bug checks</div>
    <div>üí¨ <b style="color:var(--accent2);">${aitChatHistory.length}</b> pesan dalam sesi ini</div>
    <div>üïê <b style="color:var(--accent2);">${new Date().toLocaleTimeString('id-ID')}</b></div>
  `;
}

// ‚îÄ‚îÄ Init: welcome log ‚îÄ‚îÄ
window.addEventListener('load', () => {
  const btn = document.getElementById('aitools-btn');
  if(btn) {
    btn.title = `AITools ‚Äî ${typeof BUG_CHECKS!=='undefined'?BUG_CHECKS.length:0} checks tersedia`;
    setTimeout(()=>{ showNotif('ü§ñ AITools siap! Klik bola kanan bawah'); }, 2500);
  }
});
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üéµ AUDIO VISUALIZER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let avCtx=null,avAnalyser=null,avSource=null,avStream=null,avRAF=null,avMode='bars',avMicActive=false;
function avGetCanvas(){const c=document.getElementById('av-canvas');c.width=c.offsetWidth||600;c.height=220;return c;}
function avSetMode(m){avMode=m;}
function avToggleMic(){
  if(avMicActive){avStop();return;}
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    avStream=stream;
    avCtx=new(window.AudioContext||window.webkitAudioContext)();
    avAnalyser=avCtx.createAnalyser();
    avAnalyser.fftSize=2048;
    avSource=avCtx.createMediaStreamSource(stream);
    avSource.connect(avAnalyser);
    avMicActive=true;
    document.getElementById('av-mic-btn').textContent='üî¥ Stop Mic';
    document.getElementById('av-stop-btn').style.display='inline-block';
    document.getElementById('av-status').textContent='üéôÔ∏è Merekam dari mikrofon...';
    avDraw();
  }).catch(e=>{document.getElementById('av-status').textContent='‚ùå Akses mic ditolak: '+e.message;});
}
function avLoadFile(inp){
  if(!inp.files[0])return;
  const file=inp.files[0];
  const url=URL.createObjectURL(file);
  if(avStream){avStream.getTracks().forEach(t=>t.stop());avStream=null;}
  if(avCtx){avCtx.close();}
  avCtx=new(window.AudioContext||window.webkitAudioContext)();
  avAnalyser=avCtx.createAnalyser();
  avAnalyser.fftSize=2048;
  const audio=new Audio(url);
  audio.crossOrigin='anonymous';
  avSource=avCtx.createMediaElementSource(audio);
  avSource.connect(avAnalyser);
  avAnalyser.connect(avCtx.destination);
  audio.play();
  avMicActive=false;
  document.getElementById('av-mic-btn').textContent='üéôÔ∏è Rekam Mic';
  document.getElementById('av-stop-btn').style.display='inline-block';
  document.getElementById('av-status').textContent='‚ñ∂ Memutar: '+file.name;
  avDraw();
}
function avStop(){
  cancelAnimationFrame(avRAF);
  if(avStream)avStream.getTracks().forEach(t=>t.stop());
  if(avCtx)avCtx.close();
  avCtx=avAnalyser=avSource=avStream=null;avMicActive=false;
  document.getElementById('av-mic-btn').textContent='üéôÔ∏è Rekam Mic';
  document.getElementById('av-stop-btn').style.display='none';
  document.getElementById('av-status').textContent='Dihentikan';
  const cv=document.getElementById('av-canvas');
  const ctx=cv.getContext('2d');
  ctx.clearRect(0,0,cv.width,cv.height);
}
function avGetColor(idx,total,scheme){
  const h=scheme==='rainbow'?(idx/total)*360:scheme==='purple'?260+idx/total*40:scheme==='cyan'?180+idx/total*30:scheme==='fire'?idx/total*60:idx/total*360;
  const s=scheme==='mono'?0:85,l=scheme==='mono'?60:55;
  return `hsl(${h},${s}%,${l}%)`;
}
function avDraw(){
  if(!avAnalyser)return;
  const cv=avGetCanvas();
  const ctx=cv.getContext('2d');
  const gain=parseFloat(document.getElementById('av-gain')?.value||2);
  const smooth=parseFloat(document.getElementById('av-smooth')?.value||0.75);
  const color=document.getElementById('av-color')?.value||'rainbow';
  avAnalyser.smoothingTimeConstant=smooth;
  const bufLen=avAnalyser.frequencyBinCount;
  const data=new Uint8Array(bufLen);
  const W=cv.width,H=cv.height;
  ctx.fillStyle='#050508';
  ctx.fillRect(0,0,W,H);
  if(avMode==='bars'){
    avAnalyser.getByteFrequencyData(data);
    const n=Math.min(120,bufLen);
    const bw=W/n;
    for(let i=0;i<n;i++){
      const v=Math.min(H,(data[i]/255)*H*gain);
      const x=i*bw;
      ctx.fillStyle=avGetColor(i,n,color);
      ctx.shadowColor=avGetColor(i,n,color);
      ctx.shadowBlur=8;
      ctx.beginPath();
      if(ctx.roundRect)ctx.roundRect(x+1,H-v,bw-2,v,3);
      else ctx.rect(x+1,H-v,bw-2,v);
      ctx.fill();
    }
  } else if(avMode==='wave'){
    avAnalyser.getByteTimeDomainData(data);
    ctx.beginPath();
    ctx.strokeStyle=avGetColor(0,1,color);
    ctx.lineWidth=2.5;
    ctx.shadowColor=avGetColor(0,1,color);
    ctx.shadowBlur=12;
    for(let i=0;i<bufLen;i++){
      const x=i/bufLen*W;
      const y=((data[i]/128)-1)*H/2*gain+H/2;
      i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    }
    ctx.stroke();
  } else if(avMode==='circle'){
    avAnalyser.getByteFrequencyData(data);
    const cx=W/2,cy=H/2,r=Math.min(W,H)*0.28;
    const n=Math.min(180,bufLen);
    for(let i=0;i<n;i++){
      const angle=(i/n)*Math.PI*2-Math.PI/2;
      const v=(data[i]/255)*r*gain*0.8;
      const x1=cx+Math.cos(angle)*r,y1=cy+Math.sin(angle)*r;
      const x2=cx+Math.cos(angle)*(r+v),y2=cy+Math.sin(angle)*(r+v);
      ctx.strokeStyle=avGetColor(i,n,color);
      ctx.lineWidth=2;
      ctx.shadowColor=avGetColor(i,n,color);
      ctx.shadowBlur=6;
      ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
    }
  }
  avRAF=requestAnimationFrame(avDraw);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üì∏ SCREENSHOT ANNOTATOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let annTool='arrow',annDrawing=false,annStartX=0,annStartY=0,annImg=null,annHistory=[],annSnapshot=null;
function annSetTool(t){
  annTool=t;
  document.querySelectorAll('[id^="ann-tool-"]').forEach(b=>b.style.borderColor='');
  const btn=document.getElementById('ann-tool-'+t);
  if(btn)btn.style.borderColor='var(--accent)';
  const cv=document.getElementById('ann-canvas');
  if(cv)cv.style.cursor=t==='text'?'text':t==='blur'?'crosshair':'crosshair';
  const ti=document.getElementById('ann-text-input');
  if(ti)ti.style.display=t==='text'?'block':'none';
}
function annLoad(inp){
  if(!inp.files[0])return;
  const reader=new FileReader();
  reader.onload=e=>annSetImg(e.target.result);
  reader.readAsDataURL(inp.files[0]);
}
function annSetImg(src){
  const img=new Image();
  img.onload=()=>{
    annImg=img;
    const cv=document.getElementById('ann-canvas');
    cv.width=Math.min(img.width,900);
    cv.height=Math.round(img.height*(cv.width/img.width));
    const ctx=cv.getContext('2d');
    ctx.drawImage(img,0,0,cv.width,cv.height);
    document.getElementById('ann-placeholder').style.display='none';
    annHistory=[];
    annSaveSnap();
  };
  img.src=src;
}
function annSaveSnap(){
  const cv=document.getElementById('ann-canvas');
  if(!cv.width)return;
  const snap=document.createElement('canvas');
  snap.width=cv.width;snap.height=cv.height;
  snap.getContext('2d').drawImage(cv,0,0);
  annHistory.push(snap);
  if(annHistory.length>30)annHistory.shift();
}
function annUndo(){
  if(annHistory.length<2){showNotif('‚ö† Tidak ada yang bisa di-undo');return;}
  annHistory.pop();
  const cv=document.getElementById('ann-canvas');
  cv.getContext('2d').drawImage(annHistory[annHistory.length-1],0,0);
}
function annClear(){
  if(!annImg)return;
  const cv=document.getElementById('ann-canvas');
  const ctx=cv.getContext('2d');
  ctx.drawImage(annImg,0,0,cv.width,cv.height);
  annHistory=[];annSaveSnap();
}
function annDownload(){
  const cv=document.getElementById('ann-canvas');
  if(!cv.width){showNotif('‚ö† Belum ada gambar');return;}
  const a=document.createElement('a');
  a.download='annotated-'+Date.now()+'.png';
  a.href=cv.toDataURL();a.click();
  showNotif('üíæ Gambar disimpan!');
}
(function annInit(){
  const cv=document.getElementById('ann-canvas');
  if(!cv)return;
  const getPos=e=>{
    const r=cv.getBoundingClientRect();
    const src=e.touches?e.touches[0]:e;
    return{x:(src.clientX-r.left)*(cv.width/r.width),y:(src.clientY-r.top)*(cv.height/r.height)};
  };
  cv.addEventListener('mousedown',e=>{
    if(!annImg)return;
    annDrawing=true;
    const{x,y}=getPos(e);
    annStartX=x;annStartY=y;
    annSnapshot=document.createElement('canvas');
    annSnapshot.width=cv.width;annSnapshot.height=cv.height;
    annSnapshot.getContext('2d').drawImage(cv,0,0);
    if(annTool==='text'){
      const txt=document.getElementById('ann-text-input')?.value||'Teks';
      const ctx=cv.getContext('2d');
      ctx.fillStyle=document.getElementById('ann-color')?.value||'#ff0000';
      ctx.font=`${20}px Arial`;
      ctx.fillText(txt,x,y);
      annDrawing=false;annSaveSnap();
    } else if(annTool==='pen'){
      const ctx=cv.getContext('2d');
      ctx.beginPath();ctx.moveTo(x,y);
    }
  });
  cv.addEventListener('mousemove',e=>{
    if(!annDrawing||!annSnapshot)return;
    const{x,y}=getPos(e);
    const ctx=cv.getContext('2d');
    const col=document.getElementById('ann-color')?.value||'#ff0000';
    const sz=parseInt(document.getElementById('ann-size')?.value||4);
    if(annTool==='pen'){
      ctx.strokeStyle=col;ctx.lineWidth=sz;ctx.lineCap='round';
      ctx.lineTo(x,y);ctx.stroke();ctx.beginPath();ctx.moveTo(x,y);
      return;
    }
    ctx.drawImage(annSnapshot,0,0);
    ctx.strokeStyle=col;ctx.lineWidth=sz;ctx.lineCap='round';
    if(annTool==='arrow'){
      const dx=x-annStartX,dy=y-annStartY,len=Math.hypot(dx,dy),ang=Math.atan2(dy,dx);
      ctx.beginPath();ctx.moveTo(annStartX,annStartY);ctx.lineTo(x,y);ctx.stroke();
      if(len>10){
        const hw=Math.max(12,sz*3),ha=0.45;
        ctx.beginPath();
        ctx.moveTo(x,y);
        ctx.lineTo(x-hw*Math.cos(ang-ha),y-hw*Math.sin(ang-ha));
        ctx.lineTo(x-hw*Math.cos(ang+ha),y-hw*Math.sin(ang+ha));
        ctx.closePath();ctx.fillStyle=col;ctx.fill();
      }
    } else if(annTool==='rect'){
      ctx.strokeRect(annStartX,annStartY,x-annStartX,y-annStartY);
    } else if(annTool==='blur'){
      const bw=Math.abs(x-annStartX),bh=Math.abs(y-annStartY);
      const bx=Math.min(x,annStartX),by=Math.min(y,annStartY);
      if(bw>4&&bh>4){
        ctx.save();ctx.filter='blur(12px)';
        ctx.drawImage(cv,bx,by,bw,bh,bx,by,bw,bh);
        ctx.restore();
        ctx.strokeRect(bx,by,bw,bh);
      }
    }
  });
  cv.addEventListener('mouseup',()=>{if(annDrawing){annDrawing=false;annSaveSnap();}});
  // Paste from clipboard
  document.addEventListener('paste',e=>{
    const items=[...(e.clipboardData?.items||[])];
    const imgItem=items.find(i=>i.type.startsWith('image/'));
    if(imgItem){const f=imgItem.getAsFile();const r=new FileReader();r.onload=ev=>annSetImg(ev.target.result);r.readAsDataURL(f);}
  });
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üîê PASSWORD VAULT (AES-GCM)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let vaultKey=null,vaultData=[];
async function vaultDeriveKey(pw,salt){
  const enc=new TextEncoder();
  const keyMaterial=await crypto.subtle.importKey('raw',enc.encode(pw),{name:'PBKDF2'},false,['deriveKey']);
  return crypto.subtle.deriveKey({name:'PBKDF2',salt,iterations:100000,hash:'SHA-256'},keyMaterial,{name:'AES-GCM',length:256},false,['encrypt','decrypt']);
}
async function vaultEncrypt(data,key){
  const iv=crypto.getRandomValues(new Uint8Array(12));
  const enc=new TextEncoder();
  const ct=await crypto.subtle.encrypt({name:'AES-GCM',iv},key,enc.encode(JSON.stringify(data)));
  return {iv:Array.from(iv),ct:Array.from(new Uint8Array(ct))};
}
async function vaultDecrypt(enc,key){
  const iv=new Uint8Array(enc.iv);
  const ct=new Uint8Array(enc.ct);
  const pt=await crypto.subtle.decrypt({name:'AES-GCM',iv},key,ct);
  return JSON.parse(new TextDecoder().decode(pt));
}
function vaultCheckState(){
  const hasVault=!!localStorage.getItem('tb-vault-salt');
  document.getElementById('vault-create-btn').style.display=hasVault?'none':'inline-block';
  document.getElementById('vault-lock-msg').textContent=hasVault?'Masukkan master password untuk membuka vault':'Buat vault baru dengan master password';
}
async function vaultCreate(){
  const pw=document.getElementById('vault-master-input')?.value;
  if(!pw||pw.length<6){document.getElementById('vault-lock-err').textContent='Password min 6 karakter';return;}
  const salt=crypto.getRandomValues(new Uint8Array(16));
  vaultKey=await vaultDeriveKey(pw,salt);
  localStorage.setItem('tb-vault-salt',JSON.stringify(Array.from(salt)));
  vaultData=[];
  await vaultSave();
  vaultOpen();showNotif('‚úÖ Vault berhasil dibuat!');
}
async function vaultUnlock(){
  const pw=document.getElementById('vault-master-input')?.value;
  const saltArr=JSON.parse(localStorage.getItem('tb-vault-salt')||'null');
  if(!saltArr){vaultCreate();return;}
  try{
    const salt=new Uint8Array(saltArr);
    vaultKey=await vaultDeriveKey(pw,salt);
    const enc=JSON.parse(localStorage.getItem('tb-vault-data')||'null');
    vaultData=enc?await vaultDecrypt(enc,vaultKey):[];
    vaultOpen();
  }catch(e){
    document.getElementById('vault-lock-err').textContent='‚ùå Password salah!';
    vaultKey=null;
  }
}
function vaultOpen(){
  document.getElementById('vault-lock-screen').style.display='none';
  document.getElementById('vault-main').style.display='block';
  document.getElementById('vault-master-input').value='';
  document.getElementById('vault-lock-err').textContent='';
  vaultRender();
}
function vaultLock(){
  vaultKey=null;vaultData=[];
  document.getElementById('vault-lock-screen').style.display='block';
  document.getElementById('vault-main').style.display='none';
}
async function vaultSave(){
  if(!vaultKey)return;
  const enc=await vaultEncrypt(vaultData,vaultKey);
  localStorage.setItem('tb-vault-data',JSON.stringify(enc));
}
function vaultRender(){
  const q=(document.getElementById('vault-search')?.value||'').toLowerCase();
  const list=document.getElementById('vault-list');
  const empty=document.getElementById('vault-empty');
  const filtered=vaultData.filter(e=>(e.site+e.user+e.note).toLowerCase().includes(q));
  if(!filtered.length){list.innerHTML='';empty.style.display='block';return;}
  empty.style.display='none';
  list.innerHTML=filtered.map((e,i)=>`
    <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px;">
      <div style="flex:1;min-width:0;">
        <div style="font-weight:700;font-size:0.78rem;color:var(--accent2);">${e.site||'‚Äî'}</div>
        <div style="font-size:0.72rem;color:var(--muted);margin-top:2px;">${e.user||'‚Äî'}</div>
        ${e.note?`<div style="font-size:0.65rem;color:var(--muted);margin-top:2px;">${e.note}</div>`:''}
      </div>
      <div style="display:flex;gap:4px;flex-shrink:0;">
        <button onclick="vaultCopy('${vaultData.indexOf(e)}','user')" style="background:rgba(124,58,237,0.1);border:1px solid rgba(124,58,237,0.2);border-radius:6px;padding:4px 8px;font-size:0.65rem;cursor:pointer;color:var(--accent2);">üë§ Copy</button>
        <button onclick="vaultCopy('${vaultData.indexOf(e)}','pass')" style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.2);border-radius:6px;padding:4px 8px;font-size:0.65rem;cursor:pointer;color:var(--success);">üîë Pass</button>
        <button onclick="vaultDelete(${vaultData.indexOf(e)})" style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:6px;padding:4px 8px;font-size:0.65rem;cursor:pointer;color:var(--danger);">üóë</button>
      </div>
    </div>`).join('');
}
function vaultCopy(idx,field){
  const e=vaultData[idx];if(!e)return;
  const val=field==='user'?e.user:e.pass;
  navigator.clipboard.writeText(val).then(()=>showNotif(field==='user'?'üë§ Username disalin!':'üîë Password disalin!'));
}
async function vaultDelete(idx){
  if(!confirm('Hapus entri ini?'))return;
  vaultData.splice(idx,1);
  await vaultSave();vaultRender();showNotif('üóë Dihapus!');
}
function vaultShowAdd(){document.getElementById('vault-add-form').style.display='block';}
function vaultHideAdd(){document.getElementById('vault-add-form').style.display='none';}
async function vaultSaveEntry(){
  const site=document.getElementById('v-site')?.value.trim();
  const user=document.getElementById('v-user')?.value.trim();
  const pass=document.getElementById('v-pass')?.value;
  if(!site||!user||!pass){showNotif('‚ö† Isi site, username, dan password!');return;}
  vaultData.unshift({site,user,pass,note:document.getElementById('v-note')?.value,id:Date.now()});
  await vaultSave();vaultRender();vaultHideAdd();
  ['v-site','v-user','v-pass','v-note'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  showNotif('‚úÖ Disimpan!');
}
function vaultGenPass(){
  const chars='ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%^&*';
  const arr=new Uint32Array(16);crypto.getRandomValues(arr);
  const pw=Array.from(arr).map(v=>chars[v%chars.length]).join('');
  const el=document.getElementById('v-pass');if(el){el.value=pw;el.type='text';}
}
function vaultExport(){
  if(!vaultKey){showNotif('‚ö† Buka vault dulu');return;}
  const blob=new Blob([JSON.stringify({entries:vaultData,exported:new Date().toISOString()},null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='vault-export.json';a.click();
  showNotif('üì§ Vault diekspor (SIMPAN DI TEMPAT AMAN)!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üßÆ FORMULA BUILDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FORMULA_QUICK=[
  {name:'Kuadrat',f:'x¬≤ = x * x'},
  {name:'Pythagoras',f:'c = ‚àö(a¬≤ + b¬≤)'},
  {name:'BMI',f:'BMI = berat / (tinggi * tinggi)'},
  {name:'Kecepatan',f:'v = jarak / waktu'},
  {name:'Bunga Majemuk',f:'A = P * (1 + r)^t'},
  {name:'Luas Lingkaran',f:'A = œÄ * r¬≤'},
  {name:'Keliling Lingkaran',f:'K = 2 * œÄ * r'},
  {name:'E=mc¬≤',f:'E = m * c¬≤'},
  {name:'Ohm',f:'V = I * R'},
  {name:'ABC',f:'x = (-b ¬± ‚àö(b¬≤-4ac)) / (2*a)'},
];
function formulaRender(){
  const input=document.getElementById('formula-input')?.value||'';
  const preview=document.getElementById('formula-preview');
  if(!preview)return;
  // Format display
  let html=input
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\*\*(.+?)\*\*/g,'<b>$1</b>')
    .replace(/‚àö\(([^)]+)\)/g,'‚àö<span style="border-top:1.5px solid currentColor;padding-top:1px;">($1)</span>')
    .replace(/\^(\d+)/g,'<sup>$1</sup>')
    .replace(/¬±/g,'<span style="color:var(--accent2);">¬±</span>')
    .replace(/œÄ/g,'<span style="color:var(--accent);">œÄ</span>')
    .replace(/\n/g,'<br><br>');
  preview.innerHTML=html||'<span style="color:var(--muted);">Tulis rumus di kiri...</span>';
  // Detect variables (single letters that aren't œÄ)
  const vars=[...new Set((input.match(/\b([a-zA-Z])\b/g)||[]).filter(v=>!['e','E','œÄ'].includes(v)))];
  const varDiv=document.getElementById('formula-vars');
  if(varDiv){
    varDiv.innerHTML=vars.map(v=>`
      <div style="display:flex;align-items:center;gap:6px;">
        <label style="font-size:0.72rem;color:var(--accent2);width:20px;">${v} =</label>
        <input type="number" id="fv-${v}" placeholder="0" style="width:90px;" oninput="formulaEval()">
      </div>`).join('');
  }
}
function formulaEval(){
  const input=document.getElementById('formula-input')?.value||'';
  const result=document.getElementById('formula-result');
  if(!result)return;
  // Replace variable values
  let expr=input.split('\n')[input.split('\n').length-1]; // last line
  expr=expr.replace(/=.+/,'').trim(); // get RHS if assignment
  if(input.includes('=')){const parts=input.split('\n').pop().split('=');if(parts[1])expr=parts[1];}
  // Replace vars with values
  expr=expr.replace(/‚àö\(([^)]+)\)/g,'Math.sqrt($1)')
           .replace(/\^(\d+\.?\d*)/g,'**$1')
           .replace(/œÄ/g,'Math.PI')
           .replace(/([a-wyz])\b/g,(_,v)=>document.getElementById('fv-'+v)?.value||'0');
  try{
    const val=Function('"use strict";return ('+expr+')')();
    if(isNaN(val)||!isFinite(val)){result.textContent='‚ö† Hasil tidak valid';return;}
    result.textContent='= '+parseFloat(val.toFixed(10)).toString();
    const hist=document.getElementById('formula-history');
    if(hist){
      const d=document.createElement('div');
      d.style.cssText='padding:3px 6px;border-bottom:1px solid var(--border);font-size:0.7rem;color:var(--muted);';
      d.textContent=`${expr.slice(0,40)} = ${parseFloat(val.toFixed(8))}`;
      hist.insertBefore(d,hist.firstChild);
      while(hist.children.length>20)hist.removeChild(hist.lastChild);
    }
  }catch(e){result.textContent='‚ö† Error: '+e.message;}
}
function formulaInitQuick(){
  const wrap=document.getElementById('formula-quick');
  if(!wrap)return;
  wrap.innerHTML=FORMULA_QUICK.map(q=>`<button class="aitools-quick-btn" onclick="document.getElementById('formula-input').value='${q.f}';formulaRender();">${q.name}</button>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üß† AI SUMMARIZER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function summarizeText(){
  const text=document.getElementById('sum-input')?.value?.trim();
  if(!text){showNotif('‚ö† Masukkan teks dulu!');return;}
  if(text.length<50){showNotif('‚ö† Teks terlalu pendek!');return;}
  const btn=document.getElementById('sum-btn');
  const out=document.getElementById('sum-out');
  const style=document.getElementById('sum-style')?.value||'points';
  const lang=document.getElementById('sum-lang')?.value||'id';
  btn.disabled=true;btn.textContent='‚è≥ Meringkas...';
  out.innerHTML='<span style="color:var(--muted);">AI sedang memproses...</span>';

  const stylePrompts={
    points:`Buat ringkasan dalam **3 poin utama** yang paling penting dari teks berikut. Gunakan format:\n‚Ä¢ Poin 1: ...\n‚Ä¢ Poin 2: ...\n‚Ä¢ Poin 3: ...`,
    summary:`Buat ringkasan singkat dalam 2-3 paragraf dari teks berikut.`,
    tldr:`Buat TL;DR (Too Long; Didn't Read) dalam SATU kalimat saja, max 40 kata.`,
    bullets:`Buat daftar bullet points detail (5-8 poin) dari teks berikut.`,
    keywords:`Ekstrak 8-12 kata kunci/frase terpenting dari teks berikut, pisahkan dengan koma.`,
  };
  const langNote=lang==='id'?'Tulis dalam Bahasa Indonesia.':lang==='en'?'Write in English.':'Gunakan bahasa yang sama dengan input.';

  try{
    const res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:1000,
        messages:[{role:'user',content:`${stylePrompts[style]||stylePrompts.points}\n${langNote}\n\n---\n${text.slice(0,8000)}`}]
      })
    });
    const data=await res.json();
    const reply=data?.content?.[0]?.text||'Gagal meringkas.';
    out.style.cssText='background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;min-height:220px;font-size:0.82rem;line-height:1.7;white-space:pre-wrap;overflow-y:auto;';
    out.textContent=reply;
    showNotif('‚úÖ Teks berhasil diringkas!');
  }catch(e){
    out.textContent='‚ùå Error: '+e.message;
  }
  btn.disabled=false;btn.textContent='üß† Ringkas Sekarang';
}
document.getElementById('sum-input')?.addEventListener('input',function(){
  document.getElementById('sum-chars').textContent=this.value.length+' karakter';
});
function sumSpeak(){
  if(!window.speechSynthesis){showNotif('‚ùå TTS tidak tersedia');return;}
  const text=document.getElementById('sum-out')?.textContent;
  if(!text?.trim()){showNotif('‚ö† Belum ada hasil ringkasan');return;}
  window.speechSynthesis.cancel();
  const utt=new SpeechSynthesisUtterance(text);
  utt.lang='id-ID';utt.rate=0.9;
  window.speechSynthesis.speak(utt);
  showNotif('üîä Membacakan ringkasan...');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üìß EMAIL TEMPLATE BUILDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let etplTemplates=JSON.parse(localStorage.getItem('tb-etpl')||'[]');
const ETPL_PRESETS={
  intro:`Kepada Yth,\nBapak/Ibu {{nama_penerima}}\n\nDengan hormat,\n\nPerkenalkan, saya {{nama_pengirim}} dari {{perusahaan}}. Saya menghubungi Anda untuk {{tujuan}}.\n\nSaya akan senang jika kita bisa mendiskusikan hal ini lebih lanjut. Apakah Anda tersedia untuk meeting singkat di {{waktu}}?\n\nHormat saya,\n{{nama_pengirim}}\n{{jabatan}}`,
  followup:`Subject: Follow Up ‚Äî {{topik_meeting}}\n\nHalo {{nama}},\n\nTerima kasih atas waktu Anda dalam meeting {{tanggal}}. Seperti yang telah kita diskusikan, berikut adalah poin-poin penting:\n\n‚Ä¢ {{poin_1}}\n‚Ä¢ {{poin_2}}\n‚Ä¢ {{poin_3}}\n\nLangkah selanjutnya adalah {{next_step}} dengan deadline {{deadline}}.\n\nMohon konfirmasinya.\n\nSalam,\n{{nama_pengirim}}`,
  invoice:`Kepada Yth {{klien}},\n\nBerikut adalah tagihan untuk {{proyek}} yang telah diselesaikan:\n\nNomor Invoice: INV-{{nomor}}\nTanggal: {{tanggal}}\nTotal: Rp {{jumlah}}\n\nMohon transfer ke rekening:\nBank: {{bank}}\nNo. Rek: {{no_rekening}}\nA/N: {{nama_rekening}}\n\nJatuh tempo: {{jatuh_tempo}}\n\nTerima kasih atas kepercayaan Anda.\n\n{{nama_pengirim}}`,
  thanks:`Halo {{nama}},\n\nTerima kasih banyak atas {{hal}} yang Anda berikan. Hal ini sangat berarti bagi saya/kami.\n\n{{pesan_personal}}\n\nSemoga kita bisa terus bekerja sama di masa mendatang.\n\nSalam hangat,\n{{nama_pengirim}}`,
  collab:`Kepada {{nama}},\n\nSaya {{pengirim}} dari {{perusahaan_pengirim}}. Saya sangat mengagumi {{hal_tentang_mereka}}.\n\nSaya ingin mengajak {{nama}} untuk berkolaborasi dalam {{proyek}}. Saya percaya kita bisa menciptakan sesuatu yang luar biasa bersama.\n\nNilai yang bisa saya tawarkan:\n‚Ä¢ {{nilai_1}}\n‚Ä¢ {{nilai_2}}\n\nApakah Anda tertarik untuk mendiskusikan ini lebih lanjut?\n\nSalam,\n{{pengirim}}`,
};
function etplLoadPreset(val){
  if(!val)return;
  const tpl=ETPL_PRESETS[val];
  if(tpl){
    const lines=tpl.split('\n');
    const sub=lines[0].startsWith('Subject:')?lines[0].replace('Subject:','').trim():'Email ‚Äî '+val;
    const body=lines[0].startsWith('Subject:')?lines.slice(1).join('\n').trim():tpl;
    const si=document.getElementById('etpl-subject'),bi=document.getElementById('etpl-body');
    if(si)si.value=sub;if(bi)bi.value=body;
    etplDetectVars();etplPreview();
  }
}
function etplDetectVars(){
  const body=(document.getElementById('etpl-body')?.value||'')+(document.getElementById('etpl-subject')?.value||'');
  const vars=[...new Set((body.match(/\{\{([^}]+)\}\}/g)||[]).map(m=>m.replace(/\{\{|\}\}/g,'')))];
  const wrap=document.getElementById('etpl-vars-row');
  if(!wrap)return;
  if(!vars.length){wrap.innerHTML='';etplPreview();return;}
  wrap.innerHTML='<div style="font-size:0.65rem;color:var(--muted);margin-bottom:6px;">üìù Isi variabel:</div>'+
    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">'+
    vars.map(v=>`<div><label style="font-size:0.65rem;">${v.replace(/_/g,' ')}</label><input type="text" id="etv-${v}" placeholder="${v}" oninput="etplPreview()" style="font-size:0.72rem;"></div>`).join('')+
    '</div>';
  etplPreview();
}
function etplPreview(){
  let body=document.getElementById('etpl-body')?.value||'';
  const sub=document.getElementById('etpl-subject')?.value||'';
  const vars=[...new Set((body+sub).match(/\{\{([^}]+)\}\}/g)||[]).map(m=>m.replace(/\{\{|\}\}/g,''))];
  vars.forEach(v=>{const val=document.getElementById('etv-'+v)?.value;if(val)body=body.replace(new RegExp('\\{\\{'+v+'\\}\\}','g'),val);});
  const prev=document.getElementById('etpl-preview');
  if(prev)prev.textContent=body||'(Preview kosong)';
}
function etplCopyFinal(){
  let body=document.getElementById('etpl-body')?.value||'';
  const vars=[...new Set((body).match(/\{\{([^}]+)\}\}/g)||[]).map(m=>m.replace(/\{\{|\}\}/g,''))];
  vars.forEach(v=>{const val=document.getElementById('etv-'+v)?.value;if(val)body=body.replace(new RegExp('\\{\\{'+v+'\\}\\}','g'),val);});
  navigator.clipboard.writeText(body).then(()=>showNotif('üìã Email disalin!'));
}
function etplOpenMailto(){
  const sub=encodeURIComponent(document.getElementById('etpl-subject')?.value||'');
  let body=document.getElementById('etpl-body')?.value||'';
  const vars=[...new Set((body).match(/\{\{([^}]+)\}\}/g)||[]).map(m=>m.replace(/\{\{|\}\}/g,''))];
  vars.forEach(v=>{const val=document.getElementById('etv-'+v)?.value;if(val)body=body.replace(new RegExp('\\{\\{'+v+'\\}\\}','g'),val);});
  window.open(`mailto:?subject=${sub}&body=${encodeURIComponent(body)}`);
}
function etplWhatsapp(){
  let body=document.getElementById('etpl-body')?.value||'';
  const vars=[...new Set((body).match(/\{\{([^}]+)\}\}/g)||[]).map(m=>m.replace(/\{\{|\}\}/g,''))];
  vars.forEach(v=>{const val=document.getElementById('etv-'+v)?.value;if(val)body=body.replace(new RegExp('\\{\\{'+v+'\\}\\}','g'),val);});
  window.open('https://wa.me/?text='+encodeURIComponent(body));
}
function etplSaveTemplate(){
  const title=document.getElementById('etpl-subject')?.value||('Template '+Date.now());
  const body=document.getElementById('etpl-body')?.value||'';
  etplTemplates.unshift({id:Date.now(),title,body});
  if(etplTemplates.length>10)etplTemplates.pop();
  localStorage.setItem('tb-etpl',JSON.stringify(etplTemplates));
  etplRenderSaved();showNotif('üíæ Template disimpan!');
}
function etplRenderSaved(){
  const wrap=document.getElementById('etpl-saved-list');
  if(!wrap)return;
  if(!etplTemplates.length){wrap.innerHTML='<div style="color:var(--muted);font-size:0.7rem;">Belum ada template tersimpan</div>';return;}
  wrap.innerHTML=etplTemplates.map(t=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid var(--border);">
      <span style="font-size:0.7rem;cursor:pointer;color:var(--accent2);" onclick="etplLoadSaved(${t.id})">${t.title.slice(0,30)}</span>
      <button onclick="etplDeleteSaved(${t.id})" style="background:none;border:none;color:var(--danger);cursor:pointer;font-size:0.7rem;">‚úï</button>
    </div>`).join('');
}
function etplLoadSaved(id){
  const t=etplTemplates.find(x=>x.id===id);
  if(!t)return;
  const si=document.getElementById('etpl-subject'),bi=document.getElementById('etpl-body');
  if(si)si.value=t.title;if(bi)bi.value=t.body;
  etplDetectVars();
}
function etplDeleteSaved(id){
  etplTemplates=etplTemplates.filter(t=>t.id!==id);
  localStorage.setItem('tb-etpl',JSON.stringify(etplTemplates));
  etplRenderSaved();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚è∞ FOCUS MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let focusInterval=null,focusRunning=false,focusPhase='focus',focusSessions=0,focusSecondsLeft=25*60;
function focusToggle(){
  if(focusRunning){clearInterval(focusInterval);focusRunning=false;document.getElementById('focus-start-btn').textContent='‚ñ∂ Mulai Fokus';}
  else{focusRunning=true;document.getElementById('focus-start-btn').textContent='‚è∏ Pause';
    focusInterval=setInterval(()=>{
      focusSecondsLeft--;
      focusUpdateDisplay();
      if(focusSecondsLeft<=0)focusNextPhase();
    },1000);
  }
}
function focusNextPhase(){
  clearInterval(focusInterval);focusRunning=false;
  const sessions=parseInt(document.getElementById('focus-sessions')?.value||4);
  const shortMin=parseInt(document.getElementById('focus-short')?.value||5);
  const longMin=parseInt(document.getElementById('focus-long')?.value||15);
  const focMin=parseInt(document.getElementById('focus-dur')?.value||25);
  if(focusPhase==='focus'){
    focusSessions++;
    const task=document.getElementById('focus-task')?.value||'Sesi fokus';
    const hist=document.getElementById('focus-history');
    if(hist){const d=document.createElement('div');d.style.cssText='padding:2px 0;border-bottom:1px solid var(--border);';d.textContent=`‚úÖ ${new Date().toLocaleTimeString('id-ID')} ‚Äî ${task}`;hist.insertBefore(d,hist.firstChild);}
    if(focusSessions%sessions===0){focusPhase='long';focusSecondsLeft=longMin*60;showNotif('üéâ Istirahat panjang!');}
    else{focusPhase='break';focusSecondsLeft=shortMin*60;showNotif('‚òï Istirahat pendek!');}
  } else {focusPhase='focus';focusSecondsLeft=focMin*60;showNotif('üéØ Mulai fokus!');}
  if(document.getElementById('focus-sound')?.checked)focusBeep();
  if(document.getElementById('focus-notif')?.checked&&Notification.permission==='granted'){
    new Notification('‚è∞ Toolbox Focus',{body:focusPhase==='focus'?'Waktunya fokus!':'Waktunya istirahat!',icon:''});
  }
  document.getElementById('focus-start-btn').textContent='‚ñ∂ Mulai';
  focusUpdateDisplay();focusUpdateDots();
}
function focusUpdateDisplay(){
  const m=Math.floor(focusSecondsLeft/60).toString().padStart(2,'0');
  const s=(focusSecondsLeft%60).toString().padStart(2,'0');
  const el=document.getElementById('focus-timer-display');if(el)el.textContent=`${m}:${s}`;
  const lbl=document.getElementById('focus-session-label');
  if(lbl)lbl.textContent=focusPhase==='focus'?'üéØ Fokus':focusPhase==='break'?'‚òï Istirahat Pendek':'üå¥ Istirahat Panjang';
}
function focusReset(){
  clearInterval(focusInterval);focusRunning=false;
  focusPhase='focus';focusSessions=0;
  focusSecondsLeft=(parseInt(document.getElementById('focus-dur')?.value||25))*60;
  document.getElementById('focus-start-btn').textContent='‚ñ∂ Mulai Fokus';
  focusUpdateDisplay();focusUpdateDots();
}
function focusSkip(){focusSecondsLeft=0;focusNextPhase();}
function focusUpdateDots(){
  const wrap=document.getElementById('focus-sessions-dots');
  if(!wrap)return;
  const total=parseInt(document.getElementById('focus-sessions')?.value||4);
  wrap.innerHTML=Array.from({length:total},(_,i)=>`<div style="width:10px;height:10px;border-radius:50%;background:${i<focusSessions%total?'var(--accent)':'var(--border)'};transition:background 0.3s;"></div>`).join('');
}
function focusBeep(){
  try{const ac=new(window.AudioContext||window.webkitAudioContext)();const o=ac.createOscillator();const g=ac.createGain();o.connect(g);g.connect(ac.destination);o.frequency.value=440;g.gain.setValueAtTime(0.3,ac.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ac.currentTime+0.5);o.start();o.stop(ac.currentTime+0.5);}catch(e){}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üìä DATA VIZ STUDIO (Canvas-based, no CDN needed)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let dvChart=null;
const DV_THEMES={
  neon:['#7c3aed','#06b6d4','#10b981','#f59e0b','#ef4444','#a78bfa','#34d399','#fbbf24'],
  pastel:['#c4b5fd','#93c5fd','#6ee7b7','#fcd34d','#fca5a5','#f9a8d4','#a5f3fc','#d9f99d'],
  mono:['#e8e8f0','#9ca3af','#6b7280','#4b5563','#374151','#d1d5db','#f3f4f6','#b0b7c0'],
  fire:['#ef4444','#f97316','#f59e0b','#dc2626','#ea580c','#d97706','#b91c1c','#c2410c'],
};
function dvParseData(){
  const raw=(document.getElementById('dv-input')?.value||'').trim();
  if(!raw)return null;
  try{
    const json=JSON.parse(raw);
    if(Array.isArray(json))return{labels:json.map(x=>x.label||x.name||''),values:json.map(x=>+(x.value||x.val||0))};
  }catch(e){}
  // CSV parse
  const lines=raw.split('\n').filter(l=>l.trim()&&!l.startsWith('#'));
  const labels=[],values=[];
  for(const line of lines){
    const parts=line.split(/,|\t/);
    if(parts.length>=2){labels.push(parts[0].trim());const v=parseFloat(parts[1]);if(!isNaN(v))values.push(v);}
  }
  return labels.length?{labels,values}:null;
}
function dvRender(){
  const data=dvParseData();
  const placeholder=document.getElementById('dv-placeholder');
  const canvas=document.getElementById('dv-canvas');
  if(!data||!data.labels.length){if(placeholder)placeholder.style.display='block';if(canvas)canvas.style.display='none';return;}
  if(placeholder)placeholder.style.display='none';
  if(canvas)canvas.style.display='block';
  const type=document.getElementById('dv-type')?.value||'bar';
  const theme=document.getElementById('dv-theme')?.value||'neon';
  const title=document.getElementById('dv-title')?.value||'';
  const showLegend=document.getElementById('dv-legend')?.checked;
  const showGrid=document.getElementById('dv-grid')?.checked;
  const showValues=document.getElementById('dv-values')?.checked;
  const colors=DV_THEMES[theme]||DV_THEMES.neon;
  const W=canvas.offsetWidth||500,H=360;
  canvas.width=W;canvas.height=H;
  const ctx=canvas.getContext('2d');
  ctx.fillStyle='#050508';ctx.fillRect(0,0,W,H);
  const pad={top:title?52:28,right:20,bottom:showLegend?64:36,left:52};
  const cW=W-pad.left-pad.right,cH=H-pad.top-pad.bottom;
  // Title
  if(title){ctx.fillStyle='#e8e8f0';ctx.font='bold 15px Space Mono,monospace';ctx.textAlign='center';ctx.fillText(title,W/2,24);}
  const max=Math.max(...data.values,1);
  if(type==='bar'||type==='area'){
    // Grid
    if(showGrid){ctx.strokeStyle='rgba(255,255,255,0.07)';ctx.lineWidth=1;for(let i=0;i<=5;i++){const y=pad.top+cH*(1-i/5);ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(pad.left+cW,y);ctx.stroke();ctx.fillStyle='rgba(255,255,255,0.3)';ctx.font='9px monospace';ctx.textAlign='right';ctx.fillText(Math.round(max*i/5),pad.left-6,y+3);}}
    const bw=cW/data.labels.length;
    data.values.forEach((v,i)=>{
      const bh=Math.max(2,(v/max)*cH);
      const x=pad.left+i*bw,y=pad.top+cH-bh;
      const color=colors[i%colors.length];
      if(type==='area'){
        ctx.beginPath();ctx.fillStyle=color+'40';
        if(i===0)ctx.moveTo(x+bw/2,pad.top+cH);
        ctx.lineTo(x+bw/2,y);
        if(i===data.values.length-1){ctx.lineTo(x+bw/2,pad.top+cH);ctx.closePath();ctx.fill();}
      }
      // Bar
      const grd=ctx.createLinearGradient(x,y,x,y+bh);
      grd.addColorStop(0,color);grd.addColorStop(1,color+'44');
      ctx.fillStyle=grd;ctx.shadowColor=color;ctx.shadowBlur=8;
      if(ctx.roundRect)ctx.beginPath(),ctx.roundRect(x+3,y,bw-6,bh,4),ctx.fill();
      else ctx.fillRect(x+3,y,bw-6,bh);
      ctx.shadowBlur=0;
      // Label
      ctx.fillStyle='rgba(255,255,255,0.55)';ctx.font='9px monospace';ctx.textAlign='center';
      ctx.fillText(data.labels[i].slice(0,8),x+bw/2,pad.top+cH+14);
      if(showValues){ctx.fillStyle=color;ctx.font='bold 9px monospace';ctx.fillText(v,x+bw/2,y-4);}
    });
  } else if(type==='line'){
    if(showGrid){ctx.strokeStyle='rgba(255,255,255,0.07)';ctx.lineWidth=1;for(let i=0;i<=5;i++){const y=pad.top+cH*(1-i/5);ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(pad.left+cW,y);ctx.stroke();ctx.fillStyle='rgba(255,255,255,0.3)';ctx.font='9px monospace';ctx.textAlign='right';ctx.fillText(Math.round(max*i/5),pad.left-6,y+3);}}
    const step=cW/(data.values.length-1||1);
    ctx.beginPath();ctx.strokeStyle=colors[0];ctx.lineWidth=2.5;ctx.shadowColor=colors[0];ctx.shadowBlur=10;
    data.values.forEach((v,i)=>{const x=pad.left+i*step,y=pad.top+cH-(v/max)*cH;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
    ctx.stroke();ctx.shadowBlur=0;
    data.values.forEach((v,i)=>{const x=pad.left+i*step,y=pad.top+cH-(v/max)*cH;ctx.beginPath();ctx.fillStyle=colors[0];ctx.arc(x,y,4,0,Math.PI*2);ctx.fill();ctx.fillStyle='rgba(255,255,255,0.6)';ctx.font='9px monospace';ctx.textAlign='center';ctx.fillText(data.labels[i].slice(0,8),x,pad.top+cH+14);});
  } else if(type==='pie'||type==='doughnut'){
    const total=data.values.reduce((a,b)=>a+b,0)||1;
    let angle=-Math.PI/2;
    const cx=W/2,cy=pad.top+cH/2,r=Math.min(cW,cH)/2.2;
    const innerR=type==='doughnut'?r*0.5:0;
    data.values.forEach((v,i)=>{
      const sliceAngle=(v/total)*Math.PI*2;
      const color=colors[i%colors.length];
      ctx.beginPath();ctx.fillStyle=color;ctx.shadowColor=color;ctx.shadowBlur=6;
      ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,angle,angle+sliceAngle);
      if(innerR>0)ctx.arc(cx,cy,innerR,angle+sliceAngle,angle,true);
      ctx.closePath();ctx.fill();ctx.shadowBlur=0;
      // Label
      const midA=angle+sliceAngle/2,lx=cx+Math.cos(midA)*(r+18),ly=cy+Math.sin(midA)*(r+18);
      ctx.fillStyle='rgba(255,255,255,0.8)';ctx.font='9px monospace';ctx.textAlign='center';
      if(v/total>0.04)ctx.fillText(data.labels[i].slice(0,8)+(showValues?` (${v})`:'')+` ${(v/total*100).toFixed(0)}%`,lx,ly);
      angle+=sliceAngle;
    });
    if(innerR>0){ctx.beginPath();ctx.fillStyle='#050508';ctx.arc(cx,cy,innerR,0,Math.PI*2);ctx.fill();if(title){ctx.fillStyle='rgba(255,255,255,0.7)';ctx.font='bold 11px monospace';ctx.textAlign='center';ctx.fillText(title,cx,cy+4);}}
  } else if(type==='scatter'){
    if(showGrid){ctx.strokeStyle='rgba(255,255,255,0.07)';ctx.lineWidth=1;for(let i=0;i<=5;i++){const y=pad.top+cH*(1-i/5);ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(pad.left+cW,y);ctx.stroke();const x2=pad.left+cW*(i/5);ctx.beginPath();ctx.moveTo(x2,pad.top);ctx.lineTo(x2,pad.top+cH);ctx.stroke();}}
    data.values.forEach((v,i)=>{const x=pad.left+(i/Math.max(data.values.length-1,1))*cW,y=pad.top+cH-(v/max)*cH;const color=colors[i%colors.length];ctx.beginPath();ctx.fillStyle=color;ctx.shadowColor=color;ctx.shadowBlur=10;ctx.arc(x,y,5,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;});
  }
  // Legend
  if(showLegend&&(type==='bar'||type==='area'||type==='scatter')){
    const visible=data.labels.slice(0,8);
    const lx=pad.left,ly=H-22;
    visible.forEach((lb,i)=>{const x=lx+i*(cW/visible.length);ctx.fillStyle=colors[i%colors.length];ctx.fillRect(x,ly,8,8);ctx.fillStyle='rgba(255,255,255,0.5)';ctx.font='8px monospace';ctx.textAlign='left';ctx.fillText(lb.slice(0,6),x+11,ly+7);});
  }
}
function dvLoadSample(){
  const samples={
    bar:'Label,Nilai\nJanuari,120\nFebruari,85\nMaret,200\nApril,145\nMei,178\nJuni,220\nJuli,165',
    pie:'Label,Nilai\nPython,35\nJavaScript,28\nJava,15\nTypeScript,12\nC++,10',
    scatter:'x,y\n10,120\n20,85\n30,200\n40,145\n50,178\n60,220',
  };
  const type=document.getElementById('dv-type')?.value||'bar';
  const input=document.getElementById('dv-input');
  if(input)input.value=samples[type]||samples.bar;
  dvRender();
}
function dvExport(){
  const canvas=document.getElementById('dv-canvas');
  if(!canvas||!canvas.width){showNotif('‚ö† Buat chart dulu!');return;}
  const a=document.createElement('a');a.download='chart-'+Date.now()+'.png';
  a.href=canvas.toDataURL('image/png');a.click();showNotif('üíæ Chart diekspor!');
}
function dvCopySVG(){
  const data=dvParseData();
  if(!data){showNotif('‚ö† Tidak ada data');return;}
  const text=data.labels.map((l,i)=>`${l}: ${data.values[i]}`).join('\n');
  navigator.clipboard.writeText(text).then(()=>showNotif('üìã Data disalin!'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üöÄ INIT ALL NEW FEATURES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function initNewFeatures(){
  // Formula quick buttons
  setTimeout(formulaInitQuick, 300);
  // Email template saved
  setTimeout(etplRenderSaved, 300);
  // Focus init display
  setTimeout(()=>{focusUpdateDisplay();focusUpdateDots();}, 300);
  // Vault check state
  setTimeout(vaultCheckState, 300);

  // Remove old ai-guardian references
  const oldBall=document.getElementById('ai-guardian-ball');
  const oldPanel=document.getElementById('ai-guardian-panel');
  if(oldBall)oldBall.remove();
  if(oldPanel)oldPanel.remove();
})();


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üñ•Ô∏è HYPRLAND UI SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let hyMenuOpen = false;
let hyActiveWidget = null;
let hyClockInterval = null;
let hyClockZones = JSON.parse(localStorage.getItem('tb-clock-zones') || '["Asia/Jakarta","America/Los_Angeles","Europe/London","Asia/Tokyo"]');
let hyWeatherCity = localStorage.getItem('tb-wx-city') || 'Jakarta';
let hyWeatherData = null;

// All tools index for search
const HY_ALL_TOOLS = [
  {id:'text',em:'üìù',label:'Text Analyzer',tags:'teks analisis case convert'},
  {id:'password',em:'üîê',label:'Password Generator',tags:'password generate kuat keamanan'},
  {id:'base64',em:'üîÑ',label:'Base64',tags:'encode decode base64 konversi'},
  {id:'json',em:'üì¶',label:'JSON Tools',tags:'json format validasi parse'},
  {id:'regex',em:'üîç',label:'Regex Tester',tags:'regex ekspresi reguler test'},
  {id:'markdown',em:'üìÑ',label:'Markdown Preview',tags:'markdown md preview'},
  {id:'minifier',em:'üóúÔ∏è',label:'Minifier',tags:'minify compress html css js'},
  {id:'snippet',em:'üíª',label:'Snippet Manager',tags:'snippet kode simpan'},
  {id:'cipher',em:'üîê',label:'Cipher / Enkripsi',tags:'enkripsi caesar rot13 cipher'},
  {id:'ascii',em:'üñãÔ∏è',label:'ASCII Art',tags:'ascii art teks gambar'},
  {id:'hash',em:'üîë',label:'Hash Generator',tags:'sha256 md5 hash enkripsi'},
  {id:'numSys',em:'üî¢',label:'Sistem Bilangan',tags:'biner hex oktal desimal konversi'},
  {id:'unit',em:'üìè',label:'Unit Converter',tags:'unit satuan panjang berat suhu'},
  {id:'color',em:'üé®',label:'Color Converter',tags:'warna hex rgb hsl color'},
  {id:'time',em:'‚è∞',label:'Timestamp',tags:'unix timestamp waktu tanggal'},
  {id:'aspect',em:'üìê',label:'Aspect Ratio',tags:'aspek rasio video gambar'},
  {id:'qr',em:'üì∑',label:'QR Code Generator',tags:'qr code barcode scan'},
  {id:'gradient',em:'üåà',label:'CSS Gradient',tags:'gradient warna css background'},
  {id:'glass',em:'ü™ü',label:'Glassmorphism',tags:'glass blur frosted css'},
  {id:'noise',em:'üåä',label:'Noise Generator',tags:'noise tekstur background svg'},
  {id:'fakedata',em:'üîÆ',label:'Fake Data Generator',tags:'dummy data palsu nama alamat'},
  {id:'palette',em:'üé®',label:'Color Palette',tags:'palette warna harmoni generate'},
  {id:'random',em:'üé≤',label:'Random Generator',tags:'random acak uuid string angka'},
  {id:'imgcomp',em:'üñºÔ∏è',label:'Image Compressor',tags:'kompres gambar ukuran kecilkan'},
  {id:'meme',em:'üñºÔ∏è',label:'Meme Maker',tags:'meme gambar teks lucu'},
  {id:'videogif',em:'üé¨',label:'Video ke GIF',tags:'video gif konversi animasi'},
  {id:'ocr',em:'üì∏',label:'OCR',tags:'ocr baca teks gambar scan'},
  {id:'mockup',em:'üì±',label:'Device Mockup',tags:'mockup device hp laptop frame'},
  {id:'imgEditor',em:'üñºÔ∏è',label:'Image Editor',tags:'edit gambar crop resize filter brightness'},
  {id:'svgEditor',em:'üé®',label:'SVG Editor',tags:'svg vector shape draw edit export'},
  {id:'annotator',em:'üì∏',label:'Screenshot Annotator',tags:'anotasi screenshot arrow rect blur'},
  {id:'tts',em:'üé§',label:'Text to Speech',tags:'tts suara bicara baca'},
  {id:'bpm',em:'üéµ',label:'BPM Counter',tags:'bpm tempo ketuk beat'},
  {id:'morse',em:'üéµ',label:'Morse Code',tags:'morse kode titik strip audio'},
  {id:'audioviz',em:'üéµ',label:'Audio Visualizer',tags:'audio visualizer musik mic gelombang'},
  {id:'playlist',em:'üéµ',label:'Playlist Maker',tags:'playlist lagu musik mood timer fokus'},
  {id:'calc',em:'üßÆ',label:'Kalkulator',tags:'kalkulator hitung sains matematik'},
  {id:'ageCalc',em:'üßÆ',label:'Kalkulator Umur',tags:'umur usia tanggal lahir hitung'},
  {id:'currency',em:'üí±',label:'Konversi Kurs',tags:'kurs mata uang dollar rupiah konversi'},
  {id:'formula',em:'üßÆ',label:'Formula Builder',tags:'rumus matematika formula hitung variabel'},
  {id:'timer',em:'‚è±Ô∏è',label:'Stopwatch & Timer',tags:'stopwatch timer hitung mundur lap'},
  {id:'worldclock',em:'üåç',label:'World Clock',tags:'jam dunia timezone kota'},
  {id:'pomodoro',em:'üéØ',label:'Pomodoro Timer',tags:'pomodoro produktivitas fokus istirahat'},
  {id:'focus',em:'‚è∞',label:'Focus Mode',tags:'fokus pomodoro mode penuh produktivitas'},
  {id:'calendar',em:'üìÖ',label:'Kalender',tags:'kalender tanggal event jadwal'},
  {id:'reminder',em:'üîî',label:'Reminder',tags:'reminder pengingat notifikasi alarm'},
  {id:'todo',em:'üìã',label:'To-Do List',tags:'todo daftar tugas checklist'},
  {id:'notepad',em:'üóíÔ∏è',label:'Notepad',tags:'catatan note simpan teks notepad'},
  {id:'habit',em:'üéØ',label:'Habit Tracker',tags:'kebiasaan habit streak tracker'},
  {id:'budget',em:'üí∞',label:'Budget Tracker',tags:'budget keuangan anggaran bulanan'},
  {id:'flashcard',em:'üìñ',label:'Flashcard',tags:'flashcard kartu belajar hafalan'},
  {id:'weeklyPlanner',em:'üóìÔ∏è',label:'Weekly Planner',tags:'planner jadwal mingguan drag drop'},
  {id:'expenseTracker',em:'üìà',label:'Expense Tracker',tags:'pengeluaran expense grafik csv keuangan'},
  {id:'translate',em:'üåê',label:'Translate',tags:'terjemah bahasa translate'},
  {id:'summarizer',em:'üß†',label:'AI Summarizer',tags:'ringkas artikel ai summary'},
  {id:'aiwriting',em:'‚úçÔ∏è',label:'AI Writing Assistant',tags:'tulis email caption essay ai nulis'},
  {id:'aicode',em:'üêõ',label:'AI Code Reviewer',tags:'review kode bug ai fix code'},
  {id:'aitranslator',em:'üåê',label:'AI Translator Pro',tags:'terjemah nuansa budaya idiom ai translate pro'},
  {id:'aigoal',em:'üéØ',label:'AI Goal Planner',tags:'goal tujuan rencana ai planner'},
  {id:'aihelp',em:'ü§ñ',label:'AI Assistant',tags:'ai asisten tanya jawab claude'},
  {id:'vault',em:'üîê',label:'Password Vault',tags:'vault password enkripsi aes simpan'},
  {id:'emailtpl',em:'üìß',label:'Email Template',tags:'email template variabel profesional'},
  {id:'resume',em:'üìù',label:'Resume Builder',tags:'resume cv template export'},
  {id:'biolink',em:'üîó',label:'Bio Link Page',tags:'bio link linktree halaman share'},
  {id:'chartgen',em:'üìä',label:'Chart Generator',tags:'chart grafik pie bar line'},
  {id:'csv',em:'üìä',label:'CSV ke Tabel',tags:'csv tabel data import'},
  {id:'dataviz',em:'üìä',label:'Data Viz Studio',tags:'visualisasi data chart json csv'},
  {id:'apiTester',em:'üîÑ',label:'API Tester',tags:'api rest get post put delete test'},
  {id:'mindmap',em:'üß†',label:'Mindmap',tags:'mindmap peta pikiran topik'},
  {id:'fontprev',em:'üî§',label:'Font Preview',tags:'font preview google web'},
  {id:'theme',em:'üé®',label:'Theme Customizer',tags:'tema warna custom tampilan'},
  {id:'games',em:'üéÆ',label:'Games',tags:'game snake flappy 2048 breakout'},
  {id:'about',em:'üë§',label:'Tentang Toolbox',tags:'tentang about info'},
];

function hyToggleMenu() {
  hyMenuOpen = !hyMenuOpen;
  const btn = document.getElementById('hy-menu-btn');
  const menu = document.getElementById('hy-nav-menu');
  if (!btn || !menu) return;
  btn.classList.toggle('open', hyMenuOpen);
  menu.classList.toggle('open', hyMenuOpen);
  if (hyMenuOpen) {
    setTimeout(() => document.getElementById('hy-nav-search')?.focus(), 200);
    // Close widget popups
    document.querySelectorAll('.hy-widget-popup').forEach(p => p.classList.remove('open'));
    hyActiveWidget = null;
  }
}

function hyOpenTool(id) {
  // Close menu
  hyMenuOpen = false;
  document.getElementById('hy-menu-btn')?.classList.remove('open');
  document.getElementById('hy-nav-menu')?.classList.remove('open');
  // Hide home screen
  document.getElementById('hy-home')?.classList.add('hidden');
  // Find the tab button
  const btn = document.querySelector(`[onclick*="sw('${id}'"]`);
  sw(id, btn);
}

function hyNavSearch(q) {
  const content = document.getElementById('hy-nav-content');
  if (!q.trim()) { content.innerHTML = content._original || content.innerHTML; return; }
  if (!content._original) content._original = content.innerHTML;
  const r = HY_ALL_TOOLS.filter(t =>
    (t.label + t.tags + t.id).toLowerCase().includes(q.toLowerCase())
  );
  content.innerHTML = `<div class="hy-nav-section">
    <div class="hy-nav-section-title">üîç Hasil "${q}" (${r.length})</div>
    <div class="hy-nav-grid">${r.map(t=>`
      <button class="hy-nav-btn" onclick="hyOpenTool('${t.id}')">
        <span class="icon">${t.em}</span>
        <span class="label">${t.label}</span>
      </button>`).join('')}</div></div>`;
}

function hySearch(q) {
  const featuredSection = document.getElementById('hy-featured-section');
  const searchResults = document.getElementById('hy-search-results');
  const searchGrid = document.getElementById('hy-search-grid');
  if (!q.trim()) {
    featuredSection.style.display = '';
    searchResults.style.display = 'none';
    return;
  }
  const r = HY_ALL_TOOLS.filter(t =>
    (t.label + t.tags + t.id).toLowerCase().includes(q.toLowerCase())
  );
  featuredSection.style.display = 'none';
  searchResults.style.display = 'block';
  searchGrid.innerHTML = r.map((t, i) => `
    <div class="hy-tool-card" onclick="hyOpenTool('${t.id}')" style="animation-delay:${i*20}ms">
      <span class="hy-card-icon">${t.em}</span>
      <div class="hy-card-label">${t.label}</div>
    </div>`).join('') || '<div style="color:var(--muted);font-size:0.78rem;padding:20px;grid-column:1/-1">Tidak ada hasil</div>';
}

// swBack already handles home restore (see main sw section)

// Close menu/popups on outside click
document.addEventListener('click', e => {
  const menu = document.getElementById('hy-nav-menu');
  const btn = document.getElementById('hy-menu-btn');
  if (hyMenuOpen && menu && !menu.contains(e.target) && !btn.contains(e.target)) {
    hyMenuOpen = false;
    btn.classList.remove('open');
    menu.classList.remove('open');
  }
  // Close widget popups
  if (hyActiveWidget) {
    const popup = document.getElementById('hy-popup-' + hyActiveWidget);
    const widget = document.getElementById('hy-' + hyActiveWidget + '-widget');
    if (popup && widget && !popup.contains(e.target) && !widget.contains(e.target)) {
      popup.classList.remove('open');
      hyActiveWidget = null;
    }
  }
});

// ‚îÄ‚îÄ Clock Widget ‚îÄ‚îÄ
let hyClockPrimaryZone = localStorage.getItem('tb-clock-primary') || 'Asia/Jakarta';

const TZ_PRESETS = [
  {zone:'Asia/Jakarta',label:'WIB (Jakarta)'},
  {zone:'Asia/Makassar',label:'WITA (Makassar)'},
  {zone:'Asia/Jayapura',label:'WIT (Jayapura)'},
  {zone:'America/Los_Angeles',label:'Los Angeles'},
  {zone:'America/New_York',label:'New York'},
  {zone:'Europe/London',label:'London'},
  {zone:'Europe/Paris',label:'Paris'},
  {zone:'Asia/Tokyo',label:'Tokyo'},
  {zone:'Asia/Singapore',label:'Singapore'},
  {zone:'Australia/Sydney',label:'Sydney'},
];

function hyClockStart() {
  hyClockUpdate();
  hyClockInterval = setInterval(hyClockUpdate, 1000);
}

function hyClockUpdate() {
  const now = new Date();
  // Use selected primary timezone (default WIB/Jakarta)
  const primaryTZ = hyClockPrimaryZone || 'Asia/Jakarta';
  const primaryTime = now.toLocaleTimeString('id-ID', {timeZone: primaryTZ, hour:'2-digit', minute:'2-digit'});
  const primaryPreset = TZ_PRESETS.find(p => p.zone === primaryTZ);
  const primaryLabel = primaryPreset ? primaryPreset.label.split(' ')[0] : primaryTZ.split('/')[1]?.replace(/_/g,' ') || primaryTZ;
  const clockEl = document.getElementById('hy-clock-time');
  const zoneEl = document.getElementById('hy-clock-zone');
  if (clockEl) clockEl.textContent = primaryTime;
  if (zoneEl) zoneEl.textContent = primaryLabel;
  // Update popup if open (only if visible to avoid unnecessary work)
  const popup = document.getElementById('hy-popup-clock');
  if (popup && popup.classList.contains('open')) hyRenderClockZones();
}

function hyRenderClockZones() {
  const wrap = document.getElementById('hy-clock-zones');
  if (!wrap) return;
  const now = new Date();
  wrap.innerHTML = hyClockZones.map((tz, i) => {
    const preset = TZ_PRESETS.find(p => p.zone === tz);
    const label = preset ? preset.label : tz.split('/')[1]?.replace(/_/g,' ') || tz;
    const t = now.toLocaleTimeString('id-ID', {timeZone: tz, hour:'2-digit', minute:'2-digit', second:'2-digit'});
    const d = now.toLocaleDateString('id-ID', {timeZone: tz, weekday:'short', month:'short', day:'numeric'});
    return `<div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--hy-border);gap:8px;">
      <div>
        <div style="font-size:0.72rem;color:var(--text);font-weight:600;">${label}</div>
        <div style="font-size:0.58rem;color:var(--muted);">${d}</div>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:0.9rem;color:var(--accent2);">${t}</div>
        ${i>0?`<button onclick="hyRemoveClockZone(${i})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.7rem;">‚úï</button>`:''}
      </div>
    </div>`;
  }).join('') + `<div style="margin-top:10px;">
    <div style="font-size:0.62rem;color:var(--muted);margin-bottom:6px;">Preset kota:</div>
    <div style="display:flex;flex-wrap:wrap;gap:4px;">${TZ_PRESETS.map(p=>`<button onclick="hyAddZonePreset('${p.zone}')" style="background:${p.zone===hyClockPrimaryZone?'rgba(124,58,237,0.4)':'rgba(124,58,237,0.1)'};border:1px solid ${p.zone===hyClockPrimaryZone?'rgba(124,58,237,0.8)':'rgba(124,58,237,0.2)'};border-radius:6px;padding:3px 7px;font-size:0.58rem;cursor:pointer;color:var(--text);font-weight:${p.zone===hyClockPrimaryZone?'700':'400'};">${p.label}${p.zone===hyClockPrimaryZone?' ‚úì':''}</button>`).join('')}</div>
  </div>`;
}

function hyAddClockZone() {
  const inp = document.getElementById('hy-clock-add');
  const val = inp?.value?.trim();
  if (!val) return;
  // Try to match with known presets or use as timezone
  const match = TZ_PRESETS.find(p => p.label.toLowerCase().includes(val.toLowerCase()) || p.zone.toLowerCase().includes(val.toLowerCase()));
  const tz = match ? match.zone : val;
  try {
    new Date().toLocaleTimeString('en', {timeZone: tz}); // test validity
    if (!hyClockZones.includes(tz)) {
      hyClockZones.push(tz);
      localStorage.setItem('tb-clock-zones', JSON.stringify(hyClockZones));
      hyRenderClockZones();
    }
    if (inp) inp.value = '';
  } catch(e) { showNotif('‚ö† Timezone tidak valid'); }
}

function hyAddZonePreset(zone) {
  // Switch the primary widget timezone
  hyClockPrimaryZone = zone;
  localStorage.setItem('tb-clock-primary', zone);
  // Also add to zones list if not already there
  if (!hyClockZones.includes(zone)) {
    hyClockZones.push(zone);
    localStorage.setItem('tb-clock-zones', JSON.stringify(hyClockZones));
  }
  // Update widget immediately
  hyClockUpdate();
  hyRenderClockZones();
  // Visual feedback on preset buttons
  document.querySelectorAll('[onclick^="hyAddZonePreset"]').forEach(b => {
    b.style.background = b.getAttribute('onclick').includes(zone)
      ? 'rgba(124,58,237,0.4)' : 'rgba(124,58,237,0.1)';
    b.style.borderColor = b.getAttribute('onclick').includes(zone)
      ? 'rgba(124,58,237,0.8)' : 'rgba(124,58,237,0.2)';
  });
  const preset = TZ_PRESETS.find(p => p.zone === zone);
  showNotif('üïê Jam diubah ke ' + (preset ? preset.label : zone));
}

function hyRemoveClockZone(idx) {
  if (idx === 0) return; // keep WIB
  hyClockZones.splice(idx, 1);
  localStorage.setItem('tb-clock-zones', JSON.stringify(hyClockZones));
  hyRenderClockZones();
}

// ‚îÄ‚îÄ Weather Widget ‚îÄ‚îÄ
const WX_ICONS = {0:'‚òÄÔ∏è',1:'üå§Ô∏è',2:'‚õÖ',3:'‚òÅÔ∏è',45:'üå´Ô∏è',48:'üå´Ô∏è',51:'üå¶Ô∏è',53:'üå¶Ô∏è',55:'üåßÔ∏è',61:'üåßÔ∏è',63:'üåßÔ∏è',65:'üåßÔ∏è',71:'üå®Ô∏è',73:'üå®Ô∏è',80:'üå¶Ô∏è',81:'üå¶Ô∏è',82:'‚õàÔ∏è',95:'‚õàÔ∏è',96:'‚õàÔ∏è',99:'‚õàÔ∏è'};

async function hyFetchWeather(city) {
  city = city || document.getElementById('hy-wx-input')?.value?.trim() || hyWeatherCity;
  if (!city) return;
  hyWeatherCity = city;
  localStorage.setItem('tb-wx-city', city);
  const wxEl = document.getElementById('hy-wx-temp');
  const cityEl = document.getElementById('hy-wx-city');
  const iconEl = document.getElementById('hy-wx-icon');
  if (wxEl) wxEl.textContent = '...';
  try {
    // Geocode
    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=id&format=json`);
    const geoData = await geoRes.json();
    if (!geoData.results?.length) { showNotif('‚ö† Kota tidak ditemukan'); return; }
    const loc = geoData.results[0];
    const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.latitude}&longitude=${loc.longitude}&current_weather=true&hourly=relativehumidity_2m&timezone=auto`);
    const wData = await wRes.json();
    const cw = wData.current_weather;
    const icon = WX_ICONS[cw.weathercode] || 'üå°Ô∏è';
    if (wxEl) wxEl.textContent = `${Math.round(cw.temperature)}¬∞C`;
    if (cityEl) cityEl.textContent = loc.name;
    if (iconEl) iconEl.textContent = icon;
    hyWeatherData = {loc, cw, icon};
    hyRenderWeatherDetail();
    const inp = document.getElementById('hy-wx-input');
    if (inp) inp.value = '';
  } catch(e) {
    if (wxEl) wxEl.textContent = '--¬∞C';
    showNotif('‚ö† Gagal ambil cuaca');
  }
}

function hyRenderWeatherDetail() {
  const wrap = document.getElementById('hy-weather-detail');
  if (!wrap || !hyWeatherData) return;
  const {loc, cw, icon} = hyWeatherData;
  const windDir = ['N','NE','E','SE','S','SW','W','NW'][Math.round(cw.winddirection/45)%8];
  wrap.innerHTML = `
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:10px;">
      <div style="font-size:2.5rem;">${icon}</div>
      <div>
        <div style="font-size:1.5rem;font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--text);">${Math.round(cw.temperature)}¬∞C</div>
        <div style="font-size:0.7rem;color:var(--muted);">${loc.name}, ${loc.country_code}</div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
      <div style="background:rgba(255,255,255,0.04);border-radius:8px;padding:8px;">
        <div style="font-size:0.58rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Angin</div>
        <div style="font-size:0.82rem;color:var(--accent2);margin-top:2px;">${cw.windspeed} km/h ${windDir}</div>
      </div>
      <div style="background:rgba(255,255,255,0.04);border-radius:8px;padding:8px;">
        <div style="font-size:0.58rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Cuaca</div>
        <div style="font-size:0.82rem;color:var(--accent2);margin-top:2px;">Kode ${cw.weathercode}</div>
      </div>
    </div>`;
}

function hyToggleWidget(type) {
  const popup = document.getElementById('hy-popup-' + type);
  if (!popup) return;
  const wasOpen = popup.classList.contains('open');
  document.querySelectorAll('.hy-widget-popup').forEach(p => p.classList.remove('open'));
  hyActiveWidget = null;
  if (!wasOpen) {
    popup.classList.add('open');
    hyActiveWidget = type;
    if (type === 'clock') hyRenderClockZones();
    if (type === 'weather') hyRenderWeatherDetail();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üñºÔ∏è IMAGE EDITOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let ieImg = null, ieFlipH = false, ieFlipV = false, ieRotation = 0;
const IE_PRESETS = {
  none: {brightness:100,contrast:100,saturate:100,blur:0,hue:0,opacity:100},
  grayscale: {brightness:100,contrast:110,saturate:0,blur:0,hue:0,opacity:100},
  sepia: {brightness:110,contrast:90,saturate:80,blur:0,hue:20,opacity:100},
  vivid: {brightness:110,contrast:130,saturate:160,blur:0,hue:0,opacity:100},
  cool: {brightness:100,contrast:105,saturate:110,blur:0,hue:200,opacity:100},
  warm: {brightness:110,contrast:105,saturate:120,blur:0,hue:340,opacity:100},
  dramatic: {brightness:90,contrast:160,saturate:120,blur:0,hue:0,opacity:100},
  vintage: {brightness:90,contrast:80,saturate:70,blur:0,hue:30,opacity:95},
};

function ieLoad(inp) {
  if (!inp.files[0]) return;
  const url = URL.createObjectURL(inp.files[0]);
  const img = new Image();
  img.onload = () => {
    ieImg = img; ieFlipH = false; ieFlipV = false; ieRotation = 0;
    document.getElementById('ie-placeholder').style.display = 'none';
    const cv = document.getElementById('ie-canvas');
    cv.style.display = 'block';
    iePreset('none');
    ieApply();
    document.getElementById('ie-info').textContent = `${img.naturalWidth}√ó${img.naturalHeight}px ‚Ä¢ ${(inp.files[0].size/1024).toFixed(1)}KB`;
  };
  img.src = url;
}

function ieApply() {
  if (!ieImg) return;
  const cv = document.getElementById('ie-canvas');
  const isSwapped = ieRotation % 180 !== 0;
  cv.width  = isSwapped ? ieImg.naturalHeight : ieImg.naturalWidth;
  cv.height = isSwapped ? ieImg.naturalWidth  : ieImg.naturalHeight;
  const ctx = cv.getContext('2d');
  ctx.save();
  ctx.translate(cv.width/2, cv.height/2);
  ctx.rotate(ieRotation * Math.PI/180);
  ctx.scale(ieFlipH ? -1 : 1, ieFlipV ? -1 : 1);
  const br = document.getElementById('ie-brightness')?.value || 100;
  const co = document.getElementById('ie-contrast')?.value || 100;
  const sa = document.getElementById('ie-saturate')?.value || 100;
  const bl = document.getElementById('ie-blur')?.value || 0;
  const hu = document.getElementById('ie-hue')?.value || 0;
  const op = (document.getElementById('ie-opacity')?.value || 100) / 100;
  ctx.filter = `brightness(${br}%) contrast(${co}%) saturate(${sa}%) blur(${bl}px) hue-rotate(${hu}deg)`;
  ctx.globalAlpha = op;
  ctx.drawImage(ieImg, -ieImg.naturalWidth/2, -ieImg.naturalHeight/2);
  ctx.restore();
}

function iePreset(name) {
  const p = IE_PRESETS[name];
  if (!p) return;
  ['brightness','contrast','saturate','blur','hue','opacity'].forEach(k => {
    const el = document.getElementById('ie-' + k);
    const vEl = document.getElementById('ie-' + k[0] + (k==='hue'?'u':k==='opacity'?'p':k==='blur'?'l':k==='saturate'?'a':'r')[0] + '-v');
    // simpler: find val display by data
    if (el) el.value = p[k];
  });
  // Update val displays
  document.getElementById('ie-br-v').textContent = p.brightness;
  document.getElementById('ie-co-v').textContent = p.contrast;
  document.getElementById('ie-sa-v').textContent = p.saturate;
  document.getElementById('ie-bl-v').textContent = p.blur;
  document.getElementById('ie-hu-v').textContent = p.hue;
  document.getElementById('ie-op-v').textContent = p.opacity;
  ieApply();
}

function ieFlip(dir) {
  if (dir === 'h') ieFlipH = !ieFlipH;
  else ieFlipV = !ieFlipV;
  ieApply();
}

function ieRotate(deg) {
  ieRotation = (ieRotation + deg + 360) % 360;
  ieApply();
}

function ieResize() {
  if (!ieImg) return;
  const w = parseInt(document.getElementById('ie-rw')?.value);
  const h = parseInt(document.getElementById('ie-rh')?.value);
  if (!w && !h) return;
  const aspect = ieImg.naturalWidth / ieImg.naturalHeight;
  const nw = w || Math.round(h * aspect);
  const nh = h || Math.round(w / aspect);
  const cv = document.getElementById('ie-canvas');
  cv.width = nw; cv.height = nh;
  const ctx = cv.getContext('2d');
  ctx.drawImage(ieImg, 0, 0, nw, nh);
  document.getElementById('ie-info').textContent = `Resized: ${nw}√ó${nh}px`;
  showNotif(`‚úÖ Diubah ke ${nw}√ó${nh}`);
}

function ieSave() {
  const cv = document.getElementById('ie-canvas');
  if (!cv.width) { showNotif('‚ö† Belum ada gambar'); return; }
  const a = document.createElement('a');
  a.href = cv.toDataURL('image/png');
  a.download = 'edited-' + Date.now() + '.png';
  a.click();
  showNotif('üíæ Gambar disimpan!');
}

function ieReset() {
  if (!ieImg) return;
  ieFlipH = false; ieFlipV = false; ieRotation = 0;
  iePreset('none');
}



// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üìù RESUME BUILDER                                           ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let rvEntries = JSON.parse(localStorage.getItem('tb-resume-entries')||'[]');
const RV_ENTRY_TYPES = {
  exp:   {label:'Pengalaman Kerja', fields:['Perusahaan','Jabatan','Tahun Mulai','Tahun Selesai','Deskripsi']},
  edu:   {label:'Pendidikan',       fields:['Institusi','Jurusan','Tahun','IPK / Nilai','Deskripsi']},
  skill: {label:'Skill',            fields:['Skill / Teknologi','Level (1-5)','Kategori']},
  project:{label:'Project',         fields:['Nama Project','Teknologi','URL','Deskripsi']},
};
function rvAddEntry(type) {
  const t = RV_ENTRY_TYPES[type]; if(!t) return;
  const id = Date.now();
  rvEntries.push({id, type, fields: t.fields.map(f=>({label:f, value:''}))});
  rvRenderEntries();
}
function rvRenderEntries() {
  const wrap = document.getElementById('rv-entries'); if(!wrap) return;
  wrap.innerHTML = rvEntries.map(e=>{
    const t = RV_ENTRY_TYPES[e.type];
    return `<div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px;margin-bottom:8px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <div style="font-size:0.68rem;color:var(--accent2);font-weight:700;">${t.label}</div>
        <button onclick="rvRemoveEntry(${e.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">‚úï</button>
      </div>
      ${e.fields.map((f,i)=> f.label.includes('Deskripsi')
        ? `<textarea placeholder="${f.label}" style="min-height:60px;margin-bottom:4px;font-size:0.75rem;" oninput="rvUpdateField(${e.id},${i},this.value)">${f.value}</textarea>`
        : `<input placeholder="${f.label}" value="${f.value}" style="margin-bottom:4px;font-size:0.75rem;" oninput="rvUpdateField(${e.id},${i},this.value)">`
      ).join('')}
    </div>`;
  }).join('');
}
function rvUpdateField(id, idx, val) {
  const e = rvEntries.find(e=>e.id===id); if(e) e.fields[idx].value = val;
}
function rvRemoveEntry(id) { rvEntries = rvEntries.filter(e=>e.id!==id); rvRenderEntries(); }
function rvPreview() {
  const d = {
    name: document.getElementById('rv-name')?.value||'Nama Lengkap',
    title: document.getElementById('rv-title')?.value||'Profesi',
    email: document.getElementById('rv-email')?.value||'',
    phone: document.getElementById('rv-phone')?.value||'',
    location: document.getElementById('rv-location')?.value||'',
    linkedin: document.getElementById('rv-linkedin')?.value||'',
    github: document.getElementById('rv-github')?.value||'',
    summary: document.getElementById('rv-summary')?.value||'',
  };
  const color = document.getElementById('rv-color')?.value || '#7c3aed';
  const tpl = document.getElementById('rv-template')?.value || 'modern';
  const isDark = tpl === 'modern';
  const bg = isDark ? '#0d0d12' : '#fff';
  const text = isDark ? '#e8e8f0' : '#1a1a2e';
  const muted = isDark ? '#6b6b8a' : '#555';
  const border = isDark ? 'rgba(255,255,255,0.1)' : '#ddd';
  const expHtml = rvEntries.filter(e=>e.type==='exp').map(e=>`
    <div style="margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;"><b>${e.fields[1].value||'Jabatan'}</b><span style="color:${muted};font-size:0.8em;">${e.fields[2].value}‚Äì${e.fields[3].value||'Skrg'}</span></div>
      <div style="color:${color};font-size:0.85em;">${e.fields[0].value||'Perusahaan'}</div>
      <p style="margin:4px 0;color:${muted};font-size:0.82em;">${e.fields[4].value}</p>
    </div>`).join('');
  const eduHtml = rvEntries.filter(e=>e.type==='edu').map(e=>`
    <div style="margin-bottom:10px;">
      <div><b>${e.fields[0].value||'Institusi'}</b> ‚Äî ${e.fields[1].value}</div>
      <div style="color:${muted};font-size:0.82em;">${e.fields[2].value} ${e.fields[3].value?'| IPK: '+e.fields[3].value:''}</div>
    </div>`).join('');
  const skillHtml = rvEntries.filter(e=>e.type==='skill').map(e=>`
    <span style="display:inline-block;background:${isDark?'rgba(124,58,237,0.18)':'#f0eaff'};color:${color};border:1px solid ${color}40;border-radius:20px;padding:3px 12px;margin:3px;font-size:0.78em;">${e.fields[0].value} ${e.fields[1].value?'('+e.fields[1].value+'/5)':''}</span>`).join('');
  const projHtml = rvEntries.filter(e=>e.type==='project').map(e=>`
    <div style="margin-bottom:10px;">
      <div><b>${e.fields[0].value||'Project'}</b> ${e.fields[2].value?`<a href="${e.fields[2].value}" style="color:${color};font-size:0.8em;">‚Üó Link</a>`:''}</div>
      <div style="color:${muted};font-size:0.8em;">${e.fields[1].value}</div>
      <p style="margin:4px 0;color:${muted};font-size:0.82em;">${e.fields[3].value}</p>
    </div>`).join('');
  const html = `<div style="font-family:'Georgia',serif;background:${bg};color:${text};padding:36px 40px;min-height:100%;box-sizing:border-box;">
    <div style="border-bottom:3px solid ${color};padding-bottom:16px;margin-bottom:20px;">
      <h1 style="margin:0;font-size:1.9em;color:${color};">${d.name}</h1>
      <div style="font-size:1.05em;margin:4px 0;color:${muted};">${d.title}</div>
      <div style="font-size:0.8em;display:flex;flex-wrap:wrap;gap:12px;margin-top:8px;color:${muted};">
        ${d.email?`<span>üìß ${d.email}</span>`:''}${d.phone?`<span>üì± ${d.phone}</span>`:''}
        ${d.location?`<span>üìç ${d.location}</span>`:''}${d.linkedin?`<a href="${d.linkedin}" style="color:${color};">üîó LinkedIn</a>`:''}
        ${d.github?`<a href="${d.github}" style="color:${color};">üíª Portfolio</a>`:''}
      </div>
    </div>
    ${d.summary?`<div style="margin-bottom:20px;"><h3 style="color:${color};margin:0 0 8px;font-size:0.9em;text-transform:uppercase;letter-spacing:1.5px;">Profil</h3><p style="margin:0;font-size:0.88em;line-height:1.7;color:${text};">${d.summary}</p></div>`:''}
    ${expHtml?`<div style="margin-bottom:20px;"><h3 style="color:${color};margin:0 0 12px;font-size:0.9em;text-transform:uppercase;letter-spacing:1.5px;">Pengalaman</h3>${expHtml}</div>`:''}
    ${eduHtml?`<div style="margin-bottom:20px;"><h3 style="color:${color};margin:0 0 12px;font-size:0.9em;text-transform:uppercase;letter-spacing:1.5px;">Pendidikan</h3>${eduHtml}</div>`:''}
    ${skillHtml?`<div style="margin-bottom:20px;"><h3 style="color:${color};margin:0 0 10px;font-size:0.9em;text-transform:uppercase;letter-spacing:1.5px;">Skills</h3>${skillHtml}</div>`:''}
    ${projHtml?`<div style="margin-bottom:20px;"><h3 style="color:${color};margin:0 0 12px;font-size:0.9em;text-transform:uppercase;letter-spacing:1.5px;">Projects</h3>${projHtml}</div>`:''}
  </div>`;
  const prev = document.getElementById('rv-preview'); if(prev) prev.innerHTML = html;
}
function rvExport() {
  rvPreview();
  const html = document.getElementById('rv-preview')?.innerHTML;
  if(!html) return;
  const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Resume</title><style>*{box-sizing:border-box;margin:0;padding:0;}</style></head><body>${html}</body></html>`], {type:'text/html'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = (document.getElementById('rv-name')?.value||'resume')+'.html';
  a.click(); showNotif('üìÑ Resume berhasil diexport!');
}
rvRenderEntries();

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üîó BIO LINK PAGE                                            ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let blLinks = JSON.parse(localStorage.getItem('tb-biolink-links')||'[]');
let blCurrentTheme = 'purple';
const BL_THEMES = {
  purple: {bg:'linear-gradient(135deg,#1a0533,#0d1533)', card:'rgba(124,58,237,0.2)', btn:'rgba(124,58,237,0.35)', text:'#e8e8ff'},
  dark:   {bg:'linear-gradient(135deg,#0a0a0f,#1a1a2e)', card:'rgba(255,255,255,0.07)', btn:'rgba(255,255,255,0.12)', text:'#fff'},
  neon:   {bg:'linear-gradient(135deg,#002d1c,#002640)', card:'rgba(16,185,129,0.15)', btn:'rgba(6,182,212,0.25)', text:'#e0fff8'},
  fire:   {bg:'linear-gradient(135deg,#200a00,#2a1000)', card:'rgba(239,68,68,0.15)', btn:'rgba(245,158,11,0.25)', text:'#fff5e0'},
  rose:   {bg:'linear-gradient(135deg,#1a0020,#0d0020)', card:'rgba(225,29,72,0.15)', btn:'rgba(162,28,175,0.25)', text:'#ffe8f5'},
};
function blAddLink() {
  const id = Date.now();
  blLinks.push({id, title:'', url:'', icon:'üîó'});
  blRenderLinks();
}
function blRenderLinks() {
  const wrap = document.getElementById('bl-links-wrap'); if(!wrap) return;
  wrap.innerHTML = blLinks.map((l,i)=>`
    <div style="display:flex;gap:4px;margin-bottom:6px;align-items:center;">
      <input value="${l.icon}" style="width:44px;text-align:center;" oninput="blUpdate(${l.id},'icon',this.value);blPreview()">
      <input value="${l.title}" placeholder="Judul Link" style="flex:1;" oninput="blUpdate(${l.id},'title',this.value);blPreview()">
      <input value="${l.url}" placeholder="https://..." style="flex:2;" oninput="blUpdate(${l.id},'url',this.value);blPreview()">
      <button onclick="blRemoveLink(${l.id})" style="background:none;border:1px solid var(--border);color:var(--muted);cursor:pointer;padding:6px 10px;border-radius:6px;font-size:0.7rem;">‚úï</button>
    </div>`).join('');
}
function blUpdate(id, key, val) { const l=blLinks.find(l=>l.id===id); if(l) l[key]=val; }
function blRemoveLink(id) { blLinks = blLinks.filter(l=>l.id!==id); blRenderLinks(); blPreview(); }
function blSetTheme(t) { blCurrentTheme = t; blPreview(); }
function blPreview() {
  const name = document.getElementById('bl-name')?.value||'Nama Kamu';
  const bio = document.getElementById('bl-bio')?.value||'Bio singkat di sini';
  const avatar = document.getElementById('bl-avatar')?.value;
  const th = BL_THEMES[blCurrentTheme] || BL_THEMES.purple;
  const prev = document.getElementById('bl-preview'); if(!prev) return;
  const avatarEl = avatar
    ? `<img src="${avatar}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:10px;border:3px solid rgba(255,255,255,0.3);">`
    : `<div style="width:80px;height:80px;border-radius:50%;background:rgba(255,255,255,0.15);margin-bottom:10px;display:flex;align-items:center;justify-content:center;font-size:2rem;">üë§</div>`;
  const linksHtml = blLinks.map(l=>`
    <a href="${l.url||'#'}" target="_blank" style="display:flex;align-items:center;gap:10px;background:${th.btn};color:${th.text};text-decoration:none;padding:14px 20px;border-radius:12px;margin-bottom:10px;font-size:0.9rem;font-weight:600;transition:all 0.2s;border:1px solid rgba(255,255,255,0.1);">
      <span style="font-size:1.2rem;">${l.icon||'üîó'}</span>${l.title||l.url||'Link'}
    </a>`).join('');
  prev.innerHTML = `<div style="background:${th.bg};min-height:100%;padding:40px 20px;text-align:center;font-family:'Space Mono',monospace;">
    <div style="max-width:400px;margin:0 auto;">
      ${avatarEl}
      <h2 style="color:${th.text};margin:0 0 8px;font-size:1.3rem;">${name}</h2>
      <p style="color:${th.text}80;margin-bottom:24px;font-size:0.82rem;line-height:1.6;">${bio}</p>
      ${linksHtml}
      <div style="margin-top:24px;font-size:0.65rem;color:${th.text}40;">Made with ‚ö° Toolbox</div>
    </div>
  </div>`;
}
function blExport() {
  const name = document.getElementById('bl-name')?.value||'biolink';
  const previewHtml = document.getElementById('bl-preview')?.innerHTML||'';
  const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${name} ‚Äî Bio Link</title><style>*{box-sizing:border-box;margin:0;padding:0;}body{min-height:100vh;}</style></head><body>${previewHtml}</body></html>`], {type:'text/html'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = name.replace(/\s+/g,'_')+'_biolink.html'; a.click();
  showNotif('üíæ Bio Link berhasil diexport!');
}
function blSave() {
  localStorage.setItem('tb-biolink-links', JSON.stringify(blLinks));
  showNotif('üîí Draft tersimpan!');
}
blRenderLinks();
requestAnimationFrame(()=>blPreview());

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  ‚úçÔ∏è AI WRITING ASSISTANT                                     ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let awCurrentLen = 'medium';
function awSetLen(len) {
  awCurrentLen = len;
  ['short','medium','long'].forEach(l=>{
    const b = document.getElementById('aw-len-'+l);
    if(b) b.className = l===len ? 'btn btn-primary' : 'btn btn-secondary';
  });
}
const AW_QUICK = [
  {label:'Email Meeting', type:'email', prompt:'Minta jadwal meeting dengan klien baru untuk membahas proyek website'},
  {label:'Caption Instagram', type:'caption', prompt:'Caption untuk foto produk baru yang menarik dan engaging'},
  {label:'Cover Letter', type:'cover', prompt:'Cover letter untuk posisi Software Engineer di perusahaan tech startup'},
  {label:'Bio LinkedIn', type:'bio', prompt:'Bio LinkedIn profesional untuk junior developer dengan 2 tahun pengalaman'},
  {label:'Product Pitch', type:'pitch', prompt:'Pitch deck slide: pengenalan aplikasi productivity untuk mahasiswa'},
];
function awInitQuick() {
  const wrap = document.getElementById('aw-quick-btns'); if(!wrap||wrap.children.length>0) return;
  AW_QUICK.forEach(q=>{
    const b = document.createElement('button');
    b.className = 'btn btn-secondary';
    b.style.cssText = 'font-size:0.63rem;padding:4px 9px;';
    b.textContent = q.label;
    b.onclick = ()=>{
      document.getElementById('aw-type').value = q.type;
      document.getElementById('aw-prompt').value = q.prompt;
    };
    wrap.appendChild(b);
  });
}
async function awCallClaude(systemPrompt, userMsg) {
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:1500, system:systemPrompt, messages:[{role:'user',content:userMsg}]})
  });
  const data = await res.json();
  return data?.content?.[0]?.text || 'Tidak ada respon.';
}
async function awGenerate() {
  const type = document.getElementById('aw-type')?.value;
  const tone = document.getElementById('aw-tone')?.value;
  const lang = document.getElementById('aw-lang')?.value;
  const prompt = document.getElementById('aw-prompt')?.value;
  const out = document.getElementById('aw-out');
  const btn = document.getElementById('aw-btn');
  if(!prompt?.trim()){showNotif('‚ö†Ô∏è Isi dulu topik/instruksinya!');return;}
  btn.disabled=true; btn.textContent='‚úçÔ∏è Generating...';
  out.textContent = '‚è≥ AI sedang menulis...';
  const lenMap = {short:'singkat (100-200 kata)',medium:'sedang (300-500 kata)',long:'panjang (600-900 kata)'};
  const typeMap = {email:'email profesional',caption:'caption media sosial',essay:'essay/artikel informatif',cover:'cover letter',bio:'bio profil',pitch:'pitch produk',story:'cerita pendek',custom:'konten sesuai instruksi'};
  const langMap = {id:'Bahasa Indonesia',en:'English',mixed:'campuran Indonesia dan English'};
  const sys = `Kamu adalah penulis profesional handal. Tulis ${typeMap[type]} dengan tone ${tone}, dalam ${langMap[lang]}, panjang ${lenMap[awCurrentLen]}. Langsung tulis kontennya tanpa intro seperti "Tentu saja" atau "Berikut adalah". Output langsung konten yang diminta.`;
  try {
    const result = await awCallClaude(sys, prompt);
    out.textContent = result;
  } catch(e) { out.textContent = '‚ùå Error: '+e.message; }
  btn.disabled=false; btn.textContent='‚úçÔ∏è Generate Sekarang';
}
async function awImprove() {
  const out = document.getElementById('aw-out');
  const current = out.textContent;
  if(!current||current.startsWith('‚è≥')||current.startsWith('‚Äî')) {showNotif('‚ö†Ô∏è Generate dulu teksnya!'); return;}
  out.textContent = '‚è≥ Memperbaiki...';
  try {
    const result = await awCallClaude('Kamu editor profesional. Improve teks berikut: perbaiki grammar, buat lebih engaging, pertahankan maksud asli. Output langsung teks yang sudah diperbaiki.', current);
    out.textContent = result;
  } catch(e) { out.textContent = current; showNotif('‚ùå Error: '+e.message); }
}
async function awShorten() {
  const out = document.getElementById('aw-out');
  const current = out.textContent;
  if(!current||current.startsWith('‚è≥')) {showNotif('‚ö†Ô∏è Generate dulu!'); return;}
  out.textContent = '‚è≥ Mempersingkat...';
  try {
    const result = await awCallClaude('Persingkat teks ini hingga 50% lebih pendek tanpa kehilangan poin utama. Output langsung teksnya.', current);
    out.textContent = result;
  } catch(e) { out.textContent = current; }
}
async function awExpand() {
  const out = document.getElementById('aw-out');
  const current = out.textContent;
  if(!current||current.startsWith('‚è≥')) {showNotif('‚ö†Ô∏è Generate dulu!'); return;}
  out.textContent = '‚è≥ Mengembangkan...';
  try {
    const result = await awCallClaude('Kembangkan teks ini menjadi dua kali lebih panjang dengan detail, contoh, dan penjelasan tambahan yang relevan. Output langsung teksnya.', current);
    out.textContent = result;
  } catch(e) { out.textContent = current; }
}
awInitQuick();

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üêõ AI CODE REVIEWER                                         ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
async function acrReview() {
  const code = document.getElementById('acr-code')?.value;
  const lang = document.getElementById('acr-lang')?.value;
  const focus = document.getElementById('acr-focus')?.value;
  const out = document.getElementById('acr-out');
  const btn = document.getElementById('acr-btn');
  if(!code?.trim()){showNotif('‚ö†Ô∏è Paste kode dulu!');return;}
  btn.disabled=true; btn.textContent='üîç Reviewing...';
  out.textContent='‚è≥ AI sedang menganalisis kode...';
  const focusMap = {all:'review lengkap (bug, security, performance, readability)',bugs:'hanya bug dan error',security:'kerentanan keamanan',performance:'optimasi performa',style:'code style dan naming convention',refactor:'peluang refactoring'};
  const sys = `Kamu senior software engineer berpengalaman. Review kode ${lang==='auto'?'(deteksi bahasa otomatis)':lang} berikut dengan fokus ${focusMap[focus]}.

Format response:
## üìä Summary
[ringkasan singkat kualitas kode]

## üêõ Issues Ditemukan
[list masalah dengan severity: üî¥ Critical / üü† Major / üü° Minor]

## üí° Saran Perbaikan
[saran konkret dengan contoh kode jika perlu]

## ‚úÖ Yang Sudah Baik
[poin positif dari kode]

## ‚≠ê Overall Score
[skor 1-10 dengan alasan]

Jawab dalam Bahasa Indonesia.`;
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:2000, system:sys, messages:[{role:'user', content:'Review kode ini:\n\n```\n'+code+'\n```'}]})
    });
    const data = await res.json();
    out.textContent = data?.content?.[0]?.text || 'Tidak ada respon.';
  } catch(e) { out.textContent = '‚ùå Error: '+e.message; }
  btn.disabled=false; btn.textContent='üîç Review Kode';
}
async function acrFixCode() {
  const code = document.getElementById('acr-code')?.value;
  if(!code?.trim()){showNotif('‚ö†Ô∏è Paste kode dulu!');return;}
  const out = document.getElementById('acr-out');
  out.textContent='‚è≥ AI sedang memperbaiki kode...';
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:2000,
        system:'Kamu expert programmer. Perbaiki semua bug dan masalah dalam kode ini. Jelaskan perubahan yang kamu buat. Format: [Perubahan] di atas, lalu kode yang sudah diperbaiki dalam code block.',
        messages:[{role:'user', content:'Perbaiki kode ini:\n\n```\n'+code+'\n```'}]})
    });
    const data = await res.json();
    out.textContent = data?.content?.[0]?.text || 'Tidak ada respon.';
  } catch(e) { out.textContent = '‚ùå Error: '+e.message; }
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üåê AI TRANSLATOR PRO                                        ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
function atpSwap() {
  const f = document.getElementById('atp-from');
  const t = document.getElementById('atp-to');
  if(f.value==='auto') return;
  const tmp = f.value; f.value = t.value; t.value = tmp;
}
async function atpTranslate() {
  const text = document.getElementById('atp-input')?.value;
  const from = document.getElementById('atp-from')?.value;
  const to = document.getElementById('atp-to')?.value;
  const culture = document.getElementById('atp-culture')?.checked;
  const idiom = document.getElementById('atp-idiom')?.checked;
  const formal = document.getElementById('atp-formal')?.checked;
  const out = document.getElementById('atp-output');
  const btn = document.getElementById('atp-btn');
  if(!text?.trim()){showNotif('‚ö†Ô∏è Masukkan teks!');return;}
  btn.disabled=true; btn.textContent='üåê Translating...';
  out.textContent='‚è≥ AI sedang menerjemah...';
  const extras = [culture&&'nuansa budaya & konteks', idiom&&'alternatif idiom & ungkapan', formal&&'versi formal dan informal'].filter(Boolean).join(', ');
  const sys = `Kamu penerjemah profesional dan ahli budaya. Terjemahkan teks dari ${from==='auto'?'bahasa otomatis terdeteksi':from} ke ${to}.
Format response:
## üåê Terjemahan
[terjemahan utama]
${culture?'\n## üèÆ Nuansa Budaya\n[penjelasan konteks budaya]':''}
${idiom?'\n## üí¨ Idiom & Alternatif\n[idiom/ungkapan setara]':''}
${formal?'\n## üìã Formal vs Informal\n[kedua versi]':''}
## üìù Catatan Penerjemah
[catatan penting jika ada]`;
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:1500, system:sys, messages:[{role:'user',content:text}]})
    });
    const data = await res.json();
    out.textContent = data?.content?.[0]?.text || 'Tidak ada respon.';
  } catch(e) { out.textContent='‚ùå Error: '+e.message; }
  btn.disabled=false; btn.textContent='üåê Terjemahkan';
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üéØ AI GOAL PLANNER                                          ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
async function agPlan() {
  const goal = document.getElementById('ag-goal')?.value;
  const duration = document.getElementById('ag-duration')?.value||'30';
  const level = document.getElementById('ag-level')?.value||'beginner';
  const time = document.getElementById('ag-time')?.value||'1';
  const out = document.getElementById('ag-out');
  const btn = document.getElementById('ag-btn');
  if(!goal?.trim()){showNotif('‚ö†Ô∏è Masukkan goal dulu!');return;}
  btn.disabled=true; btn.textContent='üéØ Generating...';
  out.textContent='‚è≥ AI sedang membuat rencana...';
  const sys = `Kamu life coach dan productivity expert. Buat rencana belajar/pencapaian yang detail dan realistis.

Format response:
## üéØ Goal Analysis
[analisis goal dan kelayakannya]

## üìÖ Rencana ${duration} Hari
### Minggu 1-2: Fondasi
[rencana detail]
### Minggu 3-4: Pengembangan
[rencana detail]
[dst...]

## ‚úÖ Checklist Harian
[daftar kegiatan harian yang bisa ditandai]

## üõ†Ô∏è Resources yang Dibutuhkan
[tools, buku, platform belajar]

## ‚ö†Ô∏è Tantangan & Solusi
[potensi hambatan dan cara mengatasinya]

## üìä Milestone & Cara Ukur Progress
[cara tahu kamu sudah maju]

Jawab dalam Bahasa Indonesia. Level peserta: ${level}. Waktu tersedia: ${time} jam/hari.`;
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:2500, system:sys, messages:[{role:'user',content:'Tolong buatkan rencana untuk goal saya: '+goal}]})
    });
    const data = await res.json();
    out.textContent = data?.content?.[0]?.text || 'Tidak ada respon.';
  } catch(e) { out.textContent='‚ùå Error: '+e.message; }
  btn.disabled=false; btn.textContent='üéØ Buat Rencana';
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üìà EXPENSE TRACKER                                          ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let etData = JSON.parse(localStorage.getItem('tb-expenses')||'[]');
const ET_CATS = {food:'üçú Makan',transport:'üöó Transport',shopping:'üõçÔ∏è Belanja',health:'üíä Kesehatan',entertainment:'üéÆ Hiburan',bills:'üí° Tagihan',education:'üìö Pendidikan',other:'üì¶ Lainnya'};
function etSave() { localStorage.setItem('tb-expenses', JSON.stringify(etData)); }
function etAdd() {
  const title = document.getElementById('et-title')?.value;
  const amount = parseFloat(document.getElementById('et-amount')?.value);
  const cat = document.getElementById('et-cat')?.value||'other';
  const date = document.getElementById('et-date')?.value||new Date().toISOString().split('T')[0];
  const type = document.getElementById('et-type')?.value||'expense';
  if(!title?.trim()||!amount||isNaN(amount)){showNotif('‚ö†Ô∏è Isi nama dan nominal!');return;}
  etData.unshift({id:Date.now(), title, amount, cat, date, type});
  etSave(); etRender();
  document.getElementById('et-title').value='';
  document.getElementById('et-amount').value='';
  showNotif('‚úÖ Transaksi ditambahkan!');
}
function etDelete(id) { etData = etData.filter(e=>e.id!==id); etSave(); etRender(); }
function etRender() {
  const list = document.getElementById('et-list'); if(!list) return;
  const filter = document.getElementById('et-filter')?.value||'all';
  const search = document.getElementById('et-search')?.value?.toLowerCase()||'';
  let data = etData.filter(e=>{
    if(filter!=='all'&&e.cat!==filter) return false;
    if(search&&!e.title.toLowerCase().includes(search)) return false;
    return true;
  });
  const income = data.filter(e=>e.type==='income').reduce((a,e)=>a+e.amount,0);
  const expense = data.filter(e=>e.type==='expense').reduce((a,e)=>a+e.amount,0);
  const balance = income - expense;
  const fmt = n => 'Rp '+n.toLocaleString('id-ID');
  const summaryEl = document.getElementById('et-summary');
  if(summaryEl) summaryEl.innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;">
      <div style="background:rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.3);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-size:0.62rem;color:var(--muted);">PEMASUKAN</div>
        <div style="color:#10b981;font-weight:700;font-size:0.9rem;">${fmt(income)}</div>
      </div>
      <div style="background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.3);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-size:0.62rem;color:var(--muted);">PENGELUARAN</div>
        <div style="color:#ef4444;font-weight:700;font-size:0.9rem;">${fmt(expense)}</div>
      </div>
      <div style="background:rgba(124,58,237,0.12);border:1px solid rgba(124,58,237,0.3);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-size:0.62rem;color:var(--muted);">SALDO</div>
        <div style="color:${balance>=0?'#10b981':'#ef4444'};font-weight:700;font-size:0.9rem;">${fmt(balance)}</div>
      </div>
    </div>`;
  etRenderChart(data);
  list.innerHTML = data.length ? data.map(e=>`
    <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;margin-bottom:6px;">
      <div style="font-size:1.2rem;">${ET_CATS[e.cat]?.split(' ')[0]||'üì¶'}</div>
      <div style="flex:1;">
        <div style="font-size:0.8rem;font-weight:600;">${e.title}</div>
        <div style="font-size:0.65rem;color:var(--muted);">${ET_CATS[e.cat]?.split(' ').slice(1).join(' ')} ¬∑ ${e.date}</div>
      </div>
      <div style="font-weight:700;color:${e.type==='income'?'#10b981':'#ef4444'};font-size:0.88rem;">${e.type==='income'?'+':'-'}${fmt(e.amount)}</div>
      <button onclick="etDelete(${e.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;padding:4px;">‚úï</button>
    </div>`).join('')
  : '<div style="text-align:center;color:var(--muted);padding:30px;font-size:0.78rem;">Belum ada transaksi</div>';
}
function etRenderChart(data) {
  const canvas = document.getElementById('et-chart'); if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const catTotals = {};
  data.filter(e=>e.type==='expense').forEach(e=>{ catTotals[e.cat]=(catTotals[e.cat]||0)+e.amount; });
  const cats = Object.keys(catTotals); if(!cats.length){ctx.clearRect(0,0,canvas.width,canvas.height);return;}
  const total = Object.values(catTotals).reduce((a,b)=>a+b,0);
  const W = canvas.width, H = canvas.height, cx = W/2, cy = H/2, r = Math.min(cx,cy)-20;
  const colors = ['#7c3aed','#06b6d4','#10b981','#f59e0b','#ef4444','#ec4899','#8b5cf6','#0ea5e9'];
  ctx.clearRect(0,0,W,H);
  let angle = -Math.PI/2;
  cats.forEach((cat,i)=>{
    const slice = (catTotals[cat]/total)*(Math.PI*2);
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,angle,angle+slice);
    ctx.fillStyle = colors[i%colors.length]; ctx.fill();
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,angle,angle+slice);
    ctx.strokeStyle='rgba(0,0,0,0.3)'; ctx.lineWidth=2; ctx.stroke();
    const mid = angle+slice/2;
    const tx = cx+Math.cos(mid)*(r*0.65), ty = cy+Math.sin(mid)*(r*0.65);
    ctx.fillStyle='#fff'; ctx.font='bold 10px Space Mono,monospace'; ctx.textAlign='center';
    if(slice>0.2) ctx.fillText(Math.round(catTotals[cat]/total*100)+'%', tx, ty+4);
    angle += slice;
  });
  ctx.beginPath(); ctx.arc(cx,cy,r*0.42,0,Math.PI*2); ctx.fillStyle='var(--surface)'; ctx.fill();
  ctx.fillStyle='var(--text)'; ctx.font='bold 11px Space Mono,monospace'; ctx.textAlign='center';
  ctx.fillText('Pengeluaran', cx, cy-4); ctx.fillText('per Kategori', cx, cy+12);
}
function etExportCSV() {
  const rows = [['Tanggal','Judul','Kategori','Tipe','Nominal'],...etData.map(e=>[e.date,e.title,ET_CATS[e.cat],e.type,e.amount])];
  const csv = rows.map(r=>r.join(',')).join('\n');
  const a = document.createElement('a'); a.href = 'data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download = 'expenses.csv'; a.click(); showNotif('üì§ Exported ke CSV!');
}
etRender();

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üîÑ API TESTER                                               ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let atHistory = [];
function atAddHeader() {
  const wrap = document.getElementById('at-headers-wrap'); if(!wrap) return;
  const row = document.createElement('div');
  row.style.cssText='display:flex;gap:4px;margin-bottom:4px;';
  row.innerHTML=`<input placeholder="Key" style="flex:1;font-size:0.75rem;"><input placeholder="Value" style="flex:2;font-size:0.75rem;"><button onclick="this.parentElement.remove()" style="background:none;border:1px solid var(--border);color:var(--muted);cursor:pointer;padding:4px 8px;border-radius:6px;font-size:0.7rem;">‚úï</button>`;
  wrap.appendChild(row);
}
async function atSend() {
  const method = document.getElementById('at-method')?.value||'GET';
  const url = document.getElementById('at-url')?.value;
  const body = document.getElementById('at-body')?.value;
  const resEl = document.getElementById('at-response');
  const statusEl = document.getElementById('at-status');
  const infoEl = document.getElementById('at-info');
  const btn = document.getElementById('at-send-btn');
  if(!url?.trim()){showNotif('‚ö†Ô∏è Masukkan URL!');return;}
  btn.disabled=true; btn.textContent='‚è≥ Sending...';
  if(resEl) resEl.textContent='‚è≥ Sending request...';
  const headers = {'Content-Type':'application/json'};
  document.getElementById('at-headers-wrap')?.querySelectorAll('div').forEach(row=>{
    const inputs = row.querySelectorAll('input');
    if(inputs[0]?.value&&inputs[1]?.value) headers[inputs[0].value]=inputs[1].value;
  });
  const start = Date.now();
  try {
    const opts = {method, headers};
    if(!['GET','HEAD'].includes(method)&&body?.trim()) {
      try{opts.body=JSON.stringify(JSON.parse(body));}catch{opts.body=body;}
    }
    const res = await fetch(url, opts);
    const time = Date.now()-start;
    const contentType = res.headers.get('content-type')||'';
    let responseBody;
    if(contentType.includes('json')) {
      const json = await res.json();
      responseBody = JSON.stringify(json, null, 2);
    } else { responseBody = await res.text(); }
    if(statusEl) { statusEl.textContent=`${res.status} ${res.statusText}`; statusEl.style.color=res.ok?'#10b981':'#ef4444'; }
    if(infoEl) infoEl.textContent=`${time}ms ¬∑ ${contentType||'unknown'}`;
    if(resEl) resEl.textContent = responseBody;
    atHistory.unshift({method,url,status:res.status,time,ts:new Date().toLocaleTimeString('id-ID')});
    atRenderHistory();
  } catch(e) {
    if(statusEl){statusEl.textContent='Error';statusEl.style.color='#ef4444';}
    if(resEl) resEl.textContent='‚ùå Error: '+e.message+'\n\n(CORS atau URL tidak valid)';
  }
  btn.disabled=false; btn.textContent='‚ñ∂ Send';
}
function atRenderHistory() {
  const wrap = document.getElementById('at-history'); if(!wrap) return;
  wrap.innerHTML = atHistory.slice(0,10).map((h,i)=>`
    <div style="font-size:0.68rem;padding:5px 8px;background:var(--bg);border-radius:6px;margin-bottom:4px;cursor:pointer;border:1px solid var(--border);" onclick="atLoadHistory(${i})">
      <span style="color:${['GET','HEAD'].includes(h.method)?'#06b6d4':h.method==='POST'?'#10b981':h.method==='DELETE'?'#ef4444':'#f59e0b'};font-weight:700;">${h.method}</span>
      <span style="color:var(--muted);margin:0 6px;">${h.ts}</span>
      <span style="color:${h.status<400?'#10b981':'#ef4444'};">${h.status}</span>
      <span style="color:var(--muted);margin-left:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;display:inline-block;vertical-align:bottom;">${h.url}</span>
    </div>`).join('');
}
function atLoadHistory(i) {
  const h = atHistory[i]; if(!h) return;
  document.getElementById('at-method').value = h.method;
  document.getElementById('at-url').value = h.url;
}
function atFormatJSON() {
  const el = document.getElementById('at-body'); if(!el) return;
  try { el.value = JSON.stringify(JSON.parse(el.value), null, 2); } catch(e) { showNotif('‚ùå JSON tidak valid!'); }
}

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üéµ PLAYLIST MAKER                                           ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let plData = JSON.parse(localStorage.getItem('tb-playlist')||'[]');
let plFilter_active = 'all';
let plTimerInterval = null;
function plSave() { localStorage.setItem('tb-playlist', JSON.stringify(plData)); }
function plAdd() {
  const title = document.getElementById('pl-title')?.value;
  const artist = document.getElementById('pl-artist')?.value;
  const dur = parseInt(document.getElementById('pl-dur')?.value)||0;
  const mood = document.getElementById('pl-mood')?.value||'focus';
  const url = document.getElementById('pl-url')?.value;
  if(!title?.trim()){showNotif('‚ö†Ô∏è Isi judul lagu!');return;}
  plData.push({id:Date.now(), title, artist, dur, mood, url});
  plSave(); plRender();
  ['pl-title','pl-artist','pl-dur','pl-url'].forEach(id=>{ const el=document.getElementById(id); if(el)el.value=''; });
  showNotif('üéµ Lagu ditambahkan!');
}
function plDelete(id) { plData=plData.filter(p=>p.id!==id); plSave(); plRender(); }
function plFilter(mood) {
  plFilter_active = mood;
  document.querySelectorAll('[onclick^="plFilter"]').forEach(b=>b.className='btn btn-secondary');
  event.target.className='btn btn-primary';
  plRender();
}
function plRender() {
  const list = document.getElementById('pl-list');
  const empty = document.getElementById('pl-empty');
  const count = document.getElementById('pl-count');
  const totalDur = document.getElementById('pl-total-dur');
  if(!list) return;
  const data = plFilter_active==='all' ? plData : plData.filter(p=>p.mood===plFilter_active);
  const durSec = data.reduce((a,p)=>a+p.dur,0);
  const durStr = durSec ? Math.floor(durSec/60)+'m '+durSec%60+'s' : '';
  if(count) count.textContent = data.length;
  if(totalDur) totalDur.textContent = durStr ? '‚è±Ô∏è '+durStr : '';
  const moodIcons = {focus:'üéØ',chill:'üòå',energy:'‚ö°',sad:'üòî',happy:'üòÑ',sleep:'üåô'};
  if(!data.length) { list.innerHTML=''; if(empty) empty.style.display='block'; return; }
  if(empty) empty.style.display='none';
  list.innerHTML = data.map(p=>`
    <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;">
      <div style="font-size:1.3rem;">${moodIcons[p.mood]||'üéµ'}</div>
      <div style="flex:1;min-width:0;">
        <div style="font-size:0.82rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${p.title}</div>
        <div style="font-size:0.65rem;color:var(--muted);">${p.artist||'Unknown'} ${p.dur?'¬∑ '+Math.floor(p.dur/60)+':'+String(p.dur%60).padStart(2,'0'):''}</div>
      </div>
      ${p.url?`<a href="${p.url}" target="_blank" style="color:var(--accent2);font-size:0.7rem;text-decoration:none;padding:4px 8px;border:1px solid var(--border);border-radius:6px;">‚ñ∂</a>`:''}
      <button onclick="plDelete(${p.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.75rem;">‚úï</button>
    </div>`).join('');
}
function plStartTimer() {
  const btn = document.getElementById('pl-timer-btn');
  const display = document.getElementById('pl-timer-display');
  if(plTimerInterval) { clearInterval(plTimerInterval); plTimerInterval=null; if(btn)btn.textContent='‚ñ∂ Mulai'; if(display)display.textContent=''; return; }
  const mins = parseInt(document.getElementById('pl-timer-min')?.value)||25;
  let secs = mins*60;
  if(btn) btn.textContent='‚è∏ Stop';
  const tick = ()=>{
    const m=Math.floor(secs/60), s=secs%60;
    if(display) display.textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    if(secs<=0){clearInterval(plTimerInterval);plTimerInterval=null;if(btn)btn.textContent='‚ñ∂ Mulai';if(display)display.textContent='‚úÖ Selesai!';showNotif('‚è∞ Timer musik selesai!');try{const a=new AudioContext();const o=a.createOscillator();const g=a.createGain();o.connect(g);g.connect(a.destination);o.frequency.value=523;g.gain.setValueAtTime(0.3,a.currentTime);g.gain.exponentialRampToValueAtTime(0.001,a.currentTime+0.8);o.start();o.stop(a.currentTime+0.8);}catch(e){}}
    secs--;
  };
  tick(); plTimerInterval=setInterval(tick,1000);
}
function plExport() {
  const blob = new Blob([JSON.stringify(plData,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='playlist.json'; a.click();
  showNotif('üì§ Playlist exported!');
}
function plClear() { if(confirm('Hapus semua lagu?')){plData=[];plSave();plRender();} }
plRender();

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  üóìÔ∏è WEEKLY PLANNER                                           ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
let wpTasks = JSON.parse(localStorage.getItem('tb-wp-tasks')||'{}');
let wpCurrentWeekOffset = 0;
let wpAddDay = null;
const WP_DAYS = ['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'];
function wpSaveTasks() { localStorage.setItem('tb-wp-tasks', JSON.stringify(wpTasks)); }
function wpGetWeekDates(offset=0) {
  const now = new Date();
  const day = now.getDay();
  const diff = (day===0?-6:1-day) + offset*7;
  const monday = new Date(now); monday.setDate(now.getDate()+diff);
  return WP_DAYS.map((_,i)=>{ const d=new Date(monday); d.setDate(monday.getDate()+i); return d; });
}
function wpDateKey(d) { return d.toISOString().split('T')[0]; }
function wpRender() {
  const grid = document.getElementById('wp-grid'); if(!grid) return;
  const dates = wpGetWeekDates(wpCurrentWeekOffset);
  const label = document.getElementById('wp-week-label');
  if(label) label.textContent = dates[0].toLocaleDateString('id-ID',{day:'numeric',month:'short'}) + ' ‚Äì ' + dates[6].toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'});
  const today = wpDateKey(new Date());
  grid.innerHTML = dates.map((d,i)=>{
    const key = wpDateKey(d);
    const tasks = wpTasks[key]||[];
    const isToday = key===today;
    return `<div style="background:var(--surface);border:1px solid ${isToday?'var(--accent)':'var(--border)'};border-radius:10px;padding:10px;min-height:120px;${isToday?'box-shadow:0 0 12px rgba(124,58,237,0.25);':''}">
      <div style="font-size:0.65rem;color:${isToday?'var(--accent)':'var(--muted)'};font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">${WP_DAYS[i]}<br><span style="font-size:0.62rem;font-weight:400;">${d.getDate()}/${d.getMonth()+1}</span></div>
      <div style="display:flex;flex-direction:column;gap:4px;margin-bottom:6px;">
        ${tasks.map(t=>`<div style="background:${t.color||'var(--accent)'}22;border-left:2px solid ${t.color||'var(--accent)'};border-radius:4px;padding:4px 6px;cursor:pointer;font-size:0.68rem;" onclick="wpEditTask('${key}',${t.id})">
          <div style="font-weight:600;">${t.time?t.time+' ':''}${t.title}</div>
          ${t.note?`<div style="color:var(--muted);font-size:0.6rem;margin-top:1px;">${t.note}</div>`:''}
        </div>`).join('')}
      </div>
      <button onclick="wpOpenAdd('${key}')" style="width:100%;background:none;border:1px dashed var(--border);color:var(--muted);border-radius:6px;padding:4px;cursor:pointer;font-size:0.65rem;transition:all 0.2s;">+ Tugas</button>
    </div>`;
  }).join('');
}
function wpOpenAdd(key) {
  wpAddDay = key;
  const form = document.getElementById('wp-add-form');
  const dayLabel = document.getElementById('wp-form-day');
  if(!form) return;
  const d = new Date(key);
  if(dayLabel) dayLabel.textContent = `Tambah Tugas ‚Äî ${d.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long'})}`;
  document.getElementById('wp-task-title').value='';
  document.getElementById('wp-task-time').value='';
  document.getElementById('wp-task-note').value='';
  form.style.display='flex';
}
function wpEditTask(key, id) {
  const task = (wpTasks[key]||[]).find(t=>t.id===id); if(!task) return;
  wpAddDay = key;
  const form = document.getElementById('wp-add-form');
  document.getElementById('wp-task-title').value = task.title;
  document.getElementById('wp-task-time').value = task.time||'';
  document.getElementById('wp-task-color').value = task.color||'#7c3aed';
  document.getElementById('wp-task-note').value = task.note||'';
  form._editId = id;
  form.style.display='flex';
}
function wpSaveTask() {
  const title = document.getElementById('wp-task-title')?.value;
  const time = document.getElementById('wp-task-time')?.value;
  const color = document.getElementById('wp-task-color')?.value;
  const note = document.getElementById('wp-task-note')?.value;
  const form = document.getElementById('wp-add-form');
  if(!title?.trim()||!wpAddDay){showNotif('‚ö†Ô∏è Isi judul tugas!');return;}
  if(!wpTasks[wpAddDay]) wpTasks[wpAddDay]=[];
  if(form?._editId) {
    const idx = wpTasks[wpAddDay].findIndex(t=>t.id===form._editId);
    if(idx>-1) wpTasks[wpAddDay][idx] = {id:form._editId, title,time,color,note};
    form._editId=null;
  } else {
    wpTasks[wpAddDay].push({id:Date.now(), title, time, color, note});
  }
  wpSaveTasks(); wpRender();
  form.style.display='none';
  showNotif('‚úÖ Tugas disimpan!');
}
function wpDeleteTask(key,id) {
  if(wpTasks[key]) { wpTasks[key]=wpTasks[key].filter(t=>t.id!==id); wpSaveTasks(); wpRender(); }
  document.getElementById('wp-add-form').style.display='none';
}
function wpPrevWeek() { wpCurrentWeekOffset--; wpRender(); }
function wpNextWeek() { wpCurrentWeekOffset++; wpRender(); }
function wpThisWeek() { wpCurrentWeekOffset=0; wpRender(); }
function wpExport() {
  const blob = new Blob([JSON.stringify(wpTasks,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='weekly_planner.json'; a.click();
  showNotif('üì§ Weekly Planner exported!');
}
function wpClear() { if(confirm('Hapus semua tugas minggu ini?')){const dates=wpGetWeekDates(wpCurrentWeekOffset);dates.forEach(d=>{delete wpTasks[wpDateKey(d)];});wpSaveTasks();wpRender();} }
wpRender();

// Tab switch initialization handled by existing sw() wrapper

// Add new bug checks for new features
if (typeof BUG_CHECKS !== 'undefined') {
  BUG_CHECKS.push(
    {id:'image-editor',name:'Image Editor',check:()=>{if(!document.getElementById('ie-canvas'))return{ok:false,msg:'Canvas ie-canvas tidak ada!'};if(typeof ieLoad!=='function')return{ok:false,msg:'Fungsi ieLoad tidak ada!'};return{ok:true,msg:'Image Editor OK ‚úì'};},fix:()=>{}},
    {id:'resume-builder',name:'Resume Builder',check:()=>{if(!document.getElementById('rv-preview'))return{ok:false,msg:'rv-preview tidak ada!'};if(typeof rvPreview!=='function')return{ok:false,msg:'Fungsi rvPreview tidak ada!'};return{ok:true,msg:'Resume Builder OK ‚úì'};},fix:()=>{}},
    {id:'bio-link',name:'Bio Link Page',check:()=>{if(typeof blPreview!=='function')return{ok:false,msg:'Fungsi blPreview tidak ada!'};return{ok:true,msg:'Bio Link OK ‚úì'};},fix:()=>{}},
    {id:'svg-editor',name:'SVG Editor',check:()=>{if(!document.getElementById('svg-canvas'))return{ok:false,msg:'svg-canvas tidak ada!'};if(typeof svgSetTool!=='function')return{ok:false,msg:'Fungsi svgSetTool tidak ada!'};return{ok:true,msg:'SVG Editor OK ‚úì'};},fix:()=>{}},
    {id:'ai-writing',name:'AI Writing Assistant',check:()=>{if(typeof awGenerate!=='function')return{ok:false,msg:'Fungsi awGenerate tidak ada!'};return{ok:true,msg:'AI Writing OK ‚úì'};},fix:()=>{}},
    {id:'ai-code-reviewer',name:'AI Code Reviewer',check:()=>{if(typeof acrReview!=='function')return{ok:false,msg:'Fungsi acrReview tidak ada!'};return{ok:true,msg:'AI Code Reviewer OK ‚úì'};},fix:()=>{}},
    {id:'ai-translator-pro',name:'AI Translator Pro',check:()=>{if(typeof atpTranslate!=='function')return{ok:false,msg:'Fungsi atpTranslate tidak ada!'};return{ok:true,msg:'AI Translator Pro OK ‚úì'};},fix:()=>{}},
    {id:'ai-goal-planner',name:'AI Goal Planner',check:()=>{if(typeof agPlan!=='function')return{ok:false,msg:'Fungsi agPlan tidak ada!'};return{ok:true,msg:'AI Goal Planner OK ‚úì'};},fix:()=>{}},
    {id:'expense-tracker',name:'Expense Tracker',check:()=>{if(typeof etAdd!=='function')return{ok:false,msg:'Fungsi etAdd tidak ada!'};return{ok:true,msg:'Expense Tracker OK ‚úì'};},fix:()=>etData=etData||[]},
    {id:'api-tester',name:'API Tester',check:()=>{if(typeof atSend!=='function')return{ok:false,msg:'Fungsi atSend tidak ada!'};return{ok:true,msg:'API Tester OK ‚úì'};},fix:()=>{}},
    {id:'playlist-maker',name:'Playlist Maker',check:()=>{if(typeof plAdd!=='function')return{ok:false,msg:'Fungsi plAdd tidak ada!'};return{ok:true,msg:'Playlist Maker OK ‚úì'};},fix:()=>{}},
    {id:'weekly-planner',name:'Weekly Planner',check:()=>{if(typeof wpRender!=='function')return{ok:false,msg:'Fungsi wpRender tidak ada!'};return{ok:true,msg:'Weekly Planner OK ‚úì'};},fix:()=>{}},
    {id:'hyprland-ui',name:'Hyprland UI System',check:()=>{if(!document.getElementById('hy-topbar'))return{ok:false,msg:'Topbar hy-topbar tidak ada!'};if(!document.getElementById('hy-nav-menu'))return{ok:false,msg:'Nav menu tidak ada!'};if(typeof hyToggleMenu!=='function')return{ok:false,msg:'Fungsi hyToggleMenu tidak ada!'};return{ok:true,msg:'Hyprland UI OK ‚úì'};},fix:()=>{}},
    {id:'widget-clock',name:'Clock Widget',check:()=>{if(!document.getElementById('hy-clock-widget'))return{ok:false,msg:'Clock widget tidak ada!'};if(typeof hyClockStart!=='function')return{ok:false,msg:'Fungsi hyClockStart tidak ada!'};return{ok:true,msg:'Clock Widget OK ‚úì'};},fix:()=>hyClockStart()},
    {id:'widget-weather',name:'Weather Widget',check:()=>{if(!document.getElementById('hy-weather-widget'))return{ok:false,msg:'Weather widget tidak ada!'};if(typeof hyFetchWeather!=='function')return{ok:false,msg:'Fungsi hyFetchWeather tidak ada!'};return{ok:true,msg:'Weather Widget OK ‚úì'};},fix:()=>hyFetchWeather(hyWeatherCity)}
  );
}

</script>
</body>
</html>